<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ¨èç³»ç»Ÿä¸ä¿¡æ¯æ£€ç´¢å…¥é—¨</title>
      <link href="/2020/05/12/rec-sys-notes/"/>
      <url>/2020/05/12/rec-sys-notes/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¨èç³»ç»Ÿä¸ä¿¡æ¯æ£€ç´¢å…¥é—¨"><a href="#æ¨èç³»ç»Ÿä¸ä¿¡æ¯æ£€ç´¢å…¥é—¨" class="headerlink" title="æ¨èç³»ç»Ÿä¸ä¿¡æ¯æ£€ç´¢å…¥é—¨"></a>æ¨èç³»ç»Ÿä¸ä¿¡æ¯æ£€ç´¢å…¥é—¨</h1><h2 id="å­¦ä¹ æ’åºæ–¹æ³•"><a href="#å­¦ä¹ æ’åºæ–¹æ³•" class="headerlink" title="å­¦ä¹ æ’åºæ–¹æ³•"></a>å­¦ä¹ æ’åºæ–¹æ³•</h2><h3 id="Pointwise"><a href="#Pointwise" class="headerlink" title="Pointwise"></a>Pointwise</h3><ul><li>é¢„æµ‹ç»å¯¹ç›¸å…³åº¦ (æ¯”å¦‚ RMSE), æ˜¯é¢„æµ‹ä¸“å®¶ç³»ç»Ÿ, äººä¸ºåœ°ç»™å®šç›¸å…³åº¦è¯„ä¼°, æå–ä¸€ç³»åˆ—çš„ç‰¹å¾, å½“åš<code>å›å½’é—®é¢˜</code>å¤„ç†.</li><li>å­˜åœ¨çš„é—®é¢˜: å•ç‚¹ç²¾åº¦ $\ne$ æ’åºç²¾åº¦, åœ¨ $(\hat{y}-y)^2$ ç›¸åŒçš„æƒ…å†µä¸‹, æ’åºé¡ºåºå¯èƒ½å‘ç”Ÿå˜åŒ–.</li></ul><h3 id="Pairwise"><a href="#Pairwise" class="headerlink" title="Pairwise"></a>Pairwise</h3><ul><li>ä¸å…³å¿ƒç»å¯¹ç›¸å…³æ€§, å…³æ³¨æ–‡æ¡£çš„ç›¸å¯¹åå¥½, è½¬åŒ–ä¸ºä¸€ç³»åˆ—<code>äºŒåˆ†ç±»é—®é¢˜</code>. å»ºç«‹ RankNet</li><li>æ¯ä¸ªæ–‡æ¡£çš„ç›¸å¯¹çš„ç›®æ ‡æ¦‚ç‡<script type="math/tex; mode=display">y_{i, j}=f(x)=\left\{\begin{array}{lr}1, & \text { if } iæ’åœ¨jå‰ \\0, & \text { otherwise }\end{array}\right.</script>i æ’åœ¨ j å‰é¢åˆ™ä¸º 1, å¦åˆ™ä¸º 0.<br>ä½¿ç”¨ sigmoid æ„é€ é€»è¾‘å›å½’ â€”-&gt; ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ä½œä¸º loss â€”-&gt; è®¡ç®—æ¢¯åº¦ â€”-&gt; åœ¨ç¥ç»ç½‘ç»œä¸­ BP<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/EVvyXZgjtsnaM4k.png" alt="Pairwise"></li><li>æ’åºè¯„ä¼°æŒ‡æ ‡:<br>æŸ¥è¯¢ q çš„æ ‡å‡†æŠ˜æ‰£ç´¯ç§¯å¢ç›Š (NDGC@k)<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/PpWRifaGJ3koHZ7.png" alt="NDGC"></li><li>ç¼ºç‚¹: å¯¹äºæœç´¢å¼•æ“, æ’åœ¨å‰åˆ—çš„æ–‡æ¡£æ˜¯å¦æ’åºæ­£ç¡®, æ›´ä¸ºé‡è¦. å„ä¸ªæ–‡æ¡£ä¹‹é—´ç›¸å…³æ€§æ’åºæ˜¯å¦æ­£ç¡®çš„é‡è¦æ€§ä¸åŒ. ç›¸åŒçš„æ’åº pair é”™è¯¯, å³ä¸¤å¯¹æ’åºäº¤å‰ç†µç›¸åŒ, ä½†å¯¹äºæ•´ä¸ªæ’åºåˆ—çš„å½±å“ä¸åŒ. æ¯”å¦‚ &lt; 1, 6 &gt; å’Œ &lt; 3, 4 &gt; æ’åºé”™è¯¯çš„å½±å“ä¸åŒ.</li></ul><h3 id="Listwise"><a href="#Listwise" class="headerlink" title="Listwise"></a>Listwise</h3><p>å¯¹äºä¸€ä¸ª list, å³<code>é¢„æµ‹æ’åºåˆ—è¡¨</code>å’Œ<code>çœŸå®æ’åºåˆ—è¡¨</code>ä¹‹é—´çš„å·®å¼‚ç›´æ¥ç®€å†æŸå¤±å‡½æ•°</p><ul><li>ListNet<br>å¯¹äº n ä¸ªæ–‡æ¡£, å°±æ˜¯ä¸€ä¸ª n! åˆ†ç±»çš„é—®é¢˜. å¯¹æ•´ä¸ªåˆ—è¡¨è®¡ç®— softmax, ç„¶åè®¡ç®—äº¤å‰ç†µ loss.<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/Q9l37MiZzuUxocn.png" alt="ListNet"></li><li>KL æ•£åº¦<br>è®¡ç®—ä¸åŒåˆ†å¸ƒä¹‹é—´çš„ distance</li></ul><h3 id="LambdaRank"><a href="#LambdaRank" class="headerlink" title="LambdaRank"></a>LambdaRank</h3><ul><li>Pairwise æŸå¤±äº† list-level åˆ—è¡¨çº§è¯„ä¼°, Listwise è¦æ±‚è¾ƒé«˜çš„æ¨¡å‹å¤æ‚åº¦. äºæ˜¯äº§ç”Ÿäº†ç»“åˆæ–¹æ¡ˆ: åˆ©ç”¨ listwise çš„ä¿¡æ¯, åš pairwise çš„äºŒåˆ†ç±»è®­ç»ƒ, æŸå¤±ä»ç„¶å»ºç«‹åœ¨ pair ä¸Š, ä½†æ˜¯åˆ©ç”¨ list çš„ä¿¡æ¯, åšä¸€ä¸ª weighting æ“ä½œ</li><li>LambdaRank ä¼˜åŒ– NDGC<br>äº¤æ¢ i å’Œ j çš„æ’åº, çœ‹çœ‹$\Delta$NDGC çš„å€¼, å³å˜åŒ–æƒ…å†µ. å°†å¤–éƒ¨æ’åºçš„ä¿¡æ¯, ä½œä¸º $h\left(\lambda_{i, j}, g_{q}\right)$ æ³¨å…¥.<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/YpdGTvMh9ilo6gW.png" alt="LambdaRank"></li><li>Pairwise æ–¹æ³•ä»ç„¶æ˜¯æœ€å—æ¬¢è¿æœ€å¹¿æ³›åº”ç”¨çš„å­¦ä¹ æ’åºç®—æ³•<br>æ’åºç²¾åº¦å’Œè®­ç»ƒæ•ˆç‡çš„å¹³è¡¡              </li><li>LambdaRank æ˜¯ä¸€ç§å…·æœ‰æ’åºåˆ—è¡¨çº§ä¿¡æ¯çš„ pairwise æ–¹æ³•<br>å®¹æ˜“å®ç°,æ˜“äºæ”¹è¿›å’Œè°ƒæ•´</li></ul><h2 id="çŸ©é˜µåˆ†è§£çš„ååŒè¿‡æ»¤ç®—æ³•"><a href="#çŸ©é˜µåˆ†è§£çš„ååŒè¿‡æ»¤ç®—æ³•" class="headerlink" title="çŸ©é˜µåˆ†è§£çš„ååŒè¿‡æ»¤ç®—æ³•"></a>çŸ©é˜µåˆ†è§£çš„ååŒè¿‡æ»¤ç®—æ³•</h2><p>ç”¨æˆ·-ç‰©å“çŸ©é˜µè¿›è¡Œé¢„æµ‹, éƒ½å¯ä»¥é€šè¿‡åˆ†è§£ä¸ºä¸¤ä¸ªä½ç§©çŸ©é˜µ, è¿›è¡Œç›¸ä¹˜, ä»è€Œå¯ä»¥å¾—çŸ¥çŸ©é˜µç©ºç™½å¤„çš„é¢„æµ‹å€¼. æ¯”å¦‚åˆ†è§£ç”µå½±ç½‘ç«™çš„ç”¨æˆ·æ‰“åˆ†çŸ©é˜µ, å’Œç”µå½±å¾—åˆ†çŸ©é˜µ, å¯ä»¥é¢„æµ‹ç”¨æˆ· p å¯¹äºä¸€ä¸ªæ–°çš„ç‰©å“ i çš„å–œå¥½ç¨‹åº¦.</p><h3 id="åŸºæœ¬æ¨¡å‹-Matrix-Factorization"><a href="#åŸºæœ¬æ¨¡å‹-Matrix-Factorization" class="headerlink" title="åŸºæœ¬æ¨¡å‹ Matrix Factorization"></a>åŸºæœ¬æ¨¡å‹ Matrix Factorization</h3><ul><li>åŒçº¿æ€§æ¨¡å‹, å‚æ•°ä¸å‚æ•°ç›¸ä¹˜, pu ä¸ºç”¨æˆ·åå¥½çŸ©é˜µ, qi ä¸ºç‰©å“è¯„ä»·çŸ©é˜µ, ç”¨æˆ· u åœ¨ç‰©å“ i ä¸Šçš„é¢„æµ‹ä¸º<script type="math/tex; mode=display">\hat{r}_{u, i}=p_{u}^{T} q_{i}</script></li><li>å‡æ–¹è¯¯å·®æ„é€ æŸå¤±å‡½æ•°<script type="math/tex; mode=display">\mathcal{L}\left(u, i, r_{u, i}\right)=\frac{1}{2}\left(r_{u, i}-p_{u}^{T} q_{i}\right)^{2}</script></li><li>è®­ç»ƒç›®æ ‡: å‡æ–¹è¯¯å·®+L2èŒƒå¼<script type="math/tex; mode=display">\min _{P, Q} \sum_{r_{u, i} \in D} \frac{1}{2}\left(r_{u, i}-p_{u}^{T} q_{i}\right)^{2}+\frac{\lambda}{2}\left(\left\|p_{u}\right\|^{2}+\left\|q_{i}\right\|^{2}\right)</script></li><li>æ¢¯åº¦æ›´æ–°: pu åœ¨ qi æ–¹å‘ä¸Šå˜å¤§/å˜å°, qi åœ¨ pu çš„æ–¹å‘ä¸Šå˜å¤§/å˜å°<script type="math/tex; mode=display">\begin{array}{l}\frac{\partial \mathcal{L}\left(u, i, r_{u, i}\right)}{\partial p_{u}}=\left(p_{u}^{T} q_{i}-r_{u, i}\right) q_{i}+\lambda p_{u} \\\\\frac{\partial \mathcal{L}\left(u, i, r_{u, i}\right)}{\partial q_{i}}=\left(p_{u}^{T} q_{i}-r_{u, i}\right) p_{u}+\lambda q_{i}\end{array}</script></li></ul><h3 id="å¸¦åå·®çš„çŸ©é˜µåˆ†è§£æ¨¡å‹"><a href="#å¸¦åå·®çš„çŸ©é˜µåˆ†è§£æ¨¡å‹" class="headerlink" title="å¸¦åå·®çš„çŸ©é˜µåˆ†è§£æ¨¡å‹"></a>å¸¦åå·®çš„çŸ©é˜µåˆ†è§£æ¨¡å‹</h3><ul><li><p>è§£å†³åŠ¨æ€å˜åŒ–é—®é¢˜<br>å› å­æ¨¡å‹æ–¹ä¾¿åœ°å…è®¸åˆ†åˆ«å¤„ç†ä¸åŒåŸå› , å¯ä»¥é€šè¿‡å¤§é‡å‚æ•°åŒ–å‡½æ•°æ¥è·å¾—çµæ´»æ€§. æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„å˜åŒ–: ä¸ªäººç”¨æˆ·çš„è¯„åˆ†ç­‰çº§ $b_u(t)$  ä¸ªäººç‰©å“çš„å—æ¬¢è¿ç¨‹åº¦ $b_i(t)$  ç”¨æˆ·åå¥½ $p_u(t)$  å…¨å±€bias $\mu$ </p></li><li><p>è€ƒè™‘å¤šç§åå·®, ç”¨æˆ· u åœ¨ç‰©å“ i ä¸Šçš„é¢„æµ‹ä¸º<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/IovOtfdJp2lPKUR.png" alt=""></p></li><li><p>è®­ç»ƒç›®æ ‡</p><script type="math/tex; mode=display">\min _{P, Q} \sum_{r_{u, i} \in D} \frac{1}{2}\left(r_{u, i}-\left(\mu+b_{u}+b_{i}+p_{u}^{\top} q_{i}\right)\right)^{2}+\frac{\lambda}{2}\left(\left\|p_{u}\right\|^{2}+\left\|q_{i}\right\|^{2}+b_{u}^{2}+b_{i}^{2}\right)</script></li><li><p>æ¢¯åº¦æ›´æ–° å¯¼æ•°$\times$æ­¥é•¿</p><script type="math/tex; mode=display">\begin{aligned}\delta &=r_{u, i}-\left(\mu+b_{u}+b_{i}+p_{u}^{T} q_{i}\right) \\\mu & \leftarrow \mu+\eta \delta \\b_{u} & \leftarrow(1-\eta \lambda) b_{u}+\eta \delta \\b_{i} & \leftarrow(1-\eta \lambda) b_{i}+\eta \delta \\p_{u} & \leftarrow(1-\eta \lambda) p_{u}+\eta \delta q_{i} \\q_{i} & \leftarrow(1-\eta \lambda) q_{i}+\eta \delta p_{u}\end{aligned}</script></li><li><p>å‘å±•: æ·±åº¦å­¦ä¹ å¤§è¡Œå…¶é“</p></li><li>ä»£ç å®è·µ: <a href="https://www.kaggle.com/chenhaokun/matrix-factorization" target="_blank" rel="noopener">ğŸ‘†çŸ©é˜µåˆ†è§£</a><br>å‘é‡å³ embedding<br>embedding_size æ¯ä¸ªç”¨æˆ·çš„å‘é‡ç»´åº¦<br>user_embeddings å’Œ item_embeddings å³ p å’Œ q çš„çŸ©é˜µ</li></ul><h3 id="å¸¸è§çš„å‡ ç§ååŒè¿‡æ»¤"><a href="#å¸¸è§çš„å‡ ç§ååŒè¿‡æ»¤" class="headerlink" title="å¸¸è§çš„å‡ ç§ååŒè¿‡æ»¤"></a>å¸¸è§çš„å‡ ç§ååŒè¿‡æ»¤</h3><p><strong>ä»¥ä½¿ç”¨è€…ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤</strong><br>ç”¨ç›¸ä¼¼ç»Ÿè®¡çš„æ–¹æ³•å¾—åˆ°å…·æœ‰ç›¸ä¼¼çˆ±å¥½æˆ–è€…å…´è¶£çš„ç›¸é‚»ç”¨æˆ·ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºä»¥ç”¨æˆ·ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤æˆ–åŸºäºé‚»å±…çš„ååŒè¿‡æ»¤(Neighbor-based Collaborative Filtering)ã€‚ </p><p>æ–¹æ³•æ­¥éª¤ï¼š</p><ol><li>æ”¶é›†ç”¨æˆ·ä¿¡æ¯ï¼šæ”¶é›†å¯ä»¥ä»£è¡¨ç”¨æˆ·å…´è¶£çš„ä¿¡æ¯ã€‚ä¸€èˆ¬çš„ç½‘ç«™ç³»ç»Ÿä½¿ç”¨è¯„åˆ†çš„æ–¹å¼æˆ–æ˜¯ç»™äºˆè¯„ä»·ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºâ€œä¸»åŠ¨è¯„åˆ†â€ã€‚å¦å¤–ä¸€ç§æ˜¯â€œè¢«åŠ¨è¯„åˆ†â€ï¼Œæ˜¯æ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºæ¨¡å¼ç”±ç³»ç»Ÿä»£æ›¿ç”¨æˆ·å®Œæˆè¯„ä»·ï¼Œä¸éœ€è¦ç”¨æˆ·ç›´æ¥æ‰“åˆ†æˆ–è¾“å…¥è¯„ä»·æ•°æ®ã€‚ç”µå­å•†åŠ¡ç½‘ç«™åœ¨è¢«åŠ¨è¯„åˆ†çš„æ•°æ®è·å–ä¸Šæœ‰å…¶ä¼˜åŠ¿ï¼Œç”¨æˆ·è´­ä¹°çš„å•†å“è®°å½•æ˜¯ç›¸å½“æœ‰ç”¨çš„æ•°æ®ã€‚</li><li>æœ€è¿‘é‚»æœç´¢(Nearest neighbor search, NNS)ï¼šä»¥ç”¨æˆ·ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤çš„å‡ºå‘ç‚¹æ˜¯ä¸ç”¨æˆ·å…´è¶£çˆ±å¥½ç›¸åŒçš„å¦ä¸€ç»„ç”¨æˆ·ï¼Œå°±æ˜¯è®¡ç®—ä¸¤ä¸ªç”¨æˆ·çš„ç›¸ä¼¼åº¦ã€‚ä¾‹å¦‚ï¼šæŸ¥æ‰¾nä¸ªå’ŒAæœ‰ç›¸ä¼¼å…´è¶£ç”¨æˆ·ï¼ŒæŠŠä»–ä»¬å¯¹Mçš„è¯„åˆ†ä½œä¸ºAå¯¹Mçš„è¯„åˆ†é¢„æµ‹ã€‚ä¸€èˆ¬ä¼šæ ¹æ®æ•°æ®çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ç®—æ³•ï¼Œå½“å‰è¾ƒå¤šä½¿ç”¨çš„ç›¸ä¼¼åº¦ç®—æ³•æœ‰Pearson Correlation Coefficientã€Cosine-based Similarityã€Adjusted Cosine Similarityã€‚</li><li>äº§ç”Ÿæ¨èç»“æœï¼šæœ‰äº†æœ€è¿‘é‚»**ï¼Œå°±å¯ä»¥å¯¹ç›®æ ‡ç”¨æˆ·çš„å…´è¶£è¿›è¡Œé¢„æµ‹ï¼Œäº§ç”Ÿæ¨èç»“æœã€‚ä¾æ®æ¨èç›®çš„çš„ä¸åŒè¿›è¡Œä¸åŒå½¢å¼çš„æ¨èï¼Œè¾ƒå¸¸è§çš„æ¨èç»“æœæœ‰Top-N æ¨èå’Œå…³ç³»æ¨èã€‚Top-N æ¨èæ˜¯é’ˆå¯¹ä¸ªä½“ç”¨æˆ·äº§ç”Ÿï¼Œå¯¹æ¯ä¸ªäººäº§ç”Ÿä¸ä¸€æ ·çš„ç»“æœï¼Œä¾‹å¦‚ï¼šé€è¿‡å¯¹Aç”¨æˆ·çš„æœ€è¿‘é‚»ç”¨æˆ·è¿›è¡Œç»Ÿè®¡ï¼Œé€‰æ‹©å‡ºç°é¢‘ç‡é«˜ä¸”åœ¨Aç”¨æˆ·çš„è¯„åˆ†é¡¹ç›®ä¸­ä¸å­˜åœ¨çš„ï¼Œä½œä¸ºæ¨èç»“æœã€‚å…³ç³»æ¨èæ˜¯å¯¹æœ€è¿‘é‚»ç”¨æˆ·çš„è®°å½•è¿›è¡Œå…³ç³»è§„åˆ™(association rules)æŒ–æ˜ã€‚</li></ol><p><strong>ä»¥é¡¹ç›®ä¸ºåŸºç¡€ï¼ˆItem-basedï¼‰çš„ååŒè¿‡æ»¤</strong><br>ä»¥ç”¨æˆ·ä¸ºåŸºç¡€çš„ååŒæ¨èç®—æ³•éšç€ç”¨æˆ·æ•°é‡çš„å¢å¤šï¼Œè®¡ç®—çš„æ—¶é—´å°±ä¼šå˜é•¿ï¼Œæ‰€ä»¥åœ¨2001å¹´Sarwaræå‡ºäº†åŸºäºé¡¹ç›®çš„ååŒè¿‡æ»¤æ¨èç®—æ³•(Item-based Collaborative Filtering Algorithms)ã€‚ä»¥é¡¹ç›®ä¸ºåŸºç¡€çš„ååŒè¿‡æ»¤æ–¹æ³•æœ‰ä¸€ä¸ªåŸºæœ¬çš„å‡è®¾â€œèƒ½å¤Ÿå¼•èµ·ç”¨æˆ·å…´è¶£çš„é¡¹ç›®ï¼Œå¿…å®šä¸å…¶ä¹‹å‰è¯„åˆ†é«˜çš„é¡¹ç›®ç›¸ä¼¼â€ï¼Œé€è¿‡è®¡ç®—é¡¹ç›®ä¹‹é—´çš„ç›¸ä¼¼æ€§æ¥ä»£æ›¿ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚<br>æ–¹æ³•æ­¥éª¤ï¼š</p><ol><li>æ”¶é›†ç”¨æˆ·ä¿¡æ¯ï¼šåŒä»¥ç”¨æˆ·ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤ã€‚</li><li>é’ˆå¯¹é¡¹ç›®çš„æœ€è¿‘é‚»æœç´¢ï¼šå…ˆè®¡ç®—å·²è¯„ä»·é¡¹ç›®å’Œå¾…é¢„æµ‹é¡¹ç›®çš„ç›¸ä¼¼åº¦ï¼Œå¹¶ä»¥ç›¸ä¼¼åº¦ä½œä¸ºæƒé‡ï¼ŒåŠ æƒå„å·²è¯„ä»·é¡¹ç›®çš„åˆ†æ•°ï¼Œå¾—åˆ°å¾…é¢„æµ‹é¡¹ç›®çš„é¢„æµ‹å€¼ã€‚ä¾‹å¦‚ï¼šè¦å¯¹é¡¹ç›® A å’Œé¡¹ç›® B è¿›è¡Œç›¸ä¼¼æ€§è®¡ç®—ï¼Œè¦å…ˆæ‰¾å‡ºåŒæ—¶å¯¹ A å’Œ B æ‰“è¿‡åˆ†çš„ç»„åˆï¼Œå¯¹è¿™äº›ç»„åˆè¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œå¸¸ç”¨çš„ç®—æ³•åŒä»¥ç”¨æˆ·ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤ã€‚</li><li>äº§ç”Ÿæ¨èç»“æœï¼šä»¥é¡¹ç›®ä¸ºåŸºç¡€çš„ååŒè¿‡æ»¤ä¸ç”¨è€ƒè™‘ç”¨æˆ·é—´çš„å·®åˆ«ï¼Œæ‰€ä»¥ç²¾åº¦æ¯”è¾ƒå·®ã€‚ä½†æ˜¯å´ä¸éœ€è¦ç”¨æˆ·çš„å†å²æ•°æ®ï¼Œæˆ–æ˜¯è¿›è¡Œç”¨æˆ·è¯†åˆ«ã€‚å¯¹äºé¡¹ç›®æ¥è®²ï¼Œå®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼æ€§è¦ç¨³å®šå¾ˆå¤šï¼Œå› æ­¤å¯ä»¥ç¦»çº¿å®Œæˆå·¥ä½œé‡æœ€å¤§çš„ç›¸ä¼¼æ€§è®¡ç®—æ­¥éª¤ï¼Œä»è€Œé™ä½äº†åœ¨çº¿è®¡ç®—é‡ï¼Œæé«˜æ¨èæ•ˆç‡ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·å¤šäºé¡¹ç›®çš„æƒ…å½¢ä¸‹å°¤ä¸ºæ˜¾ç€ã€‚</li></ol><p><strong>ä»¥æ¨¡å‹ä¸ºåŸºç¡€ï¼ˆModel- basedï¼‰çš„ååŒè¿‡æ»¤</strong><br>ä»¥ç”¨æˆ·ä¸ºåŸºç¡€ï¼ˆUser-basedï¼‰çš„ååŒè¿‡æ»¤å’Œä»¥é¡¹ç›®ä¸ºåŸºç¡€ï¼ˆItem-basedï¼‰çš„ååŒè¿‡æ»¤ç³»ç»Ÿç§°ä¸ºä»¥è®°å¿†ä¸ºåŸºç¡€ï¼ˆMemory basedï¼‰çš„ååŒè¿‡æ»¤æŠ€æœ¯ï¼Œä»–ä»¬å…±æœ‰çš„ç¼ºç‚¹æ˜¯æ•°æ®ç¨€ç–ï¼Œéš¾ä»¥å¤„ç†å¤§æ•°æ®é‡å½±å“å³æ—¶ç»“æœï¼Œå› æ­¤å‘å±•å‡ºä»¥æ¨¡å‹ä¸ºåŸºç¡€çš„ååŒè¿‡æ»¤æŠ€æœ¯ã€‚ ä»¥æ¨¡å‹ä¸ºåŸºç¡€çš„ååŒè¿‡æ»¤(Model-based Collaborative Filtering)æ˜¯å…ˆç”¨å†å²æ•°æ®å¾—åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œå†ç”¨æ­¤æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚ä»¥æ¨¡å‹ä¸ºåŸºç¡€çš„ååŒè¿‡æ»¤å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯åŒ…æ‹¬Latent Semantic Indexingã€Bayesian Networksâ€¦ç­‰ï¼Œæ ¹æ®å¯¹ä¸€ä¸ªæ ·æœ¬çš„åˆ†æå¾—åˆ°æ¨¡å‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¨èç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ml-script</title>
      <link href="/2020/05/12/ml-script/"/>
      <url>/2020/05/12/ml-script/</url>
      
        <content type="html"><![CDATA[<h1 id="æœºå™¨å­¦ä¹ å°æŠ„"><a href="#æœºå™¨å­¦ä¹ å°æŠ„" class="headerlink" title="æœºå™¨å­¦ä¹ å°æŠ„"></a>æœºå™¨å­¦ä¹ å°æŠ„</h1><h2 id="æœºå™¨å­¦ä¹ æ¦‚è§‚"><a href="#æœºå™¨å­¦ä¹ æ¦‚è§‚" class="headerlink" title="æœºå™¨å­¦ä¹ æ¦‚è§‚"></a>æœºå™¨å­¦ä¹ æ¦‚è§‚</h2><ol><li><p>é¢‘ç‡å­¦æ´¾ï¼šç»Ÿè®¡å­¦ä¹ <br>æ ¸å¿ƒæ˜¯ã€Œæ•°æ®ã€ï¼Œå®ƒæ—¢ä»æ•°æ®ä¸­æ¥ï¼Œåˆ©ç”¨ä¸åŒçš„æ¨¡å‹å»æ‹Ÿåˆæ•°æ®èƒŒåçš„è§„å¾‹ï¼›ä¹Ÿåˆ°æ•°æ®ä¸­å»ï¼Œç”¨æ‹Ÿåˆå‡ºçš„è§„å¾‹å»æ¨æ–­å’Œé¢„æµ‹æœªçŸ¥çš„ç»“æœ. ç»Ÿè®¡å­¦ä¹ ä¸­æœ€åŸºç¡€çš„æ¨¡å‹æ˜¯<code>çº¿æ€§å›å½’</code>ï¼Œå‡ ä¹æ‰€æœ‰å…¶ä»–æ¨¡å‹éƒ½æ˜¯ä»ä¸åŒè§’åº¦å¯¹çº¿æ€§å›å½’æ¨¡å‹åšå‡ºçš„æ‰©å±•ä¸ä¿®æ­£</p></li><li><p>è´å¶æ–¯å­¦æ´¾ï¼šç¬¦å·å­¦ä¹ ï¼Œæ¦‚ç‡å›¾æ¨¡å‹<br>åŸºäºå…³ç³»çš„å›¾æ¨¡å‹æ›´å¤šåœ°ä»£è¡¨äº†ã€Œå› æœæ¨ç†ã€çš„å‘å±•æ–¹å‘. è´å¶æ–¯ä¸»ä¹‰ä¹Ÿéœ€è¦è®¡ç®—å¾…å­¦ä¹ å¯¹è±¡çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½†å®ƒåˆ©ç”¨çš„ä¸æ˜¯æµ·é‡çš„å…·ä½“æ•°æ®ï¼Œè€Œæ˜¯å˜é‡ä¹‹é—´çš„ç›¸å…³å…³ç³»ã€æ¯ä¸ªå˜é‡çš„å…ˆéªŒåˆ†å¸ƒå’Œå¤§é‡å¤æ‚çš„ç§¯åˆ†æŠ€å·§</p></li><li><p>æœºå™¨å­¦ä¹ ä¸‰è¦ç´ <br>æœºå™¨å­¦ä¹ çš„ä¸‰è¦ç´ å°±æ˜¯ï¼š<code>è¡¨ç¤ºï¼Œè¯„ä¼°å’Œä¼˜åŒ–</code><br>è¡¨ç¤ºï¼šæŒ‡çš„æ˜¯å°†æ ·æœ¬ç©ºé—´æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„ç‰¹å¾ç©ºé—´ï¼Œä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬æ›´é’çäºè¿™æ ·çš„è¡¨ç¤ºæ˜¯ä½ç»´åº¦çš„ï¼Œæ˜¯æ›´åŠ ç¨€ç–äº¤äº’çš„ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›æ˜¯ç›¸äº’ç‹¬ç«‹çš„<br>è¯„ä¼°ï¼šæŒ‡çš„æ˜¯æ¨¡å‹åœ¨æ•°æ®ä¸Šè¡¨ç°çš„é‡åŒ–å½¢å¼ï¼Œæˆ‘ä»¬é€‰å–åˆé€‚çš„å‡½æ•°æ¥è¡¨ç¤ºä»€ä¹ˆæ ·å­çš„æ¨¡å‹æ˜¯å¥½çš„ï¼Œæ€§èƒ½åº¦é‡å°±æ˜¯è¯„ä¼°<br>ä¼˜åŒ–ï¼šå°±æ˜¯å¯¹è¯„ä¼°å‡½æ•°è¿›è¡Œæ±‚è§£ï¼Œæ‰¾å‡ºæœ€åˆé€‚çš„è§£ï¼Œæ¥ç¡®å®šæœ€ç»ˆçš„æ¨¡å‹</p></li></ol><h2 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h2><h3 id="1-ç‰¹å¾é€‰æ‹©"><a href="#1-ç‰¹å¾é€‰æ‹©" class="headerlink" title="1. ç‰¹å¾é€‰æ‹©"></a>1. ç‰¹å¾é€‰æ‹©</h3><h3 id="2-ç‰¹å¾è¡¨è¾¾"><a href="#2-ç‰¹å¾è¡¨è¾¾" class="headerlink" title="2. ç‰¹å¾è¡¨è¾¾"></a>2. ç‰¹å¾è¡¨è¾¾</h3><h3 id="3-ç‰¹å¾é¢„å¤„ç†"><a href="#3-ç‰¹å¾é¢„å¤„ç†" class="headerlink" title="3. ç‰¹å¾é¢„å¤„ç†"></a>3. ç‰¹å¾é¢„å¤„ç†</h3><p>æ ‡å‡†åŒ– å½’ä¸€åŒ– </p><h3 id="4-é™ç»´-PCA-LDA-SVD"><a href="#4-é™ç»´-PCA-LDA-SVD" class="headerlink" title="4. é™ç»´ PCA LDA SVD"></a>4. é™ç»´ PCA LDA SVD</h3><h2 id="æ¨¡å‹è¯„ä¼°"><a href="#æ¨¡å‹è¯„ä¼°" class="headerlink" title="æ¨¡å‹è¯„ä¼°"></a>æ¨¡å‹è¯„ä¼°</h2><h3 id="1-åˆ†ç±»"><a href="#1-åˆ†ç±»" class="headerlink" title="1. åˆ†ç±»"></a>1. åˆ†ç±»</h3><p>TP FP TN FN ROC AUC</p><h3 id="2-å›å½’"><a href="#2-å›å½’" class="headerlink" title="2.å›å½’"></a>2.å›å½’</h3><p>å‡æ–¹è¯¯å·®ï¼Œå¹³å‡è¯¯å·®ï¼ŒR æ–¹</p><h3 id="3-æ£€éªŒ"><a href="#3-æ£€éªŒ" class="headerlink" title="3. æ£€éªŒ"></a>3. æ£€éªŒ</h3><p>è®­ç»ƒé›† -ï¼ˆæµ‹è¯•é›†ï¼‰ - éªŒè¯é›†<br>k æŠ˜äº¤å‰éªŒè¯ï¼Œç•™ä¸€æ³•ï¼Œè‡ªåŠ©æ³•</p><h3 id="4-è¶…å‚æ•°è°ƒä¼˜"><a href="#4-è¶…å‚æ•°è°ƒä¼˜" class="headerlink" title="4. è¶…å‚æ•°è°ƒä¼˜"></a>4. è¶…å‚æ•°è°ƒä¼˜</h3><p>ç½‘æ ¼æœç´¢ï¼Œéšæœºæœç´¢ï¼Œè´å¶æ–¯ä¼˜åŒ–å…ˆéªŒ</p><h3 id="5-è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ"><a href="#5-è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ" class="headerlink" title="5. è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ"></a>5. è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ</h3><p>æ­£åˆ™åŒ–ï¼Œé›†æˆå­¦ä¹ ï¼Œdropoutï¼Œç‰¹å¾é€‰æ‹©</p><h2 id="å‡è®¾ç©ºé—´"><a href="#å‡è®¾ç©ºé—´" class="headerlink" title="å‡è®¾ç©ºé—´"></a>å‡è®¾ç©ºé—´</h2><h3 id="1-æŸå¤±å‡½æ•°"><a href="#1-æŸå¤±å‡½æ•°" class="headerlink" title="1. æŸå¤±å‡½æ•°"></a>1. æŸå¤±å‡½æ•°</h3><p>0-1 æŸå¤±ï¼Œå¹³æ–¹æŸå¤±ï¼Œlog å¯¹æ•°æŸå¤±/äº¤å‰ç†µæŸå¤±ï¼ˆé€»è¾‘å›å½’ï¼‰ï¼Œhinge æŸå¤±ï¼ˆSVMï¼‰ï¼ŒæŒ‡æ•°æŸå¤±ï¼ˆAdaboostï¼‰<br>å¤šåˆ†ç±»é—®é¢˜ä¸­ï¼Œä¸Šè¿°é€šè¿‡æœ€å¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°çš„æŸå¤±å‡½æ•°ä¸é€šè¿‡äº¤å‰ç†µå¾—åˆ°çš„æŸå¤±å‡½æ•°ç›¸åŒ</p><script type="math/tex; mode=display">l_{C E}=-\sum_{i=1}^{C} t_{i} \log \left(y_{i}\right)</script><h3 id="2-ç›®æ ‡å‡½æ•°"><a href="#2-ç›®æ ‡å‡½æ•°" class="headerlink" title="2. ç›®æ ‡å‡½æ•°"></a>2. ç›®æ ‡å‡½æ•°</h3><p>ç›®æ ‡å‡½æ•°å³æœ€å°åŒ–æŸå¤±å‡½æ•°+æ­£åˆ™</p><ul><li>ç»éªŒé£é™©ï¼ˆè®­ç»ƒé›†ä¸Šçš„ï¼‰</li><li>æœŸæœ›é£é™©ï¼ˆéªŒè¯é›†ä¸Šçš„ï¼‰</li><li>ç»“æ„é£é™©ï¼ˆåŠ å…¥ä¸€ä¸ªæ­£åˆ™åŒ–ï¼‰</li><li>æ­£åˆ™åŒ–é¡¹ -&gt; æ¨¡å‹çš„å¤æ‚åº¦</li></ul><h3 id="è·ç¦»åº¦é‡"><a href="#è·ç¦»åº¦é‡" class="headerlink" title="è·ç¦»åº¦é‡"></a>è·ç¦»åº¦é‡</h3><p>[è¯¦æƒ…ç‚¹å‡»]<a href="https://blog.csdn.net/qq_28168421/article/details/81097655" target="_blank" rel="noopener">https://blog.csdn.net/qq_28168421/article/details/81097655</a><br>æ¬§æ°è·ç¦» é©¬æ°è·ç¦» ç­‰ç­‰</p><h2 id="ç›®æ ‡å‡½æ•°çš„-ä¼˜åŒ–-or-æ±‚è§£"><a href="#ç›®æ ‡å‡½æ•°çš„-ä¼˜åŒ–-or-æ±‚è§£" class="headerlink" title="ç›®æ ‡å‡½æ•°çš„ ä¼˜åŒ– or æ±‚è§£"></a>ç›®æ ‡å‡½æ•°çš„ ä¼˜åŒ– or æ±‚è§£</h2><ol><li><p>è§£ææ³•<br>æœ€å°äºŒä¹˜æ³•</p></li><li><p>è¿­ä»£ä¼˜åŒ–ï¼šä¸€é˜¶æ³°å‹’å±•å¼€<br>æ¢¯åº¦ä¸‹é™ã€éšæœºæ¢¯åº¦ä¸‹é™ã€æ‰¹é‡æ¢¯åº¦ä¸‹é™ã€å…±è½­æ¢¯åº¦æ³•</p></li><li><p>è¿­ä»£ä¼˜åŒ–ï¼šäºŒé˜¶æ³°å‹’å±•å¼€<br>ç‰›é¡¿æ³•ã€æ‹Ÿç‰›é¡¿æ³•<br>ï¼ˆäºŒé˜¶æ³•çš„æ”¶æ•›é€Ÿåº¦ä¸€èˆ¬è¦è¿œå¿«äºä¸€é˜¶æ³•ï¼Œä½†æ˜¯åœ¨é«˜ç»´æƒ…å†µä¸‹ï¼ŒHessian çŸ©é˜µæ±‚é€†çš„è®¡ç®—å¤æ‚åº¦å¾ˆå¤§ï¼Œè€Œä¸”å½“ç›®æ ‡å‡½æ•°éå‡¸æ—¶ï¼ŒäºŒé˜¶æ³•æœ‰å¯èƒ½ä¼šæ”¶åˆ°éç‚¹ï¼ˆSaddle Point)ï¼‰</p></li><li><p>éšæœºæ¢¯åº¦ä¸‹é™<br>åŠ¨é‡ Momentumï¼ˆä¿æŒæƒ¯æ€§ï¼‰ï¼ŒAdaGradï¼ˆç¯å¢ƒæ„ŸçŸ¥ï¼‰ï¼ŒAdamï¼ˆä¿æŒæƒ¯æ€§+ç¯å¢ƒæ„ŸçŸ¥ï¼‰â€¦â€¦</p></li><li><p>é™åˆ¶ä¸­ä¼˜åŒ–<br>KKT æ¡ä»¶ï¼ˆæœ€å¤§æœ€å°åŒ–äº’æ¢ï¼‰ï¼Œæ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼ˆè®²çº¦æŸæ¡ä»¶èåˆåˆ°ç›®æ ‡å‡½æ•°ä¸­ï¼‰</p></li></ol><h2 id="é€»è¾‘å›å½’å°è®°"><a href="#é€»è¾‘å›å½’å°è®°" class="headerlink" title="é€»è¾‘å›å½’å°è®°"></a>é€»è¾‘å›å½’å°è®°</h2><ol><li><p>sigmoid å‡½æ•°<br>å°†çº¿æ€§å›å½’è½¬åŒ–ä¸ºé€»è¾‘å›å½’ï¼Œå°†å›å½’é—®é¢˜è½¬åŒ–ä¸ºäºŒåˆ†ç±»é—®é¢˜</p></li><li><p>softmax æ˜¯å¯¹äº sigmoid çš„å¤šåˆ†ç±»æ¨å¹¿<br>å°†è¾“å‡ºå€¼å˜æ¢æˆå€¼ä¸ºæ­£ä¸”å’Œä¸º1çš„æ¦‚ç‡åˆ†å¸ƒ</p><script type="math/tex; mode=display">\hat{y} 1=\frac{\exp \left(o_{1}\right)}{\sum_{i=1}^{3} \exp \left(o_{i}\right)}</script></li><li><p>å‡æ–¹è¯¯å·® ä¸å¦‚ äº¤å‰ç†µæŸå¤±å‡½æ•°<br>ä¸ä¼šä½¿å¾—åå¯¼æ¥è¿‘ 0 è€Œéš¾ä»¥å­¦ä¹ </p></li><li><p>æ›´æ–°å‚æ•° ğœƒ<br>æ­¥é•¿ = æ¢¯åº¦ x å­¦ä¹ ç‡</p></li></ol><h2 id="PCA-é™ç»´"><a href="#PCA-é™ç»´" class="headerlink" title="PCA é™ç»´"></a>PCA é™ç»´</h2><ol><li><p>æ­¥éª¤<br>æ ·æœ¬ä¸­å¿ƒåŒ– -&gt; è®¡ç®—åæ–¹å·®çŸ©é˜µ -&gt; å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ -&gt; å–æœ€å¤§çš„ m ä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡</p></li><li><p>åŸç†<br>åˆ©ç”¨ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡, æ‰¾åˆ°ä¸€ç»„æ ‡å‡†æ­£äº¤åŸº â€”-&gt; ä»è€Œå¯ä»¥å°†ä»»ä½•å‘é‡ç”¨æ ‡å‡†æ­£äº¤åŸºè¡¨ç¤º â€”-&gt; ä»è€Œå¯ä»¥å°†ä»»ä½•åæ–¹å·®çŸ©é˜µç”¨ $UWU^T$ å½¢å¼è¡¨ç¤º, U ä¸ºæ­£äº¤åŸºçŸ©é˜µ, W å°±æ˜¯æœ¬çŸ©é˜µçš„ç‰¹å¾å€¼.</p></li><li><p>è§£é‡Š<br>PCA çš„ç›®çš„æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ–¹å‘ $v$, ä½¿å¾—åœ¨è¿™ä¸ªæ–¹å‘ä¸Šæ•°æ® X çš„æŠ•å½±çš„æ–¹å·®æœ€å¤§, æ–¹å·®è¶Šå¤§è¶Šèƒ½ä¿ç•™å°½å¯èƒ½å¤šçš„æœ‰æ•ˆä¿¡æ¯. ç”±äºå‡å€¼å·²ç»ä¸º 0, æ•°æ® ğ‘‹ åœ¨æ–¹å‘ ğ‘£ çš„æ–¹å·®å°±æ˜¯ $Xv^2$. æœ€åæ¨ç®—çš„ç»“è®ºå°±æ˜¯, éœ€è¦æœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡.<br>æœ€ç»ˆå¾—åˆ° X çš„ä¸»æˆåˆ†çŸ©é˜µä¸º $T=WX$, å…¶ä¸­ $W$ ä¸º$XTX$ çš„ç‰¹å¾å€¼çŸ©é˜µ.</p></li></ol><h2 id="SVM-ç®—æ³•å°è®°"><a href="#SVM-ç®—æ³•å°è®°" class="headerlink" title="SVM ç®—æ³•å°è®°"></a>SVM ç®—æ³•å°è®°</h2><ol><li><p>è¶…å¹³é¢ï¼Œå‡½æ•°é—´éš”ï¼Œå‡ ä½•é—´éš”<br>w, b ä»»æ„ç¼©æ”¾ï¼Œå‡ ä½•é—´éš”ä¸å˜</p></li><li><p>ç›®æ ‡å‡½æ•°<br>æ‰¾åˆ°æœ€å°çš„å‡ ä½•é—´éš”ï¼Œå³ä¸ºæ”¯æŒå‘é‡ç‚¹ï¼Œæœ€å¤§åŒ–è¿™ä¸ªæ”¯æŒå‘é‡åˆ°è¶…å¹³é¢çš„å‡ ä½•é—´éš”</p></li><li><p>æ‹‰æ ¼æœ—æ—¥æ³•ï¼šèåˆçº¦æŸæ¡ä»¶å’Œç›®æ ‡å‡½æ•°<br>å…ˆè°ƒæ•´ Î± æœ€å¤§åŒ–ç›®æ ‡å‡½æ•°ï¼›å†è°ƒæ•´ w,b æœ€å°åŒ–ç›®æ ‡å‡½æ•°</p></li><li><p>KKT æ¡ä»¶ï¼šæ»¡è¶³æœ€å¤§æœ€å°åŒ– -&gt; å¾—åˆ°å¯¹å¶å½¢å¼<br>å¯ä»¥å…ˆè°ƒæ•´ w,b å¯¹ w,b æ±‚å¯¼ï¼Œæœ€ååªå‰© Î±</p></li><li><p>SMO ç®—æ³•<br>é€‰æ‹©ä¼˜åŒ–ä¸¤ä¸ªå‚æ•°ï¼Œå›ºå®šå…¶ä»– N-2 ä¸ªå‚æ•°ï¼Œç®€åŒ–æˆä¸ºäºŒå…ƒå‡½æ•° -&gt; å†è½¬åŒ–ä¸ºä¸€å…ƒå‡½æ•°</p></li><li><p>çº¿æ€§ä¸å¯åˆ†çš„æƒ…å†µ<br>åŠ æ¾å¼›å˜é‡ï¼Œåˆ©ç”¨æ ¸å‡½æ•°ï¼ˆä»£æ›¿å†…ç§¯ï¼Œå»ºç«‹ä¸€ä¸ªæ˜ å°„ï¼Œåœ¨ä½ç»´è®¡ç®—ï¼Œå¤§å¤§å‡å°‘è®¡ç®—é‡ï¼‰</p></li><li><p>æŸå¤±å‡½æ•°<br>é“°é“¾æŸå¤± Hinge Loss, åªå…³æ³¨å‡½æ•°é—´éš” &lt;=1 çš„æƒ…å†µ, &gt;1 çš„æƒ…å†µçš„ loss å¿½ç•¥ä¸º 0</p></li></ol><h2 id="å†³ç­–æ ‘å°è®°"><a href="#å†³ç­–æ ‘å°è®°" class="headerlink" title="å†³ç­–æ ‘å°è®°"></a>å†³ç­–æ ‘å°è®°</h2><ol><li><p>åˆ†ç±»<br>ID3ï¼Œ C4.5ï¼Œ CART</p></li><li><p>C4.5 å¯¹ ID3 çš„æ”¹è¿›</p></li></ol><ul><li>è¿ç»­çš„ç‰¹å¾ç¦»æ•£åŒ–</li><li>å¼•å…¥ä¿¡æ¯å¢ç›Šæ¯”</li><li>é’ˆå¯¹æœ‰ç¼ºå¤±å€¼æå‡ºç­–ç•¥</li><li>é’ˆå¯¹è¿‡æ‹Ÿåˆçš„æ”¹è¿›ï¼šé¢„å‰ªæï¼ˆç”Ÿæˆå†³ç­–æ ‘çš„æ—¶å€™åˆ¤å®šï¼‰åå‰ªæï¼ˆäº¤å‰éªŒè¯åˆ¤å®šï¼‰</li></ul><ol><li>CART å¯¹ C4.5 çš„ä¼˜åŒ–</li></ol><ul><li>ä½¿ç”¨åŸºå°¼ç³»æ•°ï¼Œæ— éœ€å¯¹æ•°è¿ç®—</li><li>ä½¿ç”¨äºŒå‰æ ‘</li><li>é™¤äº†åˆ†ç±»ï¼Œå¯ä»¥è¿›è¡Œå›å½’ï¼ˆç”¨å¶å­çš„å‡å€¼æ¥é¢„æµ‹ç»“æœï¼‰</li></ul><h2 id="é›†æˆå­¦ä¹ ï¼ˆEnsembleï¼‰"><a href="#é›†æˆå­¦ä¹ ï¼ˆEnsembleï¼‰" class="headerlink" title="é›†æˆå­¦ä¹ ï¼ˆEnsembleï¼‰"></a>é›†æˆå­¦ä¹ ï¼ˆEnsembleï¼‰</h2><ol><li>æ€»ä½“ä¸¤ç±»ï¼š</li></ol><ul><li>ä¸²è¡Œç”Ÿæˆ/åºåˆ—é›†æˆï¼Œåˆ©ç”¨åŸºç¡€å­¦ä¹ å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡å¯¹ä¹‹å‰è®­ç»ƒä¸­é”™è¯¯æ ‡è®°çš„æ ·æœ¬èµ‹å€¼è¾ƒé«˜çš„æƒé‡</li><li>å¹¶è¡Œç”Ÿæˆï¼Œåˆ©ç”¨åŸºç¡€å­¦ä¹ å™¨ä¹‹é—´çš„ç‹¬ç«‹æ€§ï¼Œé€šè¿‡å¹³å‡å¯ä»¥æ˜¾è‘—é™ä½é”™è¯¯</li><li>ä¸‰å¤§æ–¹æ³•ï¼šBaggingï¼ŒBoostingï¼ŒStacking</li></ul><ol><li>Baggingï¼ˆbootstrap aggregatingï¼‰è‡ªåŠ©é‡‡æ ·æ³•</li></ol><ul><li>ä»åŸå§‹æ ·æœ¬é›†ä¸­æŠ½å–è®­ç»ƒé›†ï¼Œkä¸ªè®­ç»ƒé›†å…±å¾—åˆ°kä¸ªæ¨¡å‹ï¼Œå¯ä»¥å¹¶è¡Œç”Ÿæˆ</li><li>åˆ†ç±»é—®é¢˜ï¼škä¸ªæ¨¡å‹é‡‡ç”¨æŠ•ç¥¨çš„æ–¹å¼å¾—åˆ°åˆ†ç±»ç»“æœ -&gt; å†³ç­–æ ‘æ¼”åŒ–ä¸ºã€Œéšæœºæ£®æ—ã€</li><li>å›å½’é—®é¢˜ï¼šæ¨¡å‹çš„å‡å€¼ä½œä¸ºæœ€åçš„ç»“æœ</li></ul><ol><li>Boosting ç®—æ³•<br>å°†å¼±åˆ†ç±»å™¨ç»„è£…æˆä¸€ä¸ªå¼ºåˆ†ç±»å™¨</li></ol><ul><li><p>AdaBoostï¼ˆAdaptive boostingï¼‰ç®—æ³•ï¼šæ¯æ¬¡è®­ç»ƒåï¼Œå¯¹è®­ç»ƒå¤±è´¥çš„è®­ç»ƒä¾‹èµ‹ä»¥è¾ƒå¤§çš„<code>æƒé‡</code>ï¼Œä»è€Œå¾—åˆ°å¤šä¸ªé¢„æµ‹å‡½æ•°. é€šè¿‡æ‹Ÿåˆ<code>æ®‹å·®</code>çš„æ–¹å¼é€æ­¥å‡å°æ®‹å·®ï¼Œå°†æ¯ä¸€æ­¥ç”Ÿæˆçš„æ¨¡å‹<code>å åŠ </code>ï¼Œåªèƒ½é¡ºåºç”Ÿæˆ</p></li><li><p>GBDTï¼ˆGradient Boost Decision Tree)ï¼Œæ¯ä¸€æ¬¡çš„è®¡ç®—æ˜¯ä¸ºäº†å‡å°‘ä¸Šä¸€æ¬¡çš„æ®‹å·®ï¼ŒGBDTåœ¨æ®‹å·®å‡å°‘ï¼ˆè´Ÿæ¢¯åº¦ï¼‰çš„æ–¹å‘ä¸Š<code>å»ºç«‹ä¸€ä¸ªæ–°çš„æ¨¡å‹</code></p></li></ul><ol><li><p>Stacking ç®—æ³•<br>æŠŠä¹‹å‰è®­ç»ƒçš„å„ä¸ªæ¨¡å‹çš„ã€Œè¾“å‡ºã€ï¼Œä½œä¸ºä¸ºã€Œè¾“å…¥ã€æ¥<code>è®­ç»ƒ</code>ä¸€ä¸ªæ¨¡å‹ï¼Œä»¥å¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„è¾“å‡º. é€šå¸¸ä½¿ç”¨logisticå›å½’ä½œä¸ºç»„åˆç­–ç•¥</p></li><li><p>å†³ç­–æ ‘ä¸è¿™äº›ç®—æ³•æ¡†æ¶è¿›è¡Œç»“åˆæ‰€å¾—åˆ°çš„æ–°çš„ç®—æ³•ï¼š<br>1ï¼‰Bagging + å†³ç­–æ ‘ = éšæœºæ£®æ—<br>2ï¼‰AdaBoost + å†³ç­–æ ‘ = æå‡æ ‘<br>3ï¼‰Gradient Boosting + å†³ç­–æ ‘ = GBDT</p></li></ol><h2 id="æœºå™¨å­¦ä¹ æ¦‚å¿µç»†èŠ‚-ï¼ˆæœ€å¥½åšä¸€ä¸ªé€ŸæŸ¥ç´¢å¼•ï¼‰"><a href="#æœºå™¨å­¦ä¹ æ¦‚å¿µç»†èŠ‚-ï¼ˆæœ€å¥½åšä¸€ä¸ªé€ŸæŸ¥ç´¢å¼•ï¼‰" class="headerlink" title="æœºå™¨å­¦ä¹ æ¦‚å¿µç»†èŠ‚ ï¼ˆæœ€å¥½åšä¸€ä¸ªé€ŸæŸ¥ç´¢å¼•ï¼‰"></a>æœºå™¨å­¦ä¹ æ¦‚å¿µç»†èŠ‚ ï¼ˆæœ€å¥½åšä¸€ä¸ªé€ŸæŸ¥ç´¢å¼•ï¼‰</h2><h3 id="èŒƒæ•°-L1-L2"><a href="#èŒƒæ•°-L1-L2" class="headerlink" title="èŒƒæ•° L1 L2"></a>èŒƒæ•° L1 L2</h3><ol><li>èŒƒæ•°çš„æ¦‚å¿µ<br>èŒƒæ•°æ˜¯å…·æœ‰â€œé•¿åº¦â€æ¦‚å¿µçš„å‡½æ•°. åœ¨å‘é‡ç©ºé—´å†…ï¼Œä¸ºæ‰€æœ‰çš„å‘é‡çš„èµ‹äºˆéé›¶çš„å¢é•¿åº¦æˆ–è€…å¤§å°. ä¸åŒçš„èŒƒæ•°ï¼Œæ‰€æ±‚çš„å‘é‡çš„é•¿åº¦æˆ–è€…å¤§å°æ˜¯ä¸åŒçš„. </li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œ2ç»´ç©ºé—´ä¸­ï¼Œå‘é‡(3,4)çš„é•¿åº¦æ˜¯5ï¼Œé‚£ä¹ˆ5å°±æ˜¯è¿™ä¸ªå‘é‡çš„ä¸€ä¸ªèŒƒæ•°çš„å€¼ï¼Œæ›´ç¡®åˆ‡çš„è¯´ï¼Œæ˜¯æ¬§å¼èŒƒæ•°æˆ–è€…L2èŒƒæ•°çš„å€¼. </p><ol><li>å„ç§èŒƒæ•°<br>L0èŒƒæ•°æ˜¯æŒ‡å‘é‡ä¸­é0çš„å…ƒç´ çš„ä¸ªæ•°. (L0èŒƒæ•°å¾ˆéš¾ä¼˜åŒ–æ±‚è§£)</li></ol><p>L1èŒƒæ•°æ˜¯æŒ‡å‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼ä¹‹å’Œ</p><p>L2èŒƒæ•°æ˜¯æŒ‡å‘é‡å„å…ƒç´ çš„å¹³æ–¹å’Œç„¶åæ±‚å¹³æ–¹æ ¹ -&gt; å²­å›å½’ Ridge Regression == æƒå€¼è¡°å‡ weight decay</p><p>L1èŒƒæ•°å¯ä»¥è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå³è®©ç‰¹å¾çš„ç³»æ•°å˜ä¸º0.</p><p>L2èŒƒæ•°å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæœ‰åŠ©äºå¤„ç† condition numberä¸å¥½ä¸‹çš„çŸ©é˜µ(æ•°æ®å˜åŒ–å¾ˆå°çŸ©é˜µæ±‚è§£åç»“æœå˜åŒ–å¾ˆå¤§)</p><ol><li>å„è‡ªçš„åŒºåˆ«<br>L1èŒƒæ•°å’ŒL0èŒƒæ•°å¯ä»¥å®ç°ç¨€ç–ï¼ŒL1å› å…·æœ‰æ¯”L0æ›´å¥½çš„ä¼˜åŒ–æ±‚è§£ç‰¹æ€§è€Œè¢«å¹¿æ³›åº”ç”¨</li></ol><p>L1 å¯ä»¥å®ç°ç¨€ç–æ€§ï¼Œè€Œ L2 ä¸è¡Œ. L1ä¼šè¶‹å‘äºäº§ç”Ÿå°‘é‡çš„ç‰¹å¾ï¼Œè€Œå…¶ä»–çš„ç‰¹å¾éƒ½æ˜¯0ï¼Œè€ŒL2ä¼šé€‰æ‹©æ›´å¤šçš„ç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾éƒ½ä¼šæ¥è¿‘äº0. Lassoåœ¨ç‰¹å¾é€‰æ‹©æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œè€ŒRidgeå°±åªæ˜¯ä¸€ç§è§„åˆ™åŒ–è€Œå·²</p><ol><li>å®ç°ç¨€ç–çš„å¥½å¤„<br>åˆ©äºç‰¹å¾é€‰æ‹© + æ›´å¥½çš„å¯è§£é‡Šæ€§</li></ol>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç«èµ›-æˆ¿ç§Ÿé¢„æµ‹</title>
      <link href="/2020/02/26/housing-project/"/>
      <url>/2020/02/26/housing-project/</url>
      
        <content type="html"><![CDATA[<h1 id="æˆ¿ç§Ÿé¢„æµ‹"><a href="#æˆ¿ç§Ÿé¢„æµ‹" class="headerlink" title="æˆ¿ç§Ÿé¢„æµ‹"></a>æˆ¿ç§Ÿé¢„æµ‹</h1><h2 id="ä¸€-èµ›é¢˜åˆ†æ"><a href="#ä¸€-èµ›é¢˜åˆ†æ" class="headerlink" title="(ä¸€) èµ›é¢˜åˆ†æ"></a>(ä¸€) èµ›é¢˜åˆ†æ</h2><p>æ¯”èµ›è¦æ±‚å‚èµ›é€‰æ‰‹æ ¹æ®ç»™å®šçš„æ•°æ®é›†ï¼Œå»ºç«‹æ¨¡å‹ï¼Œé¢„æµ‹æˆ¿å±‹ç§Ÿé‡‘ã€‚<br>æ•°æ®é›†ä¸­çš„æ•°æ®ç±»åˆ«åŒ…æ‹¬ç§Ÿèµæˆ¿æºã€å°åŒºã€äºŒæ‰‹æˆ¿ã€é…å¥—ã€æ–°æˆ¿ã€åœŸåœ°ã€äººå£ã€å®¢æˆ·ã€çœŸå®ç§Ÿé‡‘ç­‰ã€‚<br>è¿™æ˜¯å…¸å‹çš„<code>å›å½’é¢„æµ‹</code>ã€‚ </p><h3 id="EDA"><a href="#EDA" class="headerlink" title="EDA"></a>EDA</h3><p>æ¢ç´¢æ€§æ•°æ®åˆ†æ, Exploratory Data Analysisï¼Œç®€ç§°EDA</p><p>ä¼ ç»Ÿï¼šå…ˆå‡å®šæ•°æ®æœä»æŸç§åˆ†å¸ƒï¼Œç„¶åè¿ç”¨è¿™ç§æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œä»¥æ¦‚ç‡è®ºä¸ºåŸºç¡€ï¼Œåšå„ç§çš„å‚æ•°æ£€éªŒã€‚<br>EDAï¼šâ€œæŠ›å¼€â€æ¦‚ç‡ç†è®ºï¼Œä»æ•°æ®å‡ºå‘ï¼Œå¼ºè°ƒæ•°æ®å¯è§†åŒ–</p><p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://www.jianshu.com/p/9325c9f88ee6" target="_blank" rel="noopener">ä¸€æ–‡å¸¦ä½ æ¢ç´¢æ€§æ•°æ®åˆ†æ(EDA)</a></p><h2 id="1-é¢„æµ‹æŒ‡æ ‡"><a href="#1-é¢„æµ‹æŒ‡æ ‡" class="headerlink" title="1. é¢„æµ‹æŒ‡æ ‡"></a>1. é¢„æµ‹æŒ‡æ ‡</h2><h4 id="å›å½’ç»“æœè¯„ä»·æ ‡å‡†é‡‡ç”¨R-Square"><a href="#å›å½’ç»“æœè¯„ä»·æ ‡å‡†é‡‡ç”¨R-Square" class="headerlink" title="å›å½’ç»“æœè¯„ä»·æ ‡å‡†é‡‡ç”¨R-Square"></a>å›å½’ç»“æœè¯„ä»·æ ‡å‡†é‡‡ç”¨R-Square</h4><p><strong>R2ï¼ˆR-Squareï¼‰çš„å…¬å¼ä¸º</strong>ï¼š<br>æ®‹å·®å¹³æ–¹å’Œï¼š(åå·®)</p><script type="math/tex; mode=display">SS_{res}=\sum\left(y_{i}-\hat{y}_{i}\right)^{2}</script><p>æ€»å¹³å‡å€¼: (æ–¹å·®)</p><script type="math/tex; mode=display">SS_{tot}=\sum\left(y_{i}-\overline{y}_{i}\right)^{2}</script><p>å…¶ä¸­$\overline{y}$è¡¨ç¤º$y$çš„å¹³å‡å€¼<br>å¾—åˆ°$R^2$è¡¨è¾¾å¼ä¸ºï¼š</p><script type="math/tex; mode=display">R^{2}=1-\frac{SS_{res}}{SS_{tot}}=1-\frac{\sum\left(y_{i}-\hat{y}_{i}\right)^{2}}{\sum\left(y_{i}-\overline{y}\right)^{2}}</script><p>$R^2$ç”¨äºåº¦é‡<code>å› å˜é‡çš„å˜å¼‚ä¸­,å¯ç”±è‡ªå˜é‡è§£é‡Šéƒ¨åˆ†æ‰€å çš„æ¯”ä¾‹</code>ï¼Œå–å€¼èŒƒå›´æ˜¯ 0~1ï¼Œ$R^2$è¶Šæ¥è¿‘1,è¡¨æ˜å›å½’å¹³æ–¹å’Œå æ€»å¹³æ–¹å’Œçš„æ¯”ä¾‹è¶Šå¤§,å›å½’çº¿ä¸å„è§‚æµ‹ç‚¹è¶Šæ¥è¿‘ï¼Œç”¨xçš„å˜åŒ–æ¥è§£é‡Šyå€¼å˜åŒ–çš„éƒ¨åˆ†å°±è¶Šå¤š,å›å½’çš„æ‹Ÿåˆç¨‹åº¦å°±è¶Šå¥½ã€‚æ‰€ä»¥$R^2$ä¹Ÿç§°ä¸º<code>æ‹Ÿåˆä¼˜åº¦</code>ï¼ˆGoodness of Fitï¼‰çš„ç»Ÿè®¡é‡ã€‚</p><p>$y_{i}$è¡¨ç¤ºçœŸå®å€¼ï¼Œ$\hat{y}_{i}$è¡¨ç¤ºé¢„æµ‹å€¼ï¼Œ$\overline{y}_{i}$è¡¨ç¤ºæ ·æœ¬å‡å€¼ã€‚å¾—åˆ†è¶Šé«˜æ‹Ÿåˆæ•ˆæœè¶Šå¥½ã€‚</p><h4 id="ç®€è¦åˆ†æ"><a href="#ç®€è¦åˆ†æ" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h4><p>è¯¥ä»½è®­ç»ƒé›†åŒ…å« 41440è¡ŒÃ—52åˆ—æ•°æ®<br>ç›®æ ‡å˜é‡æ˜¯ çœŸå®æˆ¿ç§Ÿä»·æ ¼- <strong>tradeMoney</strong> </p><p>å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯intæˆ–floatå‹ï¼›æœ‰éƒ¨åˆ†å­—æ®µæ˜¯objectå‹ï¼Œå³æ–‡æœ¬å‹ä¸­æ–‡æˆ–è‹±æ–‡çš„ï¼Œå¦‚rentTypeå­—æ®µï¼Œè¿™äº›å­—æ®µåœ¨ä¹‹åéœ€è¦åšå¤„ç†  </p><h2 id="4-åˆ†ç±»ç‰¹å¾å’Œè¿ç»­å‹ç‰¹å¾"><a href="#4-åˆ†ç±»ç‰¹å¾å’Œè¿ç»­å‹ç‰¹å¾" class="headerlink" title="4. åˆ†ç±»ç‰¹å¾å’Œè¿ç»­å‹ç‰¹å¾"></a>4. åˆ†ç±»ç‰¹å¾å’Œè¿ç»­å‹ç‰¹å¾</h2><pre><code class="lang-py"># æ ¹æ®ç‰¹å¾å«ä¹‰å’Œç‰¹å¾ä¸€è§ˆï¼Œå¤§è‡´å¯ä»¥åˆ¤æ–­å‡ºæ•°å€¼å‹å’Œç±»åˆ«å‹ç‰¹å¾å¦‚ä¸‹categorical_feas = [&#39;rentType&#39;, &#39;houseType&#39;, &#39;houseFloor&#39;, &#39;region&#39;, &#39;plate&#39;, &#39;houseToward&#39;, &#39;houseDecoration&#39;,    &#39;communityName&#39;,&#39;city&#39;,&#39;region&#39;,&#39;plate&#39;,&#39;buildYear&#39;]numerical_feas=[&#39;ID&#39;,&#39;area&#39;,&#39;totalFloor&#39;,&#39;saleSecHouseNum&#39;,&#39;subwayStationNum&#39;,    &#39;busStationNum&#39;,&#39;interSchoolNum&#39;,&#39;schoolNum&#39;,&#39;privateSchoolNum&#39;,&#39;hospitalNum&#39;,    &#39;drugStoreNum&#39;,&#39;gymNum&#39;,&#39;bankNum&#39;,&#39;shopNum&#39;,&#39;parkNum&#39;,&#39;mallNum&#39;,&#39;superMarketNum&#39;,    &#39;totalTradeMoney&#39;,&#39;totalTradeArea&#39;,&#39;tradeMeanPrice&#39;,&#39;tradeSecNum&#39;,&#39;totalNewTradeMoney&#39;,    &#39;totalNewTradeArea&#39;,&#39;tradeNewMeanPrice&#39;,&#39;tradeNewNum&#39;,&#39;remainNewNum&#39;,&#39;supplyNewNum&#39;,    &#39;supplyLandNum&#39;,&#39;supplyLandArea&#39;,&#39;tradeLandNum&#39;,&#39;tradeLandArea&#39;,&#39;landTotalPrice&#39;,    &#39;landMeanPrice&#39;,&#39;totalWorkers&#39;,&#39;newWorkers&#39;,&#39;residentPopulation&#39;,&#39;pv&#39;,&#39;uv&#39;,&#39;lookNum&#39;]</code></pre><h2 id="5-ç¼ºå¤±å€¼åˆ†æ"><a href="#5-ç¼ºå¤±å€¼åˆ†æ" class="headerlink" title="5. ç¼ºå¤±å€¼åˆ†æ"></a>5. ç¼ºå¤±å€¼åˆ†æ</h2><pre><code class="lang-py"># ç¼ºå¤±å€¼åˆ†ædef missing_values(df):    alldata_na = pd.DataFrame(df.isnull().sum(), columns={&#39;missingNum&#39;})    alldata_na[&#39;existNum&#39;] = len(df) - alldata_na[&#39;missingNum&#39;]    alldata_na[&#39;sum&#39;] = len(df)    alldata_na[&#39;missingRatio&#39;] = alldata_na[&#39;missingNum&#39;]/len(df)*100    alldata_na[&#39;dtype&#39;] = df.dtypes    #ascendingï¼šé»˜è®¤Trueå‡åºæ’åˆ—ï¼›Falseé™åºæ’åˆ—    alldata_na = alldata_na[alldata_na[&#39;missingNum&#39;]&gt;0].reset_index().sort_values(by=[&#39;missingNum&#39;,&#39;index&#39;],ascending=[False,True])    alldata_na.set_index(&#39;index&#39;,inplace=True)    return alldata_namissing_values(data_train)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/26/PtSeMBzNDTI8l3f.png" alt=""></p><h3 id="ç®€è¦åˆ†æ-1"><a href="#ç®€è¦åˆ†æ-1" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h3><p>è¿™é‡Œé‡‡ç”¨ç¼–å†™å‡½æ•°çš„æ–¹å¼æ¥ç›´æ¥è·å–ç»“æœï¼ˆè¿™ç§æ–¹å¼ä¼šåœ¨ä¹‹ååå¤ç”¨åˆ°ï¼Œå»ºè®®å¤§å®¶å°½æ—©å…»æˆå‡½æ•°å¼ç¼–å†™çš„ä¹ æƒ¯ï¼‰ï¼›<br>å…¶å®åœ¨æ€»ä½“æƒ…å†µä¸€è§ˆä¸­ï¼Œinfo()å‡½æ•°ä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚  </p><p>ç»“æœæ˜¯ï¼Œä»…æœ‰pvã€uvå­˜åœ¨ç¼ºå¤±å€¼ï¼Œåé¢å†æ¢ç©¶ä¼šå‘ç°ç¼ºå¤±çš„éƒ½æ˜¯å±äºåŒä¸€ä¸ªplateï¼Œå¯èƒ½æ˜¯å®˜æ–¹ç›´æ¥åˆ é™¤äº†è¯¥plateçš„pvã€uv</p><h2 id="6-å•è°ƒç‰¹å¾åˆ—åˆ†æ"><a href="#6-å•è°ƒç‰¹å¾åˆ—åˆ†æ" class="headerlink" title="6. å•è°ƒç‰¹å¾åˆ—åˆ†æ"></a>6. å•è°ƒç‰¹å¾åˆ—åˆ†æ</h2><pre><code class="lang-py">#æ˜¯å¦æœ‰å•è°ƒç‰¹å¾åˆ—(å•è°ƒçš„ç‰¹å¾åˆ—å¾ˆå¤§å¯èƒ½æ˜¯æ—¶é—´)def incresing(vals):    cnt = 0    len_ = len(vals)    for i in range(len_-1):        if vals[i+1] &gt; vals[i]:            cnt += 1    return cntfea_cols = [col for col in data_train.columns]for col in fea_cols:    cnt = incresing(data_train[col].values)    if cnt / data_train.shape[0] &gt;= 0.55:        print(&#39;å•è°ƒç‰¹å¾ï¼š&#39;,col)        print(&#39;å•è°ƒç‰¹å¾å€¼ä¸ªæ•°ï¼š&#39;, cnt)        print(&#39;å•è°ƒç‰¹å¾å€¼æ¯”ä¾‹ï¼š&#39;, cnt / data_train.shape[0])</code></pre><p>å•è°ƒç‰¹å¾ï¼š tradeTime<br>å•è°ƒç‰¹å¾å€¼ä¸ªæ•°ï¼š 24085<br>å•è°ƒç‰¹å¾å€¼æ¯”ä¾‹ï¼š 0.5812017374517374</p><h3 id="ç®€è¦åˆ†æ-2"><a href="#ç®€è¦åˆ†æ-2" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h3><p>å…ˆç¼–å†™åˆ¤æ–­å•è°ƒçš„å‡½æ•° <em>incresing</em>ï¼Œ ç„¶åå†åº”ç”¨åˆ°æ¯åˆ—ä¸Šï¼›<br>å•è°ƒç‰¹å¾æ˜¯ tradeTimeï¼Œä¸ºæ—¶é—´åˆ—ã€‚  </p><p>å¤šè¯´å¥é¢å¤–çš„ï¼Œæ—¶é—´åˆ—åœ¨ç‰¹å¾å·¥ç¨‹çš„æ—¶å€™ï¼Œä¸åŒçš„æƒ…å†µä¸‹èƒ½æœ‰å¾ˆå¤šçš„å˜ç§å½¢å¼ï¼Œæ¯”å¦‚æŒ‰å¹´æœˆæ—¥åˆ†ç®±ï¼Œæˆ–è€…æŒ‰ä¸åŒçš„ç»´åº¦åœ¨æ—¶é—´ä¸Šèšåˆåˆ†ç»„ï¼Œç­‰ç­‰  </p><h2 id="7-ç‰¹å¾nuniqueåˆ†å¸ƒ"><a href="#7-ç‰¹å¾nuniqueåˆ†å¸ƒ" class="headerlink" title="7. ç‰¹å¾nuniqueåˆ†å¸ƒ"></a>7. ç‰¹å¾nuniqueåˆ†å¸ƒ</h2><pre><code class="lang-py"># ç‰¹å¾nuniqueåˆ†å¸ƒ# unique()æ˜¯ä»¥ æ•°ç»„å½¢å¼ï¼ˆnumpy.ndarrayï¼‰è¿”å›åˆ—çš„æ‰€æœ‰å”¯ä¸€å€¼ï¼ˆç‰¹å¾çš„æ‰€æœ‰å”¯ä¸€å€¼ï¼‰nunique è¿”å›å”¯ä¸€å€¼çš„ä¸ªæ•°for feature in categorical_feas:   # ç±»åˆ«å‹ç‰¹å¾    print(feature + &quot;çš„ç‰¹å¾åˆ†å¸ƒå¦‚ä¸‹ï¼š&quot;)    print(data_train[feature].value_counts())    if feature != &#39;communityName&#39;: # communityNameå€¼å¤ªå¤šï¼Œæš‚ä¸”ä¸çœ‹å›¾è¡¨        plt.hist(data_all[feature], bins=3)        plt.show()</code></pre><h3 id="ç®€è¦åˆ†æ-3"><a href="#ç®€è¦åˆ†æ-3" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h3><p>ç”¨è‡ªå¸¦å‡½æ•°value_counts() æ¥å¾—åˆ°æ¯ä¸ªåˆ†ç±»å˜é‡çš„ ç§ç±» åˆ†å¸ƒï¼›<br>å¹¶ä¸”ç®€å•ç”»å‡ºæŸ±çŠ¶å›¾ã€‚  </p><p>rentTypeï¼š4ç§ï¼Œä¸”ç»å¤§å¤šæ•°æ˜¯æ— ç”¨çš„æœªçŸ¥æ–¹å¼ï¼›<br>houseTypeï¼š104ç§ï¼Œç»å¤§å¤šæ•°åœ¨3å®¤åŠä»¥ä¸‹ï¼›<br>houseFloorï¼š3ç§ï¼Œåˆ†å¸ƒè¾ƒä¸ºå‡åŒ€ï¼›<br>regionï¼š       15ç§ï¼›<br>plateï¼š        66ç§ï¼›<br>houseTowardï¼š    10ç§ï¼›<br>houseDecorationï¼š 4ç§ï¼Œä¸€å¤§åŠæ˜¯å…¶ä»–ï¼›<br>buildYearï¼š     80ç§ï¼›<br>communityNameï¼š   4236ç§ï¼Œä¸”åˆ†å¸ƒè¾ƒä¸ºç¨€ç–ï¼›  </p><p>æ­¤æ­¥éª¤æ˜¯ä¸ºä¹‹åæ•°æ®å¤„ç†å’Œç‰¹å¾å·¥ç¨‹åšå‡†å¤‡ï¼Œå…ˆç†è§£æ¯ä¸ªå­—æ®µçš„å«ä¹‰ä»¥åŠåˆ†å¸ƒï¼Œä¹‹åéœ€è¦æ ¹æ®å®é™…å«ä¹‰å¯¹åˆ†ç±»å˜é‡åšä¸åŒçš„å¤„ç†ã€‚</p><h2 id="8-ç»Ÿè®¡ç‰¹å¾å€¼é¢‘æ¬¡å¤§äº100çš„ç‰¹å¾"><a href="#8-ç»Ÿè®¡ç‰¹å¾å€¼é¢‘æ¬¡å¤§äº100çš„ç‰¹å¾" class="headerlink" title="8. ç»Ÿè®¡ç‰¹å¾å€¼é¢‘æ¬¡å¤§äº100çš„ç‰¹å¾"></a>8. ç»Ÿè®¡ç‰¹å¾å€¼é¢‘æ¬¡å¤§äº100çš„ç‰¹å¾</h2><pre><code class="lang-py"># ç»Ÿè®¡ç‰¹å¾å€¼å‡ºç°é¢‘æ¬¡å¤§äº100çš„ç‰¹å¾for feature in categorical_feas:    df_value_counts = pd.DataFrame(data_train[feature].value_counts())    df_value_counts = df_value_counts.reset_index()    df_value_counts.columns = [feature, &#39;counts&#39;] # åˆ—çš„åå­—    print(df_value_counts[df_value_counts[&#39;counts&#39;] &gt;= 100])</code></pre><pre><code>  rentType  counts0     æœªçŸ¥æ–¹å¼   307591       æ•´ç§Ÿ    54722       åˆç§Ÿ    5204   houseType  counts0     1å®¤1å…1å«    98051     2å®¤1å…1å«    85122     2å®¤2å…1å«    67833     3å®¤1å…1å«    39924     3å®¤2å…2å«    27375     4å®¤1å…1å«    19576     3å®¤2å…1å«    19207     1å®¤0å…1å«    12868     1å®¤2å…1å«     9339     2å®¤2å…2å«     88110    4å®¤2å…2å«     43511    2å®¤0å…1å«     419......</code></pre><h3 id="ç®€è¦åˆ†æ-4"><a href="#ç®€è¦åˆ†æ-4" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h3><p>æ­¤æ­¥éª¤å’Œç‰¹å¾nuniqueåˆ†å¸ƒç»“åˆæ­¥éª¤ç»“åˆèµ·æ¥çœ‹ï¼Œæœ‰ä¸€äº›å°äº100çš„æ˜¯å¯ä»¥ç›´æ¥ç»Ÿä¸€å½’ç±»ä¸ºå…¶ä»–çš„</p><h2 id="9-Labelåˆ†å¸ƒ"><a href="#9-Labelåˆ†å¸ƒ" class="headerlink" title="9. Labelåˆ†å¸ƒ"></a>9. Labelåˆ†å¸ƒ</h2><p>åˆ†æ®µè¿›è¡Œ tradeMoney çš„ç»˜å›¾ (tradeMoney å°±æ˜¯æœ€åè¦é¢„æµ‹çš„å€¼)</p><pre><code class="lang-py"># Label åˆ†å¸ƒfig,axes = plt.subplots(2,3,figsize=(20,5))fig.set_size_inches(20,12)sns.distplot(data_train[&#39;tradeMoney&#39;],ax=axes[0][0])sns.distplot(data_train[(data_train[&#39;tradeMoney&#39;]&lt;=20000)][&#39;tradeMoney&#39;],ax=axes[0][1])sns.distplot(data_train[(data_train[&#39;tradeMoney&#39;]&gt;20000)&amp;(data_train[&#39;tradeMoney&#39;]&lt;=50000)][&#39;tradeMoney&#39;],ax=axes[0][2])sns.distplot(data_train[(data_train[&#39;tradeMoney&#39;]&gt;50000)&amp;(data_train[&#39;tradeMoney&#39;]&lt;=100000)][&#39;tradeMoney&#39;],ax=axes[1][0])sns.distplot(data_train[(data_train[&#39;tradeMoney&#39;]&gt;100000)][&#39;tradeMoney&#39;],ax=axes[1][1])</code></pre><p>money&lt;=10000 38964<br>10000&lt;money&lt;=20000 1985<br>20000&lt;money&lt;=50000 433<br>50000&lt;money&lt;=100000 39<br>100000&lt;money 19</p><h3 id="ç®€è¦åˆ†æ-5"><a href="#ç®€è¦åˆ†æ-5" class="headerlink" title="ç®€è¦åˆ†æ"></a>ç®€è¦åˆ†æ</h3><p>å°†ç›®æ ‡å˜é‡tradeMoneyåˆ†ç»„ï¼Œå¹¶æŸ¥çœ‹æ¯ç»„é—´çš„åˆ†å¸ƒï¼›<br>å¯ä»¥çœ‹å‡ºç»å¤§å¤šæ•°éƒ½æ˜¯é›†ä¸­åœ¨10000å…ƒä»¥å†…çš„ï¼Œå¹¶ä¸”ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°è¯¥åˆ†å¸ƒæ˜¯å³åçš„ã€‚  </p><p>è¿™é‡Œåªæ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œå®Œå…¨å¯ä»¥å°†tradeMoneyå’Œå…¶ä»–å­—æ®µä¸€èµ·ç»“åˆèµ·æ¥æŸ¥çœ‹ï¼Œæ¯”å¦‚æ¥¼å±‚é«˜ä½ï¼Œåœ°åŒºæ¿å—ã€‚  </p><h2 id="äºŒ-æ•°æ®æ¸…æ´—"><a href="#äºŒ-æ•°æ®æ¸…æ´—" class="headerlink" title="(äºŒ) æ•°æ®æ¸…æ´—"></a>(äºŒ) æ•°æ®æ¸…æ´—</h2><h3 id="ç¼ºå¤±å€¼åˆ†æåŠå¤„ç†"><a href="#ç¼ºå¤±å€¼åˆ†æåŠå¤„ç†" class="headerlink" title="ç¼ºå¤±å€¼åˆ†æåŠå¤„ç†"></a>ç¼ºå¤±å€¼åˆ†æåŠå¤„ç†</h3><ul><li>ç¼ºå¤±å€¼å‡ºç°çš„åŸå› åˆ†æ</li><li>é‡‡å–åˆé€‚çš„æ–¹å¼å¯¹ç¼ºå¤±å€¼è¿›è¡Œå¡«å……</li></ul><h3 id="å¼‚å¸¸å€¼åˆ†æåŠå¤„ç†"><a href="#å¼‚å¸¸å€¼åˆ†æåŠå¤„ç†" class="headerlink" title="å¼‚å¸¸å€¼åˆ†æåŠå¤„ç†"></a>å¼‚å¸¸å€¼åˆ†æåŠå¤„ç†</h3><ul><li><p>æ ¹æ®æµ‹è¯•é›†æ•°æ®çš„åˆ†å¸ƒå¤„ç†è®­ç»ƒé›†çš„æ•°æ®åˆ†å¸ƒ</p></li><li><p>ä½¿ç”¨åˆé€‚çš„æ–¹æ³•æ‰¾å‡ºå¼‚å¸¸å€¼</p></li><li>å¯¹å¼‚å¸¸å€¼è¿›è¡Œå¤„ç†</li></ul><h3 id="æ·±åº¦æ¸…æ´—"><a href="#æ·±åº¦æ¸…æ´—" class="headerlink" title="æ·±åº¦æ¸…æ´—"></a>æ·±åº¦æ¸…æ´—</h3><ul><li>åˆ†ææ¯ä¸€ä¸ªcommunityNameã€cityã€regionã€plateçš„æ•°æ®åˆ†å¸ƒå¹¶å¯¹å…¶è¿›è¡Œæ•°æ®æ¸…æ´—</li></ul><h2 id="ç¼ºå¤±å€¼å¤„ç†"><a href="#ç¼ºå¤±å€¼å¤„ç†" class="headerlink" title="ç¼ºå¤±å€¼å¤„ç†"></a>ç¼ºå¤±å€¼å¤„ç†</h2><p>è™½ç„¶è¿™æ­¥éª¤æ˜¯ç¼ºå¤±å€¼å¤„ç†ï¼Œä½†è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›æœ€æœ€åŸºç¡€çš„æ•°æ®å¤„ç†ã€‚  </p><ol><li><p><strong>ä¸»è¦æ€è·¯åˆ†æ</strong><br>ç¼ºå¤±å€¼çš„å¤„ç†æ‰‹æ®µå¤§ä½“å¯ä»¥åˆ†ä¸ºï¼š<code>åˆ é™¤ã€å¡«å……ã€æ˜ å°„åˆ°é«˜ç»´(å½“åšç±»åˆ«å¤„ç†)</code>.<br>æ ¹æ®ä»»åŠ¡ä¸€ï¼Œç›´æ¥æ‰¾åˆ°çš„ç¼ºå¤±å€¼æƒ…å†µæ˜¯puå’Œpvï¼›ä½†æ˜¯ï¼Œæ ¹æ®ç‰¹å¾nuniqueåˆ†å¸ƒçš„åˆ†æï¼Œå¯ä»¥å‘ç°rentTypeå­˜åœ¨â€â€”â€œçš„æƒ…å†µï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸€ç§ç¼ºå¤±å€¼.<br>æ­¤å¤–ï¼Œè¯¸å¦‚rentTypeçš„â€æœªçŸ¥æ–¹å¼â€ï¼›houseTowardçš„â€æš‚æ— æ•°æ®â€ç­‰ï¼Œæœ¬è´¨ä¸Šä¹Ÿç®—æ˜¯ä¸€ç§ç¼ºå¤±å€¼ï¼Œä½†æ˜¯å¯¹äºè¿™äº›ç¼ºå¤±æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšæ˜¯<code>ç‰¹æ®Šçš„ä¸€ç±»</code>å¤„ç†ï¼Œè€Œä¸éœ€è¦å»ä¸»åŠ¨ä¿®æ”¹æˆ–å¡«å……å€¼. </p><p> (1) å°†rentTypeçš„â€â€”â€œè½¬æ¢æˆ<code>æœªçŸ¥æ–¹å¼</code>ç±»åˆ«ï¼›<br> (2) pv/puçš„ç¼ºå¤±å€¼ç”¨<code>å‡å€¼</code>å¡«å……ï¼›<br> (3) buildYearå­˜åœ¨â€æš‚æ— ä¿¡æ¯â€ï¼Œå°†å…¶ç”¨<code>ä¼—æ•°</code>å¡«å……ã€‚  </p></li></ol><ol><li><strong>è½¬æ¢objectç±»å‹æ•°æ®</strong><br>è¿™é‡Œç›´æ¥é‡‡ç”¨<code>LabelEncoder</code>çš„æ–¹å¼ç¼–ç ï¼Œè¯¦ç»†çš„ç¼–ç æ–¹å¼è§ç›¸å…³èµ„æ–™.  </li></ol><ol><li><strong>æ—¶é—´å­—æ®µçš„å¤„ç†</strong><br>buildYearç”±äºå­˜åœ¨â€æš‚æ— ä¿¡æ¯â€,æ‰€ä»¥éœ€è¦ä¸»åŠ¨å°†å…¶è½¬æ¢intç±»å‹ï¼›<br>tradeTimeï¼Œå°†å…¶åˆ†å‰²æˆæœˆå’Œæ—¥.</li></ol><ol><li><strong>åˆ é™¤æ— å…³å­—æ®µ</strong><br>IDæ˜¯å”¯ä¸€ç ï¼Œå»ºæ¨¡æ— ç”¨ï¼Œæ‰€ä»¥ç›´æ¥åˆ é™¤ï¼›<br>cityåªæœ‰ä¸€ä¸ªSHå€¼ï¼Œä¹Ÿç›´æ¥åˆ é™¤ï¼›<br>tradeTimeå·²ç»åˆ†å‰²æˆæœˆå’Œæ—¥ï¼Œåˆ é™¤åŸæ¥å­—æ®µ</li></ol><h2 id="å¼‚å¸¸å€¼å¤„ç†"><a href="#å¼‚å¸¸å€¼å¤„ç†" class="headerlink" title="å¼‚å¸¸å€¼å¤„ç†"></a>å¼‚å¸¸å€¼å¤„ç†</h2><p>è¿™é‡Œä¸»è¦é’ˆå¯¹areaå’ŒtradeMoneyä¸¤ä¸ªç»´åº¦å¤„ç†ã€‚<br>é’ˆå¯¹tradeMoneyï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯IsolationForestæ¨¡å‹è‡ªåŠ¨å¤„ç†ï¼›<br>é’ˆå¯¹areaå’ŒtotalFlooræ˜¯ä¸»è§‚+æ•°æ®å¯è§†åŒ–çš„æ–¹å¼å¾—åˆ°çš„ç»“æœã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://zhuanlan.zhihu.com/p/25040651" target="_blank" rel="noopener">iForest ï¼ˆIsolation Forestï¼‰å­¤ç«‹æ£®æ— å¼‚å¸¸æ£€æµ‹ å…¥é—¨ç¯‡</a></p><pre><code class="lang-py"># clean datadef IF_drop(train):    IForest = IsolationForest(contamination=0.01)    IForest.fit(train[&quot;tradeMoney&quot;].values.reshape(-1,1))    y_pred = IForest.predict(train[&quot;tradeMoney&quot;].values.reshape(-1,1))    drop_index = train.loc[y_pred==-1].index    print(drop_index)    train.drop(drop_index,inplace=True)    return traindata_train = IF_drop(data_train)def dropData(train):    # ä¸¢å¼ƒéƒ¨åˆ†å¼‚å¸¸å€¼    train = train[train.area &lt;= 200]    train = train[(train.tradeMoney &lt;=16000) &amp; (train.tradeMoney &gt;=700)]    train.drop(train[(train[&#39;totalFloor&#39;] == 0)].index, inplace=True)    return train  #æ•°æ®é›†å¼‚å¸¸å€¼å¤„ç†data_train = dropData(data_train)</code></pre><pre><code class="lang-py"># å¤„ç†å¼‚å¸¸å€¼åå†æ¬¡æŸ¥çœ‹é¢ç§¯å’Œç§Ÿé‡‘åˆ†å¸ƒå›¾plt.figure(figsize=(15,5))sns.boxplot(data_train.area)plt.show()plt.figure(figsize=(15,5))sns.boxplot(data_train.tradeMoney),plt.show()</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/26/FSBwQgIRaWX1OLv.png" alt="tradeMoney"></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/26/l5v69PJUBwndINO.png" alt="area"></p><h2 id="æ·±åº¦æ¸…æ´—-1"><a href="#æ·±åº¦æ¸…æ´—-1" class="headerlink" title="æ·±åº¦æ¸…æ´—"></a>æ·±åº¦æ¸…æ´—</h2><p>é’ˆå¯¹æ¯ä¸€ä¸ªregionçš„æ•°æ®ï¼Œå¯¹areaå’ŒtradeMoneyä¸¤ä¸ªç»´åº¦è¿›è¡Œæ·±åº¦æ¸…æ´—, é€ä¸ªé€ä¸ª drop.<br>é‡‡ç”¨ä¸»è§‚+æ•°æ®å¯è§†åŒ–çš„æ–¹å¼.</p><pre><code class="lang-py">def cleanData(data):    data.drop(data[(data[&#39;region&#39;]==&#39;RG00001&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1000)&amp;(data[&#39;area&#39;]&gt;50)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00001&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;25000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00001&#39;) &amp; (data[&#39;area&#39;]&gt;250)&amp;(data[&#39;tradeMoney&#39;]&lt;20000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00001&#39;) &amp; (data[&#39;area&#39;]&gt;400)&amp;(data[&#39;tradeMoney&#39;]&gt;50000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00001&#39;) &amp; (data[&#39;area&#39;]&gt;100)&amp;(data[&#39;tradeMoney&#39;]&lt;2000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00002&#39;) &amp; (data[&#39;area&#39;]&lt;100)&amp;(data[&#39;tradeMoney&#39;]&gt;60000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;area&#39;]&lt;300)&amp;(data[&#39;tradeMoney&#39;]&gt;30000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;500)&amp;(data[&#39;area&#39;]&lt;50)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1500)&amp;(data[&#39;area&#39;]&gt;100)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;2000)&amp;(data[&#39;area&#39;]&gt;300)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;5000)&amp;(data[&#39;area&#39;]&lt;20)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00003&#39;) &amp; (data[&#39;area&#39;]&gt;600)&amp;(data[&#39;tradeMoney&#39;]&gt;40000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00004&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1000)&amp;(data[&#39;area&#39;]&gt;80)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00006&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;200)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00005&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;2000)&amp;(data[&#39;area&#39;]&gt;180)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00005&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;50000)&amp;(data[&#39;area&#39;]&lt;200)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00006&#39;) &amp; (data[&#39;area&#39;]&gt;200)&amp;(data[&#39;tradeMoney&#39;]&lt;2000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00007&#39;) &amp; (data[&#39;area&#39;]&gt;100)&amp;(data[&#39;tradeMoney&#39;]&lt;2500)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00010&#39;) &amp; (data[&#39;area&#39;]&gt;200)&amp;(data[&#39;tradeMoney&#39;]&gt;25000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00010&#39;) &amp; (data[&#39;area&#39;]&gt;400)&amp;(data[&#39;tradeMoney&#39;]&lt;15000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00010&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;3000)&amp;(data[&#39;area&#39;]&gt;200)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00010&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;7000)&amp;(data[&#39;area&#39;]&lt;75)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00010&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;12500)&amp;(data[&#39;area&#39;]&lt;100)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00004&#39;) &amp; (data[&#39;area&#39;]&gt;400)&amp;(data[&#39;tradeMoney&#39;]&gt;20000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00008&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;2000)&amp;(data[&#39;area&#39;]&gt;80)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00009&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;40000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00009&#39;) &amp; (data[&#39;area&#39;]&gt;300)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00009&#39;) &amp; (data[&#39;area&#39;]&gt;100)&amp;(data[&#39;tradeMoney&#39;]&lt;2000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00011&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;10000)&amp;(data[&#39;area&#39;]&gt;390)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00012&#39;) &amp; (data[&#39;area&#39;]&gt;120)&amp;(data[&#39;tradeMoney&#39;]&lt;5000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00013&#39;) &amp; (data[&#39;area&#39;]&lt;100)&amp;(data[&#39;tradeMoney&#39;]&gt;40000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00013&#39;) &amp; (data[&#39;area&#39;]&gt;400)&amp;(data[&#39;tradeMoney&#39;]&gt;50000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00013&#39;) &amp; (data[&#39;area&#39;]&gt;80)&amp;(data[&#39;tradeMoney&#39;]&lt;2000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;area&#39;]&gt;300)&amp;(data[&#39;tradeMoney&#39;]&gt;40000)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1300)&amp;(data[&#39;area&#39;]&gt;80)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;8000)&amp;(data[&#39;area&#39;]&gt;200)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1000)&amp;(data[&#39;area&#39;]&gt;20)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;25000)&amp;(data[&#39;area&#39;]&gt;200)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00014&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;20000)&amp;(data[&#39;area&#39;]&gt;250)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00005&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;30000)&amp;(data[&#39;area&#39;]&lt;100)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00005&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;50000)&amp;(data[&#39;area&#39;]&gt;600)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00005&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;50000)&amp;(data[&#39;area&#39;]&gt;350)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00006&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;4000)&amp;(data[&#39;area&#39;]&lt;100)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00006&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;600)&amp;(data[&#39;area&#39;]&gt;100)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00006&#39;) &amp; (data[&#39;area&#39;]&gt;165)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00012&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;800)&amp;(data[&#39;area&#39;]&lt;30)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00007&#39;) &amp; (data[&#39;tradeMoney&#39;]&lt;1100)&amp;(data[&#39;area&#39;]&gt;50)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00004&#39;) &amp; (data[&#39;tradeMoney&#39;]&gt;8000)&amp;(data[&#39;area&#39;]&lt;80)].index,inplace=True)    data.loc[(data[&#39;region&#39;]==&#39;RG00002&#39;)&amp;(data[&#39;area&#39;]&gt;50)&amp;(data[&#39;rentType&#39;]==&#39;åˆç§Ÿ&#39;),&#39;rentType&#39;]=&#39;æ•´ç§Ÿ&#39;    data.loc[(data[&#39;region&#39;]==&#39;RG00014&#39;)&amp;(data[&#39;rentType&#39;]==&#39;åˆç§Ÿ&#39;)&amp;(data[&#39;area&#39;]&gt;60),&#39;rentType&#39;]=&#39;æ•´ç§Ÿ&#39;    data.drop(data[(data[&#39;region&#39;]==&#39;RG00008&#39;)&amp;(data[&#39;tradeMoney&#39;]&gt;15000)&amp;(data[&#39;area&#39;]&lt;110)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00008&#39;)&amp;(data[&#39;tradeMoney&#39;]&gt;20000)&amp;(data[&#39;area&#39;]&gt;110)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00008&#39;)&amp;(data[&#39;tradeMoney&#39;]&lt;1500)&amp;(data[&#39;area&#39;]&lt;50)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00008&#39;)&amp;(data[&#39;rentType&#39;]==&#39;åˆç§Ÿ&#39;)&amp;(data[&#39;area&#39;]&gt;50)].index,inplace=True)    data.drop(data[(data[&#39;region&#39;]==&#39;RG00015&#39;) ].index,inplace=True)    data.reset_index(drop=True, inplace=True)    return datadata_train = cleanData(data_train)</code></pre><h2 id="ä¸‰-ç‰¹å¾å·¥ç¨‹"><a href="#ä¸‰-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="(ä¸‰) ç‰¹å¾å·¥ç¨‹"></a>(ä¸‰) ç‰¹å¾å·¥ç¨‹</h2><pre><code class="lang-python">#æ ¸å¿ƒä»£ç ä¸¾ä¾‹# ç»Ÿè®¡ç‰¹å¾    #è®¡ç®—å‡å€¼    gp = train.groupby(by)[fea].mean()    #è®¡ç®—ä¸­ä½æ•°    gp = train.groupby(by)[fea].median()    #è®¡ç®—æ–¹å·®    gp = train.groupby(by)[fea].std()    #è®¡ç®—æœ€å¤§å€¼    gp = train.groupby(by)[fea].max()    #è®¡ç®—æœ€å°å€¼    gp = train.groupby(by)[fea].min()    #è®¡ç®—å‡ºç°æ¬¡æ•°    gp = train.groupby(by)[fea].size()# groupbyç”Ÿæˆç»Ÿè®¡ç‰¹å¾ï¼šmean,std    # æŒ‰ç…§communityNameåˆ†ç»„è®¡ç®—é¢ç§¯çš„å‡å€¼å’Œæ–¹å·®    temp = data.groupby(&#39;communityName&#39;)[&#39;area&#39;].agg({&#39;com_area_mean&#39;: &#39;mean&#39;, &#39;com_area_std&#39;: &#39;std&#39;})# ç‰¹å¾æ‹†åˆ†    # å°†houseTypeè½¬ä¸º&#39;Room&#39;ï¼Œ&#39;Hall&#39;ï¼Œ&#39;Bath&#39;    def Room(x):        Room = int(x.split(&#39;å®¤&#39;)[0])        return Room    def Hall(x):        Hall = int(x.split(&quot;å®¤&quot;)[1].split(&quot;å…&quot;)[0])        return Hall    def Bath(x):        Bath = int(x.split(&quot;å®¤&quot;)[1].split(&quot;å…&quot;)[1].split(&quot;å«&quot;)[0])        return Bath    data[&#39;Room&#39;] = data[&#39;houseType&#39;].apply(lambda x: Room(x))    data[&#39;Hall&#39;] = data[&#39;houseType&#39;].apply(lambda x: Hall(x))    data[&#39;Bath&#39;] = data[&#39;houseType&#39;].apply(lambda x: Bath(x))#ç‰¹å¾åˆå¹¶    # åˆå¹¶éƒ¨åˆ†é…å¥—è®¾æ–½ç‰¹å¾    data[&#39;trainsportNum&#39;] = 5 * data[&#39;subwayStationNum&#39;] / data[&#39;subwayStationNum&#39;].mean() + data[&#39;busStationNum&#39;] / \                                                                                             data[                                                                                                 &#39;busStationNum&#39;].mean()# äº¤å‰ç”Ÿæˆç‰¹å¾:ç‰¹å¾ä¹‹é—´äº¤å‰+ - * / data[&#39;Room_Bath&#39;] = (data[&#39;Bath&#39;]+1) / (data[&#39;Room&#39;]+1)# èšç±»ç‰¹å¾from sklearn.mixture import GaussianMixture  ä½¿ç”¨GaussianMixtureåšèšç±»ç‰¹å¾gmm = GaussianMixture(n_components=4, covariance_type=&#39;full&#39;, random_state=0)gmm.fit_predict(data)# ç‰¹å¾ç¼–ç from sklearn.preprocessing import LabelEncoderdata[&#39;communityName&#39;] = LabelEncoder().fit_transform(data[&#39;communityName&#39;])from sklearn import preprocessing.OneHotEncoderdata[&#39;communityName&#39;] = OneHotEncoder().fit_transform(data[&#39;communityName&#39;])# è¿‡å¤§é‡çº§å€¼å–logå¹³æ»‘ï¼ˆé’ˆå¯¹çº¿æ€§æ¨¡å‹æœ‰æ•ˆï¼‰data[feature]=np.log1p(data[feature])</code></pre><pre><code class="lang-python">import pandas as pdimport warningswarnings.filterwarnings(&#39;ignore&#39;)from sklearn.preprocessing import LabelEncodertrain = pd.read_csv(&#39;./train_data.csv&#39;)test = pd.read_csv(&#39;./test_a.csv&#39;)target_train = train.pop(&#39;tradeMoney&#39;)target_test = test.pop(&#39;tradeMoney&#39;)</code></pre><h3 id="ç‰¹å¾åˆå¹¶"><a href="#ç‰¹å¾åˆå¹¶" class="headerlink" title="ç‰¹å¾åˆå¹¶"></a>ç‰¹å¾åˆå¹¶</h3><pre><code class="lang-python">def newfeature(data):    # å°†houseTypeè½¬ä¸º&#39;Room&#39;ï¼Œ&#39;Hall&#39;ï¼Œ&#39;Bath&#39;    def Room(x):        Room = int(x.split(&#39;å®¤&#39;)[0])        return Room    def Hall(x):        Hall = int(x.split(&quot;å®¤&quot;)[1].split(&quot;å…&quot;)[0])        return Hall    def Bath(x):        Bath = int(x.split(&quot;å®¤&quot;)[1].split(&quot;å…&quot;)[1].split(&quot;å«&quot;)[0])        return Bath    data[&#39;Room&#39;] = data[&#39;houseType&#39;].apply(lambda x: Room(x))    data[&#39;Hall&#39;] = data[&#39;houseType&#39;].apply(lambda x: Hall(x))    data[&#39;Bath&#39;] = data[&#39;houseType&#39;].apply(lambda x: Bath(x))    data[&#39;Room_Bath&#39;] = (data[&#39;Bath&#39;]+1) / (data[&#39;Room&#39;]+1)    # å¡«å……ç§Ÿæˆ¿ç±»å‹  loc å–è¡Œæ•°æ®    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;Room&#39;] &lt;= 1), &#39;rentType&#39;] = &#39;æ•´ç§Ÿ&#39;    # print(data.loc[(data[&#39;rentType&#39;]==&#39;æœªçŸ¥æ–¹å¼&#39;)&amp;(data[&#39;Room_Bath&#39;]&gt;1),&#39;rentType&#39;])    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;Room_Bath&#39;] &gt; 1), &#39;rentType&#39;] = &#39;åˆç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;Room&#39;] &gt; 1) &amp; (data[&#39;area&#39;] &lt; 50), &#39;rentType&#39;] = &#39;åˆç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] / data[&#39;Room&#39;] &lt; 20), &#39;rentType&#39;] = &#39;åˆç§Ÿ&#39;    # data.loc[(data[&#39;rentType&#39;]==&#39;æœªçŸ¥æ–¹å¼&#39;)&amp;(data[&#39;area&#39;]&gt;60),&#39;rentType&#39;]=&#39;åˆç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] &lt;= 50) &amp; (data[&#39;Room&#39;] == 2), &#39;rentType&#39;] = &#39;åˆç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] &gt; 60) &amp; (data[&#39;Room&#39;] == 2), &#39;rentType&#39;] = &#39;æ•´ç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] &lt;= 60) &amp; (data[&#39;Room&#39;] == 3), &#39;rentType&#39;] = &#39;åˆç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] &gt; 60) &amp; (data[&#39;Room&#39;] == 3), &#39;rentType&#39;] = &#39;æ•´ç§Ÿ&#39;    data.loc[(data[&#39;rentType&#39;] == &#39;æœªçŸ¥æ–¹å¼&#39;) &amp; (data[&#39;area&#39;] &gt;= 100) &amp; (data[&#39;Room&#39;] &gt; 3), &#39;rentType&#39;] = &#39;æ•´ç§Ÿ&#39;    # data.drop(&#39;Room_Bath&#39;, axis=1, inplace=True)    # æå‡0.0001    def month(x):        month = int(x.split(&#39;/&#39;)[1])        return month    # def day(x):    #     day = int(x.split(&#39;/&#39;)[2])    #     return day    # ç»“æœå˜å·®    # åˆ†å‰²äº¤æ˜“æ—¶é—´    # data[&#39;year&#39;]=data[&#39;tradeTime&#39;].apply(lambda x:year(x))    data[&#39;month&#39;] = data[&#39;tradeTime&#39;].apply(lambda x: month(x))    # data[&#39;day&#39;] = data[&#39;tradeTime&#39;].apply(lambda x: day(x))# ç»“æœå˜å·®    #     data[&#39;pv/uv&#39;] = data[&#39;pv&#39;] / data[&#39;uv&#39;]    #     data[&#39;æˆ¿é—´æ€»æ•°&#39;] = data[&#39;å®¤&#39;] + data[&#39;å…&#39;] + data[&#39;å«&#39;]    # åˆå¹¶éƒ¨åˆ†é…å¥—è®¾æ–½ç‰¹å¾    data[&#39;trainsportNum&#39;] = 5 * data[&#39;subwayStationNum&#39;] / data[&#39;subwayStationNum&#39;].mean() + data[&#39;busStationNum&#39;] / \                                                                                             data[                                                                                                 &#39;busStationNum&#39;].mean()    data[&#39;all_SchoolNum&#39;] = 2 * data[&#39;interSchoolNum&#39;] / data[&#39;interSchoolNum&#39;].mean() + data[&#39;schoolNum&#39;] / data[        &#39;schoolNum&#39;].mean() \                            + data[&#39;privateSchoolNum&#39;] / data[&#39;privateSchoolNum&#39;].mean()    data[&#39;all_hospitalNum&#39;] = 2 * data[&#39;hospitalNum&#39;] / data[&#39;hospitalNum&#39;].mean() + \                              data[&#39;drugStoreNum&#39;] / data[&#39;drugStoreNum&#39;].mean()    data[&#39;all_mall&#39;] = data[&#39;mallNum&#39;] / data[&#39;mallNum&#39;].mean() + \                       data[&#39;superMarketNum&#39;] / data[&#39;superMarketNum&#39;].mean()    data[&#39;otherNum&#39;] = data[&#39;gymNum&#39;] / data[&#39;gymNum&#39;].mean() + data[&#39;bankNum&#39;] / data[&#39;bankNum&#39;].mean() + \                       data[&#39;shopNum&#39;] / data[&#39;shopNum&#39;].mean() + 2 * data[&#39;parkNum&#39;] / data[&#39;parkNum&#39;].mean()    data.drop([&#39;subwayStationNum&#39;, &#39;busStationNum&#39;,               &#39;interSchoolNum&#39;, &#39;schoolNum&#39;, &#39;privateSchoolNum&#39;,               &#39;hospitalNum&#39;, &#39;drugStoreNum&#39;, &#39;mallNum&#39;, &#39;superMarketNum&#39;, &#39;gymNum&#39;, &#39;bankNum&#39;, &#39;shopNum&#39;, &#39;parkNum&#39;],              axis=1, inplace=True)    # æå‡0.0005#     data[&#39;houseType_1sumcsu&#39;]=data[&#39;Bath&#39;].map(lambda x:str(x))+data[&#39;month&#39;].map(lambda x:str(x))#     data[&#39;houseType_2sumcsu&#39;]=data[&#39;Bath&#39;].map(lambda x:str(x))+data[&#39;communityName&#39;]#     data[&#39;houseType_3sumcsu&#39;]=data[&#39;Bath&#39;].map(lambda x:str(x))+data[&#39;plate&#39;]    data.drop(&#39;houseType&#39;, axis=1, inplace=True)    data.drop(&#39;tradeTime&#39;, axis=1, inplace=True)    data[&quot;area&quot;] = data[&quot;area&quot;].astype(int)    # categorical_feats = [&#39;rentType&#39;, &#39;houseFloor&#39;, &#39;houseToward&#39;, &#39;houseDecoration&#39;, &#39;communityName&#39;,&#39;region&#39;, &#39;plate&#39;]    categorical_feats = [&#39;rentType&#39;, &#39;houseFloor&#39;, &#39;houseToward&#39;, &#39;houseDecoration&#39;,  &#39;region&#39;, &#39;plate&#39;,&#39;cluster&#39;]    return data, categorical_feats</code></pre><h3 id="è®¡ç®—ç»Ÿè®¡ç‰¹å¾"><a href="#è®¡ç®—ç»Ÿè®¡ç‰¹å¾" class="headerlink" title="è®¡ç®—ç»Ÿè®¡ç‰¹å¾"></a>è®¡ç®—ç»Ÿè®¡ç‰¹å¾</h3><pre><code class="lang-python">#è®¡ç®—ç»Ÿè®¡ç‰¹å¾def featureCount(train,test):    train[&#39;data_type&#39;] = 0    test[&#39;data_type&#39;] = 1    data = pd.concat([train, test], axis=0, join=&#39;outer&#39;)    def feature_count(data, features=[]):        new_feature = &#39;count&#39;        for i in features:            new_feature += &#39;_&#39; + i        temp = data.groupby(features).size().reset_index().rename(columns={0: new_feature})        data = data.merge(temp, &#39;left&#39;, on=features)        return data    data = feature_count(data, [&#39;communityName&#39;])    data = feature_count(data, [&#39;buildYear&#39;])    data = feature_count(data, [&#39;totalFloor&#39;])    data = feature_count(data, [&#39;communityName&#39;, &#39;totalFloor&#39;])    data = feature_count(data, [&#39;communityName&#39;, &#39;newWorkers&#39;])    data = feature_count(data, [&#39;communityName&#39;, &#39;totalTradeMoney&#39;])    new_train = data[data[&#39;data_type&#39;] == 0]    new_test = data[data[&#39;data_type&#39;] == 1]    new_train.drop(&#39;data_type&#39;, axis=1, inplace=True)    new_test.drop([&#39;data_type&#39;], axis=1, inplace=True)    return new_train, new_testtrain, test = featureCount(train, test)</code></pre><h3 id="groupbyæ–¹æ³•ç”Ÿæˆç»Ÿè®¡ç‰¹å¾"><a href="#groupbyæ–¹æ³•ç”Ÿæˆç»Ÿè®¡ç‰¹å¾" class="headerlink" title="groupbyæ–¹æ³•ç”Ÿæˆç»Ÿè®¡ç‰¹å¾"></a>groupbyæ–¹æ³•ç”Ÿæˆç»Ÿè®¡ç‰¹å¾</h3><pre><code class="lang-python">#groupbyç”Ÿæˆç»Ÿè®¡ç‰¹å¾ï¼šmean,stdç­‰def gourpby(train,test):    train[&#39;data_type&#39;] = 0    test[&#39;data_type&#39;] = 1    data = pd.concat([train, test], axis=0, join=&#39;outer&#39;)    columns = [&#39;rentType&#39;, &#39;houseFloor&#39;, &#39;houseToward&#39;, &#39;houseDecoration&#39;, &#39;communityName&#39;, &#39;region&#39;, &#39;plate&#39;]    for feature in columns:        data[feature] = LabelEncoder().fit_transform(data[feature])    temp = data.groupby(&#39;communityName&#39;)[&#39;area&#39;].agg({&#39;com_area_mean&#39;: &#39;mean&#39;, &#39;com_area_std&#39;: &#39;std&#39;})    temp.fillna(0, inplace=True)    data = data.merge(temp, on=&#39;communityName&#39;, how=&#39;left&#39;)    data[&#39;price_per_area&#39;] = data.tradeMeanPrice / data.area * 100    temp = data.groupby(&#39;communityName&#39;)[&#39;price_per_area&#39;].agg(        {&#39;comm_price_mean&#39;: &#39;mean&#39;, &#39;comm_price_std&#39;: &#39;std&#39;})    temp.fillna(0, inplace=True)    data = data.merge(temp, on=&#39;communityName&#39;, how=&#39;left&#39;)    temp = data.groupby(&#39;plate&#39;)[&#39;price_per_area&#39;].agg(        {&#39;plate_price_mean&#39;: &#39;mean&#39;, &#39;plate_price_std&#39;: &#39;std&#39;})    temp.fillna(0, inplace=True)    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    data.drop(&#39;price_per_area&#39;, axis=1, inplace=True)    temp = data.groupby(&#39;plate&#39;)[&#39;area&#39;].agg({&#39;plate_area_mean&#39;: &#39;mean&#39;, &#39;plate_area_std&#39;: &#39;std&#39;})    temp.fillna(0, inplace=True)    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    temp = data.groupby([&#39;plate&#39;])[&#39;buildYear&#39;].agg({&#39;plate_year_mean&#39;: &#39;mean&#39;, &#39;plate_year_std&#39;: &#39;std&#39;})    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    data.plate_year_mean = data.plate_year_mean.astype(&#39;int&#39;)    data[&#39;comm_plate_year_diff&#39;] = data.buildYear - data.plate_year_mean    data.drop(&#39;plate_year_mean&#39;, axis=1, inplace=True)    temp = data.groupby(&#39;plate&#39;)[&#39;trainsportNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;plate_trainsportNum&#39;)    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    temp = data.groupby([&#39;communityName&#39;, &#39;plate&#39;])[&#39;trainsportNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;com_trainsportNum&#39;)    data = data.merge(temp, on=[&#39;communityName&#39;, &#39;plate&#39;], how=&#39;left&#39;)    data[&#39;trainsportNum_ratio&#39;] = list(map(lambda x, y: round(x / y, 3) if y != 0 else -1,                                           data[&#39;com_trainsportNum&#39;], data[&#39;plate_trainsportNum&#39;]))    data = data.drop([&#39;com_trainsportNum&#39;, &#39;plate_trainsportNum&#39;], axis=1)    temp = data.groupby(&#39;plate&#39;)[&#39;all_SchoolNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;plate_all_SchoolNum&#39;)    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    temp = data.groupby([&#39;communityName&#39;, &#39;plate&#39;])[&#39;all_SchoolNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;com_all_SchoolNum&#39;)    data = data.merge(temp, on=[&#39;communityName&#39;, &#39;plate&#39;], how=&#39;left&#39;)    data = data.drop([&#39;com_all_SchoolNum&#39;, &#39;plate_all_SchoolNum&#39;], axis=1)    temp = data.groupby([&#39;communityName&#39;, &#39;plate&#39;])[&#39;all_mall&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;com_all_mall&#39;)    data = data.merge(temp, on=[&#39;communityName&#39;, &#39;plate&#39;], how=&#39;left&#39;)    temp = data.groupby(&#39;plate&#39;)[&#39;otherNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;plate_otherNum&#39;)    data = data.merge(temp, on=&#39;plate&#39;, how=&#39;left&#39;)    temp = data.groupby([&#39;communityName&#39;, &#39;plate&#39;])[&#39;otherNum&#39;].agg(&#39;sum&#39;).reset_index(name=&#39;com_otherNum&#39;)    data = data.merge(temp, on=[&#39;communityName&#39;, &#39;plate&#39;], how=&#39;left&#39;)    data[&#39;other_ratio&#39;] = list(map(lambda x, y: round(x / y, 3) if y != 0 else -1,                                   data[&#39;com_otherNum&#39;], data[&#39;plate_otherNum&#39;]))    data = data.drop([&#39;com_otherNum&#39;, &#39;plate_otherNum&#39;], axis=1)    temp = data.groupby([&#39;month&#39;, &#39;communityName&#39;]).size().reset_index(name=&#39;communityName_saleNum&#39;)    data = data.merge(temp, on=[&#39;month&#39;, &#39;communityName&#39;], how=&#39;left&#39;)    temp = data.groupby([&#39;month&#39;, &#39;plate&#39;]).size().reset_index(name=&#39;plate_saleNum&#39;)    data = data.merge(temp, on=[&#39;month&#39;, &#39;plate&#39;], how=&#39;left&#39;)    data[&#39;sale_ratio&#39;] = round((data.communityName_saleNum + 1) / (data.plate_saleNum + 1), 3)    data[&#39;sale_newworker_differ&#39;] = 3 * data.plate_saleNum - data.newWorkers    data.drop([&#39;communityName_saleNum&#39;, &#39;plate_saleNum&#39;], axis=1, inplace=True)    new_train = data[data[&#39;data_type&#39;] == 0]    new_test = data[data[&#39;data_type&#39;] == 1]    new_train.drop(&#39;data_type&#39;, axis=1, inplace=True)    new_test.drop([&#39;data_type&#39;], axis=1, inplace=True)    return new_train, new_testtrain, test = gourpby(train, test)</code></pre><h3 id="èšç±»æ–¹æ³•"><a href="#èšç±»æ–¹æ³•" class="headerlink" title="èšç±»æ–¹æ³•"></a>èšç±»æ–¹æ³•</h3><pre><code class="lang-python">#èšç±»def cluster(train,test):    from sklearn.mixture import GaussianMixture    train[&#39;data_type&#39;] = 0    test[&#39;data_type&#39;] = 1    data = pd.concat([train, test], axis=0, join=&#39;outer&#39;)    col = [&#39;totalFloor&#39;,           &#39;houseDecoration&#39;, &#39;communityName&#39;, &#39;region&#39;, &#39;plate&#39;, &#39;buildYear&#39;,           &#39;tradeMeanPrice&#39;, &#39;tradeSecNum&#39;, &#39;totalNewTradeMoney&#39;,           &#39;totalNewTradeArea&#39;, &#39;tradeNewMeanPrice&#39;, &#39;tradeNewNum&#39;, &#39;remainNewNum&#39;,           &#39;landTotalPrice&#39;, &#39;landMeanPrice&#39;, &#39;totalWorkers&#39;,           &#39;newWorkers&#39;, &#39;residentPopulation&#39;, &#39;lookNum&#39;,           &#39;trainsportNum&#39;,           &#39;all_SchoolNum&#39;, &#39;all_hospitalNum&#39;, &#39;all_mall&#39;, &#39;otherNum&#39;]    # EM    gmm = GaussianMixture(n_components=3, covariance_type=&#39;full&#39;, random_state=0)    data[&#39;cluster&#39;]= pd.DataFrame(gmm.fit_predict(data[col]))    col1 = [&#39;totalFloor&#39;,&#39;houseDecoration&#39;, &#39;communityName&#39;, &#39;region&#39;, &#39;plate&#39;, &#39;buildYear&#39;]    col2 = [&#39;tradeMeanPrice&#39;, &#39;tradeSecNum&#39;, &#39;totalNewTradeMoney&#39;,            &#39;totalNewTradeArea&#39;, &#39;tradeNewMeanPrice&#39;, &#39;tradeNewNum&#39;, &#39;remainNewNum&#39;,            &#39;landTotalPrice&#39;, &#39;landMeanPrice&#39;, &#39;totalWorkers&#39;,            &#39;newWorkers&#39;, &#39;residentPopulation&#39;, &#39;lookNum&#39;,            &#39;trainsportNum&#39;,            &#39;all_SchoolNum&#39;, &#39;all_hospitalNum&#39;, &#39;all_mall&#39;, &#39;otherNum&#39;]    for feature1 in col1:        for feature2 in col2:            temp = data.groupby([&#39;cluster&#39;,feature1])[feature2].agg(&#39;mean&#39;).reset_index(name=feature2+&#39;_&#39;+feature1+&#39;_cluster_mean&#39;)            temp.fillna(0, inplace=True)            data = data.merge(temp, on=[&#39;cluster&#39;, feature1], how=&#39;left&#39;)    new_train = data[data[&#39;data_type&#39;] == 0]    new_test = data[data[&#39;data_type&#39;] == 1]    new_train.drop(&#39;data_type&#39;, axis=1, inplace=True)    new_test.drop([&#39;data_type&#39;], axis=1, inplace=True)    return new_train, new_testtrain, test = cluster(train, test)</code></pre><h3 id="logå¹³æ»‘"><a href="#logå¹³æ»‘" class="headerlink" title="logå¹³æ»‘"></a>logå¹³æ»‘</h3><pre><code class="lang-python"># è¿‡å¤§é‡çº§å€¼å–logå¹³æ»‘ï¼ˆé’ˆå¯¹çº¿æ€§æ¨¡å‹æœ‰æ•ˆï¼‰big_num_cols = [&#39;totalTradeMoney&#39;,&#39;totalTradeArea&#39;,&#39;tradeMeanPrice&#39;,&#39;totalNewTradeMoney&#39;, &#39;totalNewTradeArea&#39;,                &#39;tradeNewMeanPrice&#39;,&#39;remainNewNum&#39;, &#39;supplyNewNum&#39;, &#39;supplyLandArea&#39;,                &#39;tradeLandArea&#39;,&#39;landTotalPrice&#39;,&#39;landMeanPrice&#39;,&#39;totalWorkers&#39;,&#39;newWorkers&#39;,                &#39;residentPopulation&#39;,&#39;pv&#39;,&#39;uv&#39;]for col in big_num_cols:        train[col] = train[col].map(lambda x: np.log1p(x))        test[col] = test[col].map(lambda x: np.log1p(x))</code></pre><pre><code class="lang-python">#å¯¹æ¯”ç‰¹å¾å·¥ç¨‹å‰åçº¿æ€§æ¨¡å‹ç»“æœæƒ…å†µtest=test.fillna(0)# Lassoå›å½’from sklearn.linear_model import Lassolasso=Lasso(alpha=0.1)lasso.fit(train,target_train)#é¢„æµ‹æµ‹è¯•é›†å’Œè®­ç»ƒé›†ç»“æœy_pred_train=lasso.predict(train)y_pred_test=lasso.predict(test)#å¯¹æ¯”ç»“æœfrom sklearn.metrics import r2_scorescore_train=r2_score(y_pred_train,target_train)print(&quot;è®­ç»ƒé›†ç»“æœï¼š&quot;,score_train)score_test=r2_score(y_pred_test, target_test)print(&quot;æµ‹è¯•é›†ç»“æœï¼š&quot;,score_test)</code></pre><h2 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h2><pre><code class="lang-python">import pandas as pdimport warningswarnings.filterwarnings(&#39;ignore&#39;)from sklearn.preprocessing import LabelEncoder#è¯»å–æ•°æ®train = pd.read_csv(&#39;&#39;)test = pd.read_csv(&#39;&#39;)target_train = train.pop(&#39;tradeMoney&#39;)target_test = test.pop(&#39;tradeMoney&#39;)</code></pre><h3 id="ç›¸å…³ç³»æ•°æ³•"><a href="#ç›¸å…³ç³»æ•°æ³•" class="headerlink" title="ç›¸å…³ç³»æ•°æ³•"></a>ç›¸å…³ç³»æ•°æ³•</h3><pre><code class="lang-python">#ç›¸å…³ç³»æ•°æ³•ç‰¹å¾é€‰æ‹©from sklearn.feature_selection import SelectKBestprint(train.shape)sk=SelectKBest(k=150)new_train=sk.fit_transform(train,target_train)print(new_train.shape)# è·å–å¯¹åº”åˆ—ç´¢å¼•select_columns=sk.get_support(indices = True)# print(select_columns)# è·å–å¯¹åº”åˆ—å# print(test.columns[select_columns])select_columns_name=test.columns[select_columns]new_test=test[select_columns_name]print(new_test.shape)# Lassoå›å½’from sklearn.linear_model import Lassolasso=Lasso(alpha=0.1)lasso.fit(new_train,target_train)#é¢„æµ‹æµ‹è¯•é›†å’Œè®­ç»ƒé›†ç»“æœy_pred_train=lasso.predict(new_train)y_pred_test=lasso.predict(new_test)#å¯¹æ¯”ç»“æœfrom sklearn.metrics import r2_scorescore_train=r2_score(y_pred_train,target_train)print(&quot;è®­ç»ƒé›†ç»“æœï¼š&quot;,score_train)score_test=r2_score(y_pred_test, target_test)print(&quot;æµ‹è¯•é›†ç»“æœï¼š&quot;,score_test)</code></pre><h3 id="Wrapper"><a href="#Wrapper" class="headerlink" title="Wrapper"></a>Wrapper</h3><pre><code class="lang-python"># Wrapperfrom sklearn.feature_selection import RFEfrom sklearn.linear_model import LinearRegressionlr = LinearRegression()rfe = RFE(lr, n_features_to_select=160)rfe.fit(train,target_train)RFE(estimator=LinearRegression(copy_X=True, fit_intercept=True, n_jobs=None,                               normalize=False),    n_features_to_select=40, step=1, verbose=0)select_columns = [f for f, s in zip(train.columns, rfe.support_) if s]print(select_columns)new_train = train[select_columns]new_test = test[select_columns]# Lassoå›å½’from sklearn.linear_model import Lassolasso=Lasso(alpha=0.1)lasso.fit(new_train,target_train)#é¢„æµ‹æµ‹è¯•é›†å’Œè®­ç»ƒé›†ç»“æœy_pred_train=lasso.predict(new_train)y_pred_test=lasso.predict(new_test)#å¯¹æ¯”ç»“æœfrom sklearn.metrics import r2_scorescore_train=r2_score(y_pred_train,target_train)print(&quot;è®­ç»ƒé›†ç»“æœï¼š&quot;,score_train)score_test=r2_score(y_pred_test, target_test)print(&quot;æµ‹è¯•é›†ç»“æœï¼š&quot;,score_test)</code></pre><h3 id="Embedded"><a href="#Embedded" class="headerlink" title="Embedded"></a>Embedded</h3><h4 id="åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•"><a href="#åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•" class="headerlink" title="åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•"></a>åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•</h4><h4 id="Lasso-L1-å’Œ-Ridge-L2"><a href="#Lasso-L1-å’Œ-Ridge-L2" class="headerlink" title="Lasso(L1) å’Œ Ridge(L2)"></a>Lasso(L1) å’Œ Ridge(L2)</h4><pre><code class="lang-python"># Embedded# åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•# Lasso(l1)å’ŒRidge(l2)from sklearn.linear_model import Ridgeridge = Ridge(alpha=5)ridge.fit(train,target_train)Ridge(alpha=5, copy_X=True, fit_intercept=True, max_iter=None, normalize=False,      random_state=None, solver=&#39;auto&#39;, tol=0.001)# ç‰¹å¾ç³»æ•°æ’åºcoefSort = ridge.coef_.argsort()print(coefSort)# ç‰¹å¾ç³»æ•°featureCoefSore=ridge.coef_[coefSort]print(featureCoefSore)select_columns = [f for f, s in zip(train.columns, featureCoefSore) if abs(s)&gt; 0.0000005 ] # é€‰æ‹©ç»å¯¹å€¼å¤§äº0.0000005çš„ç‰¹å¾new_train = train[select_columns]new_test = test[select_columns]# Lassoå›å½’from sklearn.linear_model import Lassolasso=Lasso(alpha=0.1)lasso.fit(new_train,target_train)#é¢„æµ‹æµ‹è¯•é›†å’Œè®­ç»ƒé›†ç»“æœy_pred_train=lasso.predict(new_train)y_pred_test=lasso.predict(new_test)#å¯¹æ¯”ç»“æœfrom sklearn.metrics import r2_scorescore_train=r2_score(y_pred_train,target_train)print(&quot;è®­ç»ƒé›†ç»“æœï¼š&quot;,score_train)score_test=r2_score(y_pred_test, target_test)print(&quot;æµ‹è¯•é›†ç»“æœï¼š&quot;,score_test)</code></pre><h4 id="åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•"><a href="#åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•" class="headerlink" title="åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•"></a>åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•</h4><h4 id="éšæœºæ£®æ—-å¹³å‡ä¸çº¯åº¦å‡å°‘ï¼ˆmean-decrease-impurityï¼‰"><a href="#éšæœºæ£®æ—-å¹³å‡ä¸çº¯åº¦å‡å°‘ï¼ˆmean-decrease-impurityï¼‰" class="headerlink" title="éšæœºæ£®æ— å¹³å‡ä¸çº¯åº¦å‡å°‘ï¼ˆmean decrease impurityï¼‰"></a>éšæœºæ£®æ— å¹³å‡ä¸çº¯åº¦å‡å°‘ï¼ˆmean decrease impurityï¼‰</h4><pre><code class="lang-python"># Embedded# åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•# éšæœºæ£®æ— å¹³å‡ä¸çº¯åº¦å‡å°‘ï¼ˆmean decrease impurityfrom sklearn.ensemble import RandomForestRegressorrf = RandomForestRegressor()# è®­ç»ƒéšæœºæ£®æ—æ¨¡å‹ï¼Œå¹¶é€šè¿‡feature_importances_å±æ€§è·å–æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§åˆ†æ•°ã€‚rf = RandomForestRegressor()rf.fit(train,target_train)print(&quot;Features sorted by their score:&quot;)print(sorted(zip(map(lambda x: round(x, 4), rf.feature_importances_), train.columns),             reverse=True))select_columns = [f for f, s in zip(train.columns, rf.feature_importances_) if abs(s)&gt; 0.00005 ] # é€‰æ‹©ç»å¯¹å€¼å¤§äº0.00005çš„ç‰¹å¾new_train = train[select_columns]new_test = test[select_columns]# Lassoå›å½’from sklearn.linear_model import Lassolasso=Lasso(alpha=0.1)lasso.fit(new_train,target_train)#é¢„æµ‹æµ‹è¯•é›†å’Œè®­ç»ƒé›†ç»“æœy_pred_train=lasso.predict(new_train)y_pred_test=lasso.predict(new_test)#å¯¹æ¯”ç»“æœfrom sklearn.metrics import r2_scorescore_train=r2_score(y_pred_train,target_train)print(&quot;è®­ç»ƒé›†ç»“æœï¼š&quot;,score_train)score_test=r2_score(y_pred_test, target_test)print(&quot;æµ‹è¯•é›†ç»“æœï¼š&quot;,score_test)</code></pre><h2 id="å››-æ¨¡å‹é€‰æ‹©"><a href="#å››-æ¨¡å‹é€‰æ‹©" class="headerlink" title="(å››) æ¨¡å‹é€‰æ‹©"></a>(å››) æ¨¡å‹é€‰æ‹©</h2><h3 id="ä»¥-lightGBM-ä¸ºä¾‹"><a href="#ä»¥-lightGBM-ä¸ºä¾‹" class="headerlink" title="ä»¥ lightGBM ä¸ºä¾‹"></a>ä»¥ lightGBM ä¸ºä¾‹</h3><pre><code class="lang-py">from __future__ import print_functionimport lightgbm as lgbimport sklearnimport numpyimport hyperoptfrom hyperopt import hp, fmin, tpe, STATUS_OK, Trialsimport coloramaimport numpy as npN_HYPEROPT_PROBES = 500HYPEROPT_ALGO = tpe.suggest  #  tpe.suggest OR hyperopt.rand.suggest# ----------------------------------------------------------colorama.init()# ---------------------------------------------------------------------def get_lgb_params(space):    lgb_params = dict()    lgb_params[&#39;boosting_type&#39;] = space[&#39;boosting_type&#39;] if &#39;boosting_type&#39; in space else &#39;gbdt&#39;    lgb_params[&#39;objective&#39;] = &#39;regression&#39;    lgb_params[&#39;metric&#39;] = &#39;rmse&#39;    lgb_params[&#39;learning_rate&#39;] = space[&#39;learning_rate&#39;]    lgb_params[&#39;num_leaves&#39;] = int(space[&#39;num_leaves&#39;])    lgb_params[&#39;min_data_in_leaf&#39;] = int(space[&#39;min_data_in_leaf&#39;])    lgb_params[&#39;min_sum_hessian_in_leaf&#39;] = space[&#39;min_sum_hessian_in_leaf&#39;]    lgb_params[&#39;max_depth&#39;] = -1    lgb_params[&#39;lambda_l1&#39;] = space[&#39;lambda_l1&#39;] if &#39;lambda_l1&#39; in space else 0.0    lgb_params[&#39;lambda_l2&#39;] = space[&#39;lambda_l2&#39;] if &#39;lambda_l2&#39; in space else 0.0    lgb_params[&#39;max_bin&#39;] = int(space[&#39;max_bin&#39;]) if &#39;max_bin&#39; in space else 256    lgb_params[&#39;feature_fraction&#39;] = space[&#39;feature_fraction&#39;]    lgb_params[&#39;bagging_fraction&#39;] = space[&#39;bagging_fraction&#39;]    lgb_params[&#39;bagging_freq&#39;] = int(space[&#39;bagging_freq&#39;]) if &#39;bagging_freq&#39; in space else 1    lgb_params[&#39;nthread&#39;] = 4    return lgb_params# ---------------------------------------------------------------------obj_call_count = 0cur_best_score = 0 # 0 or np.inflog_writer = open( &#39;../log/lgb-hyperopt-log.txt&#39;, &#39;w&#39; )def objective(space):    global obj_call_count, cur_best_score    obj_call_count += 1    print(&#39;\nLightGBM objective call #{} cur_best_score={:7.5f}&#39;.format(obj_call_count,cur_best_score) )    lgb_params = get_lgb_params(space)    sorted_params = sorted(space.items(), key=lambda z: z[0])    params_str = str.join(&#39; &#39;, [&#39;{}={}&#39;.format(k, v) for k, v in sorted_params])    print(&#39;Params: {}&#39;.format(params_str) )    kf = KFold(n_splits=3, shuffle=True, random_state=0)    out_of_fold = np.zeros(len(X_train))    for fold, (train_idx, val_idx) in enumerate(kf.split(X_train)):        D_train = lgb.Dataset(X_train.iloc[train_idx], label=Y_train[train_idx])        D_val = lgb.Dataset(X_train.iloc[val_idx], label=Y_train[val_idx])        # Train        num_round = 10000        clf = lgb.train(lgb_params,                           D_train,                           num_boost_round=num_round,                           # metrics=&#39;mlogloss&#39;,                           valid_sets=D_val,                           # valid_names=&#39;val&#39;,                           # fobj=None,                           # feval=None,                           # init_model=None,                           # feature_name=&#39;auto&#39;,                           # categorical_feature=&#39;auto&#39;,                           early_stopping_rounds=200,                           # evals_result=None,                           verbose_eval=False,                           # learning_rates=None,                           # keep_training_booster=False,                           # callbacks=None                           )        # predict        nb_trees = clf.best_iteration        val_loss = clf.best_score[&#39;valid_0&#39;]        print(&#39;nb_trees={} val_loss={}&#39;.format(nb_trees, val_loss))        out_of_fold[val_idx] = clf.predict(X_train.iloc[val_idx], num_iteration=nb_trees)        score = r2_score(out_of_fold, Y_train)    print(&#39;val_r2_score={}&#39;.format(score))    log_writer.write(&#39;score={} Params:{} nb_trees={}\n&#39;.format(score, params_str, nb_trees ))    log_writer.flush()    if score&gt;cur_best_score:        cur_best_score = score        print(colorama.Fore.GREEN + &#39;NEW BEST SCORE={}&#39;.format(cur_best_score) + colorama.Fore.RESET)    return {&#39;loss&#39;: -score, &#39;status&#39;: STATUS_OK}# --------------------------------------------------------------------------------space ={        &#39;num_leaves&#39;: hp.quniform (&#39;num_leaves&#39;, 10, 100, 1),        &#39;min_data_in_leaf&#39;:  hp.quniform (&#39;min_data_in_leaf&#39;, 10, 100, 1),        &#39;feature_fraction&#39;: hp.uniform(&#39;feature_fraction&#39;, 0.75, 1.0),        &#39;bagging_fraction&#39;: hp.uniform(&#39;bagging_fraction&#39;, 0.75, 1.0),        &#39;learning_rate&#39;: hp.uniform(&#39;learning_rate&#39;, 0, 0.01),#         &#39;learning_rate&#39;: hp.loguniform(&#39;learning_rate&#39;, -5.0, -2.3),        &#39;min_sum_hessian_in_leaf&#39;: hp.loguniform(&#39;min_sum_hessian_in_leaf&#39;, 0, 2.3),        &#39;max_bin&#39;: hp.quniform (&#39;max_bin&#39;, 88, 200, 1),        &#39;bagging_freq&#39;: hp.quniform (&#39;bagging_freq&#39;, 1, 15, 1),        &#39;lambda_l1&#39;: hp.uniform(&#39;lambda_l1&#39;, 0, 10 ),        &#39;lambda_l2&#39;: hp.uniform(&#39;lambda_l2&#39;, 0, 10 ),       }trials = Trials()best = hyperopt.fmin(fn=objective,                     space=space,                     algo=HYPEROPT_ALGO,                     max_evals=N_HYPEROPT_PROBES,                     trials=trials,                     verbose=1)print(&#39;-&#39;*50)print(&#39;The best params:&#39;)print( best )print(&#39;\n\n&#39;)</code></pre><h2 id="äº”-æ¨¡å‹èåˆ"><a href="#äº”-æ¨¡å‹èåˆ" class="headerlink" title="(äº”) æ¨¡å‹èåˆ"></a>(äº”) æ¨¡å‹èåˆ</h2><p>å°†ç‰¹å¾æ”¾è¿›æ¨¡å‹ä¸­é¢„æµ‹ï¼Œå¹¶å°†é¢„æµ‹ç»“æœä½œä¸ºæ–°çš„ç‰¹å¾åŠ å…¥åŸæœ‰ç‰¹å¾ä¸­å†ç»è¿‡æ¨¡å‹é¢„æµ‹ç»“æœï¼ˆå¯ä»¥åå¤é¢„æµ‹å¤šæ¬¡å°†ç»“æœåŠ å…¥æœ€åçš„ç‰¹å¾ä¸­ï¼‰</p><pre><code class="lang-python">from sklearn.model_selection import KFold    folds = KFold(n_splits=5, shuffle=True, random_state=2333)    &quot;===================================ç¬¬ä¸€è½®========================================================&quot;    y_pre_list = []    r2_list = []    train_feat = pd.Series()    for fold_, (trn_idx, val_idx) in enumerate(folds.split(feature.values, label)):        print(&quot;fold {}&quot;.format(fold_))        trn_data = lgb.Dataset(feature.iloc[trn_idx], label[trn_idx], categorical_feature=categorical_feats)        val_data = lgb.Dataset(feature.iloc[val_idx], label[val_idx], categorical_feature=categorical_feats)        num_round = 10000        clf = lgb.train(params, trn_data, num_round,valid_sets=[trn_data, val_data], verbose_eval=500,                    early_stopping_rounds=200)        y_pre = clf.predict(feature.iloc[val_idx], num_iteration=clf.best_iteration)        r2 = r2_score(y_pre,label[val_idx])        r2_list.append(r2)        train_feat = train_feat.append(pd.Series(y_pre,index=val_idx))        y_pre_test = clf.predict(test,num_iteration=clf.best_iteration)        y_pre_list.append(y_pre_test)    print(&#39;r2 score{:}&#39;.format(r2))    print(&#39;r2:{:}&#39;.format(np.mean(r2_list)))    y_pred_final=  (y_pre_list[0]+y_pre_list[1]+y_pre_list[2]+y_pre_list[3]+y_pre_list[4])/5    feature[&#39;pre&#39;] = train_feat    test[&#39;pre&#39;] = y_pred_final    &quot;===================================ç¬¬äºŒè½®========================================================&quot;    y_pre_list = []    r2_list = []    train_feat = pd.Series()    for fold_, (trn_idx, val_idx) in enumerate(folds.split(feature.values, label)):        print(&quot;fold {}&quot;.format(fold_))        trn_data = lgb.Dataset(feature.iloc[trn_idx], label[trn_idx], categorical_feature=categorical_feats)        val_data = lgb.Dataset(feature.iloc[val_idx], label[val_idx], categorical_feature=categorical_feats)        num_round = 10000        clf = lgb.train(params, trn_data, num_round, feval=get_r2_metric,valid_sets=[trn_data, val_data], verbose_eval=500,                    early_stopping_rounds=200)        y_pre = clf.predict(feature.iloc[val_idx], num_iteration=clf.best_iteration)        r2 = r2_score(y_pre,label[val_idx])        r2_list.append(r2)        train_feat = train_feat.append(pd.Series(y_pre,index=val_idx))        y_pre_test = clf.predict(test,num_iteration=clf.best_iteration)        y_pre_list.append(y_pre_test)    print(&#39;r2 score{:}&#39;.format(r2))    print(&#39;r2:{:}&#39;.format(np.mean(r2_list)))    y_pred_final=  (y_pre_list[0]+y_pre_list[1]+y_pre_list[2]+y_pre_list[3]+y_pre_list[4])/5    feature[&#39;pre_2&#39;] = train_feat    test[&#39;pre_2&#39;] = y_pred_final    &quot;=======================ç¬¬ä¸‰è½®========================================================&quot;    y_pre_list = []    r2_list = []    train_feat = pd.Series()    for fold_, (trn_idx, val_idx) in enumerate(folds.split(feature.values, label)):        print(&quot;fold {}&quot;.format(fold_))        trn_data = lgb.Dataset(feature.iloc[trn_idx], label[trn_idx], categorical_feature=categorical_feats)        val_data = lgb.Dataset(feature.iloc[val_idx], label[val_idx], categorical_feature=categorical_feats)        num_round = 10000        clf = lgb.train(params, trn_data, num_round, feval=get_r2_metric,valid_sets=[trn_data, val_data], verbose_eval=500,                    early_stopping_rounds=200)        y_pre = clf.predict(feature.iloc[val_idx], num_iteration=clf.best_iteration)        r2 = r2_score(y_pre,label[val_idx])        r2_list.append(r2)        train_feat = train_feat.append(pd.Series(y_pre,index=val_idx))        y_pre_test = clf.predict(test,num_iteration=clf.best_iteration)        y_pre_list.append(y_pre_test)    print(&#39;r2 score{:}&#39;.format(r2))    print(&#39;r2:{:}&#39;.format(np.mean(r2_list)))    y_pred_final=  (y_pre_list[0]+y_pre_list[1]+y_pre_list[2]+y_pre_list[3]+y_pre_list[4])/5    return y_pred_final</code></pre><p>pre1-prenåˆ†åˆ«æ˜¯nç»„æ¨¡å‹é¢„æµ‹å‡ºæ¥çš„ç»“æœï¼Œå°†å…¶è¿›è¡ŒåŠ æƒèåˆ</p><pre><code class="lang-python">pre = (pre1 + pre2 + pre3 +...+pren )/npd.DataFrame(pre).to_csv(&quot;pre.csv&quot;,header=None,index=None)</code></pre><h3 id="blending"><a href="#blending" class="headerlink" title="blending"></a>blending</h3><pre><code class="lang-python">def blend(train,test,target):    &#39;&#39;&#39;5æŠ˜&#39;&#39;&#39;    # n_flods = 5    # skf = list(StratifiedKFold(y, n_folds=n_flods))    &#39;&#39;&#39;åˆ‡åˆ†è®­ç»ƒæ•°æ®é›†ä¸ºd1,d2ä¸¤éƒ¨åˆ†&#39;&#39;&#39;    X_d1, X_d2, y_d1, y_d2 = train_test_split(train, target, test_size=0.5, random_state=914)    train_ = np.zeros((X_d2.shape[0],len(clfs*3)))    test_ = np.zeros((test.shape[0],len(clfs*3)))    for j,clf in enumerate(clfs):        &#39;&#39;&#39;ä¾æ¬¡è®­ç»ƒå„ä¸ªå•æ¨¡å‹&#39;&#39;&#39;        # print(j, clf)        &#39;&#39;&#39;ä½¿ç”¨ç¬¬1ä¸ªéƒ¨åˆ†ä½œä¸ºé¢„æµ‹ï¼Œç¬¬2éƒ¨åˆ†æ¥è®­ç»ƒæ¨¡å‹ï¼Œè·å¾—å…¶é¢„æµ‹çš„è¾“å‡ºä½œä¸ºç¬¬2éƒ¨åˆ†çš„æ–°ç‰¹å¾ã€‚&#39;&#39;&#39;        # X_train, y_train, X_test, y_test = X[train], y[train], X[test], y[test]        X_d1fillna=X_d1.fillna(0)        X_d2fillna = X_d2.fillna(0)        X_predictfillna= test.fillna(0)        clf.fit(X_d1fillna,y_d1)        y_submission = clf.predict(X_d2fillna)        y_test_submission = clf.predict(X_predictfillna)        train_[:,j*3] = y_submission*y_submission        &#39;&#39;&#39;å¯¹äºæµ‹è¯•é›†ï¼Œç›´æ¥ç”¨è¿™kä¸ªæ¨¡å‹çš„é¢„æµ‹å€¼ä½œä¸ºæ–°çš„ç‰¹å¾ã€‚&#39;&#39;&#39;        test_[:, j*3] = y_test_submission*y_test_submission        train_[:, j+1] =(y_submission - y_submission.min()) /(y_submission.max() - y_submission.min())        &#39;&#39;&#39;å¯¹äºæµ‹è¯•é›†ï¼Œç›´æ¥ç”¨è¿™kä¸ªæ¨¡å‹çš„é¢„æµ‹å€¼ä½œä¸ºæ–°çš„ç‰¹å¾ã€‚&#39;&#39;&#39;        y_test_submission = (y_test_submission - y_test_submission.min()) / \                            (y_test_submission.max() - y_test_submission.min())        test_[:, j+1] = y_test_submission        train_[:, j+2] = np.log(y_submission)        &#39;&#39;&#39;å¯¹äºæµ‹è¯•é›†ï¼Œç›´æ¥ç”¨è¿™kä¸ªæ¨¡å‹çš„é¢„æµ‹å€¼ä½œä¸ºæ–°çš„ç‰¹å¾ã€‚&#39;&#39;&#39;        y_test_submission =np.log(y_test_submission)        test_[:, j+2] = y_test_submission        # print(&quot;val auc Score: %f&quot; % r2_score(y_predict, dataset_d2[:, j]))        print(&#39;å·²å®Œæˆç¬¬&#39;,j)    train_.to_csv(&#39;./input/train_blending.csv&#39;, index=False)    test_.to_csv(&#39;./input/test_blending.csv&#39;, index=False)</code></pre><h3 id="Stacking"><a href="#Stacking" class="headerlink" title="Stacking"></a>Stacking</h3><pre><code class="lang-python">#!pip install mlxtendimport warningswarnings.filterwarnings(&#39;ignore&#39;)import itertoolsimport numpy as npimport seaborn as snsimport matplotlib.pyplot as pltimport matplotlib.gridspec as gridspecfrom sklearn import datasetsfrom sklearn.linear_model import LogisticRegressionfrom sklearn.neighbors import KNeighborsClassifierfrom sklearn.naive_bayes import GaussianNB from sklearn.ensemble import RandomForestClassifierfrom mlxtend.classifier import StackingClassifierfrom sklearn.model_selection import cross_val_score, train_test_splitfrom mlxtend.plotting import plot_learning_curvesfrom mlxtend.plotting import plot_decision_regions</code></pre><pre><code class="lang-python"># ä»¥pythonè‡ªå¸¦çš„é¸¢å°¾èŠ±æ•°æ®é›†ä¸ºä¾‹iris = datasets.load_iris()X, y = iris.data[:, 1:3], iris.targetclf1 = KNeighborsClassifier(n_neighbors=1)clf2 = RandomForestClassifier(random_state=1)clf3 = GaussianNB()lr = LogisticRegression()sclf = StackingClassifier(classifiers=[clf1, clf2, clf3],                           meta_classifier=lr)label = [&#39;KNN&#39;, &#39;Random Forest&#39;, &#39;Naive Bayes&#39;, &#39;Stacking Classifier&#39;]clf_list = [clf1, clf2, clf3, sclf]fig = plt.figure(figsize=(10,8))gs = gridspec.GridSpec(2, 2)grid = itertools.product([0,1],repeat=2)clf_cv_mean = []clf_cv_std = []for clf, label, grd in zip(clf_list, label, grid):    scores = cross_val_score(clf, X, y, cv=3, scoring=&#39;accuracy&#39;)    print(&quot;Accuracy: %.2f (+/- %.2f) [%s]&quot; %(scores.mean(), scores.std(), label))    clf_cv_mean.append(scores.mean())    clf_cv_std.append(scores.std())    clf.fit(X, y)    ax = plt.subplot(gs[grd[0], grd[1]])    fig = plot_decision_regions(X=X, y=y, clf=clf)    plt.title(label)plt.show()</code></pre><pre><code>Accuracy: 0.91 (+/- 0.01) [KNN]Accuracy: 0.93 (+/- 0.05) [Random Forest]Accuracy: 0.92 (+/- 0.03) [Naive Bayes]Accuracy: 0.95 (+/- 0.03) [Stacking Classifier]</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/26/aGs18DEHCYZFnoP.png" alt=""></p><h2 id="å…­-æ€»ç»“"><a href="#å…­-æ€»ç»“" class="headerlink" title="(å…­) æ€»ç»“"></a>(å…­) æ€»ç»“</h2><p><a href="https://blog.csdn.net/qq_39756719/article/details/95634744" target="_blank" rel="noopener">ç­”è¾© ppt</a></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (åä¸€):ç°ä»£ CNN æ¨¡å‹</title>
      <link href="/2020/02/20/dl-notes11-modern-cnn/"/>
      <url>/2020/02/20/dl-notes11-modern-cnn/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œ"></a>æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>LeNet:  åœ¨å¤§çš„çœŸå®æ•°æ®é›†ä¸Šçš„è¡¨ç°å¹¶ä¸å°½å¦‚â¼ˆæ„ã€‚<br>1.ç¥ç»ç½‘ç»œè®¡ç®—å¤æ‚ã€‚<br>2.è¿˜æ²¡æœ‰â¼¤é‡æ·±â¼Šç ”ç©¶å‚æ•°åˆå§‹åŒ–å’Œâ¾®å‡¸ä¼˜åŒ–ç®—æ³•ç­‰è¯¸å¤šé¢†åŸŸã€‚  </p><p>æœºå™¨å­¦ä¹ çš„ç‰¹å¾æå–:æ‰‹å·¥å®šä¹‰çš„ç‰¹å¾æå–å‡½æ•°<br>ç¥ç»ç½‘ç»œçš„ç‰¹å¾æå–ï¼šé€šè¿‡å­¦ä¹ å¾—åˆ°æ•°æ®çš„å¤šçº§è¡¨å¾ï¼Œå¹¶é€çº§è¡¨â½°è¶Šæ¥è¶ŠæŠ½è±¡çš„æ¦‚å¿µæˆ–æ¨¡å¼ã€‚  </p><p>ç¥ç»ç½‘ç»œå‘å±•çš„é™åˆ¶:æ•°æ®ã€ç¡¬ä»¶</p><h2 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h2><p>é¦–æ¬¡è¯æ˜äº†å­¦ä¹ åˆ°çš„ç‰¹å¾å¯ä»¥è¶…è¶Šâ¼¿â¼¯è®¾è®¡çš„ç‰¹å¾ï¼Œä»è€Œâ¼€ä¸¾æ‰“ç ´è®¡ç®—æœºè§†è§‰ç ”ç©¶çš„å‰çŠ¶ã€‚<br><strong>ç‰¹å¾ï¼š</strong></p><ol><li>8å±‚å˜æ¢ï¼Œå…¶ä¸­æœ‰5å±‚å·ç§¯å’Œ2å±‚å…¨è¿æ¥éšè—å±‚ï¼Œä»¥åŠ1ä¸ªå…¨è¿æ¥è¾“å‡ºå±‚ã€‚</li><li>å°†sigmoidæ¿€æ´»å‡½æ•°æ”¹æˆäº†æ›´åŠ ç®€å•çš„ReLUæ¿€æ´»å‡½æ•°ã€‚<br> ReLuå‡½æ•°çš„å¥½å¤„ï¼šç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œå¯¼æ•°è®¡ç®—æ›´å¿«ï¼Œæ”¶æ•›å¿«ï¼Œè´Ÿæ•°çš„æ—¶å€™æ¢¯åº¦ä¸º 0ï¼Œæœ‰æ­£åˆ™åŒ–ï¼Œç¨€ç–åŒ–çš„ä½œç”¨</li><li>ç”¨Dropoutæ¥æ§åˆ¶å…¨è¿æ¥å±‚çš„æ¨¡å‹å¤æ‚åº¦ã€‚<br> Dropout è§£å†³è¿‡æ‹Ÿåˆï¼Œä¸ä¼šè¿‡åº¦ä¾èµ–æŸä¸ªç¥ç»å…ƒ</li><li>å¼•å…¥æ•°æ®å¢å¼ºï¼Œå¦‚ç¿»è½¬ã€è£å‰ªå’Œé¢œè‰²å˜åŒ–ï¼Œä»è€Œè¿›ä¸€æ­¥æ‰©å¤§æ•°æ®é›†æ¥ç¼“è§£è¿‡æ‹Ÿåˆã€‚</li></ol><p>æ›´å¤šçš„é€šé“æ•°ï¼Œå…·æœ‰æ›´å¤šçš„ç‰¹å¾</p><p>è®¡ç®—ç¤ºä¾‹ï¼ˆç¬¬ä¸€å±‚ï¼‰ï¼š(224-11)/4 + 1 = 54 è¿™ä¸€å±‚è¾“å‡ºçš„å®½å’Œé«˜å°±æ˜¯ 54ï¼Œé€šé“æ•°æ˜¯ 96</p><p>ä¸‹ä¸€å±‚ (54-3)/2 +1 = 26</p><p>ä¸‹ä¸€å±‚ (26+4-5)/1 + 1 =26<br>â€¦</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/d9UtZ2CpjrIbiyV.png" alt="è®¡ç®—å…¬å¼"></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5kv4gpx88.png?imageView2/0/w/640/h/640" alt="LeNet å’Œ AlexNet å¯¹æ¯”"></p><pre><code class="lang-python">#è€ƒè™‘åˆ°æœ¬ä»£ç ä¸­çš„æ¨¡å‹è¿‡å¤§ï¼ŒCPU è®­ç»ƒè¾ƒæ…¢ï¼Œéœ€è¦ GPU#æˆ‘ä»¬è¿˜å°†ä»£ç ä¸Šä¼ äº†ä¸€ä»½åˆ° https://www.kaggle.com/boyuai/boyu-d2l-modernconvolutionalnetwork#å¦‚å¸Œæœ›æå‰ä½¿ç”¨gpuè¿è¡Œè¯·è‡³kaggleã€‚import timeimport torchfrom torch import nn, optimimport torchvisionimport numpy as npimport syssys.path.append(&quot;/home/kesci/input/&quot;) import d2lzh1981 as d2limport osimport torch.nn.functional as Fdevice = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)class AlexNet(nn.Module):    def __init__(self):        super(AlexNet, self).__init__()        self.conv = nn.Sequential(            nn.Conv2d(1, 96, 11, 4), # in_channels, out_channels, kernel_size, stride, padding            nn.ReLU(),            nn.MaxPool2d(3, 2), # kernel_size, stride            # å‡å°å·ç§¯çª—å£ï¼Œä½¿ç”¨å¡«å……ä¸º2æ¥ä½¿å¾—è¾“å…¥ä¸è¾“å‡ºçš„é«˜å’Œå®½ä¸€è‡´ï¼Œä¸”å¢å¤§è¾“å‡ºé€šé“æ•°            nn.Conv2d(96, 256, 5, 1, 2),            nn.ReLU(),            nn.MaxPool2d(3, 2),            # è¿ç»­3ä¸ªå·ç§¯å±‚ï¼Œä¸”ä½¿ç”¨æ›´å°çš„å·ç§¯çª—å£ã€‚é™¤äº†æœ€åçš„å·ç§¯å±‚å¤–ï¼Œè¿›ä¸€æ­¥å¢å¤§äº†è¾“å‡ºé€šé“æ•°ã€‚            # å‰ä¸¤ä¸ªå·ç§¯å±‚åä¸ä½¿ç”¨æ± åŒ–å±‚æ¥å‡å°è¾“å…¥çš„é«˜å’Œå®½            nn.Conv2d(256, 384, 3, 1, 1),            nn.ReLU(),            nn.Conv2d(384, 384, 3, 1, 1),            nn.ReLU(),            nn.Conv2d(384, 256, 3, 1, 1),            nn.ReLU(),            nn.MaxPool2d(3, 2)        )         # è¿™é‡Œå…¨è¿æ¥å±‚çš„è¾“å‡ºä¸ªæ•°æ¯”LeNetä¸­çš„å¤§æ•°å€ã€‚ä½¿ç”¨ä¸¢å¼ƒå±‚æ¥ç¼“è§£è¿‡æ‹Ÿåˆ        self.fc = nn.Sequential(            nn.Linear(256*5*5, 4096),            nn.ReLU(),            nn.Dropout(0.5),            #ç”±äºä½¿ç”¨CPUé•œåƒï¼Œç²¾ç®€ç½‘ç»œï¼Œè‹¥ä¸ºGPUé•œåƒå¯æ·»åŠ è¯¥å±‚            #nn.Linear(4096, 4096),            #nn.ReLU(),            #nn.Dropout(0.5),            # è¾“å‡ºå±‚ã€‚ç”±äºè¿™é‡Œä½¿ç”¨Fashion-MNISTï¼Œæ‰€ä»¥ç”¨ç±»åˆ«æ•°ä¸º10ï¼Œè€Œéè®ºæ–‡ä¸­çš„1000            nn.Linear(4096, 10),        )    def forward(self, img):  # æŠŠ self.conv å’Œ self.fc è¿æ¥èµ·æ¥        feature = self.conv(img)  # è¾“å‡º 4 ç»´ï¼šbatch_size * channels * h * w        output = self.fc(feature.view(img.shape[0], -1))  # å˜æˆ 2 ç»´ï¼šbatch_size * hiddens        return output</code></pre><pre><code class="lang-python">net = AlexNet()print(net)</code></pre><pre><code>AlexNet(  (conv): Sequential(    (0): Conv2d(1, 96, kernel_size=(11, 11), stride=(4, 4))    (1): ReLU()    (2): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)    (3): Conv2d(96, 256, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))    (4): ReLU()    (5): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)    (6): Conv2d(256, 384, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (7): ReLU()    (8): Conv2d(384, 384, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (9): ReLU()    (10): Conv2d(384, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (11): ReLU()    (12): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (fc): Sequential(    (0): Linear(in_features=6400, out_features=4096, bias=True)    (1): ReLU()    (2): Dropout(p=0.5, inplace=False)    (3): Linear(in_features=4096, out_features=10, bias=True)  ))</code></pre><h3 id="è½½å…¥æ•°æ®é›†"><a href="#è½½å…¥æ•°æ®é›†" class="headerlink" title="è½½å…¥æ•°æ®é›†"></a>è½½å…¥æ•°æ®é›†</h3><pre><code class="lang-python"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨def load_data_fashion_mnist(batch_size, resize=None, root=&#39;/home/kesci/input/FashionMNIST2065&#39;):    &quot;&quot;&quot;Download the fashion mnist dataset and then load into memory.&quot;&quot;&quot;    trans = []    if resize:        trans.append(torchvision.transforms.Resize(size=resize))    trans.append(torchvision.transforms.ToTensor())  # å˜æˆ tensor æ‰èƒ½è®­ç»ƒ    transform = torchvision.transforms.Compose(trans)    mnist_train = torchvision.datasets.FashionMNIST(root=root, train=True, download=True, transform=transform)    mnist_test = torchvision.datasets.FashionMNIST(root=root, train=False, download=True, transform=transform)    train_iter = torch.utils.data.DataLoader(mnist_train, batch_size=batch_size, shuffle=True, num_workers=2)    test_iter = torch.utils.data.DataLoader(mnist_test, batch_size=batch_size, shuffle=False, num_workers=2)    return train_iter, test_iter#batchsize=128batch_size = 16# å¦‚å‡ºç°â€œout of memoryâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯å‡å°batch_sizeæˆ–resizetrain_iter, test_iter = load_data_fashion_mnist(batch_size,224)for X, Y in train_iter:    print(&#39;X =&#39;, X.shape,        &#39;\nY =&#39;, Y.type(torch.int32)) # Y å°±æ˜¯æ ‡ç­¾    break</code></pre><pre><code>X = torch.Size([16, 1, 224, 224]) Y = tensor([2, 4, 5, 2, 3, 2, 7, 7, 7, 3, 5, 7, 8, 2, 6, 3], dtype=torch.int32)</code></pre><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><pre><code class="lang-python">lr, num_epochs = 0.001, 3optimizer = torch.optim.Adam(net.parameters(), lr=lr)d2l.train_ch5(net, train_iter, test_iter, batch_size, optimizer, device, num_epochs)</code></pre><pre><code>training on  cpuepoch 1, loss 0.4997, train acc 0.812, test acc 0.865, time 3995.5 sec</code></pre><p>cpu ç‰¹åˆ«æ…¢ï¼Œæ˜æ˜¾ä¸å¦‚ cuda(gpu)</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/U1pLjfKmEd8IAnu.png" alt="AlexNet ç»“æœ"></p><h2 id="ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"><a href="#ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰" class="headerlink" title="ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"></a>ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰</h2><p>AlexNetï¼šæ¯”è¾ƒæ­»æ¿ï¼Œå¾ˆéš¾æ‰©å±•<br>VGGï¼šé€šè¿‡é‡å¤ä½¿â½¤ç®€å•çš„åŸºç¡€å—æ¥æ„å»ºæ·±åº¦æ¨¡å‹ã€‚ï¼ˆä¸åŒçš„ VGG ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä½†å‚æ•°å¯èƒ½ä¸ä¸€æ ·ï¼‰<br>Block:æ•°ä¸ªç›¸åŒçš„å¡«å……ä¸º1ã€çª—å£å½¢çŠ¶ä¸º$3\times 3$çš„å·ç§¯å±‚,æ¥ä¸Šä¸€ä¸ªæ­¥å¹…ä¸º2ã€çª—å£å½¢çŠ¶ä¸º$2\times 2$çš„æœ€å¤§æ± åŒ–å±‚ï¼ˆå›¾ä¸­å†™é”™ï¼‰<br>å·ç§¯å±‚ä¿æŒè¾“å…¥çš„é«˜å’Œå®½ä¸å˜ï¼Œè€Œæ± åŒ–å±‚åˆ™å¯¹å…¶å‡åŠã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5l6vut7h1.png?imageView2/0/w/640/h/640" alt=""></p><h3 id="VGG11çš„ç®€å•å®ç°"><a href="#VGG11çš„ç®€å•å®ç°" class="headerlink" title="VGG11çš„ç®€å•å®ç°"></a>VGG11çš„ç®€å•å®ç°</h3><pre><code class="lang-python">def vgg_block(num_convs, in_channels, out_channels): #å·ç§¯å±‚ä¸ªæ•°ï¼Œè¾“å…¥é€šé“æ•°ï¼Œè¾“å‡ºé€šé“æ•°    blk = []    for i in range(num_convs):        if i == 0:            blk.append(nn.Conv2d(in_channels, out_channels, kernel_size=3, padding=1))        else:            blk.append(nn.Conv2d(out_channels, out_channels, kernel_size=3, padding=1)) # ä¹‹åé€šé“æ•°éƒ½ä¸å˜        blk.append(nn.ReLU())    blk.append(nn.MaxPool2d(kernel_size=2, stride=2)) # è¿™é‡Œä¼šä½¿å®½é«˜å‡åŠ    return nn.Sequential(*blk)  # å¯¹ block å†…è¿›è¡Œç»„åˆ</code></pre><pre><code class="lang-python">conv_arch = ((1, 1, 64), (1, 64, 128), (2, 128, 256), (2, 256, 512), (2, 512, 512)) # æ¯ä¸€å±‚çš„ channel h w# ç»è¿‡5ä¸ªvgg_block, å®½é«˜ä¼šå‡åŠ5æ¬¡, å˜æˆ 224/32 = 7ï¼Œæœ€åå˜æˆ 7 * 7 * 512fc_features = 512 * 7 * 7 # c * w * hfc_hidden_units = 4096 # ä»»æ„</code></pre><pre><code class="lang-python">def vgg(conv_arch, fc_features, fc_hidden_units=4096): # æŠŠå¤šä¸ª block ç»„åˆèµ·æ¥    net = nn.Sequential()    # å·ç§¯å±‚éƒ¨åˆ†    for i, (num_convs, in_channels, out_channels) in enumerate(conv_arch):        # æ¯ç»è¿‡ä¸€ä¸ªvgg_blockéƒ½ä¼šä½¿å®½é«˜å‡åŠ        net.add_module(&quot;vgg_block_&quot; + str(i+1), vgg_block(num_convs, in_channels, out_channels))    # å…¨è¿æ¥å±‚éƒ¨åˆ†    net.add_module(&quot;fc&quot;, nn.Sequential(d2l.FlattenLayer(),                                 nn.Linear(fc_features, fc_hidden_units),                                 nn.ReLU(),                                 nn.Dropout(0.5),                                 nn.Linear(fc_hidden_units, fc_hidden_units),                                 nn.ReLU(),                                 nn.Dropout(0.5),                                 nn.Linear(fc_hidden_units, 10)  # ä¸¤ä¸ªéšè—å±‚ï¼Œä¸€ä¸ªè¾“å‡ºå±‚                                ))    return net</code></pre><pre><code class="lang-python">net = vgg(conv_arch, fc_features, fc_hidden_units)X = torch.rand(1, 1, 224, 224)# named_childrenè·å–ä¸€çº§å­æ¨¡å—åŠå…¶åå­—(named_modulesä¼šè¿”å›æ‰€æœ‰å­æ¨¡å—,åŒ…æ‹¬å­æ¨¡å—çš„å­æ¨¡å—)for name, blk in net.named_children():     X = blk(X)    print(name, &#39;output shape: &#39;, X.shape)</code></pre><pre><code>vgg_block_1 output shape:  torch.Size([1, 64, 112, 112])vgg_block_2 output shape:  torch.Size([1, 128, 56, 56])vgg_block_3 output shape:  torch.Size([1, 256, 28, 28])vgg_block_4 output shape:  torch.Size([1, 512, 14, 14])vgg_block_5 output shape:  torch.Size([1, 512, 7, 7])fc output shape:  torch.Size([1, 10])</code></pre><pre><code class="lang-python">ratio = 8  # Fashionæ•°æ®é›†ä¸ç”¨å¤ªå¤šå‚æ•°ï¼Œé‡‡ç”¨å°ä¸€ç‚¹çš„æ¨¡å‹ï¼Œä¹Ÿé˜²æ­¢è¿‡æ‹Ÿåˆsmall_conv_arch = [(1, 1, 64//ratio), (1, 64//ratio, 128//ratio), (2, 128//ratio, 256//ratio),                    (2, 256//ratio, 512//ratio), (2, 512//ratio, 512//ratio)]net = vgg(small_conv_arch, fc_features // ratio, fc_hidden_units // ratio)print(net)</code></pre><pre><code>Sequential(  (vgg_block_1): Sequential(    (0): Conv2d(1, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (1): ReLU()    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (vgg_block_2): Sequential(    (0): Conv2d(8, 16, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (1): ReLU()    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (vgg_block_3): Sequential(    (0): Conv2d(16, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (1): ReLU()    (2): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (3): ReLU()    (4): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (vgg_block_4): Sequential(    (0): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (1): ReLU()    (2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (3): ReLU()    (4): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (vgg_block_5): Sequential(    (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (1): ReLU()    (2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))    (3): ReLU()    (4): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)  )  (fc): Sequential(    (0): FlattenLayer()    (1): Linear(in_features=3136, out_features=512, bias=True)    (2): ReLU()    (3): Dropout(p=0.5, inplace=False)    (4): Linear(in_features=512, out_features=512, bias=True)    (5): ReLU()    (6): Dropout(p=0.5, inplace=False)    (7): Linear(in_features=512, out_features=10, bias=True)  ))</code></pre><pre><code class="lang-python">batchsize=16#batch_size = 64# å¦‚å‡ºç°â€œout of memoryâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯å‡å°batch_sizeæˆ–resize# train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, resize=224)lr, num_epochs = 0.001, 5optimizer = torch.optim.Adam(net.parameters(), lr=lr)d2l.train_ch5(net, train_iter, test_iter, batch_size, optimizer, device, num_epochs)</code></pre><h2 id="â½¹ç»œä¸­çš„â½¹ç»œï¼ˆNiNï¼‰"><a href="#â½¹ç»œä¸­çš„â½¹ç»œï¼ˆNiNï¼‰" class="headerlink" title="â½¹ç»œä¸­çš„â½¹ç»œï¼ˆNiNï¼‰"></a>â½¹ç»œä¸­çš„â½¹ç»œï¼ˆNiNï¼‰</h2><p>LeNetã€AlexNetå’ŒVGGï¼šå…ˆä»¥ç”±å·ç§¯å±‚æ„æˆçš„æ¨¡å—å……åˆ†æŠ½å–ç©ºé—´ç‰¹å¾ï¼Œå†ä»¥ç”±<code>å…¨è¿æ¥å±‚</code>æ„æˆçš„æ¨¡å—æ¥è¾“å‡ºåˆ†ç±»ç»“æœã€‚ </p><p>NiNï¼š</p><ul><li><code>ä¸²è”</code>å¤šä¸ªç”±å·ç§¯å±‚å’Œâ€œå…¨è¿æ¥â€å±‚æ„æˆçš„å°â½¹ç»œæ¥æ„å»ºâ¼€ä¸ªæ·±å±‚â½¹ç»œã€‚ï¼ˆå°æ¨¡å—ç»„è£…èµ·æ¥ï¼‰</li><li>â½¤äº†<code>è¾“å‡ºé€šé“æ•°</code>ç­‰äº<code>æ ‡ç­¾ç±»åˆ«æ•°</code>çš„NiNå—ï¼Œé€šè¿‡è°ƒèŠ‚æœ€åä¸€ä¸ªæ¨¡å—çš„é€šé“æ•°ï¼Œæ¥ä½¿æœ€åçš„è¾“å‡ºç­‰äºç±»åˆ«æ•°</li><li>ç„¶åä½¿â½¤<code>å…¨å±€å¹³å‡æ± åŒ–å±‚</code> GlobalAvgPool å¯¹æ¯ä¸ªé€šé“ä¸­æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡å¹¶ç›´æ¥â½¤äºåˆ†ç±»ï¼Œå¯ä»¥å‡å°‘æ¨¡å‹å‚æ•°ï¼Œç¼“è§£è¿‡æ‹Ÿåˆï¼Œä½†ä¹Ÿä¼šé€ æˆæ¨¡å‹è®­ç»ƒæ—¶é—´å¢åŠ </li></ul><h2 id="å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚-å¯¹æ¯”åˆ†æ"><a href="#å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚-å¯¹æ¯”åˆ†æ" class="headerlink" title="å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚:å¯¹æ¯”åˆ†æ"></a>å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚:å¯¹æ¯”åˆ†æ</h2><p>å¤šæ¢ä¸€ä¸ªæ•°æ®é›†çš„è¯ï¼ˆä¸»è¦æ˜¯sizeçš„å˜åŒ–ï¼‰ï¼ŒNiN blockä»…éœ€è¦æ”¹å˜ç¬¬ä¸€ä¸ªConvolutionçš„å¤§å°ï¼Œè€Œåç»­çš„1x1çš„Convolutionä¿æŒä¸å˜</p><p>å·ç§¯å’Œå…¨è¿æ¥çš„ä¸€ä¸ªé‡è¦çš„å·®åˆ«ï¼Œå·ç§¯å…¶å®<code>ä¸å…³å¿ƒç‰¹å¾å›¾çš„Hå’ŒW</code>.<br>å¦‚æœä½ ä»10åˆ†ç±»shape224<em>224</em>3çš„å½©è‰²æ•°æ®é›†ï¼Œåˆ‡æ¢åˆ°ä¸€ä¸ª2åˆ†ç±»shape160<em>160</em>1çš„ç°åº¦å›¾æ•°æ®é›†.<br>åªéœ€è¦æ›¿æ¢ç¬¬ä¸€ä¸ªå·ç§¯çš„input_channel å’Œæœ€åä¸€ä¸ªå·ç§¯æˆ–è€…å…¨è¿æ¥å±‚çš„output_channel.<br>è€Œå¦‚æœä½ æ˜¯ä»å½©è‰²æ•°æ®é›†æ¢æˆäº†å½©è‰²æ•°æ®é›†ï¼Œç¬¬ä¸€ä¸ªå·ç§¯ç”šè‡³éƒ½ä¸éœ€è¦å‘ç”Ÿå˜åŒ–.</p><h2 id="ç†è§£å·ç§¯å·¥ä½œåŸç†"><a href="#ç†è§£å·ç§¯å·¥ä½œåŸç†" class="headerlink" title="ç†è§£å·ç§¯å·¥ä½œåŸç†"></a>ç†è§£å·ç§¯å·¥ä½œåŸç†</h2><ol><li><p>å·ç§¯ç¥ç»ç½‘ç»œé€šè¿‡ä½¿ç”¨<code>æ»‘åŠ¨çª—å£</code>åœ¨è¾“å…¥çš„ä¸åŒä½ç½®å¤„é‡å¤è®¡ç®—ï¼Œå‡å°å‚æ•°æ•°é‡ã€‚è¿æ¥å·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—æ—¶ï¼Œéœ€è¦åšä¸€æ¬¡å±•å¹³æ“ä½œã€‚</p></li><li><p>åœ¨é€šè¿‡å·ç§¯å±‚æˆ–æ± åŒ–å±‚åï¼Œè¾“å‡ºçš„é«˜å’Œå®½å¯èƒ½å‡å°ï¼Œä¸ºäº†å°½å¯èƒ½<code>ä¿ç•™è¾“å…¥çš„ç‰¹å¾</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡å°é«˜å®½çš„åŒæ—¶å¢åŠ <code>é€šé“æ•°</code>ã€‚</p></li><li><p>å·ç§¯çš„å·¥ä½œæµç¨‹æ˜¯ï¼Œä»¥ä¸€å®šçš„å·ç§¯æ ¸å¤§å°ï¼Œä¸€å®šçš„æ­¥é•¿ï¼Œåœ¨ç‰¹å¾å›¾çš„ä¸åŒä½ç½®ï¼Œç”¨<code>åŒä¸€ä¸ªå·ç§¯æ ¸</code>æ¥è¿›è¡Œäº’ç›¸å…³è¿ç®—ã€‚</p></li><li><p>è¿™å°±å¥½åƒæ˜¯ï¼Œä¸€ä¸ªå·ç§¯æ ¸æ˜¯ç”¨æ¥æå–æŸä¸€ç§<code>å±€éƒ¨ç‰¹å¾</code>çš„ï¼Œå®ƒåœ¨å›¾åƒä¸­çš„ä¸åŒä½ç½®æ¥å¯»æ‰¾æ˜¯å¦æœ‰ç¬¦åˆå®ƒæ‰€å…³å¿ƒçš„ç‰¹å¾çš„å±€éƒ¨åŒºåŸŸã€‚</p></li><li><p>è¿™ç§å·¥ä½œæœºåˆ¶å¯¼è‡´äº†å›¾åƒçš„<code>å°ºå¯¸ï¼ˆå®½å’Œé«˜ï¼‰å¹¶ä¸å½±å“</code>å·ç§¯è¿ç®—ï¼Œåªæœ‰é€šé“æ•°çš„å˜åŒ–æ‰ä¼šå½±å“ã€‚å¯ä»¥å’Œæƒå€¼å…±äº«çš„æ¦‚å¿µè”ç³»ä¸€ä¸‹ç†è§£ã€‚</p></li><li><p>1x1 convé™¤äº†æ”¹å˜channelæ•°ï¼Œè¿˜æœ‰å¢åŠ éçº¿æ€§çš„ä½œç”¨ï¼Œä¸€èˆ¬éƒ½ä¼šè·Ÿç€ä¸€ä¸ª<code>æ¿€æ´»å±‚</code>ï¼Œå…¶ä»–æ„Ÿè§‰æ¯”è¾ƒç„å­¦è®¾è®¡ï¼ŒCVé‡Œå¯èƒ½è·ŸReLUå¯ä»¥åšåˆ°å•ä¾§æŠ‘åˆ¶å¢åŠ ç¨€ç–æœ‰å…³å§ã€‚</p></li></ol><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5l6u1p5vy.png?imageView2/0/w/960/h/960" alt=""></p><ul><li><p><code>1Ã—1å·ç§¯æ ¸ä½œç”¨</code></p><p>  1.æ”¾ç¼©é€šé“æ•°ï¼šé€šè¿‡æ§åˆ¶å·ç§¯æ ¸çš„æ•°é‡è¾¾åˆ°é€šé“æ•°çš„æ”¾ç¼©ï¼Œæ”¾å¤§ or ç¼©å°<br>  2.å¢åŠ éçº¿æ€§ã€‚1Ã—1å·ç§¯æ ¸çš„å·ç§¯è¿‡ç¨‹<code>ç›¸å½“äºå…¨è¿æ¥å±‚çš„è®¡ç®—è¿‡ç¨‹</code>ï¼Œå¹¶ä¸”è¿˜åŠ å…¥äº†éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œä»è€Œå¯ä»¥å¢åŠ ç½‘ç»œçš„éçº¿æ€§ã€‚<br>  3.è®¡ç®—å‚æ•°å°‘   </p></li></ul><pre><code class="lang-python">def nin_block(in_channels, out_channels, kernel_size, stride, padding):  # å¯å¤ç”¨çš„ block    blk = nn.Sequential(nn.Conv2d(in_channels, out_channels, kernel_size, stride, padding),                        nn.ReLU(),                        nn.Conv2d(out_channels, out_channels, kernel_size=1), # åé¢ä¸¤ä¸ª channel ä¸å˜                        nn.ReLU(),                        nn.Conv2d(out_channels, out_channels, kernel_size=1), # kernel_size=1 ä¸æ”¹å˜å½¢çŠ¶                         nn.ReLU())    return blk</code></pre><pre><code class="lang-python"># å·²ä¿å­˜åœ¨d2lzh_pytorchclass GlobalAvgPool2d(nn.Module):    # å…¨å±€å¹³å‡æ± åŒ–å±‚å¯é€šè¿‡å°†æ± åŒ–çª—å£å½¢çŠ¶è®¾ç½®æˆè¾“å…¥çš„é«˜å’Œå®½å®ç°    def __init__(self):        super(GlobalAvgPool2d, self).__init__()    def forward(self, x):        return F.avg_pool2d(x, kernel_size=x.size()[2:]) # å¯¹æ¯ä¸ªé€šé“çš„æ•´ä¸ª feature_map å–å¹³å‡ï¼Œç­‰äº x.size()å³å¯net = nn.Sequential(    nin_block(1, 96, kernel_size=11, stride=4, padding=0),    nn.MaxPool2d(kernel_size=3, stride=2),    nin_block(96, 256, kernel_size=5, stride=1, padding=2),    nn.MaxPool2d(kernel_size=3, stride=2),    nin_block(256, 384, kernel_size=3, stride=1, padding=1),    nn.MaxPool2d(kernel_size=3, stride=2),     nn.Dropout(0.5),    # æ ‡ç­¾ç±»åˆ«æ•°æ˜¯10    nin_block(384, 10, kernel_size=3, stride=1, padding=1),  # è¾“å‡ºä¸º 10ï¼Œ=ç±»åˆ«æ•°    GlobalAvgPool2d(),  # å½¢çŠ¶æ˜¯ï¼ˆæ‰¹é‡å¤§å°ï¼Œ10ï¼Œ1ï¼Œ1ï¼‰    # å°†å››ç»´çš„è¾“å‡ºè½¬æˆäºŒç»´çš„è¾“å‡ºï¼Œå…¶å½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, 10)    d2l.FlattenLayer())</code></pre><pre><code class="lang-python">X = torch.rand(1, 1, 224, 224)for name, blk in net.named_children():     X = blk(X)    print(name, &#39;output shape: &#39;, X.shape)</code></pre><pre><code>0 output shape:  torch.Size([1, 96, 54, 54])1 output shape:  torch.Size([1, 96, 26, 26])2 output shape:  torch.Size([1, 256, 26, 26])3 output shape:  torch.Size([1, 256, 12, 12])4 output shape:  torch.Size([1, 384, 12, 12])5 output shape:  torch.Size([1, 384, 5, 5])6 output shape:  torch.Size([1, 384, 5, 5])7 output shape:  torch.Size([1, 10, 5, 5])8 output shape:  torch.Size([1, 10, 1, 1])9 output shape:  torch.Size([1, 10])</code></pre><pre><code class="lang-python">batch_size = 128# å¦‚å‡ºç°â€œout of memoryâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯å‡å°batch_sizeæˆ–resize#train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, resize=224)lr, num_epochs = 0.002, 5optimizer = torch.optim.Adam(net.parameters(), lr=lr)d2l.train_ch5(net, train_iter, test_iter, batch_size, optimizer, device, num_epochs)</code></pre><p>NiNé‡å¤ä½¿â½¤ç”±å·ç§¯å±‚å’Œä»£æ›¿å…¨è¿æ¥å±‚çš„1Ã—1å·ç§¯å±‚æ„æˆçš„NiNå—æ¥æ„å»ºæ·±å±‚â½¹ç»œã€‚<br>NiNå»é™¤äº†å®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆçš„å…¨è¿æ¥è¾“å‡ºå±‚ï¼Œè€Œæ˜¯å°†å…¶æ›¿æ¢æˆè¾“å‡ºé€šé“æ•°ç­‰äºæ ‡ç­¾ç±»åˆ«æ•° çš„NiNå—å’Œå…¨å±€å¹³å‡æ± åŒ–å±‚ã€‚<br>NiNçš„ä»¥ä¸Šè®¾è®¡æ€æƒ³å½±å“äº†åâ¾¯â¼€ç³»åˆ—å·ç§¯ç¥ç»â½¹ç»œçš„è®¾è®¡ã€‚  </p><h2 id="GoogLeNet"><a href="#GoogLeNet" class="headerlink" title="GoogLeNet"></a>GoogLeNet</h2><ol><li>ç”±InceptionåŸºç¡€å—ç»„æˆã€‚  </li><li>Inceptionå—ç›¸å½“äºâ¼€ä¸ªæœ‰4æ¡çº¿è·¯çš„â¼¦â½¹ç»œï¼ˆå¹¶è¡Œçº¿è·¯ï¼‰ã€‚å®ƒé€šè¿‡ä¸åŒçª—å£å½¢çŠ¶çš„å·ç§¯å±‚å’Œæœ€â¼¤æ± åŒ–å±‚æ¥å¹¶â¾æŠ½å–ä¿¡æ¯ï¼Œå¹¶ä½¿â½¤<strong>ã€Œ1Ã—1å·ç§¯å±‚ã€</strong> <strong>ã€Œå‡å°‘é€šé“æ•°ä»è€Œé™ä½æ¨¡å‹å¤æ‚åº¦ã€</strong>ã€‚   </li><li>å¯ä»¥â¾ƒå®šä¹‰çš„è¶…å‚æ•°æ˜¯æ¯ä¸ªå±‚çš„è¾“å‡ºé€šé“æ•°ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚ </li><li>éƒ½ç”¨äº† padding ä¿è¯é«˜å’Œå®½ä¸å˜</li></ol><p>æ¦‚æ‹¬ 4 ä¸ªæ¨¡å‹ï¼š</p><ul><li>AlexNet éš¾ä»¥çµæ´»åœ°æ”¹å˜æ¨¡å‹ç»“æ„ã€‚</li><li>VGG é€šè¿‡é‡å¤ä½¿â½¤ç®€å•çš„åŸºç¡€å—æ¥æ„å»ºæ·±åº¦æ¨¡å‹, ç”±VGG blockç»„æˆ</li><li>NiN ä½¿â½¤å…¨å±€å¹³å‡æ± åŒ–å±‚å¯¹æ¯ä¸ªé€šé“ä¸­æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡å¹¶ç›´æ¥â½¤äºåˆ†ç±», ç”±NiN blockç»„æˆ</li><li>GooLeNet é€šè¿‡ä¸åŒçª—å£å½¢çŠ¶çš„å·ç§¯å±‚å’Œæœ€â¼¤æ± åŒ–å±‚æ¥å¹¶â¾æŠ½å–ä¿¡æ¯, ç”±Inceptionç»„æˆ</li></ul><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5l6uortw.png?imageView2/0/w/640/h/640" alt="Inception"></p><pre><code class="lang-python">class Inception(nn.Module):    # c1 - c4ä¸ºæ¯æ¡çº¿è·¯é‡Œçš„å±‚çš„è¾“å‡ºé€šé“æ•°    def __init__(self, in_c, c1, c2, c3, c4):        super(Inception, self).__init__()        # çº¿è·¯1ï¼Œå•1 x 1å·ç§¯å±‚        self.p1_1 = nn.Conv2d(in_c, c1, kernel_size=1)        # çº¿è·¯2ï¼Œ1 x 1å·ç§¯å±‚åæ¥3 x 3å·ç§¯å±‚        self.p2_1 = nn.Conv2d(in_c, c2[0], kernel_size=1)        self.p2_2 = nn.Conv2d(c2[0], c2[1], kernel_size=3, padding=1)        # çº¿è·¯3ï¼Œ1 x 1å·ç§¯å±‚åæ¥5 x 5å·ç§¯å±‚        self.p3_1 = nn.Conv2d(in_c, c3[0], kernel_size=1)        self.p3_2 = nn.Conv2d(c3[0], c3[1], kernel_size=5, padding=2)        # çº¿è·¯4ï¼Œ3 x 3æœ€å¤§æ± åŒ–å±‚åæ¥1 x 1å·ç§¯å±‚        self.p4_1 = nn.MaxPool2d(kernel_size=3, stride=1, padding=1)        self.p4_2 = nn.Conv2d(in_c, c4, kernel_size=1)    def forward(self, x):        p1 = F.relu(self.p1_1(x))        p2 = F.relu(self.p2_2(F.relu(self.p2_1(x))))        p3 = F.relu(self.p3_2(F.relu(self.p3_1(x))))        p4 = F.relu(self.p4_2(self.p4_1(x)))        return torch.cat((p1, p2, p3, p4), dim=1)  # åœ¨é€šé“ç»´ä¸Šè¿ç»“è¾“å‡ºï¼ˆå„ä¸ªçº¿è·¯é€šé“æ•°ç›´æ¥ç›¸åŠ ï¼‰</code></pre><h3 id="GoogLeNetæ¨¡å‹"><a href="#GoogLeNetæ¨¡å‹" class="headerlink" title="GoogLeNetæ¨¡å‹"></a>GoogLeNetæ¨¡å‹</h3><p>å®Œæ•´æ¨¡å‹ç»“æ„ ï¼ˆä¸­é—´çš„å¹¶è”æ˜¯è‹¥å¹²ä¸ª Inceptionï¼‰</p><p>æœ€åä¸€å±‚ï¼Œå®ƒå¯ä»¥ç¡®ä¿ç»è¿‡ Global AvgPool åè¾“å‡ºçš„å½¢çŠ¶ä¸º [batch_size, num_of_channels, 1, 1]ã€‚<br>å½“è¾“å…¥å›¾åƒçš„å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥å‘æŒ¥ä½œç”¨</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5l6x0fyyn.png?imageView2/0/w/640/h/640" alt="å®Œæ•´GoogLeNetæ¨¡å‹"></p><pre><code class="lang-python">b1 = nn.Sequential(nn.Conv2d(1, 64, kernel_size=7, stride=2, padding=3),  # æŠ½å–ç‰¹å¾ï¼Œå‡å°å®½é«˜                   nn.ReLU(),                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))b2 = nn.Sequential(nn.Conv2d(64, 64, kernel_size=1),  # 1x1 å¢åŠ éçº¿æ€§çš„ä½œç”¨                   nn.Conv2d(64, 192, kernel_size=3, padding=1), # padding=1 åœ¨ kernel_size=3 æ—¶å¯ä¿æŒå®½é«˜ä¸å˜                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))b3 = nn.Sequential(Inception(192, 64, (96, 128), (16, 32), 32),  # å¯¹åº” inception å†…çš„å„ä¸ªçº¿è·¯                   Inception(256, 128, (128, 192), (32, 96), 64),                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))b4 = nn.Sequential(Inception(480, 192, (96, 208), (16, 48), 64),  # 480 å°±æ˜¯ä¸Šä¸€å±‚å„ä¸ªçº¿è·¯çš„å åŠ                    Inception(512, 160, (112, 224), (24, 64), 64),                   Inception(512, 128, (128, 256), (24, 64), 64),                   Inception(512, 112, (144, 288), (32, 64), 64),                   Inception(528, 256, (160, 320), (32, 128), 128),                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))b5 = nn.Sequential(Inception(832, 256, (160, 320), (32, 128), 128),                   Inception(832, 384, (192, 384), (48, 128), 128),                   d2l.GlobalAvgPool2d())net = nn.Sequential(b1, b2, b3, b4, b5,                     d2l.FlattenLayer(), nn.Linear(1024, 10))net = nn.Sequential(b1, b2, b3, b4, b5, d2l.FlattenLayer(), nn.Linear(1024, 10))X = torch.rand(1, 1, 96, 96)for blk in net.children():     X = blk(X)    print(&#39;output shape: &#39;, X.shape)#batchsize=128batch_size = 16# å¦‚å‡ºç°â€œout of memoryâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯å‡å°batch_sizeæˆ–resize#train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, resize=96)lr, num_epochs = 0.001, 5optimizer = torch.optim.Adam(net.parameters(), lr=lr)d2l.train_ch5(net, train_iter, test_iter, batch_size, optimizer, device, num_epochs)</code></pre><p>æ¯ä¸€å±‚è®­ç»ƒï¼Œfeature_map å›¾åƒçš„å®½é«˜éƒ½ä¼šå‡åŠï¼Œç‰¹å¾æ•°éƒ½ä¼šç¿»å€ï¼Œè¡¨ç¤ºæå–çš„ç‰¹å¾è¶Šæ¥è¶Šé«˜çº§ï¼Œè¶Šæ¥è¶ŠæŠ½è±¡</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/8xDuCcnMRre1LbU.png" alt="å„å±‚çš„å®é™…å‚æ•°-è®­ç»ƒç»“æœ"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (å):LeNet æ¨¡å‹ -- CNN å‡çº§ç‰ˆ</title>
      <link href="/2020/02/20/dl-notes10-LeNet/"/>
      <url>/2020/02/20/dl-notes10-LeNet/</url>
      
        <content type="html"><![CDATA[<h2 id="LeNet-æ¨¡å‹ï¼ˆCNN-å‡çº§ç‰ˆï¼‰"><a href="#LeNet-æ¨¡å‹ï¼ˆCNN-å‡çº§ç‰ˆï¼‰" class="headerlink" title="LeNet æ¨¡å‹ï¼ˆCNN å‡çº§ç‰ˆï¼‰"></a>LeNet æ¨¡å‹ï¼ˆCNN å‡çº§ç‰ˆï¼‰</h2><ol><li>lenet æ¨¡å‹ä»‹ç»</li><li>lenet ç½‘ç»œæ­å»º</li><li>è¿ç”¨lenetè¿›è¡Œå›¾åƒè¯†åˆ«-fashion-mnistæ•°æ®é›†</li></ol><h1 id="Convolutional-Neural-Networks"><a href="#Convolutional-Neural-Networks" class="headerlink" title="Convolutional Neural Networks"></a>Convolutional Neural Networks</h1><p>ä½¿ç”¨å…¨è¿æ¥å±‚çš„å±€é™æ€§ï¼š</p><ul><li>å›¾åƒåœ¨åŒä¸€åˆ—é‚»è¿‘çš„åƒç´ åœ¨è¿™ä¸ªå‘é‡ä¸­å¯èƒ½ç›¸è·è¾ƒè¿œã€‚å®ƒä»¬æ„æˆçš„æ¨¡å¼å¯èƒ½éš¾ä»¥è¢«æ¨¡å‹è¯†åˆ«ã€‚</li><li>å¯¹äºå¤§å°ºå¯¸çš„è¾“å…¥å›¾åƒï¼Œä½¿ç”¨å…¨è¿æ¥å±‚å®¹æ˜“å¯¼è‡´æ¨¡å‹è¿‡å¤§ã€‚</li></ul><p>ä½¿ç”¨å·ç§¯å±‚çš„ä¼˜åŠ¿ï¼š</p><ul><li>å·ç§¯å±‚ä¿ç•™è¾“å…¥å½¢çŠ¶ã€‚</li><li>å·ç§¯å±‚é€šè¿‡æ»‘åŠ¨çª—å£å°†åŒä¸€å·ç§¯æ ¸ä¸ä¸åŒä½ç½®çš„è¾“å…¥é‡å¤è®¡ç®—ï¼Œä»è€Œé¿å…å‚æ•°å°ºå¯¸è¿‡å¤§ã€‚</li></ul><h2 id="LeNet-æ¨¡å‹"><a href="#LeNet-æ¨¡å‹" class="headerlink" title="LeNet æ¨¡å‹"></a>LeNet æ¨¡å‹</h2><p>LeNetåˆ†ä¸ºå·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—ä¸¤ä¸ªéƒ¨åˆ†ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªæ¨¡å—ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VrrQ0.png" alt="LeNet æ¨¡å‹å›¾"></p><p>å·ç§¯å±‚å—é‡Œçš„åŸºæœ¬å•ä½æ˜¯å·ç§¯å±‚åæ¥å¹³å‡æ± åŒ–å±‚ï¼šå·ç§¯å±‚ç”¨æ¥è¯†åˆ«å›¾åƒé‡Œçš„ç©ºé—´æ¨¡å¼ï¼Œå¦‚çº¿æ¡å’Œç‰©ä½“å±€éƒ¨ï¼Œä¹‹åçš„å¹³å‡æ± åŒ–å±‚åˆ™ç”¨æ¥é™ä½å·ç§¯å±‚å¯¹ä½ç½®çš„æ•æ„Ÿæ€§ã€‚</p><p>å·ç§¯å±‚å—ç”±ä¸¤ä¸ªè¿™æ ·çš„åŸºæœ¬å•ä½é‡å¤å †å æ„æˆã€‚åœ¨å·ç§¯å±‚å—ä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚éƒ½ä½¿ç”¨$5 \times 5$çš„çª—å£ï¼Œå¹¶åœ¨è¾“å‡ºä¸Šä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå·ç§¯å±‚è¾“å‡ºé€šé“æ•°ä¸º6ï¼Œç¬¬äºŒä¸ªå·ç§¯å±‚è¾“å‡ºé€šé“æ•°åˆ™å¢åŠ åˆ°16ã€‚</p><p>å…¨è¿æ¥å±‚å—å«3ä¸ªå…¨è¿æ¥å±‚ã€‚å®ƒä»¬çš„è¾“å‡ºä¸ªæ•°åˆ†åˆ«æ˜¯120ã€84å’Œ10ï¼Œå…¶ä¸­10ä¸ºè¾“å‡ºçš„ç±»åˆ«ä¸ªæ•°ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡Sequentialç±»æ¥å®ç°LeNetæ¨¡å‹ã€‚</p><pre><code class="lang-python">#importimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2limport torchimport torch.nn as nnimport torch.optim as optimimport time</code></pre><pre><code class="lang-python">#netclass Flatten(torch.nn.Module):  #å±•å¹³æ“ä½œ    def forward(self, x):        return x.view(x.shape[0], -1)class Reshape(torch.nn.Module): #å°†å›¾åƒå¤§å°é‡å®šå‹    def forward(self, x):        return x.view(-1,1,28,28)      #(B x C x H x W)net = torch.nn.Sequential(     #Lelet                                                      Reshape(),    nn.Conv2d(in_channels=1, out_channels=6, kernel_size=5, padding=2), #å·ç§¯ b*1*28*28  =&gt;b*6*28*28 ï¼ˆb:batch_size)    nn.Sigmoid(),                                                           nn.AvgPool2d(kernel_size=2, stride=2),    # å¹³å‡æ± åŒ–                #b*6*28*28  =&gt;b*6*14*14    nn.Conv2d(in_channels=6, out_channels=16, kernel_size=5),           #b*6*14*14  =&gt;b*16*10*10    nn.Sigmoid(),    nn.AvgPool2d(kernel_size=2, stride=2),                              #b*16*10*10  =&gt; b*16*5*5    Flatten(),          # çº¯ç²¹çš„å±•å¹³æ“ä½œ                                #b*16*5*5   =&gt; b*400    nn.Linear(in_features=16*5*5, out_features=120),    nn.Sigmoid(),    nn.Linear(120, 84),    nn.Sigmoid(),    nn.Linear(84, 10))</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ„é€ ä¸€ä¸ªé«˜å’Œå®½å‡ä¸º28çš„å•é€šé“æ•°æ®æ ·æœ¬ï¼Œå¹¶é€å±‚è¿›è¡Œå‰å‘è®¡ç®—æ¥æŸ¥çœ‹æ¯ä¸ªå±‚çš„è¾“å‡ºå½¢çŠ¶ã€‚</p><pre><code class="lang-python">#printX = torch.randn(size=(1,1,28,28), dtype = torch.float32)   # batch_size = 1, channel = 1, h = w =28for layer in net:    X = layer(X)    print(layer.__class__.__name__,&#39;output shape: \t&#39;,X.shape)</code></pre><pre><code>Reshape output shape:      torch.Size([1, 1, 28, 28])Conv2d output shape:      torch.Size([1, 6, 28, 28])Sigmoid output shape:      torch.Size([1, 6, 28, 28])AvgPool2d output shape:      torch.Size([1, 6, 14, 14])Conv2d output shape:      torch.Size([1, 16, 10, 10])Sigmoid output shape:      torch.Size([1, 16, 10, 10])AvgPool2d output shape:      torch.Size([1, 16, 5, 5])Flatten output shape:      torch.Size([1, 400])Linear output shape:      torch.Size([1, 120])Sigmoid output shape:      torch.Size([1, 120])Linear output shape:      torch.Size([1, 84])Sigmoid output shape:      torch.Size([1, 84])Linear output shape:      torch.Size([1, 10])</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å·ç§¯å±‚å—ä¸­è¾“å…¥çš„é«˜å’Œå®½åœ¨é€å±‚å‡å°ã€‚å·ç§¯å±‚ç”±äºä½¿ç”¨é«˜å’Œå®½å‡ä¸º5çš„å·ç§¯æ ¸ï¼Œä»è€Œå°†é«˜å’Œå®½åˆ†åˆ«å‡å°4ï¼Œè€Œæ± åŒ–å±‚åˆ™å°†é«˜å’Œå®½å‡åŠï¼Œä½†é€šé“æ•°åˆ™ä»1å¢åŠ åˆ°16ã€‚å…¨è¿æ¥å±‚åˆ™é€å±‚å‡å°‘è¾“å‡ºä¸ªæ•°ï¼Œç›´åˆ°å˜æˆå›¾åƒçš„ç±»åˆ«æ•°10ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VrHeO.png" alt="é€å±‚å˜åŒ–æƒ…å†µ"></p><h2 id="è·å–æ•°æ®å’Œè®­ç»ƒæ¨¡å‹"><a href="#è·å–æ•°æ®å’Œè®­ç»ƒæ¨¡å‹" class="headerlink" title="è·å–æ•°æ®å’Œè®­ç»ƒæ¨¡å‹"></a>è·å–æ•°æ®å’Œè®­ç»ƒæ¨¡å‹</h2><p>ä¸‹é¢æˆ‘ä»¬æ¥å®ç°LeNetæ¨¡å‹ã€‚æˆ‘ä»¬ä»ç„¶ä½¿ç”¨Fashion-MNISTä½œä¸ºè®­ç»ƒæ•°æ®é›†ã€‚</p><pre><code class="lang-python"># æ•°æ®batch_size = 256train_iter, test_iter = d2l.load_data_fashion_mnist(  # è®­ç»ƒé›†ã€æµ‹è¯•é›†    batch_size=batch_size, root=&#39;/home/kesci/input/FashionMNIST2065&#39;)print(len(train_iter))  # 235 ä¸ª batchï¼Œæ¯ä¸ª batch 256å¼ å›¾</code></pre><pre><code>235</code></pre><p>ä¸ºäº†ä½¿è¯»è€…æ›´åŠ å½¢è±¡çš„çœ‹åˆ°æ•°æ®ï¼Œæ·»åŠ é¢å¤–çš„éƒ¨åˆ†æ¥å±•ç¤ºæ•°æ®çš„å›¾åƒ</p><pre><code class="lang-python">#æ•°æ®å±•ç¤ºimport matplotlib.pyplot as pltdef show_fashion_mnist(images, labels):    d2l.use_svg_display()    # è¿™é‡Œçš„_è¡¨ç¤ºæˆ‘ä»¬å¿½ç•¥ï¼ˆä¸ä½¿ç”¨ï¼‰çš„å˜é‡    _, figs = plt.subplots(1, len(images), figsize=(12, 12))    for f, img, lbl in zip(figs, images, labels):        f.imshow(img.view((28, 28)).numpy())        f.set_title(lbl)        f.axes.get_xaxis().set_visible(False)        f.axes.get_yaxis().set_visible(False)    plt.show()for Xdata,ylabel in train_iter:    breakX, y = [], []for i in range(10):    print(Xdata[i].shape,ylabel[i].numpy())    X.append(Xdata[i]) # å°†ç¬¬iä¸ªfeatureåŠ åˆ°Xä¸­    y.append(ylabel[i].numpy()) # å°†ç¬¬iä¸ªlabelåŠ åˆ°yä¸­show_fashion_mnist(X, y)</code></pre><pre><code>torch.Size([1, 28, 28]) 3torch.Size([1, 28, 28]) 8torch.Size([1, 28, 28]) 1torch.Size([1, 28, 28]) 4torch.Size([1, 28, 28]) 0torch.Size([1, 28, 28]) 0torch.Size([1, 28, 28]) 4torch.Size([1, 28, 28]) 9torch.Size([1, 28, 28]) 4torch.Size([1, 28, 28]) 7</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/4FE5CE6E20494BFE898E9D8EAAF30C7B/q5ndypu2sq.svg"></p><p>å› ä¸ºå·ç§¯ç¥ç»ç½‘ç»œè®¡ç®—æ¯”å¤šå±‚æ„ŸçŸ¥æœºè¦å¤æ‚ï¼Œå»ºè®®ä½¿ç”¨GPUæ¥åŠ é€Ÿè®¡ç®—ã€‚æˆ‘ä»¬æŸ¥çœ‹çœ‹æ˜¯å¦å¯ä»¥ç”¨GPUï¼Œå¦‚æœæˆåŠŸåˆ™ä½¿ç”¨<code>cuda:0</code>ï¼Œå¦åˆ™ä»ç„¶ä½¿ç”¨<code>cpu</code>ã€‚</p><pre><code class="lang-python"># This function has been saved in the d2l package for future use#use GPUdef try_gpu():    &quot;&quot;&quot;If GPU is available, return torch.device as cuda:0; else return torch.device as cpu.&quot;&quot;&quot;    if torch.cuda.is_available():        device = torch.device(&#39;cuda:0&#39;)    else:        device = torch.device(&#39;cpu&#39;)    return devicedevice = try_gpu()device</code></pre><pre><code>device(type=&#39;cpu&#39;)</code></pre><p>æˆ‘ä»¬å®ç°<code>evaluate_accuracy</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºè®¡ç®—æ¨¡å‹<code>net</code>åœ¨æ•°æ®é›†<code>data_iter</code>ä¸Šçš„å‡†ç¡®ç‡ã€‚</p><pre><code class="lang-python">#è®¡ç®—å‡†ç¡®ç‡&#39;&#39;&#39;(1). net.train()  å¯ç”¨ BatchNormalization å’Œ Dropoutï¼Œå°†BatchNormalizationå’ŒDropoutç½®ä¸ºTrue(2). net.eval()ä¸å¯ç”¨ BatchNormalization å’Œ Dropoutï¼Œå°†BatchNormalizationå’ŒDropoutç½®ä¸ºFalse&#39;&#39;&#39;def evaluate_accuracy(data_iter, net,device=torch.device(&#39;cpu&#39;)):    &quot;&quot;&quot;Evaluate accuracy of a model on the given data set.&quot;&quot;&quot;    acc_sum,n = torch.tensor([0],dtype=torch.float32,device=device),0    for X,y in data_iter:        # If device is the GPU, copy the data to the GPU.        X,y = X.to(device),y.to(device)        net.eval()        with torch.no_grad():   # ä¸éœ€è¦æ¢¯åº¦ï¼Œä¹Ÿä¸ä¼šåå‘ä¼ æ’­            y = y.long()            acc_sum += torch.sum((torch.argmax(net(X), dim=1) == y))              # dim=1 dim 0 -&gt; 1 -&gt; ... ç»´åº¦ä»å¤§åˆ°å°[[0.2 ,0.4 ,0.5 ,0.6 ,0.8] ,[ 0.1,0.2 ,0.4 ,0.3 ,0.1]] =&gt; [ 4 , 2 ]            n += y.shape[0]    return acc_sum.item()/n</code></pre><p>æˆ‘ä»¬å®šä¹‰å‡½æ•°<code>train_ch5</code>ï¼Œç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p><pre><code class="lang-python">#è®­ç»ƒå‡½æ•°def train_ch5(net, train_iter, test_iter,criterion, num_epochs, batch_size, device,lr=None):    &quot;&quot;&quot;Train and evaluate a model with CPU or GPU.&quot;&quot;&quot;    print(&#39;training on&#39;, device)    net.to(device)    optimizer = optim.SGD(net.parameters(), lr=lr)    for epoch in range(num_epochs):        train_l_sum = torch.tensor([0.0],dtype=torch.float32,device=device)     # loss æ€»å’Œ        train_acc_sum = torch.tensor([0.0],dtype=torch.float32,device=device)   # é¢„æµ‹æ­£ç¡®çš„æ€»æ•°        n, start = 0, time.time()        for X, y in train_iter:  # X è®­ç»ƒæ•°æ®ï¼Œy è®­ç»ƒæ ‡ç­¾            net.train()  # ä¸ net.eval ç›¸åï¼Œå¯ç”¨ æ‰¹æ ‡å‡†åŒ–å’Œ dropout            optimizer.zero_grad()  # ä¸åŒæ‰¹çš„æ¢¯åº¦ä¸ç›¸å…³ï¼Œè¦æ¸…é›¶            X,y = X.to(device),y.to(device)             y_hat = net(X)            loss = criterion(y_hat, y)            loss.backward()            optimizer.step()            with torch.no_grad():                y = y.long()                train_l_sum += loss.float()                train_acc_sum += (torch.sum((torch.argmax(y_hat, dim=1) == y))).float()                n += y.shape[0]        test_acc = evaluate_accuracy(test_iter, net,device)        print(&#39;epoch %d, loss %.4f, train acc %.3f, test acc %.3f, &#39;              &#39;time %.1f sec&#39;              % (epoch + 1, train_l_sum/n, train_acc_sum/n, test_acc,                 time.time() - start))</code></pre><p>æˆ‘ä»¬é‡æ–°å°†æ¨¡å‹å‚æ•°åˆå§‹åŒ–åˆ°å¯¹åº”çš„è®¾å¤‡<code>device</code>(<code>cpu</code> or <code>cuda:0</code>)ä¹‹ä¸Šï¼Œå¹¶ä½¿ç”¨Xavieréšæœºåˆå§‹åŒ–ã€‚æŸå¤±å‡½æ•°å’Œè®­ç»ƒç®—æ³•åˆ™ä¾ç„¶ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å’Œå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€‚</p><pre><code class="lang-python"># è®­ç»ƒlr, num_epochs = 0.9, 10def init_weights(m):    if type(m) == nn.Linear or type(m) == nn.Conv2d:        torch.nn.init.xavier_uniform_(m.weight)net.apply(init_weights)net = net.to(device)criterion = nn.CrossEntropyLoss()   #äº¤å‰ç†µæè¿°äº†ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œäº¤å‰ç†µè¶Šå°è¯´æ˜ä¸¤è€…ä¹‹é—´è¶Šæ¥è¿‘train_ch5(net, train_iter, test_iter, criterion,num_epochs, batch_size,device, lr)</code></pre><pre><code>training on cpuepoch 1, loss 0.0091, train acc 0.100, test acc 0.168, time 21.6 secepoch 2, loss 0.0065, train acc 0.355, test acc 0.599, time 21.5 secepoch 3, loss 0.0035, train acc 0.651, test acc 0.665, time 21.8 secepoch 4, loss 0.0028, train acc 0.717, test acc 0.723, time 21.7 secepoch 5, loss 0.0025, train acc 0.746, test acc 0.753, time 21.4 secepoch 6, loss 0.0023, train acc 0.767, test acc 0.754, time 21.5 secepoch 7, loss 0.0022, train acc 0.782, test acc 0.785, time 21.3 secepoch 8, loss 0.0021, train acc 0.798, test acc 0.791, time 21.8 secepoch 9, loss 0.0019, train acc 0.811, test acc 0.790, time 22.0 secepoch 10, loss 0.0019, train acc 0.821, test acc 0.804, time 22.1 sec</code></pre><pre><code class="lang-python"># testfor testdata,testlabe in test_iter:    testdata,testlabe = testdata.to(device),testlabe.to(device)    breakprint(testdata.shape,testlabe.shape)net.eval()y_pre = net(testdata)print(torch.argmax(y_pre,dim=1)[:10])print(testlabe[:10])</code></pre><pre><code>torch.Size([256, 1, 28, 28]) torch.Size([256])tensor([9, 2, 1, 1, 6, 1, 2, 6, 5, 7])tensor([9, 2, 1, 1, 6, 1, 4, 6, 5, 7])</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å·ç§¯ç¥ç»ç½‘ç»œå°±æ˜¯å«å·ç§¯å±‚çš„ç½‘ç»œã€‚<br>LeNetäº¤æ›¿ä½¿ç”¨å·ç§¯å±‚å’Œæœ€å¤§æ± åŒ–å±‚åæ¥å…¨è¿æ¥å±‚æ¥è¿›è¡Œå›¾åƒåˆ†ç±»ã€‚</p><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VkvBd.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (ä¹):å·ç§¯ç¥ç»ç½‘ç»œ CNN åŸºç¡€</title>
      <link href="/2020/02/20/dl-notes9-cnn-basic/"/>
      <url>/2020/02/20/dl-notes9-cnn-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€"><a href="#å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€"></a>å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€</h1><p>å·ç§¯æœ¬è´¨ä¸Šä½“ç°äº†<code>ä¸¤ç§ä¿¡å·çš„æ—¶ç§»ç´¯åŠ </code>ã€‚</p><p>æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»å·ç§¯ç¥ç»ç½‘ç»œçš„åŸºç¡€æ¦‚å¿µï¼Œä¸»è¦æ˜¯å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œå¹¶è§£é‡Šå¡«å……ã€æ­¥å¹…ã€è¾“å…¥é€šé“å’Œè¾“å‡ºé€šé“çš„å«ä¹‰ã€‚</p><h2 id="äºŒç»´å·ç§¯å±‚"><a href="#äºŒç»´å·ç§¯å±‚" class="headerlink" title="äºŒç»´å·ç§¯å±‚"></a>äºŒç»´å·ç§¯å±‚</h2><p>æœ¬èŠ‚ä»‹ç»çš„æ˜¯æœ€å¸¸è§çš„äºŒç»´å·ç§¯å±‚ï¼Œå¸¸ç”¨äºå¤„ç†å›¾åƒæ•°æ®ã€‚</p><h3 id="äºŒç»´äº’ç›¸å…³è¿ç®—"><a href="#äºŒç»´äº’ç›¸å…³è¿ç®—" class="headerlink" title="äºŒç»´äº’ç›¸å…³è¿ç®—"></a>äºŒç»´äº’ç›¸å…³è¿ç®—</h3><p>äºŒç»´äº’ç›¸å…³ï¼ˆcross-correlationï¼‰è¿ç®—çš„è¾“å…¥æ˜¯ä¸€ä¸ªäºŒç»´è¾“å…¥æ•°ç»„å’Œä¸€ä¸ªäºŒç»´<code>æ ¸ï¼ˆkernelï¼‰æ•°ç»„</code>ï¼Œè¾“å‡ºä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ ¸æ•°ç»„é€šå¸¸ç§°ä¸º<code>å·ç§¯æ ¸</code>æˆ–<code>è¿‡æ»¤å™¨</code>ï¼ˆfilterï¼‰ã€‚å·ç§¯æ ¸çš„å°ºå¯¸é€šå¸¸å°äºè¾“å…¥æ•°ç»„ï¼Œå·ç§¯æ ¸åœ¨è¾“å…¥æ•°ç»„ä¸Šæ»‘åŠ¨ï¼Œåœ¨æ¯ä¸ªä½ç½®ä¸Šï¼Œå·ç§¯æ ¸ä¸è¯¥ä½ç½®å¤„çš„è¾“å…¥å­æ•°ç»„æŒ‰å…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œï¼Œå¾—åˆ°è¾“å‡ºæ•°ç»„ä¸­ç›¸åº”ä½ç½®çš„å…ƒç´ ã€‚å›¾1å±•ç¤ºäº†ä¸€ä¸ªäº’ç›¸å…³è¿ç®—çš„ä¾‹å­ï¼Œé˜´å½±éƒ¨åˆ†åˆ†åˆ«æ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªè®¡ç®—åŒºåŸŸã€æ ¸æ•°ç»„ä»¥åŠå¯¹åº”çš„è¾“å‡ºã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/xTyKEpR7j6gVaHb.png" alt="äºŒç»´äº’ç›¸å…³è¿ç®—"></p><p>ä¸‹é¢æˆ‘ä»¬ç”¨<code>corr2d</code>å‡½æ•°å®ç°äºŒç»´äº’ç›¸å…³è¿ç®—ï¼Œå®ƒæ¥å—è¾“å…¥æ•°ç»„<code>X</code>ä¸æ ¸æ•°ç»„<code>K</code>ï¼Œå¹¶è¾“å‡ºæ•°ç»„<code>Y</code>ã€‚</p><pre><code class="lang-python">import torch import torch.nn as nndef corr2d(X, K):    H, W = X.shape    h, w = K.shape    Y = torch.zeros(H - h + 1, W - w + 1)    for i in range(Y.shape[0]):        for j in range(Y.shape[1]):            Y[i, j] = (X[i: i + h, j: j + w] * K).sum()    return Y</code></pre><p>æ„é€ ä¸Šå›¾ä¸­çš„è¾“å…¥æ•°ç»„<code>X</code>ã€æ ¸æ•°ç»„<code>K</code>æ¥éªŒè¯äºŒç»´äº’ç›¸å…³è¿ç®—çš„è¾“å‡ºã€‚</p><pre><code class="lang-python">X = torch.tensor([[0, 1, 2], [3, 4, 5], [6, 7, 8]])K = torch.tensor([[0, 1], [2, 3]])Y = corr2d(X, K)print(Y)</code></pre><pre><code>tensor([[19., 25.],        [37., 43.]])</code></pre><h3 id="äºŒç»´å·ç§¯å±‚-1"><a href="#äºŒç»´å·ç§¯å±‚-1" class="headerlink" title="äºŒç»´å·ç§¯å±‚"></a>äºŒç»´å·ç§¯å±‚</h3><p>äºŒç»´å·ç§¯å±‚å°†è¾“å…¥å’Œå·ç§¯æ ¸åšäº’ç›¸å…³è¿ç®—ï¼Œå¹¶åŠ ä¸Šä¸€ä¸ªæ ‡é‡åç½®æ¥å¾—åˆ°è¾“å‡ºã€‚å·ç§¯å±‚çš„<code>æ¨¡å‹å‚æ•°</code>åŒ…æ‹¬ã€Œå·ç§¯æ ¸ã€<code>self.weight</code>å’Œã€Œæ ‡é‡åç½®ã€<code>self.bias</code>ã€‚</p><ul><li><p><code>nn.Parameter()</code>æ˜¯ tensor çš„å­ç±»ï¼Œä¼šä¸ºå‚æ•°è‡ªåŠ¨é™„ä¸Šæ¢¯åº¦ï¼Œæ˜¯å¯å­¦ä¹ çš„</p></li><li><p><code>nn.Module</code>è¡¨ç¤ºçš„æ¨¡å‹ä¸­ä¼šç»´æŠ¤ä¸€ä¸ªå‚æ•°é›†åˆï¼Œå®šä¹‰nn.Parameter()ä¼šè‡ªåŠ¨æŠŠå‚æ•°æ³¨å†Œåˆ° model çš„å‚æ•°é›†åˆä¸­</p></li></ul><pre><code class="lang-python">class Conv2D(nn.Module):    def __init__(self, kernel_size):  # kernel_size å·ç§¯å±‚çš„é«˜å’Œå®½        super(Conv2D, self).__init__()        self.weight = nn.Parameter(torch.randn(kernel_size))        self.bias = nn.Parameter(torch.randn(1))    def forward(self, x):        return corr2d(x, self.weight) + self.bias  # å¹¿æ’­æœºåˆ¶ï¼Œæ¯ä¸ªä½ç½®åŠ äº†åŒæ ·ä¸€ä¸ªåç½®</code></pre><p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ„é€ ä¸€å¼ $6 \times 8$çš„å›¾åƒï¼Œä¸­é—´4åˆ—ä¸ºé»‘ï¼ˆ0ï¼‰ï¼Œå…¶ä½™ä¸ºç™½ï¼ˆ1ï¼‰ï¼Œå¸Œæœ›æ£€æµ‹åˆ°é¢œè‰²è¾¹ç¼˜ã€‚æˆ‘ä»¬çš„æ ‡ç­¾æ˜¯ä¸€ä¸ª$6 \times 7$çš„äºŒç»´æ•°ç»„ï¼Œç¬¬2åˆ—æ˜¯1ï¼ˆä»1åˆ°0çš„è¾¹ç¼˜ï¼‰ï¼Œç¬¬6åˆ—æ˜¯-1ï¼ˆä»0åˆ°1çš„è¾¹ç¼˜ï¼‰ã€‚</p><pre><code class="lang-python">X = torch.ones(6, 8)Y = torch.zeros(6, 7)X[:, 2: 6] = 0Y[:, 1] = 1Y[:, 5] = -1print(X)print(Y)</code></pre><pre><code>tensor([[1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.]])tensor([[ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.]])</code></pre><p>æˆ‘ä»¬å¸Œæœ›å­¦ä¹ ä¸€ä¸ª$1 \times 2$å·ç§¯å±‚ï¼Œé€šè¿‡å·ç§¯å±‚æ¥æ£€æµ‹é¢œè‰²è¾¹ç¼˜ã€‚ï¼ˆå› ä¸ºè®¡ç®—è¾¹ç¼˜è€ƒè™‘çš„æ˜¯åŒä¸€è¡Œçš„ç›¸é‚»ä¸¤ä¸ªå…ƒç´ ï¼Œ1 è¡Œ 2 åˆ—ï¼‰</p><pre><code class="lang-python">conv2d = Conv2D(kernel_size=(1, 2))step = 30lr = 0.01for i in range(step):    Y_hat = conv2d(X)    l = ((Y_hat - Y) ** 2).sum()    l.backward()    # æ¢¯åº¦ä¸‹é™    conv2d.weight.data -= lr * conv2d.weight.grad    conv2d.bias.data -= lr * conv2d.bias.grad    # æ¢¯åº¦æ¸…é›¶    conv2d.weight.grad.zero_()    conv2d.bias.grad.zero_()    if (i + 1) % 5 == 0:        print(&#39;Step %d, loss %.3f&#39; % (i + 1, l.item()))print(conv2d.weight.data)print(conv2d.bias.data)</code></pre><pre><code>Step 5, loss 4.569Step 10, loss 0.949Step 15, loss 0.228Step 20, loss 0.060Step 25, loss 0.016Step 30, loss 0.004tensor([[ 1.0161, -1.0177]])tensor([0.0009])</code></pre><h3 id="äº’ç›¸å…³è¿ç®—ä¸å·ç§¯è¿ç®—"><a href="#äº’ç›¸å…³è¿ç®—ä¸å·ç§¯è¿ç®—" class="headerlink" title="äº’ç›¸å…³è¿ç®—ä¸å·ç§¯è¿ç®—"></a>äº’ç›¸å…³è¿ç®—ä¸å·ç§¯è¿ç®—</h3><p>å·ç§¯å±‚å¾—åäºå·ç§¯è¿ç®—ï¼Œä½†å·ç§¯å±‚ä¸­ç”¨åˆ°çš„å¹¶éå·ç§¯è¿ç®—è€Œæ˜¯äº’ç›¸å…³è¿ç®—ã€‚æˆ‘ä»¬å°†æ ¸æ•°ç»„ä¸Šä¸‹ç¿»è½¬ã€å·¦å³ç¿»è½¬ï¼Œå†ä¸è¾“å…¥æ•°ç»„åšäº’ç›¸å…³è¿ç®—ï¼Œè¿™ä¸€è¿‡ç¨‹å°±æ˜¯å·ç§¯è¿ç®—ã€‚ç”±äºå·ç§¯å±‚çš„æ ¸æ•°ç»„æ˜¯å¯å­¦ä¹ çš„ï¼Œæ‰€ä»¥ä½¿ç”¨äº’ç›¸å…³è¿ç®—ä¸ä½¿ç”¨å·ç§¯è¿ç®—å¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚</p><h3 id="ç‰¹å¾å›¾ä¸æ„Ÿå—é‡"><a href="#ç‰¹å¾å›¾ä¸æ„Ÿå—é‡" class="headerlink" title="ç‰¹å¾å›¾ä¸æ„Ÿå—é‡"></a>ç‰¹å¾å›¾ä¸æ„Ÿå—é‡</h3><p>äºŒç»´å·ç§¯å±‚<strong>è¾“å‡º</strong>çš„äºŒç»´æ•°ç»„å¯ä»¥çœ‹ä½œæ˜¯è¾“å…¥åœ¨ç©ºé—´ç»´åº¦ï¼ˆå®½å’Œé«˜ï¼‰ä¸ŠæŸä¸€çº§çš„è¡¨å¾ï¼Œä¹Ÿå«<strong>ã€Œç‰¹å¾å›¾ã€ï¼ˆfeature mapï¼‰</strong>ã€‚å½±å“å…ƒç´ $x$çš„å‰å‘è®¡ç®—çš„æ‰€æœ‰å¯èƒ½<strong>è¾“å…¥</strong>åŒºåŸŸï¼ˆå¯èƒ½å¤§äºè¾“å…¥çš„å®é™…å°ºå¯¸ï¼‰å«åš$x$çš„ <strong>ã€Œæ„Ÿå—é‡ã€ï¼ˆreceptive fieldï¼‰</strong>ã€‚</p><p>ä»¥å›¾1ä¸ºä¾‹ï¼Œè¾“å…¥ä¸­é˜´å½±éƒ¨åˆ†çš„å››ä¸ªå…ƒç´ æ˜¯è¾“å‡ºä¸­é˜´å½±éƒ¨åˆ†å…ƒç´ çš„æ„Ÿå—é‡ã€‚æˆ‘ä»¬å°†å›¾ä¸­å½¢çŠ¶ä¸º$2 \times 2$çš„è¾“å‡ºè®°ä¸º$Y$ï¼Œå°†$Y$ä¸å¦ä¸€ä¸ªå½¢çŠ¶ä¸º$2 \times 2$çš„æ ¸æ•°ç»„åšäº’ç›¸å…³è¿ç®—ï¼Œè¾“å‡ºå•ä¸ªå…ƒç´ $z$ã€‚é‚£ä¹ˆï¼Œ$z$åœ¨$Y$ä¸Šçš„æ„Ÿå—é‡åŒ…æ‹¬$Y$çš„å…¨éƒ¨å››ä¸ªå…ƒç´ ï¼Œåœ¨è¾“å…¥ä¸Šçš„æ„Ÿå—é‡åŒ…æ‹¬å…¶ä¸­å…¨éƒ¨9ä¸ªå…ƒç´ ã€‚å¯è§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ·±çš„å·ç§¯ç¥ç»ç½‘ç»œä½¿ç‰¹å¾å›¾ä¸­å•ä¸ªå…ƒç´ çš„æ„Ÿå—é‡å˜å¾—æ›´åŠ å¹¿é˜”ï¼Œä»è€Œæ•æ‰è¾“å…¥ä¸Šæ›´å¤§å°ºå¯¸çš„ç‰¹å¾ã€‚</p><p>å †å åŠ æ·±ï¼Œä¸åŒå±‚çš„æ„Ÿå—é‡ä¸åŒï¼Œ<code>è¶Šæ·±è¶Šå¤§</code></p><h2 id="å¡«å……å’Œæ­¥å¹…"><a href="#å¡«å……å’Œæ­¥å¹…" class="headerlink" title="å¡«å……å’Œæ­¥å¹…"></a>å¡«å……å’Œæ­¥å¹…</h2><p>æˆ‘ä»¬ä»‹ç»å·ç§¯å±‚çš„ä¸¤ä¸ªè¶…å‚æ•°ï¼Œå³å¡«å……å’Œæ­¥å¹…ï¼Œå®ƒä»¬å¯ä»¥å¯¹ç»™å®šå½¢çŠ¶çš„è¾“å…¥å’Œå·ç§¯æ ¸æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚</p><h3 id="å¡«å……"><a href="#å¡«å……" class="headerlink" title="å¡«å……"></a>å¡«å……</h3><p>å¡«å……ï¼ˆpaddingï¼‰æ˜¯æŒ‡åœ¨è¾“å…¥é«˜å’Œå®½çš„ä¸¤ä¾§å¡«å……å…ƒç´ ï¼ˆé€šå¸¸æ˜¯0å…ƒç´ ï¼‰ï¼Œå›¾2é‡Œæˆ‘ä»¬åœ¨åŸè¾“å…¥é«˜å’Œå®½çš„ä¸¤ä¾§åˆ†åˆ«æ·»åŠ äº†å€¼ä¸º0çš„å…ƒç´ ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/qzCBiYL8nONrIds.png" alt="å¡«å……"></p><p>å›¾2 åœ¨è¾“å…¥çš„é«˜å’Œå®½ä¸¤ä¾§åˆ†åˆ«å¡«å……äº†0å…ƒç´ çš„äºŒç»´äº’ç›¸å…³è®¡ç®—</p><p>å¦‚æœåŸè¾“å…¥çš„é«˜å’Œå®½æ˜¯$n_h$å’Œ$n_w$ï¼Œå·ç§¯æ ¸çš„é«˜å’Œå®½æ˜¯$k_h$å’Œ$k_w$ï¼Œåœ¨é«˜çš„ä¸¤ä¾§ä¸€å…±å¡«å……$p_h$è¡Œï¼Œåœ¨å®½çš„ä¸¤ä¾§ä¸€å…±å¡«å……$p_w$åˆ—ï¼Œåˆ™è¾“å‡ºå½¢çŠ¶ä¸ºï¼š</p><script type="math/tex; mode=display">(n_h+p_h-k_h+1)\times(n_w+p_w-k_w+1)</script><p>æˆ‘ä»¬åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨å¥‡æ•°é«˜å®½çš„æ ¸ï¼Œæ¯”å¦‚$3 \times 3$ï¼Œ$5 \times 5$çš„å·ç§¯æ ¸ï¼Œå¯¹äºé«˜åº¦ï¼ˆæˆ–å®½åº¦ï¼‰ä¸ºå¤§å°ä¸º$2 k + 1$çš„æ ¸ï¼Œä»¤æ­¥å¹…ä¸º1ï¼Œåœ¨é«˜ï¼ˆæˆ–å®½ï¼‰ä¸¤ä¾§é€‰æ‹©å¤§å°ä¸º$k$çš„å¡«å……ï¼Œä¾¿å¯ä¿æŒè¾“å…¥ä¸è¾“å‡ºå°ºå¯¸ç›¸åŒã€‚</p><h3 id="æ­¥å¹…"><a href="#æ­¥å¹…" class="headerlink" title="æ­¥å¹…"></a>æ­¥å¹…</h3><p>åœ¨äº’ç›¸å…³è¿ç®—ä¸­ï¼Œå·ç§¯æ ¸åœ¨è¾“å…¥æ•°ç»„ä¸Šæ»‘åŠ¨ï¼Œæ¯æ¬¡æ»‘åŠ¨çš„è¡Œæ•°ä¸åˆ—æ•°å³æ˜¯æ­¥å¹…ï¼ˆstrideï¼‰ã€‚æ­¤å‰æˆ‘ä»¬ä½¿ç”¨çš„æ­¥å¹…éƒ½æ˜¯1ï¼Œå›¾3å±•ç¤ºäº†åœ¨é«˜ä¸Šæ­¥å¹…ä¸º3ã€åœ¨å®½ä¸Šæ­¥å¹…ä¸º2çš„äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/r9cVRdxynqzvjbt.png" alt="æ­¥å¹…"></p><p>å›¾3 é«˜å’Œå®½ä¸Šæ­¥å¹…åˆ†åˆ«ä¸º3å’Œ2çš„äºŒç»´äº’ç›¸å…³è¿ç®—</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“é«˜ä¸Šæ­¥å¹…ä¸º$s_h$ï¼Œå®½ä¸Šæ­¥å¹…ä¸º$s_w$æ—¶ï¼Œè¾“å‡ºå½¢çŠ¶ä¸ºï¼š</p><script type="math/tex; mode=display">\lfloor(n_h+p_h-k_h+s_h)/s_h\rfloor \times \lfloor(n_w+p_w-k_w+s_w)/s_w\rfloor</script><p>å¦‚æœ$p_h=k_h-1$ï¼Œ$p_w=k_w-1$ï¼Œé‚£ä¹ˆè¾“å‡ºå½¢çŠ¶å°†ç®€åŒ–ä¸º$\lfloor(n_h+s_h-1)/s_h\rfloor \times \lfloor(n_w+s_w-1)/s_w\rfloor$ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœè¾“å…¥çš„é«˜å’Œå®½èƒ½åˆ†åˆ«è¢«é«˜å’Œå®½ä¸Šçš„æ­¥å¹…æ•´é™¤ï¼Œé‚£ä¹ˆè¾“å‡ºå½¢çŠ¶å°†æ˜¯$(n_h / s_h) \times (n_w/s_w)$ã€‚</p><p>å½“$p_h = p_w = p$æ—¶ï¼Œæˆ‘ä»¬ç§°å¡«å……ä¸º$p$ï¼›å½“$s_h = s_w = s$æ—¶ï¼Œæˆ‘ä»¬ç§°æ­¥å¹…ä¸º$s$ã€‚</p><h2 id="å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“"><a href="#å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“" class="headerlink" title="å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“"></a>å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“</h2><p>ä¹‹å‰çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯äºŒç»´æ•°ç»„ï¼Œä½†çœŸå®æ•°æ®çš„ç»´åº¦ç»å¸¸æ›´é«˜ã€‚ä¾‹å¦‚ï¼Œå½©è‰²å›¾åƒåœ¨é«˜å’Œå®½2ä¸ªç»´åº¦å¤–è¿˜æœ‰RGBï¼ˆçº¢ã€ç»¿ã€è“ï¼‰3ä¸ªé¢œè‰²é€šé“ã€‚å‡è®¾å½©è‰²å›¾åƒçš„é«˜å’Œå®½åˆ†åˆ«æ˜¯$h$å’Œ$w$ï¼ˆåƒç´ ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ª$3 \times h \times w$çš„å¤šç»´æ•°ç»„ï¼Œæˆ‘ä»¬å°†å¤§å°ä¸º3çš„è¿™ä¸€ç»´ç§°ä¸ºé€šé“ï¼ˆchannelï¼‰ç»´ã€‚</p><h3 id="å¤šè¾“å…¥é€šé“"><a href="#å¤šè¾“å…¥é€šé“" class="headerlink" title="å¤šè¾“å…¥é€šé“"></a>å¤šè¾“å…¥é€šé“</h3><p>å·ç§¯å±‚çš„è¾“å…¥å¯ä»¥åŒ…å«å¤šä¸ªé€šé“ï¼Œå›¾4å±•ç¤ºäº†ä¸€ä¸ªå«2ä¸ªè¾“å…¥é€šé“çš„äºŒç»´äº’ç›¸å…³è®¡ç®—çš„ä¾‹å­ã€‚ï¼ˆæ¯å±‚çš„è¾“å…¥å’Œè¯¥å±‚çš„æ ¸ç›¸ä¹˜ï¼Œæœ€åå åŠ æˆå•ç»´åº¦è¾“å‡ºï¼Œè¾“å‡ºåªæœ‰ä¸€ä¸ªé€šé“ï¼‰</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/NCjg1iDhPY8ItOF.png" alt="2 è¾“å…¥é€šé“ 1 è¾“å‡ºé€šé“"></p><p>å›¾4 å«2ä¸ªè¾“å…¥é€šé“çš„äº’ç›¸å…³è®¡ç®—</p><p>å‡è®¾è¾“å…¥æ•°æ®çš„é€šé“æ•°ä¸º$c_i$ï¼Œå·ç§¯æ ¸å½¢çŠ¶ä¸º$k_h\times k_w$ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªè¾“å…¥é€šé“å„åˆ†é…ä¸€ä¸ªå½¢çŠ¶ä¸º$k_h\times k_w$çš„æ ¸æ•°ç»„ï¼Œå°†$c_i$ä¸ªäº’ç›¸å…³è¿ç®—çš„äºŒç»´è¾“å‡ºæŒ‰é€šé“ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªäºŒç»´æ•°ç»„ä½œä¸ºè¾“å‡ºã€‚æˆ‘ä»¬æŠŠ$c_i$ä¸ªæ ¸æ•°ç»„åœ¨é€šé“ç»´ä¸Šè¿ç»“ï¼Œå³å¾—åˆ°ä¸€ä¸ªå½¢çŠ¶ä¸º$c_i\times k_h\times k_w$çš„å·ç§¯æ ¸ã€‚</p><h3 id="å¤šè¾“å‡ºé€šé“"><a href="#å¤šè¾“å‡ºé€šé“" class="headerlink" title="å¤šè¾“å‡ºé€šé“"></a>å¤šè¾“å‡ºé€šé“</h3><p>å·ç§¯å±‚çš„è¾“å‡ºä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªé€šé“ï¼Œè®¾å·ç§¯æ ¸è¾“å…¥é€šé“æ•°å’Œè¾“å‡ºé€šé“æ•°åˆ†åˆ«ä¸º$c_i$å’Œ$c_o$ï¼Œé«˜å’Œå®½åˆ†åˆ«ä¸º$k_h$å’Œ$k_w$ã€‚å¦‚æœå¸Œæœ›å¾—åˆ°å«å¤šä¸ªé€šé“çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªè¾“å‡ºé€šé“åˆ†åˆ«åˆ›å»ºå½¢çŠ¶ä¸º$c_i\times k_h\times k_w$çš„æ ¸æ•°ç»„ï¼Œå°†å®ƒä»¬åœ¨è¾“å‡ºé€šé“ç»´ä¸Šè¿ç»“ï¼ˆæœ‰åŠ æ³•è®¡ç®—ï¼‰ï¼Œå·ç§¯æ ¸çš„å½¢çŠ¶å³$c_o\times c_i\times k_h\times k_w$ã€‚<br>ï¼ˆå¦‚ä¸‹å›¾ï¼Œ3 ä¸ªè¾“å…¥é€šé“ï¼Œ2 ä¸ªè¾“å‡ºé€šé“ï¼Œä¸­é—´æœ‰ 6 ä¸ª $1 \times 1$ çš„æ ¸æ•°ç»„ã€‚)</p><p>å¯¹äºè¾“å‡ºé€šé“çš„å·ç§¯æ ¸ï¼Œæˆ‘ä»¬æä¾›è¿™æ ·ä¸€ç§ç†è§£ï¼Œä¸€ä¸ª$c_i \times k_h \times k_w$çš„æ ¸æ•°ç»„å¯ä»¥æå–æŸç§å±€éƒ¨ç‰¹å¾ï¼Œä½†æ˜¯è¾“å…¥å¯èƒ½å…·æœ‰ç›¸å½“ä¸°å¯Œçš„ç‰¹å¾ï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¤šä¸ªè¿™æ ·çš„$c_i \times k_h \times k_w$çš„æ ¸æ•°ç»„ï¼Œä¸åŒçš„æ ¸æ•°ç»„æå–çš„æ˜¯ä¸åŒçš„ç‰¹å¾ã€‚</p><h3 id="1x1å·ç§¯å±‚"><a href="#1x1å·ç§¯å±‚" class="headerlink" title="1x1å·ç§¯å±‚"></a>1x1å·ç§¯å±‚</h3><p>æœ€åè®¨è®ºå½¢çŠ¶ä¸º$1 \times 1$çš„å·ç§¯æ ¸ï¼Œæˆ‘ä»¬é€šå¸¸ç§°è¿™æ ·çš„å·ç§¯è¿ç®—ä¸º$1 \times 1$å·ç§¯ï¼Œç§°åŒ…å«è¿™ç§å·ç§¯æ ¸çš„å·ç§¯å±‚ä¸º$1 \times 1$å·ç§¯å±‚ã€‚å›¾5å±•ç¤ºäº†ä½¿ç”¨è¾“å…¥é€šé“æ•°ä¸º3ã€è¾“å‡ºé€šé“æ•°ä¸º2çš„$1\times 1$å·ç§¯æ ¸çš„äº’ç›¸å…³è®¡ç®—ã€‚</p><p>$1\times 1$å·ç§¯å±‚çš„ä½œç”¨ä¸<code>å…¨è¿æ¥å±‚</code>ç­‰ä»·ï¼Œç›¸å½“äº<code>çŸ©é˜µä¹˜æ³•</code>ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/I8MX65oJvur3b7f.png" alt="2x3=6 ä¸ª 1x1 å·ç§¯å±‚"></p><p>å›¾5 1x1å·ç§¯æ ¸çš„äº’ç›¸å…³è®¡ç®—ã€‚è¾“å…¥å’Œè¾“å‡ºå…·æœ‰<code>ç›¸åŒçš„é«˜å’Œå®½</code></p><p>$1 \times 1$å·ç§¯æ ¸å¯åœ¨ä¸æ”¹å˜é«˜å®½çš„æƒ…å†µä¸‹ï¼Œ<code>è°ƒæ•´é€šé“æ•°</code>ã€‚$1 \times 1$å·ç§¯æ ¸ä¸è¯†åˆ«é«˜å’Œå®½ç»´åº¦ä¸Šç›¸é‚»å…ƒç´ æ„æˆçš„æ¨¡å¼ï¼Œå…¶ä¸»è¦è®¡ç®—å‘ç”Ÿåœ¨é€šé“ç»´ä¸Šã€‚å‡è®¾æˆ‘ä»¬å°†é€šé“ç»´å½“ä½œç‰¹å¾ç»´ï¼Œå°†é«˜å’Œå®½ç»´åº¦ä¸Šçš„å…ƒç´ å½“æˆæ•°æ®æ ·æœ¬ï¼Œé‚£ä¹ˆ$1\times 1$å·ç§¯å±‚çš„ä½œç”¨ä¸å…¨è¿æ¥å±‚ç­‰ä»·ã€‚</p><h2 id="å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚çš„å¯¹æ¯”"><a href="#å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚çš„å¯¹æ¯”" class="headerlink" title="å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚çš„å¯¹æ¯”"></a>å·ç§¯å±‚ä¸å…¨è¿æ¥å±‚çš„å¯¹æ¯”</h2><p>äºŒç»´å·ç§¯å±‚ç»å¸¸ç”¨äºå¤„ç†å›¾åƒï¼Œä¸æ­¤å‰çš„å…¨è¿æ¥å±‚ç›¸æ¯”ï¼Œå®ƒä¸»è¦æœ‰ä¸¤ä¸ªä¼˜åŠ¿ï¼š</p><ul><li><p>ä¸€æ˜¯å…¨è¿æ¥å±‚æŠŠå›¾åƒ<code>å±•å¹³</code>æˆä¸€ä¸ªå‘é‡ï¼Œåœ¨è¾“å…¥å›¾åƒä¸Šç›¸é‚»çš„å…ƒç´ å¯èƒ½å› ä¸ºå±•å¹³æ“ä½œä¸å†ç›¸é‚»ï¼Œç½‘ç»œéš¾ä»¥æ•æ‰å±€éƒ¨ä¿¡æ¯ã€‚è€Œå·ç§¯å±‚çš„è®¾è®¡ï¼Œå¤©ç„¶åœ°å…·æœ‰æå–å±€éƒ¨ä¿¡æ¯çš„èƒ½åŠ›ã€‚</p></li><li><p>äºŒæ˜¯å·ç§¯å±‚çš„å‚æ•°é‡æ›´å°‘ã€‚ä¸è€ƒè™‘åç½®çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå½¢çŠ¶ä¸º$(c_i, c_o, h, w)$çš„å·ç§¯æ ¸çš„å‚æ•°é‡æ˜¯$c_i \times c_o \times h \times w$ï¼Œ<code>ä¸è¾“å…¥å›¾åƒçš„å®½é«˜æ— å…³</code>ã€‚å‡å¦‚ä¸€ä¸ªå·ç§¯å±‚çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶åˆ†åˆ«æ˜¯$(c_1, h_1, w_1)$å’Œ$(c_2, h_2, w_2)$ï¼Œå¦‚æœè¦ç”¨å…¨è¿æ¥å±‚è¿›è¡Œè¿æ¥ï¼Œå‚æ•°æ•°é‡å°±æ˜¯$c_1 \times c_2 \times h_1 \times w_1 \times h_2 \times w_2$ã€‚ä½¿ç”¨å·ç§¯å±‚å¯ä»¥ä»¥è¾ƒå°‘çš„å‚æ•°æ•°é‡æ¥å¤„ç†æ›´å¤§çš„å›¾åƒã€‚</p></li></ul><h2 id="å·ç§¯å±‚çš„ç®€æ´å®ç°"><a href="#å·ç§¯å±‚çš„ç®€æ´å®ç°" class="headerlink" title="å·ç§¯å±‚çš„ç®€æ´å®ç°"></a>å·ç§¯å±‚çš„ç®€æ´å®ç°</h2><p>æˆ‘ä»¬ä½¿ç”¨Pytorchä¸­çš„<code>nn.Conv2d</code>ç±»æ¥å®ç°äºŒç»´å·ç§¯å±‚ï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ„é€ å‡½æ•°å‚æ•°ï¼š</p><ul><li><code>in_channels</code> (python:int) â€“ Number of channels in the input imag  è¾“å…¥é€šé“æ•°</li><li><code>out_channels</code> (python:int) â€“ Number of channels produced by the convolution è¾“å‡ºé€šé“æ•°</li><li><code>kernel_size</code> (python:int or tuple) â€“ Size of the convolving kernel å·ç§¯æ ¸å¤§å°ï¼Œint è¡¨ç¤ºé«˜å’Œå®½ç›¸ç­‰ï¼Œå…ƒç»„è¡¨ç¤ºä¸ç›¸ç­‰</li><li><code>stride</code> (python:int or tuple, optional) â€“ Stride of the convolution. Default: 1</li><li><code>padding</code> (python:int or tuple, optional) â€“ Zero-padding added to both sides of the input. Default: 0</li><li><code>bias</code> (bool, optional) â€“ If True, adds a learnable bias to the output. Default: True</li></ul><p><code>forward</code>å‡½æ•°çš„å‚æ•°ä¸ºä¸€ä¸ªå››ç»´å¼ é‡ï¼Œå½¢çŠ¶ä¸º$(Næ‰¹é‡å¤§å°, C_{in}é€šé“æ•°ï¼Œ H_{in}é«˜åº¦, W_{in}å®½åº¦)$ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå››ç»´å¼ é‡ï¼Œå½¢çŠ¶ä¸º$(N, C_{out}, H_{out}, W_{out})$</p><p>kernel_sizeï¼ˆå³å·ç§¯æ ¸å¤§å°ï¼‰è¿™æ˜¯éœ€è¦äººä¸ºè®¾å®šçš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸éœ€è¦å­¦ä¹ çš„ï¼Œå½“ç„¶å¤§å°ä¸åŒï¼Œå·ç§¯ç»“æœä¹Ÿæ˜¯ä¸åŒçš„ã€‚ç»è¿‡å¤§é‡å®éªŒè¡¨æ˜ï¼Œå¤§å¤šé€‰ç”¨<code>1x1ã€3x3ã€5x5</code>ç­‰å°ºå¯¸è¾ƒå°ä¸”é•¿å®½ä¸ºå¥‡æ•°çš„å·ç§¯æ ¸ã€‚</p><p>ä»£ç è®²è§£</p><pre><code class="lang-python">X = torch.rand(4, 2, 3, 5)print(X.shape)conv2d = nn.Conv2d(in_channels=2, out_channels=3, kernel_size=(3, 5), stride=1, padding=(1, 2))Y = conv2d(X)print(&#39;Y.shape: &#39;, Y.shape)print(&#39;weight.shape: &#39;, conv2d.weight.shape)  # padding å’Œ size åˆšå¥½æ˜¯ 2k+1 çš„å…³ç³»ï¼Œæ‰€ä»¥ in å’Œ out å®½é«˜ä¸å˜print(&#39;bias.shape: &#39;, conv2d.bias.shape) # Y.shape:  torch.Size([4, 2, 3, 5])# Y.shape:  torch.Size([4, 3, 3, 5])# weight.shape:  torch.Size([3, 2, 3, 5])# bias.shape:  torch.Size([3])</code></pre><h2 id="æ± åŒ–"><a href="#æ± åŒ–" class="headerlink" title="æ± åŒ–"></a>æ± åŒ–</h2><h3 id="äºŒç»´æ± åŒ–å±‚"><a href="#äºŒç»´æ± åŒ–å±‚" class="headerlink" title="äºŒç»´æ± åŒ–å±‚"></a>äºŒç»´æ± åŒ–å±‚</h3><p>æ± åŒ–å±‚ä¸»è¦ç”¨äºç¼“è§£å·ç§¯å±‚å¯¹ä½ç½®çš„è¿‡åº¦æ•æ„Ÿæ€§ã€‚åŒå·ç§¯å±‚ä¸€æ ·ï¼Œæ± åŒ–å±‚æ¯æ¬¡å¯¹è¾“å…¥æ•°æ®çš„ä¸€ä¸ªå›ºå®šå½¢çŠ¶çª—å£ï¼ˆåˆç§°æ± åŒ–çª—å£ï¼‰ä¸­çš„å…ƒç´ è®¡ç®—è¾“å‡ºï¼Œæ± åŒ–å±‚ç›´æ¥è®¡ç®—æ± åŒ–çª—å£å†…å…ƒç´ çš„æœ€å¤§å€¼æˆ–è€…å¹³å‡å€¼ï¼Œè¯¥è¿ç®—ä¹Ÿåˆ†åˆ«å«åš<code>æœ€å¤§æ± åŒ–</code>æˆ–<code>å¹³å‡æ± åŒ–</code>ã€‚å›¾6å±•ç¤ºäº†æ± åŒ–çª—å£å½¢çŠ¶ä¸º$2\times 2$çš„æœ€å¤§æ± åŒ–ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/CpF4XrYOE3Z2qKc.png" alt="2x2 çš„æœ€å¤§æ± åŒ–"></p><p>äºŒç»´å¹³å‡æ± åŒ–çš„å·¥ä½œåŸç†ä¸äºŒç»´æœ€å¤§æ± åŒ–ç±»ä¼¼ï¼Œä½†å°†æœ€å¤§è¿ç®—ç¬¦æ›¿æ¢æˆå¹³å‡è¿ç®—ç¬¦ã€‚æ± åŒ–çª—å£å½¢çŠ¶ä¸º$p \times q$çš„æ± åŒ–å±‚ç§°ä¸º$p \times q$æ± åŒ–å±‚ï¼Œå…¶ä¸­çš„æ± åŒ–è¿ç®—å«ä½œ$p \times q$æ± åŒ–ã€‚</p><p>æ± åŒ–å±‚ä¹Ÿå¯ä»¥åœ¨è¾“å…¥çš„é«˜å’Œå®½ä¸¤ä¾§å¡«å……å¹¶è°ƒæ•´çª—å£çš„ç§»åŠ¨æ­¥å¹…æ¥æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚æ± åŒ–å±‚å¡«å……å’Œæ­¥å¹…ä¸å·ç§¯å±‚å¡«å……å’Œæ­¥å¹…çš„å·¥ä½œæœºåˆ¶ä¸€æ ·ã€‚</p><p>åœ¨å¤„ç†å¤šé€šé“è¾“å…¥æ•°æ®æ—¶ï¼Œæ± åŒ–å±‚å¯¹æ¯ä¸ªè¾“å…¥é€šé“åˆ†åˆ«æ± åŒ–ï¼Œä½†ä¸ä¼šåƒå·ç§¯å±‚é‚£æ ·å°†å„é€šé“çš„ç»“æœæŒ‰é€šé“ç›¸åŠ ã€‚è¿™æ„å‘³ç€æ± åŒ–å±‚çš„<code>è¾“å‡ºé€šé“æ•°ä¸è¾“å…¥é€šé“æ•°ç›¸ç­‰</code>ã€‚</p><ul><li><code>å·ç§¯ä¸æ± åŒ–çš„åŒºåˆ«</code>ï¼š<br>  æ± åŒ–å±‚æ²¡æœ‰éœ€è¦å­¦ä¹ çš„ç‰¹å¾<br>  å·ç§¯å±‚ç”¨æ¥å­¦ä¹ è¯†åˆ«æŸä¸€ç§ç‰¹å¾<br>  æ± åŒ–å±‚çš„ä¸»è¦ä½œç”¨æ˜¯é™ç»´<br>  å·ç§¯å±‚å½“è®¾ç½®æ­¥é•¿ &gt;1 æ—¶ä¹Ÿå¯ä»¥ç”¨æ¥å®Œæˆé™ç»´çš„å·¥ä½œ</li></ul><h3 id="æ± åŒ–å±‚çš„ç®€æ´å®ç°"><a href="#æ± åŒ–å±‚çš„ç®€æ´å®ç°" class="headerlink" title="æ± åŒ–å±‚çš„ç®€æ´å®ç°"></a>æ± åŒ–å±‚çš„ç®€æ´å®ç°</h3><p>æˆ‘ä»¬ä½¿ç”¨Pytorchä¸­çš„<code>nn.MaxPool2d</code>å®ç°æœ€å¤§æ± åŒ–å±‚ï¼Œå…³æ³¨ä»¥ä¸‹æ„é€ å‡½æ•°å‚æ•°ï¼š</p><ul><li><code>kernel_size</code> â€“ the size of the window to take a max over</li><li><code>stride</code> â€“ the stride of the window. Default value is kernel_size</li><li><code>padding</code> â€“ implicit zero padding to be added on both sides</li></ul><p><code>forward</code>å‡½æ•°çš„å‚æ•°ä¸ºä¸€ä¸ªå››ç»´å¼ é‡ï¼Œå½¢çŠ¶ä¸º$(N, C, H_{in}, W_{in})$ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå››ç»´å¼ é‡ï¼Œå½¢çŠ¶ä¸º$(N, C, H_{out}, W_{out})$ï¼Œå…¶ä¸­$N$æ˜¯æ‰¹é‡å¤§å°ï¼Œ$C, H, W$åˆ†åˆ«è¡¨ç¤ºé€šé“æ•°ã€é«˜åº¦ã€å®½åº¦ã€‚</p><p>ä»£ç è®²è§£</p><pre><code class="lang-python">X = torch.arange(32, dtype=torch.float32).view(1, 2, 4, 4)pool2d = nn.MaxPool2d(kernel_size=3, padding=1, stride=(2, 1))Y = pool2d(X)print(X)print(Y)</code></pre><pre><code>tensor([[[[ 0.,  1.,  2.,  3.],          [ 4.,  5.,  6.,  7.],          [ 8.,  9., 10., 11.],          [12., 13., 14., 15.]],         [[16., 17., 18., 19.],          [20., 21., 22., 23.],          [24., 25., 26., 27.],          [28., 29., 30., 31.]]]])tensor([[[[ 5.,  6.,  7.,  7.],          [13., 14., 15., 15.]],         [[21., 22., 23., 23.],          [29., 30., 31., 31.]]]])</code></pre><p>å¹³å‡æ± åŒ–å±‚ä½¿ç”¨çš„æ˜¯<code>nn.AvgPool2d</code>ï¼Œä½¿ç”¨æ–¹æ³•ä¸<code>nn.MaxPool2d</code>ç›¸åŒã€‚</p><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/ktF7bxGVugQzO5U.png" alt=""></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/FYjpTINr4ViwZ39.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (å…«):æœºå™¨ç¿»è¯‘ç®€ä»‹</title>
      <link href="/2020/02/20/dl-notes8-mach-trans/"/>
      <url>/2020/02/20/dl-notes8-mach-trans/</url>
      
        <content type="html"><![CDATA[<h1 id="æœºå™¨ç¿»è¯‘å’Œæ•°æ®é›†"><a href="#æœºå™¨ç¿»è¯‘å’Œæ•°æ®é›†" class="headerlink" title="æœºå™¨ç¿»è¯‘å’Œæ•°æ®é›†"></a>æœºå™¨ç¿»è¯‘å’Œæ•°æ®é›†</h1><p>æœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ï¼šå°†ä¸€æ®µæ–‡æœ¬ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘ä¸ºå¦ä¸€ç§è¯­è¨€ï¼Œç”¨ç¥ç»ç½‘ç»œè§£å†³è¿™ä¸ªé—®é¢˜é€šå¸¸ç§°ä¸ºç¥ç»æœºå™¨ç¿»è¯‘ï¼ˆNMTï¼‰ã€‚<br>ä¸»è¦ç‰¹å¾ï¼šè¾“å‡ºæ˜¯å•è¯<code>åºåˆ—</code>è€Œä¸æ˜¯å•ä¸ªå•è¯ã€‚ è¾“å‡ºåºåˆ—çš„é•¿åº¦å¯èƒ½ä¸æºåºåˆ—çš„é•¿åº¦<code>ä¸åŒ</code>ã€‚</p><h2 id="æœºå™¨ç¿»è¯‘ä»»åŠ¡ä»£ç æ€»ç»“å¦‚ä¸‹"><a href="#æœºå™¨ç¿»è¯‘ä»»åŠ¡ä»£ç æ€»ç»“å¦‚ä¸‹" class="headerlink" title="æœºå™¨ç¿»è¯‘ä»»åŠ¡ä»£ç æ€»ç»“å¦‚ä¸‹"></a>æœºå™¨ç¿»è¯‘ä»»åŠ¡ä»£ç æ€»ç»“å¦‚ä¸‹</h2><h3 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><ol><li><code>è¯»å–æ•°æ®</code>ï¼Œå¤„ç†æ•°æ®ä¸­çš„ç¼–ç é—®é¢˜ï¼Œå¹¶å°†æ— æ•ˆçš„å­—ç¬¦ä¸²åˆ é™¤</li><li><code>åˆ†è¯</code>ï¼Œåˆ†è¯çš„ç›®çš„å°±æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢æˆå•è¯ç»„æˆçš„åˆ—è¡¨ã€‚ç›®å‰æœ‰å¾ˆå¤šç°æˆçš„åˆ†è¯å·¥å…·å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‰ç…§ç©ºæ ¼è¿›è¡Œåˆ†è¯(ä¸æ¨èï¼Œå› ä¸ºåˆ†è¯ä¸æ˜¯å¾ˆå‡†ç¡®)</li><li><code>å»ºç«‹è¯å…¸</code>ï¼Œå°†å•è¯ç»„æˆçš„åˆ—è¡¨ç¼–ç¨‹å•è¯idç»„æˆçš„åˆ—è¡¨ï¼Œè¿™é‡Œä¼šå¾—åˆ°å¦‚ä¸‹å‡ æ ·ä¸œè¥¿<ol><li>å»é‡åè¯å…¸ï¼ŒåŠå…¶ä¸­å•è¯å¯¹åº”çš„ç´¢å¼•åˆ—è¡¨</li><li>è¿˜å¯ä»¥å¾—åˆ°ç»™å®šç´¢å¼•æ‰¾åˆ°å…¶å¯¹åº”çš„å•è¯çš„åˆ—è¡¨ï¼Œä»¥åŠç»™å®šå•è¯å¾—åˆ°å¯¹åº”ç´¢å¼•çš„å­—å…¸</li><li>åŸå§‹è¯­æ–™æ‰€æœ‰è¯å¯¹åº”çš„è¯å…¸ç´¢å¼•çš„åˆ—è¡¨</li></ol></li><li>å¯¹æ•°æ®è¿›è¡Œ<code>paddingæ“ä½œ</code>ã€‚åŸºäºrnnçš„Seq2Seqæ¨¡å‹ï¼Œå¯ä»¥å¤„ç†ä»»æ„é•¿åº¦ï¼Œâ€œå˜é•¿æ•°æ®çš„è¯»å…¥â€åŸºäºrnnçš„æœºå™¨ç¿»è¯‘ä¹Ÿå¹¶ä¸éœ€è¦å›ºå®šé•¿åº¦ã€‚è¦<code>padding</code>ï¼Œæ˜¯å› ä¸ºåƒtfã€pytorchè¿™äº›æ¡†æ¶è¦æ±‚ä¸€ä¸ªbatchçš„æ•°æ®å¿…é¡»é•¿åº¦ç›¸ç­‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼›è¦<code>æˆªæ–­</code>ï¼Œè®¾ç½®æœ€å¤§çš„æ•°æ®é•¿åº¦æ˜¯å› ä¸ºdecodeçš„æ—¶å€™è¾¾åˆ°è¿™ä¸ªé•¿åº¦æˆ‘ä»¬å°±åœæ­¢ï¼›å†ä¸€ä¸ªåŸå› å°±æ˜¯ä¸ºäº†åŠ å¿«è®¡ç®—ï¼Œä¸ç„¶çš„è¯ä¸ºäº†å•ä¸ªç‰¹åˆ«é•¿çš„æ•°æ®ï¼Œbatchä¸­çš„å…¶ä»–æ•°æ®éƒ½è¡¥æˆè¿™ä¹ˆé•¿ï¼Œå¾ˆæ…¢ã€‚</li><li><code>åˆ¶ä½œæ•°æ®ç”Ÿæˆå™¨</code>ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºç¿»è¯‘ä»»åŠ¡çš„æ•°æ®æ ¼å¼ï¼Œæœºå™¨ç¿»è¯‘çš„è¾“å…¥æ˜¯ä¸€æ®µæ–‡æœ¬åºåˆ—ï¼Œè¾“å‡ºä¹Ÿæ˜¯ä¸€æ®µæ–‡æœ¬åºåˆ—ã€‚</li></ol><h3 id="Seq2Seqæ¨¡å‹çš„æ„å»º"><a href="#Seq2Seqæ¨¡å‹çš„æ„å»º" class="headerlink" title="Seq2Seqæ¨¡å‹çš„æ„å»º"></a>Seq2Seqæ¨¡å‹çš„æ„å»º</h3><ol><li>å…ˆç¼–ç åè§£ç çš„æ¡†æ¶: å…ˆå¯¹è¾“å…¥åºåˆ—ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œå¯¹ä»–è¿›è¡Œç¼–ç ï¼Œç¼–ç æˆä¸€ä¸ª<code>å‘é‡</code>ä¹‹åï¼Œå†å°†ç¼–ç å¾—åˆ°çš„å‘é‡ä½œä¸ºä¸€ä¸ªæ–°çš„<code>è§£ç å¾ªç¯ç¥ç»ç½‘ç»œ</code>çš„éšè—çŠ¶æ€çš„è¾“å…¥ï¼Œè¿›è¡Œè§£ç ï¼Œä¸€æ¬¡è¾“å‡ºä¸€ä¸ªåºåˆ—çš„å…ƒç´ ï¼Œå†å°†æ¨¡å‹è®­ç»ƒè¾“å‡ºçš„åºåˆ—å…ƒç´ ä¸çœŸå®æ ‡ç­¾è®¡ç®—æŸå¤±è¿›è¡Œå­¦ä¹ ã€‚</li><li>è¯åµŒå…¥: ä¸€èˆ¬æƒ…å†µä¸‹è¾“å…¥åˆ°ç¼–ç ç½‘ç»œä¸­çš„æ•°æ®ä¸æ˜¯ä¸€ä¸ª<code>onehot</code>å‘é‡è€Œæ˜¯ç»è¿‡äº†ç¼–ç ä¹‹åçš„å‘é‡ï¼Œæ¯”å¦‚ç”±<code>word2vec</code>æŠ€æœ¯ï¼Œè®©ç¼–ç åçš„å‘é‡ç”±æ›´åŠ ä¸°å¯Œçš„å«ä¹‰ã€‚</li><li>åœ¨è¿›è¡Œç¼–ç å’Œè§£ç çš„è¿‡ç¨‹ä¸­æ•°æ®éƒ½æ˜¯ä»¥<code>æ—¶é—´æ­¥</code>å±•å¼€ï¼Œä¹Ÿå°±æ˜¯(Seq_len,)è¿™ç§å½¢å¼çš„æ•°æ®è¿›è¡Œå¤„ç†çš„</li><li>å¯¹äºç¼–ç ä¸è§£ç çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶éšè—å±‚çš„<code>å±‚æ•°</code>åŠæ¯ä¸€å±‚éšè—å±‚ç¥ç»å…ƒçš„<code>æ•°é‡</code>æ¥æ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦</li><li>ç¼–ç éƒ¨åˆ†ï¼ŒRNNçš„ç”¨0åˆå§‹åŒ–éšå«çŠ¶æ€ï¼Œæœ€åçš„è¾“å‡ºä¸»è¦æ˜¯éšè—çŠ¶æ€, ç¼–ç RNNè¾“å‡ºçš„éšå«çŠ¶æ€è®¤ä¸ºæ˜¯å…¶å¯¹åº”çš„ç¼–ç å‘é‡</li><li>è§£ç å™¨çš„æ•´ä½“å½¢çŠ¶ä¸ç¼–ç å™¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è§£ç å™¨çš„æ¨¡å‹çš„éšè—çŠ¶æ€æ˜¯<code>ç”±ç¼–ç å™¨çš„è¾“å‡ºçš„éšè—çŠ¶æ€åˆå§‹åŒ–</code>çš„ã€‚</li></ol><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><ol><li>è§£ç å™¨çš„è¾“å‡ºæ˜¯ä¸€ä¸ªå’Œè¯å…¸ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œå…¶æ¯ä¸ªå€¼å¯¹åº”ä¸å‘é‡ç´¢å¼•ä½ç½®å¯¹åº”è¯çš„åˆ†æ•°ï¼Œä¸€èˆ¬æ˜¯é€‰æ‹©<code>åˆ†æ•°æœ€å¤§</code>çš„é‚£ä¸ªè¯ä½œä¸ºæœ€ç»ˆçš„è¾“å‡ºã€‚</li><li>åœ¨è®¡ç®—æŸå¤±å‡½æ•°ä¹‹å‰ï¼Œè¦æŠŠ<code>paddingå»æ‰</code>ï¼Œå› ä¸ºpaddingçš„éƒ¨åˆ†ä¸å‚ä¸è®¡ç®—</li></ol><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li>è§£ç å™¨åœ¨æµ‹è¯•çš„æ—¶å€™éœ€è¦å°†æ¨¡å‹çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥</li><li>Beam Searchæœç´¢ç®—æ³•ã€‚<ol><li>å‡è®¾é¢„æµ‹çš„æ—¶å€™è¯å…¸çš„å¤§å°ä¸º3ï¼Œå†…å®¹ä¸ºa,b,c. <code>beam size</code>ä¸º2ï¼Œè§£ç çš„æ—¶å€™è¿‡ç¨‹å¦‚ä¸‹</li><li>ç”Ÿæˆç¬¬ä¸€ä¸ªè¯çš„æ—¶å€™ï¼Œé€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ä¸¤ä¸ªè¯ï¼Œå‡è®¾ä¸ºa,c.é‚£ä¹ˆå½“å‰çš„ä¸¤ä¸ªåºåˆ—å°±æ˜¯aå’Œcã€‚</li><li>ç”Ÿæˆç¬¬äºŒä¸ªè¯çš„æ—¶å€™ï¼Œå°†å½“å‰åºåˆ—aå’Œcï¼Œåˆ†åˆ«ä¸æ­¤è¡¨ä¸­çš„æ‰€æœ‰è¯è¿›è¡Œç»„åˆï¼Œå¾—åˆ°æ–°çš„6ä¸ªåºåˆ—aa ab ac ca cb cc,è®¡ç®—æ¯ä¸ªåºåˆ—çš„å¾—åˆ†ï¼Œå¹¶é€‰æ‹©å¾—åˆ†æœ€é«˜çš„2ä¸ªåºåˆ—ï¼Œä½œä¸ºæ–°çš„å½“å‰åºåˆ—ï¼Œå‡å¦‚ä¸ºaa cb </li><li>åé¢ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°é‡åˆ°ç»“æŸç¬¦æˆ–è€…è¾¾åˆ°æœ€å¤§é•¿åº¦ä¸ºæ­¢ï¼Œæœ€ç»ˆè¾“å‡ºå¾—åˆ†æœ€é«˜çš„2ä¸ªåºåˆ—ã€‚</li></ol></li></ol><pre><code class="lang-python">import osos.listdir(&#39;/home/kesci/input/&#39;)</code></pre><pre><code>[&#39;fraeng6506&#39;, &#39;d2l9528&#39;, &#39;d2l6239&#39;]</code></pre><pre><code class="lang-python">import syssys.path.append(&#39;/home/kesci/input/d2l9528/&#39;)import collectionsimport d2limport zipfilefrom d2l.data.base import Vocabimport timeimport torchimport torch.nn as nnimport torch.nn.functional as Ffrom torch.utils import datafrom torch import optim</code></pre><h3 id="æ•°æ®é¢„å¤„ç†-1"><a href="#æ•°æ®é¢„å¤„ç†-1" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><p>å°†æ•°æ®é›†æ¸…æ´—ã€è½¬åŒ–ä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥minbatch</p><pre><code class="lang-python">with open(&#39;/home/kesci/input/fraeng6506/fra.txt&#39;, &#39;r&#39;) as f:      raw_text = f.read()print(raw_text[0:1000])</code></pre><pre><code>Go.    Va !    CC-BY 2.0 (France) Attribution: tatoeba.org #2877272 (CM) &amp; #1158250 (Wittydev)Hi.    Salut !    CC-BY 2.0 (France) Attribution: tatoeba.org #538123 (CM) &amp; #509819 (Aiji)Hi.    Salut.    CC-BY 2.0 (France) Attribution: tatoeba.org #538123 (CM) &amp; #4320462 (gillux)Run!    Coursâ€¯!    CC-BY 2.0 (France) Attribution: tatoeba.org #906328 (papabear) &amp; #906331 (sacredceltic)Run!    Courezâ€¯!    CC-BY 2.0 (France) Attribution: tatoeba.org #906328 (papabear) &amp; #906332 (sacredceltic)Who?    Qui ?    CC-BY 2.0 (France) Attribution: tatoeba.org #2083030 (CK) &amp; #4366796 (gillux)Wow!    Ã‡a alorsâ€¯!    CC-BY 2.0 (France) Attribution: tatoeba.org #52027 (Zifre) &amp; #374631 (zmoo)Fire!    Au feu !    CC-BY 2.0 (France) Attribution: tatoeba.org #1829639 (Spamster) &amp; #4627939 (sacredceltic)Help!    Ã€ l&#39;aideâ€¯!    CC-BY 2.0 (France) Attribution: tatoeba.org #435084 (lukaszpp) &amp; #128430 (sysko)Jump.    Saute.    CC-BY 2.0 (France) Attribution: tatoeba.org #631038 (Shishir) &amp; #2416938 (Phoenix)Stop!    Ã‡a suffitâ€¯!    CC-BY 2.0 (France) Attribution: tato</code></pre><pre><code class="lang-python">def preprocess_raw(text):    text = text.replace(&#39;\u202f&#39;, &#39; &#39;).replace(&#39;\xa0&#39;, &#39; &#39;)    out = &#39;&#39;    for i, char in enumerate(text.lower()):        if char in (&#39;,&#39;, &#39;!&#39;, &#39;.&#39;) and i &gt; 0 and text[i-1] != &#39; &#39;:            out += &#39; &#39;        out += char    return outtext = preprocess_raw(raw_text)print(text[0:1000])</code></pre><pre><code>go .    va !    cc-by 2 .0 (france) attribution: tatoeba .org #2877272 (cm) &amp; #1158250 (wittydev)hi .    salut !    cc-by 2 .0 (france) attribution: tatoeba .org #538123 (cm) &amp; #509819 (aiji)hi .    salut .    cc-by 2 .0 (france) attribution: tatoeba .org #538123 (cm) &amp; #4320462 (gillux)run !    cours !    cc-by 2 .0 (france) attribution: tatoeba .org #906328 (papabear) &amp; #906331 (sacredceltic)run !    courez !    cc-by 2 .0 (france) attribution: tatoeba .org #906328 (papabear) &amp; #906332 (sacredceltic)who?    qui ?    cc-by 2 .0 (france) attribution: tatoeba .org #2083030 (ck) &amp; #4366796 (gillux)wow !    Ã§a alors !    cc-by 2 .0 (france) attribution: tatoeba .org #52027 (zifre) &amp; #374631 (zmoo)fire !    au feu !    cc-by 2 .0 (france) attribution: tatoeba .org #1829639 (spamster) &amp; #4627939 (sacredceltic)help !    Ã  l&#39;aide !    cc-by 2 .0 (france) attribution: tatoeba .org #435084 (lukaszpp) &amp; #128430 (sysko)jump .    saute .    cc-by 2 .0 (france) attribution: tatoeba .org #631038 (shishir) &amp; #2416938 (phoenix)stop !    Ã§a suffit !    cc-b</code></pre><p>å­—ç¬¦åœ¨è®¡ç®—æœºé‡Œæ˜¯ä»¥ç¼–ç çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€ç”¨çš„ç©ºæ ¼æ˜¯ \x20 ï¼Œæ˜¯åœ¨æ ‡å‡†ASCIIå¯è§å­—ç¬¦ 0x20~0x7e èŒƒå›´å†…ã€‚<br>è€Œ \xa0 å±äº latin1 ï¼ˆISO/IEC_8859-1ï¼‰ä¸­çš„æ‰©å±•å­—ç¬¦é›†å­—ç¬¦ï¼Œä»£è¡¨ä¸é—´æ–­ç©ºç™½ç¬¦nbsp(non-breaking space)ï¼Œè¶…å‡ºgbkç¼–ç èŒƒå›´ï¼Œæ˜¯éœ€è¦å»é™¤çš„ç‰¹æ®Šå­—ç¬¦ã€‚å†æ•°æ®é¢„å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€‚</p><h3 id="åˆ†è¯"><a href="#åˆ†è¯" class="headerlink" title="åˆ†è¯"></a>åˆ†è¯</h3><p>å­—ç¬¦ä¸²â€”-å•è¯ç»„æˆçš„åˆ—è¡¨</p><pre><code class="lang-python">num_examples = 50000source, target = [], []for i, line in enumerate(text.split(&#39;\n&#39;)):    if i &gt; num_examples:        break    parts = line.split(&#39;\t&#39;)    if len(parts) &gt;= 2:        source.append(parts[0].split(&#39; &#39;))        target.append(parts[1].split(&#39; &#39;))source[0:3], target[0:3]</code></pre><pre><code>([[&#39;go&#39;, &#39;.&#39;], [&#39;hi&#39;, &#39;.&#39;], [&#39;hi&#39;, &#39;.&#39;]], [[&#39;va&#39;, &#39;!&#39;], [&#39;salut&#39;, &#39;!&#39;], [&#39;salut&#39;, &#39;.&#39;]])</code></pre><pre><code class="lang-python">d2l.set_figsize()d2l.plt.hist([[len(l) for l in source], [len(l) for l in target]],label=[&#39;source&#39;, &#39;target&#39;])d2l.plt.legend(loc=&#39;upper right&#39;);</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/t19DZi4dB2XOPEn.png" alt="åˆ†è¯ç»“æœ"></p><h3 id="å»ºç«‹è¯å…¸"><a href="#å»ºç«‹è¯å…¸" class="headerlink" title="å»ºç«‹è¯å…¸"></a>å»ºç«‹è¯å…¸</h3><p>å•è¯ç»„æˆçš„åˆ—è¡¨â€”-å•è¯idç»„æˆçš„åˆ—è¡¨</p><pre><code class="lang-python">def build_vocab(tokens):    tokens = [token for line in tokens for token in line]    return d2l.data.base.Vocab(tokens, min_freq=3, use_special_tokens=True)src_vocab = build_vocab(source)  # 4 ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œpad è¡¥å…… boså¥å¼€å§‹ eoså¥ç»“æŸ unkæœªçŸ¥å­—ç¬¦len(src_vocab)</code></pre><pre><code>3789</code></pre><p><code>Vocab</code> ä¼šè¿›è¡Œè¯é¢‘ç»Ÿè®¡, ä»å¤§åˆ°å°æ’åº<br><code>__len__</code> è¿”å›é•¿åº¦<br><code>__getitem__</code> è¿”å›å•è¯å¯¹åº”çš„ id<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/3oBvEZdHYKXzwfg.png" alt="Vocab"></p><h3 id="è½½å…¥æ•°æ®é›†"><a href="#è½½å…¥æ•°æ®é›†" class="headerlink" title="è½½å…¥æ•°æ®é›†"></a>è½½å…¥æ•°æ®é›†</h3><p>è¿›è¡Œ pad ä¿è¯å¥å­é•¿åº¦æ˜¯ä¸€æ ·çš„, ä¸€ä¸ª batch ä½¿ç”¨çš„åŒä¸€ä¸ªé•¿åº¦</p><pre><code class="lang-python">def pad(line, max_len, padding_token):    if len(line) &gt; max_len:        return line[:max_len]    return line + [padding_token] * (max_len - len(line))pad(src_vocab[source[0]], 10, src_vocab.pad)</code></pre><pre><code>[38, 4, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><p>é¦–å°¾æ ‡æ³¨ <code>bos</code> å’Œ <code>eos</code></p><pre><code class="lang-python">def build_array(lines, vocab, max_len, is_source):    lines = [vocab[line] for line in lines]    if not is_source:  # å¦‚æœæ˜¯ç›®æ ‡æ•°æ®é›†ï¼Œå°±è¦åŠ ä¸€å¯¹é¦–å°¾æ ‡æ³¨        lines = [[vocab.bos] + line + [vocab.eos] for line in lines]    array = torch.tensor([pad(line, max_len, vocab.pad) for line in lines])    valid_len = (array != vocab.pad).sum(1) #ç¬¬ä¸€ä¸ªç»´åº¦    return array, valid_len</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/LW4YMRvUpCA9ul6.png" alt="TensorDataset"></p><pre><code class="lang-python">def load_data_nmt(batch_size, max_len): # This function is saved in d2l.    src_vocab, tgt_vocab = build_vocab(source), build_vocab(target)  # å…ˆè¿›è¡Œåˆ†è¯    src_array, src_valid_len = build_array(source, src_vocab, max_len, True)  # æ„å»ºæºè¯­è¨€æ•°ç»„    tgt_array, tgt_valid_len = build_array(target, tgt_vocab, max_len, False) # æ„å»ºç›®æ ‡è¯­è¨€æ•°ç»„    train_data = data.TensorDataset(src_array, src_valid_len, tgt_array, tgt_valid_len)     # TensorDataset åˆ©ç”¨ assert åˆ¤æ–­ 4 ä¸ªå‚æ•°æ˜¯ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„    train_iter = data.DataLoader(train_data, batch_size, shuffle=True)    return src_vocab, tgt_vocab, train_iter</code></pre><p>X æ˜¯è‹±è¯­å¥å­, Y æ˜¯æ³•è¯­å¥å­</p><pre><code class="lang-python">src_vocab, tgt_vocab, train_iter = load_data_nmt(batch_size=2, max_len=8)for X, X_valid_len, Y, Y_valid_len, in train_iter:    print(&#39;X =&#39;, X.type(torch.int32), &#39;\nValid lengths for X =&#39;, X_valid_len,        &#39;\nY =&#39;, Y.type(torch.int32), &#39;\nValid lengths for Y =&#39;, Y_valid_len)    break</code></pre><pre><code>X = tensor([[   5,   24,    3,    4,    0,    0,    0,    0],        [  12, 1388,    7,    3,    4,    0,    0,    0]], dtype=torch.int32) Valid lengths for X = tensor([4, 5]) Y = tensor([[   1,   23,   46,    3,    3,    4,    2,    0],        [   1,   15,  137,   27, 4736,    4,    2,    0]], dtype=torch.int32) Valid lengths for Y = tensor([7, 7])</code></pre><h1 id="Encoder-Decoder"><a href="#Encoder-Decoder" class="headerlink" title="Encoder-Decoder"></a>Encoder-Decoder</h1><p> encoderï¼šè¾“å…¥åˆ°éšè—çŠ¶æ€<br> decoderï¼šéšè—çŠ¶æ€åˆ°è¾“å‡º</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/7aEyZcGDVS1zXPU.png" alt="Encoder-Decoder"></p><pre><code class="lang-python">class Encoder(nn.Module):    def __init__(self, **kwargs):        super(Encoder, self).__init__(**kwargs)    def forward(self, X, *args):        raise NotImplementedError</code></pre><pre><code class="lang-python">class Decoder(nn.Module):    def __init__(self, **kwargs):        super(Decoder, self).__init__(**kwargs)    def init_state(self, enc_outputs, *args):        raise NotImplementedError    def forward(self, X, state):        raise NotImplementedError</code></pre><pre><code class="lang-python">class EncoderDecoder(nn.Module):    def __init__(self, encoder, decoder, **kwargs):        super(EncoderDecoder, self).__init__(**kwargs)        self.encoder = encoder        self.decoder = decoder    def forward(self, enc_X, dec_X, *args):        enc_outputs = self.encoder(enc_X, *args)        dec_state = self.decoder.init_state(enc_outputs, *args)        return self.decoder(dec_X, dec_state)</code></pre><p>å¯ä»¥åº”ç”¨åœ¨å¯¹è¯ç³»ç»Ÿã€ç”Ÿæˆå¼ä»»åŠ¡ä¸­ã€‚</p><h1 id="Sequence-to-Sequenceæ¨¡å‹"><a href="#Sequence-to-Sequenceæ¨¡å‹" class="headerlink" title="Sequence to Sequenceæ¨¡å‹"></a>Sequence to Sequenceæ¨¡å‹</h1><h3 id="æ¨¡å‹ï¼š"><a href="#æ¨¡å‹ï¼š" class="headerlink" title="æ¨¡å‹ï¼š"></a>æ¨¡å‹ï¼š</h3><ul><li>è®­ç»ƒï¼ˆå·²çŸ¥è‹±è¯­æ‰€å¯¹åº”çš„æ³•è¯­ï¼‰</li><li>Encoder æ˜¯ä¸€ä¸ª RNNï¼Œå¯ä»¥æ˜¯ LSTM å¯ä»¥æ˜¯ GRU</li><li>hidden state å°±æ˜¯ Encoder å¾—åˆ°çš„ htï¼Œå°±æ˜¯è¯­ä¹‰ç¼–ç ï¼Œä¹Ÿå°±æ˜¯ Decoder ç”¨æ¥åˆå§‹åŒ–çš„ $H_{-1}$</li><li>Decoder å°±æ˜¯ä¸€ä¸ªç”Ÿæˆè¯­è¨€æ¨¡å‹ï¼Œæœ‰äº†å‰å‡ ä¸ªç”Ÿæˆåå‡ ä¸ªï¼Œç±»ä¼¼äºæ­Œè¯ç”Ÿæˆ<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/JL3VW7gznsGIStw.png" alt="ç”Ÿæˆ"></li><li>é¢„æµ‹ï¼ˆä¸çŸ¥é“å¯¹åº”çš„æ³•è¯­ï¼‰</li></ul><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/YhcpTl6nQERLosu.png" alt="é¢„æµ‹"></p><h3 id="å…·ä½“ç»“æ„ï¼š"><a href="#å…·ä½“ç»“æ„ï¼š" class="headerlink" title="å…·ä½“ç»“æ„ï¼š"></a>å…·ä½“ç»“æ„ï¼š</h3><ul><li>æ¯”å¦‚ apple å¯¹åº”çš„ idï¼Œä¼šæŠŠå®ƒç¿»è¯‘æˆ<code>è¯å‘é‡</code>ï¼Œä»£è¡¨ apple çš„å«ä¹‰</li><li><code>dense()</code>å¤šç”¨äºCNNç½‘ç»œæ­å»ºæ—¶æ­å»ºå…¨è¿æ¥å±‚ä½¿ç”¨ï¼Œåœ¨RNNç½‘ç»œæ­å»ºï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°ç”¨RNNåšåˆ†ç±»æ—¶ï¼Œdense()å¯ä»¥ç”¨ä½œRNN<code>åˆ†ç±»é¢„æµ‹è¾“å‡º</code>, æ¯ä¸ªè¾“å‡ºä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»é—®é¢˜</li><li><code>embeddingå±‚</code>çš„ä½œç”¨å°±æ˜¯ç»™æ¯ä¸ªå•è¯ï¼Œèµ‹ä¸€ä¸ªç‰¹å®šçš„è¯å‘é‡<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/5otbRSFCVqhZDUK.png" alt="å…·ä½“ç»“æ„"><h3 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h3></li></ul><pre><code class="lang-python">class Seq2SeqEncoder(d2l.Encoder):    def __init__(self, vocab_size, embed_size, num_hiddens, num_layers,                 dropout=0, **kwargs):        super(Seq2SeqEncoder, self).__init__(**kwargs)        self.num_hiddens=num_hiddens        self.num_layers=num_layers        self.embedding = nn.Embedding(vocab_size, embed_size) # embed_size è¯å‘é‡ç»´åº¦ï¼Œè¾“å…¥å•è¯çš„å½¢çŠ¶        self.rnn = nn.LSTM(embed_size,num_hiddens, num_layers, dropout=dropout)    def begin_state(self, batch_size, device):  # åˆå§‹åŒ–        return [torch.zeros(size=(self.num_layers, batch_size, self.num_hiddens),  device=device),                torch.zeros(size=(self.num_layers, batch_size, self.num_hiddens),  device=device)]    def forward(self, X, *args):        X = self.embedding(X) # X shape: (batch_size, seq_len, embed_size)         # batch_size æœ‰å‡ å¥è¯ï¼Œseq_len ä¸€å¥è¯æœ‰å‡ ä¸ªå•è¯ï¼Œæ¯ä¸ªå•è¯éƒ½å˜æˆäº† embed_size ç»´çš„è¯å‘é‡        X = X.transpose(0, 1)  # RNN ç¬¬ä¸€ä¸ªç»´åº¦åº”è¯¥æ˜¯æ—¶é—´ï¼ˆå¥å­çš„é¡ºåºæ˜¯ç¬¬ä¸€ä¸ªç»´åº¦ï¼‰ï¼Œæ‰€ä»¥æŠŠç¬¬ 1ã€2 ç»´åº¦è°ƒæ¢ä¸€ä¸‹        # state = self.begin_state(X.shape[1], device=X.device)        out, state = self.rnn(X) # out æ˜¯æ¯ä¸ªå•å…ƒçš„è¾“å‡ºï¼Œstate æ˜¯æœ€åä¸€ä¸ªå•å…ƒçš„è¾“å‡º        # out çš„ shape æ˜¯ (seq_len, batch_size, num_hiddens).        # state åŒ…å«æœ€åä¸€ä¸ªè®°å¿†ç»†èƒçš„çŠ¶æ€ï¼Œå’Œéšå±‚çŠ¶æ€        # åœ¨æœ€åä¸€æ­¥ï¼Œ state shape æ˜¯ (num_layers, batch_size, num_hiddens)        return out, state</code></pre><pre><code class="lang-python">encoder = Seq2SeqEncoder(vocab_size=10, embed_size=8,num_hiddens=16, num_layers=2) #æ¯ä¸ªè¯ç”¨ 8 ç»´å‘é‡è¡¨ç¤ºX = torch.zeros((4, 7),dtype=torch.long)  # è¾“å…¥ 4 å¥è¯ï¼Œæ¯å¥è¯ 7 ä¸ªå•è¯output, state = encoder(X)output.shape, len(state), state[0].shape, state[1].shape  # len(state)=2 è¡¨ç¤ºåŒ…å«äº†è®°å¿†ç»†èƒå’Œéšå±‚çŠ¶æ€ä¸¤ä¸ªéƒ¨åˆ†</code></pre><pre><code>(torch.Size([7, 4, 16]), 2, torch.Size([2, 4, 16]), torch.Size([2, 4, 16]))</code></pre><h3 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h3><pre><code class="lang-python">class Seq2SeqDecoder(d2l.Decoder):    def __init__(self, vocab_size, embed_size, num_hiddens, num_layers,                 dropout=0, **kwargs):        super(Seq2SeqDecoder, self).__init__(**kwargs)        self.embedding = nn.Embedding(vocab_size, embed_size)        self.rnn = nn.LSTM(embed_size,num_hiddens, num_layers, dropout=dropout)        self.dense = nn.Linear(num_hiddens,vocab_size) # dense ç”¨äºè¾“å‡ºç»“æœ        # é€šè¿‡å…¨è¿æ¥å±‚æŠŠ16ä¸ªéšè—å•å…ƒæ˜ å°„åˆ°100ä¸ªå•è¯ï¼Œåœ¨100 ç»´åº¦çš„å‘é‡é‡Œï¼Œé€‰å‡ºè¯„åˆ†æœ€é«˜çš„ï¼Œä½œä¸ºç»“æœè¾“å‡º    def init_state(self, enc_outputs, *args):        return enc_outputs[1]  # ç”¨ Encoder çš„è¾“å‡ºä½œåˆå§‹åŒ–    def forward(self, X, state):        X = self.embedding(X).transpose(0, 1)        out, state = self.rnn(X, state)        # Make the batch to be the first dimension to simplify loss computation.        out = self.dense(out).transpose(0, 1)        return out, state</code></pre><pre><code class="lang-python">decoder = Seq2SeqDecoder(vocab_size=10, embed_size=8,num_hiddens=16, num_layers=2)state = decoder.init_state(encoder(X))out, state = decoder(X, state)out.shape, len(state), state[0].shape, state[1].shape  # out 4*7*10 10 ä»£è¡¨å•è¯è¡¨å¤§å°ï¼Œåœ¨ 10 ä¸ªå¾—åˆ†é‡Œé€‰æœ€é«˜çš„</code></pre><pre><code>(torch.Size([4, 7, 10]), 2, torch.Size([2, 4, 16]), torch.Size([2, 4, 16]))</code></pre><h3 id="æŸå¤±å‡½æ•°-1"><a href="#æŸå¤±å‡½æ•°-1" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>è®¡ç®—æœ‰æ•ˆé•¿åº¦, å¿½ç•¥ padding</p><pre><code class="lang-python">def SequenceMask(X, X_len,value=0):      # X ä¸€ä¸ª batch çš„è¾“å…¥ï¼ŒX_len è¾“å…¥åŸæœ¬çš„æœ‰æ•ˆé•¿åº¦ï¼ˆç”±äºæœ‰ padï¼‰    maxlen = X.size(1)    mask = torch.arange(maxlen)[None, :].to(X_len.device) &lt; X_len[:, None] # len ä»¥åçš„éƒ¨åˆ†éƒ½ç”¨ value å¡«å……    X[~mask]=value    return X</code></pre><pre><code class="lang-python">X = torch.tensor([[1,2,3], [4,5,6]])SequenceMask(X,torch.tensor([1,2]))  # ç¬¬ä¸€å¥æœ‰æ•ˆé•¿åº¦ä¸º 1ï¼Œç¬¬äºŒå¥æœ‰æ•ˆé•¿åº¦ä¸º 2</code></pre><pre><code>tensor([[1, 0, 0],        [4, 5, 0]])</code></pre><pre><code class="lang-python">X = torch.ones((2,3, 4))SequenceMask(X, torch.tensor([1,2]),value=-1)</code></pre><pre><code>tensor([[[ 1.,  1.,  1.,  1.],         [-1., -1., -1., -1.],         [-1., -1., -1., -1.]],        [[ 1.,  1.,  1.,  1.],         [ 1.,  1.,  1.,  1.],         [-1., -1., -1., -1.]]])</code></pre><p>å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•°, ç»§æ‰¿<code>CrossEntropyLoss</code></p><pre><code class="lang-python">class MaskedSoftmaxCELoss(nn.CrossEntropyLoss):    # pred shape: (batch_size, seq_len, vocab_size)    # label shape: (batch_size, seq_len)    # valid_length shape: (batch_size, )    def forward(self, pred, label, valid_length):        # the sample weights shape should be (batch_size, seq_len)        weights = torch.ones_like(label)        weights = SequenceMask(weights, valid_length).float()  # padding éƒ¨åˆ†çš„æŸå¤±å˜æˆ 0ï¼Œä¿ç•™æœ‰æ•ˆé•¿åº¦éƒ¨åˆ†çš„å­˜ä¸–        self.reduction=&#39;none&#39;        output=super(MaskedSoftmaxCELoss, self).forward(pred.transpose(1,2), label)        return (output*weights).mean(dim=1)</code></pre><pre><code class="lang-python">loss = MaskedSoftmaxCELoss()loss(torch.ones((3, 4, 10)), torch.ones((3,4),dtype=torch.long), torch.tensor([4,3,0])) # label 3ä¸ªå¥å­ï¼Œ4 ä¸ªæ­£ç¡®å•è¯ï¼› æœ‰æ•ˆé•¿åº¦[4, 3, 0]</code></pre><pre><code>tensor([2.3026, 1.7269, 0.0000])</code></pre><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><pre><code class="lang-python">def train_ch7(model, data_iter, lr, num_epochs, device):  # Saved in d2l å¦‚æœdeviceæ˜¯GPUï¼Œä¸‹é¢çš„deviceéƒ½è¦è®¾å®š    model.to(device)    optimizer = optim.Adam(model.parameters(), lr=lr)    loss = MaskedSoftmaxCELoss()    tic = time.time()    for epoch in range(1, num_epochs+1):        l_sum, num_tokens_sum = 0.0, 0.0  # loss çš„æ€»å’Œï¼Œå•è¯æ•°é‡çš„æ€»å’Œ        for batch in data_iter:            optimizer.zero_grad()            X, X_vlen, Y, Y_vlen = [x.to(device) for x in batch]            Y_input, Y_label, Y_vlen = Y[:,:-1], Y[:,1:], Y_vlen-1 # Y_input decoderçš„è¾“å…¥            Y_hat, _ = model(X, Y_input, X_vlen, Y_vlen)            l = loss(Y_hat, Y_label, Y_vlen).sum()            l.backward()            with torch.no_grad():                d2l.grad_clipping_nn(model, 5, device)  #æ¢¯åº¦è£å‰ª            num_tokens = Y_vlen.sum().item()            optimizer.step()            l_sum += l.sum().item()            num_tokens_sum += num_tokens        if epoch % 50 == 0:            print(&quot;epoch {0:4d},loss {1:.3f}, time {2:.1f} sec&quot;.format(                   epoch, (l_sum/num_tokens_sum), time.time()-tic))            tic = time.time()</code></pre><pre><code class="lang-python">embed_size, num_hiddens, num_layers, dropout = 32, 32, 2, 0.0batch_size, num_examples, max_len = 64, 1e3, 10lr, num_epochs, ctx = 0.005, 300, d2l.try_gpu()src_vocab, tgt_vocab, train_iter = d2l.load_data_nmt(    batch_size, max_len,num_examples)encoder = Seq2SeqEncoder(    len(src_vocab), embed_size, num_hiddens, num_layers, dropout)decoder = Seq2SeqDecoder(    len(tgt_vocab), embed_size, num_hiddens, num_layers, dropout)model = d2l.EncoderDecoder(encoder, decoder)train_ch7(model, train_iter, lr, num_epochs, ctx)</code></pre><pre><code>epoch   50,loss 0.093, time 38.2 secepoch  100,loss 0.046, time 37.9 secepoch  150,loss 0.032, time 36.8 secepoch  200,loss 0.027, time 37.5 secepoch  250,loss 0.026, time 37.8 secepoch  300,loss 0.025, time 37.3 sec</code></pre><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><pre><code class="lang-python">def translate_ch7(model, src_sentence, src_vocab, tgt_vocab, max_len, device):    src_tokens = src_vocab[src_sentence.lower().split(&#39; &#39;)]    src_len = len(src_tokens)    if src_len &lt; max_len:        src_tokens += [src_vocab.pad] * (max_len - src_len)  # è¿›è¡Œ padding    enc_X = torch.tensor(src_tokens, device=device)    enc_valid_length = torch.tensor([src_len], device=device)    # use expand_dim to add the batch_size dimension.    enc_outputs = model.encoder(enc_X.unsqueeze(dim=0), enc_valid_length) # unsqueeze å¢åŠ ä¸€ä¸ªç»´åº¦ï¼ˆå› ä¸ºæœ‰å¤šä¸ª batch_size)    dec_state = model.decoder.init_state(enc_outputs, enc_valid_length) # encoder çš„è¾“å‡ºä½œä¸º dec çš„è¾“å…¥åˆå§‹åŒ–    dec_X = torch.tensor([tgt_vocab.bos], device=device).unsqueeze(dim=0) # è®¾ä¸º bos è¡¨ç¤ºå¼€å§‹    predict_tokens = []    for _ in range(max_len):        Y, dec_state = model.decoder(dec_X, dec_state) # å½“å‰ RNN å•å…ƒçš„ output Yï¼Œç»™ä¸‹ä¸€ä¸ªå•å…ƒçš„ dec_state        dec_X = Y.argmax(dim=2)  # å¾—åˆ†æœ€é«˜çš„å•è¯ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå•å…ƒçš„è¾“å…¥        py = dec_X.squeeze(dim=0).int().item()        if py == tgt_vocab.eos:  # ç»“æŸåˆ™è·³å‡ºå¾ªç¯            break        predict_tokens.append(py)    return &#39; &#39;.join(tgt_vocab.to_tokens(predict_tokens))</code></pre><pre><code class="lang-python">for sentence in [&#39;Go .&#39;, &#39;Wow !&#39;, &quot;I&#39;m OK .&quot;, &#39;I won !&#39;]:    print(sentence + &#39; =&gt; &#39; + translate_ch7(        model, sentence, src_vocab, tgt_vocab, max_len, ctx))</code></pre><pre><code>Go . =&gt; va !Wow ! =&gt; &lt;unk&gt; !I&#39;m OK . =&gt; Ã§a va .I won ! =&gt; j&#39;ai gagnÃ© !</code></pre><h2 id="Beam-Search-é›†æŸæœç´¢"><a href="#Beam-Search-é›†æŸæœç´¢" class="headerlink" title="Beam Search é›†æŸæœç´¢"></a>Beam Search é›†æŸæœç´¢</h2><p>ç®€å•greedy searchï¼šï¼ˆè´ªå¿ƒï¼‰åªè€ƒè™‘äº†å±€éƒ¨æœ€ä¼˜è§£</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/emJlxcIbrCVTS1o.png" alt="ç®€å•è´ªå¿ƒ"></p><p>ç»´ç‰¹æ¯”ç®—æ³•ï¼šé€‰æ‹©æ•´ä½“åˆ†æ•°æœ€é«˜çš„å¥å­ï¼ˆæœç´¢ç©ºé—´å¤ªå¤§ï¼‰<br>é›†æŸæœç´¢ï¼šæ¯æ¬¡ä¸åªé€‰ä¸€ä¸ªï¼Œé€‰æ‹© top nï¼Œå¢åŠ å¤‡é€‰é¡¹ä½†åˆä¸å…¨å±€æœç´¢</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/L5aI1irfAKm2znq.png" alt="é›†æŸæœç´¢"></p><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/BAHTqRNlPsiMdyr.png" alt="æœºå™¨ç¿»è¯‘-ç»ƒä¹ é¢˜"></p><ul><li>è®­ç»ƒæ—¶ä¸‹ä¸€ä¸ªå•è¯æ˜¯å·²çŸ¥çš„, é¢„æµ‹æ—¶éœ€è¦ä½œä¸ºä¸‹ä¸€ä¸ªå•è¯ç”Ÿæˆçš„è¾“å…¥</li><li>æ¯ä¸ª batch ä¹‹å†…, size æ˜¯ç»™å®šçš„, å¥å­é•¿åº¦éƒ½æ˜¯ä¸€æ ·çš„</li></ul>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> NLP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (ä¸ƒ):å¾ªç¯ç¥ç»ç½‘ç»œ RNN åŸºç¡€</title>
      <link href="/2020/02/19/dl-notes7-rnn-basic/"/>
      <url>/2020/02/19/dl-notes7-rnn-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h1><p>æœ¬èŠ‚ä»‹ç»å¾ªç¯ç¥ç»ç½‘ç»œï¼Œä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•åŸºäºå¾ªç¯ç¥ç»ç½‘ç»œå®ç°è¯­è¨€æ¨¡å‹ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯åŸºäºå½“å‰çš„è¾“å…¥ä¸è¿‡å»çš„è¾“å…¥åºåˆ—ï¼Œé¢„æµ‹åºåˆ—çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚å¾ªç¯ç¥ç»ç½‘ç»œå¼•å…¥ä¸€ä¸ªéšè—å˜é‡$H$ï¼Œç”¨$H_{t}$è¡¨ç¤º$H$åœ¨æ—¶é—´æ­¥$t$çš„å€¼ã€‚$H_{t}$çš„è®¡ç®—åŸºäº$X_{t}$å’Œ$H_{t-1}$ï¼Œå¯ä»¥è®¤ä¸º$H_{t}$è®°å½•äº†åˆ°å½“å‰å­—ç¬¦ä¸ºæ­¢çš„åºåˆ—ä¿¡æ¯ï¼Œåˆ©ç”¨$H_{t}$å¯¹åºåˆ—çš„ä¸‹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œé¢„æµ‹ã€‚</p><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>W_xh: çŠ¶æ€-è¾“å…¥æƒé‡<br>W_hh: çŠ¶æ€-çŠ¶æ€æƒé‡<br>W_hq: çŠ¶æ€-è¾“å‡ºæƒé‡<br>b_h: éšè—å±‚çš„åç½®<br>b_q: è¾“å‡ºå±‚çš„åç½®</p><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><ul><li>å¾ªç¯ç¥ç»ç½‘ç»œ <code>RNN</code> çš„å‚æ•°å°±æ˜¯ä¸Šè¿°çš„ä¸‰ä¸ªæƒé‡å’Œä¸¤ä¸ªåç½®ï¼Œå¹¶ä¸”åœ¨æ²¿ç€æ—¶é—´è®­ç»ƒï¼ˆå‚æ•°çš„æ›´æ–°ï¼‰ï¼Œå‚æ•°çš„æ•°é‡æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä»…ä»…æ˜¯ä¸Šè¿°çš„å‚æ•°çš„å€¼åœ¨æ›´æ–°ã€‚å¾ªç¯ç¥ç»ç½‘ç»œå¯ä»¥çœ‹ä½œæ˜¯æ²¿ç€æ—¶é—´ç»´åº¦ä¸Šçš„æƒå€¼å…±äº«</li><li>å·ç§¯ç¥ç»ç½‘ç»œ <code>CNN</code> ä¸­ï¼Œä¸€ä¸ªå·ç§¯æ ¸é€šè¿‡åœ¨ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨è¿›è¡Œå·ç§¯ï¼Œæ˜¯ç©ºé—´ç»´åº¦çš„æƒå€¼å…±äº«ã€‚åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­é€šè¿‡æ§åˆ¶ç‰¹å¾å›¾çš„æ•°é‡æ¥æ§åˆ¶æ¯ä¸€å±‚æ¨¡å‹çš„å¤æ‚åº¦ï¼Œè€Œå¾ªç¯ç¥ç»ç½‘ç»œæ˜¯é€šè¿‡æ§åˆ¶W_xhå’ŒW_hhä¸­hçš„ç»´åº¦æ¥æ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ã€‚</li></ul><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VcEfH.png" alt="RNN æ¨¡å‹"></p><h2 id="ä¸€ä¸ªbatchçš„æ•°æ®çš„è¡¨ç¤º"><a href="#ä¸€ä¸ªbatchçš„æ•°æ®çš„è¡¨ç¤º" class="headerlink" title="ä¸€ä¸ªbatchçš„æ•°æ®çš„è¡¨ç¤º"></a>ä¸€ä¸ªbatchçš„æ•°æ®çš„è¡¨ç¤º</h2><ul><li>å¦‚ä½•å°†ä¸€ä¸ªbatchçš„æ•°æ®è½¬æ¢æˆæ—¶é—´æ­¥æ•°ä¸ªï¼ˆæ‰¹é‡å¤§å°ï¼Œè¯å…¸å¤§å°ï¼‰çš„çŸ©é˜µï¼Ÿ</li><li>æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªè¯å…¸å¤§å°çš„å‘é‡(<code>one-hot è¡¨ç¤ºæ³•</code>)ï¼Œæ¯ä¸ªæ ·æœ¬æ˜¯æ—¶é—´æ­¥æ•°ä¸ªåºåˆ—ï¼Œæ¯ä¸ªbatchæ˜¯æ‰¹é‡å¤§å°ä¸ªæ ·æœ¬</li><li>ç¬¬ä¸€ä¸ª{æ‰¹é‡å¤§å°ï¼Œè¯å…¸å¤§å°}çš„çŸ©é˜µï¼šå–å‡ºä¸€ä¸ªæ‰¹é‡æ ·æœ¬ä¸­<code>æ¯ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</code>ï¼Œå¹¶å°†æ¯ä¸ªå­—ç¬¦å±•å¼€æˆè¯å…¸å¤§å°çš„å‘é‡ï¼Œå°±å½¢æˆäº†ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥æ‰€è¡¨ç¤ºçš„çŸ©é˜µ</li><li>ç¬¬äºŒä¸ª{æ‰¹é‡å¤§å°ï¼Œè¯å…¸å¤§å°}çš„çŸ©é˜µï¼šå–å‡ºä¸€ä¸ªæ‰¹é‡æ ·æœ¬ä¸­<code>æ¯ä¸ªåºåˆ—çš„ç¬¬äºŒä¸ªå­—ç¬¦</code>ï¼Œå¹¶å°†æ¯ä¸ªå­—ç¬¦å±•å¼€æˆè¯å…¸å¤§å°çš„å‘é‡ï¼Œå°±å½¢æˆäº†ç¬¬äºŒä¸ªæ—¶é—´æ­¥æ‰€è¡¨ç¤ºçš„çŸ©é˜µ</li><li>æœ€åå°±å½¢æˆäº†æ—¶é—´æ­¥ä¸ª{æ‰¹é‡å¤§å°ï¼Œè¯å…¸å¤§å°}çš„çŸ©é˜µ. 1ä¸ª batch = <code>step * batch_size * vocab_size</code> ï¼Œè¿™ä¹Ÿå°±æ˜¯æ¯ä¸ªbatchæœ€åçš„å½¢å¼</li></ul><h2 id="éšè—çŠ¶æ€çš„åˆå§‹åŒ–"><a href="#éšè—çŠ¶æ€çš„åˆå§‹åŒ–" class="headerlink" title="éšè—çŠ¶æ€çš„åˆå§‹åŒ–"></a>éšè—çŠ¶æ€çš„åˆå§‹åŒ–</h2><ul><li>éšæœºé‡‡æ ·æ—¶ï¼šæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦é‡æ–°åˆå§‹åŒ–éšè—çŠ¶æ€ï¼ˆæ¯ä¸ªepochæœ‰å¾ˆå¤šè¯è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºå¯¹äºéšæœºé‡‡æ ·çš„æ ·æœ¬ä¸­åªæœ‰ä¸€ä¸ªæ‰¹é‡å†…çš„æ•°æ®æ˜¯è¿ç»­çš„ï¼‰</li><li>ç›¸é‚»é‡‡æ ·æ—¶ï¼šå¦‚æœæ˜¯ç›¸é‚»é‡‡æ ·ï¼Œåˆ™è¯´æ˜å‰åä¸¤ä¸ªbatchçš„æ•°æ®æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨è®­ç»ƒæ¯ä¸ªbatchçš„æ—¶å€™åªéœ€è¦æ›´æ–°ä¸€æ¬¡ï¼ˆä¹Ÿå°±æ˜¯è¯´æ¨¡å‹åœ¨ä¸€ä¸ªepochä¸­çš„è¿­ä»£ä¸éœ€è¦é‡æ–°åˆå§‹åŒ–éšè—çŠ¶æ€ï¼‰</li></ul><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„é€ "><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„é€ " class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„é€ "></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„é€ </h2><p>æˆ‘ä»¬å…ˆçœ‹å¾ªç¯ç¥ç»ç½‘ç»œçš„å…·ä½“æ„é€ ã€‚å‡è®¾$\boldsymbol{X}_t \in \mathbb{R}^{n \times d}$æ˜¯æ—¶é—´æ­¥$t$çš„å°æ‰¹é‡è¾“å…¥ï¼ˆå…¶æ‰¹é‡å¤§å°ä¸º ğ‘› ï¼Œè¾“å…¥ä¸ªæ•°ä¸º ğ‘‘ï¼‰ï¼Œ$\boldsymbol{H}_t  \in \mathbb{R}^{n \times h}$æ˜¯è¯¥æ—¶é—´æ­¥çš„éšè—å˜é‡ï¼Œåˆ™ï¼š</p><script type="math/tex; mode=display">\boldsymbol{H}_t = \phi(\boldsymbol{X}_t \boldsymbol{W}_{xh} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hh}  + \boldsymbol{b}_h).</script><p>å…¶ä¸­ï¼Œ$\boldsymbol{W}_{xh} \in \mathbb{R}^{d \times h}$ï¼Œ$\boldsymbol{W}_{hh} \in \mathbb{R}^{h \times h}$ï¼Œ$\boldsymbol{b}_{h} \in \mathbb{R}^{1 \times h}$ï¼Œ$\phi$å‡½æ•°æ˜¯<code>éçº¿æ€§æ¿€æ´»å‡½æ•°</code>ã€‚ç”±äºå¼•å…¥äº†$\boldsymbol{H}_{t-1} \boldsymbol{W}_{hh}$ï¼Œ$H_{t}$èƒ½å¤Ÿæ•æ‰æˆªè‡³å½“å‰æ—¶é—´æ­¥çš„åºåˆ—çš„å†å²ä¿¡æ¯ï¼Œå°±åƒæ˜¯ç¥ç»ç½‘ç»œå½“å‰æ—¶é—´æ­¥çš„çŠ¶æ€æˆ–è®°å¿†ä¸€æ ·ã€‚ç”±äº$H_{t}$çš„è®¡ç®—åŸºäº$H_{t-1}$ï¼Œä¸Šå¼çš„è®¡ç®—æ˜¯å¾ªç¯çš„ï¼Œä½¿ç”¨å¾ªç¯è®¡ç®—çš„ç½‘ç»œå³<code>å¾ªç¯ç¥ç»ç½‘ç»œ</code>ï¼ˆrecurrent neural networkï¼‰ã€‚</p><p>åœ¨æ—¶é—´æ­¥$t$ï¼Œè¾“å‡ºå±‚çš„è¾“å‡ºä¸ºï¼š</p><script type="math/tex; mode=display">\boldsymbol{O}_t = \boldsymbol{H}_t \boldsymbol{W}_{hq} + \boldsymbol{b}_q.</script><p>å…¶ä¸­$\boldsymbol{W}_{hq} \in \mathbb{R}^{h \times q}$ï¼Œ$\boldsymbol{b}_q \in \mathbb{R}^{1 \times q}$ã€‚<br>ï¼ˆh æ˜¯ç”±ä¸Šä¸€å±‚éšè—å±‚çš„ç¥ç»å…ƒä¸ªæ•°å†³å®šçš„ï¼Œq æ˜¯è‡ªå·±çš„è¾“å‡ºä¸ªæ•°ï¼‰</p><h2 id="ä»é›¶å¼€å§‹å®ç°å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#ä»é›¶å¼€å§‹å®ç°å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="ä»é›¶å¼€å§‹å®ç°å¾ªç¯ç¥ç»ç½‘ç»œ"></a>ä»é›¶å¼€å§‹å®ç°å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p>æˆ‘ä»¬å…ˆå°è¯•ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªåŸºäºå­—ç¬¦çº§å¾ªç¯ç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å‘¨æ°ä¼¦çš„æ­Œè¯ä½œä¸ºè¯­æ–™ï¼Œé¦–å…ˆæˆ‘ä»¬è¯»å…¥æ•°æ®ï¼š</p><pre><code class="lang-python">import torchimport torch.nn as nnimport timeimport mathimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2l_jay9460 as d2l(corpus_indices, char_to_idx, idx_to_char, vocab_size) = d2l.load_data_jay_lyrics()device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)</code></pre><h3 id="one-hotå‘é‡"><a href="#one-hotå‘é‡" class="headerlink" title="one-hotå‘é‡"></a>one-hotå‘é‡</h3><p>æˆ‘ä»¬éœ€è¦å°†å­—ç¬¦è¡¨ç¤ºæˆå‘é‡ï¼Œè¿™é‡Œé‡‡ç”¨one-hotå‘é‡ã€‚å‡è®¾è¯å…¸å¤§å°æ˜¯$N$ï¼Œæ¯æ¬¡å­—ç¬¦å¯¹åº”ä¸€ä¸ªä»$0$åˆ°$N-1$çš„å”¯ä¸€çš„ç´¢å¼•ï¼Œåˆ™è¯¥å­—ç¬¦çš„å‘é‡æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º$N$çš„å‘é‡ï¼Œè‹¥å­—ç¬¦çš„ç´¢å¼•æ˜¯$i$ï¼Œåˆ™è¯¥å‘é‡çš„ç¬¬$i$ä¸ªä½ç½®ä¸º$1$ï¼Œå…¶ä»–ä½ç½®ä¸º$0$ã€‚ä¸‹é¢åˆ†åˆ«å±•ç¤ºäº†ç´¢å¼•ä¸º0å’Œ2çš„one-hotå‘é‡ï¼Œå‘é‡é•¿åº¦ç­‰äºè¯å…¸å¤§å° vocab_sizeã€‚</p><pre><code class="lang-python">def one_hot(x, n_class, dtype=torch.float32):    result = torch.zeros(x.shape[0], n_class, dtype=dtype, device=x.device)  # shape: (n, n_class)    result.scatter_(1, x.long().view(-1, 1), 1)  # result[i, x[i, 0]] = 1    return result# one-hot æ¯ä¸ªäººæºå¸¦æ•´ä¸ªåºåˆ—ï¼Œä½†æ˜¯åªæ ‡è®°è‡ªå·±print(vocab_size)x = torch.tensor([0, 2])x_one_hot = one_hot(x, vocab_size)print(x_one_hot)print(x_one_hot.shape)print(x_one_hot.sum(axis=1))</code></pre><pre><code>1027tensor([[1., 0., 0.,  ..., 0., 0., 0.],        [0., 0., 1.,  ..., 0., 0., 0.]])torch.Size([2, 1027])tensor([1., 1.])</code></pre><p>æˆ‘ä»¬æ¯æ¬¡é‡‡æ ·çš„å°æ‰¹é‡çš„å½¢çŠ¶æ˜¯ï¼ˆæ‰¹é‡å¤§å°, æ—¶é—´æ­¥æ•°ï¼‰ã€‚ä¸‹é¢çš„å‡½æ•°å°†è¿™æ ·çš„å°æ‰¹é‡å˜æ¢æˆæ•°ä¸ªå½¢çŠ¶ä¸ºï¼ˆæ‰¹é‡å¤§å°, è¯å…¸å¤§å°ï¼‰çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸ªæ•°ç­‰äºæ—¶é—´æ­¥æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ—¶é—´æ­¥$t$çš„è¾“å…¥ä¸º$\boldsymbol{X}_t \in \mathbb{R}^{n \times d}$ï¼Œå…¶ä¸­$n$ä¸ºæ‰¹é‡å¤§å°ï¼Œ$d$ä¸ºè¯å‘é‡å¤§å°ï¼Œå³one-hotå‘é‡é•¿åº¦ï¼ˆè¯å…¸å¤§å°ï¼‰ã€‚</p><pre><code class="lang-python">def to_onehot(X, n_class):      # X ç›¸å½“äºå°æ‰¹é‡ï¼Œæ‰¹é‡å¤§å°å³è¡Œæ•°nï¼Œæ—¶é—´æ­¥æ•°å³åˆ—æ•°d, n_class ç›¸å½“äºå­—å…¸å¤§å°ï¼Œå³å•è¯ä¸ªæ•° vocab_size    # æ¯æ¬¡ä¼ ç»™ one_hot å‚æ•°ï¼ŒX[:, i]è¡¨ç¤ºç¬¬ i åˆ—æ‰€æœ‰è¡Œï¼Œæ¯æ¬¡ä¸¤è¡Œï¼Œ0/5, 1/6... n_class å³ vocab_size    # å¯¹æ¯ä¸€åˆ—è¿›è¡Œ one_hot, æœ€åè¿”å›çš„ä¸€ä¸ªä¸‰ç»´ tensor    # one_hot(X[:, i] ä¸º [tensor([0, 5]), tensor([1, 6]), tensor([2, 7]), tensor([3, 8]), tensor([4, 9])]    return [one_hot(X[:, i], n_class) for i in range(X.shape[1])]X = torch.arange(10).view(2, 5) #æ­¤å¤„æ‰¹é‡å¤§å°ä¸º 2ï¼Œæ—¶é—´æ­¥æ•°ä¸º 5inputs = to_onehot(X, vocab_size)print(X)print(inputs)# ä¸Šé¢æ˜¯ä¸€è¡Œä¸€ç»„x = torch.tensor([0, 2]), xåªæœ‰ä¸€è¡Œï¼Œè¿™é‡Œæ˜¯ä¸¤ä¸ªä¸€ç»„ï¼Œå› ä¸º X æœ‰ä¸¤è¡Œ</code></pre><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><pre><code class="lang-python">num_inputs, num_hiddens, num_outputs = vocab_size, 256, vocab_size# num_inputs: d# num_hiddens: h, éšè—å•å…ƒçš„ä¸ªæ•°256, æ˜¯è¶…å‚æ•°# num_outputs: qdef get_params():    def _one(shape): # å¯¹ç»™å®šçš„ shape è¿›è¡Œéšæœºåˆå§‹åŒ–        param = torch.zeros(shape, device=device, dtype=torch.float32)        nn.init.normal_(param, 0, 0.01)        return torch.nn.Parameter(param)    # éšè—å±‚å‚æ•°    W_xh = _one((num_inputs, num_hiddens))    W_hh = _one((num_hiddens, num_hiddens))    b_h = torch.nn.Parameter(torch.zeros(num_hiddens, device=device))    # è¾“å‡ºå±‚å‚æ•°    W_hq = _one((num_hiddens, num_outputs))    b_q = torch.nn.Parameter(torch.zeros(num_outputs, device=device))    return (W_xh, W_hh, b_h, W_hq, b_q)</code></pre><h3 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>å‡½æ•°<code>rnn</code>ç”¨å¾ªç¯çš„æ–¹å¼ä¾æ¬¡å®Œæˆå¾ªç¯ç¥ç»ç½‘ç»œæ¯ä¸ªæ—¶é—´æ­¥çš„è®¡ç®—ã€‚</p><pre><code class="lang-python">def rnn(inputs, state, params):    # inputså’Œoutputsçš†ä¸ºnum_stepsä¸ªå½¢çŠ¶ä¸º(batch_size, vocab_size)çš„çŸ©é˜µ    W_xh, W_hh, b_h, W_hq, b_q = params    H, = state   # çŠ¶æ€å¯èƒ½æœ‰å¤šä¸ªï¼Œå…ˆå®šä¹‰æˆä¸€ä¸ªå…ƒç»„    outputs = []    for X in inputs:        H = torch.tanh(torch.matmul(X, W_xh) + torch.matmul(H, W_hh) + b_h)  # æ ¹æ®å…¬å¼        Y = torch.matmul(H, W_hq) + b_q        outputs.append(Y)    return outputs, (H,)   # å¯èƒ½ä¼šä½¿ç”¨ç›¸é‚»é‡‡æ ·ï¼Œå½“å‰çš„çŠ¶æ€(H,)å°±å¯ä»¥ä½œä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€çš„åˆå§‹å€¼</code></pre><p>å‡½æ•°init_rnn_stateåˆå§‹åŒ–éšè—å˜é‡ï¼Œè¿™é‡Œçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚</p><pre><code class="lang-python">def init_rnn_state(batch_size, num_hiddens, device):    return (torch.zeros((batch_size, num_hiddens), device=device), )</code></pre><p>åšä¸ªç®€å•çš„æµ‹è¯•æ¥è§‚å¯Ÿè¾“å‡ºç»“æœçš„ä¸ªæ•°ï¼ˆæ—¶é—´æ­¥æ•°ï¼‰ï¼Œä»¥åŠç¬¬ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºå±‚è¾“å‡ºçš„å½¢çŠ¶å’Œéšè—çŠ¶æ€çš„å½¢çŠ¶ã€‚</p><pre><code class="lang-python"># print(X.shape)  # è¾“å…¥æ‰¹é‡ï¼Œæ‰¹é‡å¤§å°æ˜¯ 2ï¼Œæ—¶é—´æ­¥æ•°æ˜¯ 5# print(num_hiddens) # éšè—å•å…ƒä¸ªæ•° 256# print(vocab_size)  # å­—å…¸å¤§å° 1027state = init_rnn_state(X.shape[0], num_hiddens, device)  # åˆå§‹åŒ–çŠ¶æ€inputs = to_onehot(X.to(device), vocab_size)params = get_params()outputs, state_new = rnn(inputs, state, params)  # æŠŠ one_hot å½¢å¼çš„ X ä½œä¸º inputs è¾“å…¥è¿›å»# print(len(inputs), inputs[0].shape)   # 5 torch.Size([2, 1027])# print(len(outputs), outputs[0].shape) # 5 torch.Size([2, 1027])# print(len(state), state[0].shape)     # 1 torch.Size([2, 256])# print(len(state_new), state_new[0].shape) # 1 torch.Size([2, 256])  éƒ½æ˜¯ 2 è¡Œ 256 åˆ—</code></pre><h3 id="è£å‰ªæ¢¯åº¦"><a href="#è£å‰ªæ¢¯åº¦" class="headerlink" title="è£å‰ªæ¢¯åº¦"></a>è£å‰ªæ¢¯åº¦</h3><p>å¾ªç¯ç¥ç»ç½‘ç»œä¸­è¾ƒå®¹æ˜“å‡ºç°æ¢¯åº¦è¡°å‡æˆ–æ¢¯åº¦çˆ†ç‚¸ï¼Œè¿™ä¼šå¯¼è‡´ç½‘ç»œå‡ ä¹æ— æ³•è®­ç»ƒã€‚<code>è£å‰ªæ¢¯åº¦</code>ï¼ˆclip gradientï¼‰æ˜¯ä¸€ç§åº”å¯¹<code>æ¢¯åº¦çˆ†ç‚¸</code>çš„æ–¹æ³•ã€‚å‡è®¾æˆ‘ä»¬æŠŠæ‰€æœ‰æ¨¡å‹å‚æ•°çš„æ¢¯åº¦æ‹¼æ¥æˆä¸€ä¸ªå‘é‡ $\boldsymbol{g}$ï¼Œå¹¶è®¾è£å‰ªçš„é˜ˆå€¼æ˜¯$\theta$ã€‚è£å‰ªåçš„æ¢¯åº¦</p><script type="math/tex; mode=display"> \min\left(\frac{\theta}{\|\boldsymbol{g}\|}, 1\right)\boldsymbol{g}</script><p>çš„$L_2$èŒƒæ•°ä¸è¶…è¿‡$\theta$ã€‚</p><pre><code class="lang-python">def grad_clipping(params, theta, device):    norm = torch.tensor([0.0], device=device)    for param in params:        norm += (param.grad.data ** 2).sum()    norm = norm.sqrt().item()    if norm &gt; theta:  # å¦‚æœä¸å¤Ÿ 1ï¼Œå°±ä¹˜ä¸Šä¸€ä¸ªæ•°        for param in params:            param.grad.data *= (theta / norm)</code></pre><h3 id="å®šä¹‰é¢„æµ‹å‡½æ•°"><a href="#å®šä¹‰é¢„æµ‹å‡½æ•°" class="headerlink" title="å®šä¹‰é¢„æµ‹å‡½æ•°"></a>å®šä¹‰é¢„æµ‹å‡½æ•°</h3><p>ä»¥ä¸‹å‡½æ•°åŸºäºå‰ç¼€<code>prefix</code>ï¼ˆå«æœ‰æ•°ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼‰æ¥é¢„æµ‹æ¥ä¸‹æ¥çš„<code>num_chars</code>ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªå‡½æ•°ç¨æ˜¾å¤æ‚ï¼Œå…¶ä¸­æˆ‘ä»¬å°†å¾ªç¯ç¥ç»å•å…ƒ<code>rnn</code>è®¾ç½®æˆäº†å‡½æ•°å‚æ•°ï¼Œè¿™æ ·åœ¨åé¢å°èŠ‚ä»‹ç»å…¶ä»–å¾ªç¯ç¥ç»ç½‘ç»œæ—¶èƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><pre><code class="lang-python">def predict_rnn(prefix, num_chars, rnn, params, init_rnn_state,  # ç»™å®š prefixï¼Œé¢„æµ‹æ¥ä¸‹æ¥çš„ num_chars                num_hiddens, vocab_size, device, idx_to_char, char_to_idx):    state = init_rnn_state(1, num_hiddens, device)    output = [char_to_idx[prefix[0]]]   # outputè®°å½•prefixåŠ ä¸Šé¢„æµ‹çš„num_charsä¸ªå­—ç¬¦    for t in range(num_chars + len(prefix) - 1):        # å°†ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡ºä½œä¸ºå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥        X = to_onehot(torch.tensor([[output[-1]]], device=device), vocab_size)        # è®¡ç®—è¾“å‡ºå’Œæ›´æ–°éšè—çŠ¶æ€        (Y, state) = rnn(X, state, params)        # ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥æ˜¯prefixé‡Œçš„å­—ç¬¦(è¿˜åœ¨åˆå§‹æ€ï¼‰, æˆ–è€…å½“å‰çš„æœ€ä½³é¢„æµ‹å­—ç¬¦ï¼ˆè®¡ç®—å‡ºäº† Yï¼‰        if t &lt; len(prefix) - 1:            output.append(char_to_idx[prefix[t + 1]])        else:            output.append(Y[0].argmax(dim=1).item())    return &#39;&#39;.join([idx_to_char[i] for i in output])</code></pre><p>æˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹<code>predict_rnn</code>å‡½æ•°ã€‚æˆ‘ä»¬å°†æ ¹æ®å‰ç¼€â€œåˆ†å¼€â€åˆ›ä½œé•¿åº¦ä¸º10ä¸ªå­—ç¬¦ï¼ˆä¸è€ƒè™‘å‰ç¼€é•¿åº¦ï¼‰çš„ä¸€æ®µæ­Œè¯ã€‚å› ä¸ºæ¨¡å‹å‚æ•°ä¸ºéšæœºå€¼ï¼Œæ‰€ä»¥é¢„æµ‹ç»“æœä¹Ÿæ˜¯éšæœºçš„ã€‚</p><pre><code class="lang-python">predict_rnn(&#39;åˆ†å¼€&#39;, 10, rnn, params, init_rnn_state, num_hiddens, vocab_size,            device, idx_to_char, char_to_idx)</code></pre><pre><code>&#39;åˆ†å¼€æ½®å…»æ¯éœœæ•Œåˆºæ¯å¼ æš´æ¬¢&#39;</code></pre><h3 id="å›°æƒ‘åº¦"><a href="#å›°æƒ‘åº¦" class="headerlink" title="å›°æƒ‘åº¦"></a>å›°æƒ‘åº¦</h3><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>å›°æƒ‘åº¦</code>ï¼ˆperplexityï¼‰æ¥è¯„ä»·è¯­è¨€æ¨¡å‹çš„å¥½åã€‚å›å¿†ä¸€ä¸‹â€œsoftmaxå›å½’â€ä¸€èŠ‚ä¸­äº¤å‰ç†µæŸå¤±å‡½æ•°çš„å®šä¹‰ã€‚å›°æƒ‘åº¦æ˜¯å¯¹äº¤å‰ç†µæŸå¤±å‡½æ•°åšæŒ‡æ•°è¿ç®—åå¾—åˆ°çš„å€¼ã€‚ç‰¹åˆ«åœ°ï¼Œ</p><ul><li><code>æœ€ä½³</code>æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯æŠŠæ ‡ç­¾ç±»åˆ«çš„æ¦‚ç‡é¢„æµ‹ä¸º1ï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸º1ï¼›  ï¼ˆå›°æƒ‘åº¦å°±æ˜¯é¢„æµ‹æ¦‚ç‡çš„å€’æ•°ï¼‰</li><li><code>æœ€å</code>æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯æŠŠæ ‡ç­¾ç±»åˆ«çš„æ¦‚ç‡é¢„æµ‹ä¸º0ï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸ºæ­£æ— ç©·ï¼›</li><li><code>åŸºçº¿</code>æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯é¢„æµ‹æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡éƒ½ç›¸åŒï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸ºç±»åˆ«ä¸ªæ•°ã€‚</li></ul><p>æ˜¾ç„¶ï¼Œä»»ä½•ä¸€ä¸ªæœ‰æ•ˆæ¨¡å‹çš„å›°æƒ‘åº¦å¿…é¡»å°äºç±»åˆ«ä¸ªæ•°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå›°æƒ‘åº¦å¿…é¡»<code>å°äº</code>è¯å…¸å¤§å°<code>vocab_size</code>ã€‚</p><h3 id="å®šä¹‰æ¨¡å‹è®­ç»ƒå‡½æ•°"><a href="#å®šä¹‰æ¨¡å‹è®­ç»ƒå‡½æ•°" class="headerlink" title="å®šä¹‰æ¨¡å‹è®­ç»ƒå‡½æ•°"></a>å®šä¹‰æ¨¡å‹è®­ç»ƒå‡½æ•°</h3><p>è·Ÿä¹‹å‰ç« èŠ‚çš„æ¨¡å‹è®­ç»ƒå‡½æ•°ç›¸æ¯”ï¼Œè¿™é‡Œçš„æ¨¡å‹è®­ç»ƒå‡½æ•°æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š</p><ol><li>ä½¿ç”¨å›°æƒ‘åº¦è¯„ä»·æ¨¡å‹ã€‚</li><li>åœ¨è¿­ä»£æ¨¡å‹å‚æ•°å‰è£å‰ªæ¢¯åº¦ã€‚</li><li>å¯¹æ—¶åºæ•°æ®é‡‡ç”¨ä¸åŒé‡‡æ ·æ–¹æ³•å°†å¯¼è‡´éšè—çŠ¶æ€åˆå§‹åŒ–çš„ä¸åŒã€‚</li></ol><pre><code class="lang-python">def train_and_predict_rnn(rnn, get_params, init_rnn_state, num_hiddens,                          vocab_size, device, corpus_indices, idx_to_char,                          char_to_idx, is_random_iter, num_epochs, num_steps,                          lr, clipping_theta, batch_size, pred_period,                          pred_len, prefixes):    if is_random_iter:        data_iter_fn = d2l.data_iter_random  # éšæœºé‡‡æ ·    else:        data_iter_fn = d2l.data_iter_consecutive # ç›¸é‚»é‡‡æ ·    params = get_params()    loss = nn.CrossEntropyLoss()    for epoch in range(num_epochs):        if not is_random_iter:  # å¦‚ä½¿ç”¨ç›¸é‚»é‡‡æ ·ï¼Œåœ¨epochå¼€å§‹æ—¶åˆå§‹åŒ–éšè—çŠ¶æ€            state = init_rnn_state(batch_size, num_hiddens, device)        l_sum, n, start = 0.0, 0, time.time()        data_iter = data_iter_fn(corpus_indices, batch_size, num_steps, device)        for X, Y in data_iter:            if is_random_iter:  # å¦‚ä½¿ç”¨éšæœºé‡‡æ ·ï¼Œåœ¨æ¯ä¸ªå°æ‰¹é‡æ›´æ–°å‰åˆå§‹åŒ–éšè—çŠ¶æ€                state = init_rnn_state(batch_size, num_hiddens, device)            else:  # å¦åˆ™éœ€è¦ä½¿ç”¨detachå‡½æ•°ä»è®¡ç®—å›¾åˆ†ç¦»éšè—çŠ¶æ€                for s in state:                    s.detach_()  # detach_()å°†è¿”å›çš„å‘é‡ä»åˆ›å»ºå®ƒçš„è®¡ç®—å›¾ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œåé¢å°±ä¸å†å¯¹å®ƒæ±‚æ¢¯åº¦äº†            # inputsæ˜¯num_stepsä¸ªå½¢çŠ¶ä¸º(batch_size, vocab_size)çš„çŸ©é˜µ            inputs = to_onehot(X, vocab_size)            # outputsæœ‰num_stepsä¸ªå½¢çŠ¶ä¸º(batch_size, vocab_size)çš„çŸ©é˜µ            (outputs, state) = rnn(inputs, state, params)  # å‰å‘è®¡ç®—            # æ‹¼æ¥ä¹‹åå½¢çŠ¶ä¸º(num_steps * batch_size, vocab_size)            outputs = torch.cat(outputs, dim=0)            # Yçš„å½¢çŠ¶æ˜¯(batch_size, num_steps)ï¼Œè½¬ç½®åå†å˜æˆå½¢çŠ¶ä¸º            # (num_steps * batch_size,)çš„å‘é‡ï¼Œè¿™æ ·è·Ÿè¾“å‡ºçš„è¡Œä¸€ä¸€å¯¹åº”            y = torch.flatten(Y.T)            # ä½¿ç”¨äº¤å‰ç†µæŸå¤±è®¡ç®—å¹³å‡åˆ†ç±»è¯¯å·®            l = loss(outputs, y.long())            # æ¢¯åº¦æ¸…0            if params[0].grad is not None:                for param in params:                    param.grad.data.zero_()            l.backward()            grad_clipping(params, clipping_theta, device)  # è£å‰ªæ¢¯åº¦            d2l.sgd(params, lr, 1)  # å› ä¸ºè¯¯å·®å·²ç»å–è¿‡å‡å€¼ï¼Œæ¢¯åº¦ä¸ç”¨å†åšå¹³å‡            l_sum += l.item() * y.shape[0]            n += y.shape[0]        if (epoch + 1) % pred_period == 0:            print(&#39;epoch %d, perplexity %f, time %.2f sec&#39; % (                epoch + 1, math.exp(l_sum / n), time.time() - start))            for prefix in prefixes:                print(&#39; -&#39;, predict_rnn(prefix, pred_len, rnn, params, init_rnn_state,                    num_hiddens, vocab_size, device, idx_to_char, char_to_idx))</code></pre><h3 id="è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯"><a href="#è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯" class="headerlink" title="è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯"></a>è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯</h3><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è®­ç»ƒæ¨¡å‹äº†ã€‚é¦–å…ˆï¼Œè®¾ç½®æ¨¡å‹è¶…å‚æ•°ã€‚æˆ‘ä»¬å°†æ ¹æ®å‰ç¼€â€œåˆ†å¼€â€å’Œâ€œä¸åˆ†å¼€â€åˆ†åˆ«åˆ›ä½œé•¿åº¦ä¸º50ä¸ªå­—ç¬¦ï¼ˆä¸è€ƒè™‘å‰ç¼€é•¿åº¦ï¼‰çš„ä¸€æ®µæ­Œè¯ã€‚æˆ‘ä»¬æ¯è¿‡50ä¸ªè¿­ä»£å‘¨æœŸä¾¿æ ¹æ®å½“å‰è®­ç»ƒçš„æ¨¡å‹åˆ›ä½œä¸€æ®µæ­Œè¯ã€‚</p><pre><code class="lang-python">num_epochs, num_steps, batch_size, lr, clipping_theta = 250, 35, 32, 1e2, 1e-2pred_period, pred_len, prefixes = 50, 50, [&#39;åˆ†å¼€&#39;, &#39;ä¸åˆ†å¼€&#39;]</code></pre><p>ä¸‹é¢é‡‡ç”¨éšæœºé‡‡æ ·è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯ã€‚</p><pre><code class="lang-python">train_and_predict_rnn(rnn, get_params, init_rnn_state, num_hiddens,                      vocab_size, device, corpus_indices, idx_to_char,                      char_to_idx, True, num_epochs, num_steps, lr,                      clipping_theta, batch_size, pred_period, pred_len,                      prefixes)</code></pre><pre><code>epoch 50, perplexity 71.093786, time 0.76 sec - åˆ†å¼€ æˆ‘ä¸è¦å†æƒ³ä½  æˆ‘çŸ¥è¦è¿™ æˆ‘çš„è®©æˆ‘å¿ƒèƒ½ ä¸è¦æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­ - ä¸åˆ†å¼€ æˆ‘ä¸è¦è¿™ç”Ÿä½  æˆ‘çŸ¥æƒ³è¿™ æˆ‘çš„è®©æˆ‘å¿ƒèƒ½ ä¸è¦æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­æˆ‘ åˆ«å­epoch 100, perplexity 9.897621, time 0.71 sec - åˆ†å¼€ æˆ‘æƒ³æƒ³å¥½ç”Ÿæ´» ä¸çŸ¥ æ˜¯ä½  å´ä¸ ç—›ç®­  ç©¿ä»€ä¹ˆ å¦‚æœæˆ‘é‡èµ·å¤´ æœ‰è¯å»å¯¹åŒ»è¯ è¯´å“¼ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸ - ä¸åˆ†å¼€æ°¸ æˆ‘ä¸æƒ³å†æƒ³ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸è¦ çˆ±æƒ…èµ°çš„å¤ªå¿«å°±åƒé¾™å·é£ ä¸èƒ½ä¸è®©æˆ‘ç–¯ç‹‚çš„å¯çˆ±å¥³äºº ååçš„è®©æˆ‘ç–¯ç‹‚epoch 150, perplexity 2.847206, time 0.77 sec - åˆ†å¼€ è¿˜é»˜æ³• ä¸€æ­¥ä¸¤æ­¥ä¸‰æ­¥å››æ­¥æœ›è‘—å¤© çœ‹æ˜Ÿæ˜Ÿ ä¸€é¢—ä¸¤é¢—ä¸‰é¢—å››é¢— è¿æˆçº¿èƒŒè‘—èƒŒé»˜é»˜è®¸ä¸‹å¿ƒæ„¿ çœ‹è¿œæ–¹çš„æ˜Ÿæ˜¯å¦ - ä¸åˆ†å¼€å— æˆ‘ä¸èƒ½å†æƒ³ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸è¦ çˆ±æƒ…èµ°çš„å¤ªå¿«å°±åƒé¾™å·é£ ä¸èƒ½æ‰¿å—æˆ‘å·²æ— å¤„å¯èº² æˆ‘ä¸æƒ³å†æƒ³ æˆ‘ä¸èƒ½epoch 200, perplexity 1.564534, time 0.72 sec - åˆ†å¼€ æœ‰æƒ³éƒ½ æ•™æ‹³è„šæ­¦æœ¯çš„è€æ¿ ç»ƒé“æ²™æŒ è€æ¨å®¶æª åœ¨ä¼¤å­ä¸­å¤«æˆ‘å¦ˆæ„¿çŸ¥é”™æé”™  çˆ± ç”¨ç€æ˜Ÿçš„å¯¹ç¬‘ä¸‹æƒ³é€š  - ä¸åˆ†å¼€æƒ³ æˆ‘ä¸èƒ½å†æƒ³ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸èƒ½ çˆ±æƒ…èµ°çš„å¤ªå¿«å°±åƒé¾™å·é£ ä¸èƒ½æ‰¿å—æˆ‘å·²æ— å¤„å¯èº² æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦epoch 250, perplexity 1.311809, time 0.72 sec - åˆ†å¼€ é‚£åˆ‡éƒ½ä¸Šä¸€æ­¥å››æ­¥æœ›é€çš„ ä¸ºå¸èµ° ä¸€é¢—ä¸¤é¢—ä¸‰é¢—å››é¢— è¿æˆçº¿èƒŒè‘—èƒŒ æ¸¸è¡åœ¨è“å®‰æ’çš„é›¨ éšæ—¶å‡†å¤‡æ¥è¢­ æˆ‘ - ä¸åˆ†å¼€ç®€ç®€çš„èƒ–å¥³å·« ç”¨æ‹‰ä¸æ–‡å¿µå’’è¯­å•¦å•¦å‘œ å¥¹å…»çš„é»‘çŒ«ç¬‘èµ·æ¥åƒå“­ å•¦å•¦å•¦å‘œ é™æ»¡æ‘æª åœ¨äººç¬‘åŠŸ æˆ‘ä¸€å®šå¸¦æˆ‘å¦ˆ</code></pre><p>æ¥ä¸‹æ¥é‡‡ç”¨ç›¸é‚»é‡‡æ ·è®­ç»ƒæ¨¡å‹å¹¶åˆ›ä½œæ­Œè¯ã€‚</p><pre><code class="lang-python">train_and_predict_rnn(rnn, get_params, init_rnn_state, num_hiddens,                      vocab_size, device, corpus_indices, idx_to_char,                      char_to_idx, False, num_epochs, num_steps, lr,                      clipping_theta, batch_size, pred_period, pred_len,                      prefixes)</code></pre><pre><code>epoch 50, perplexity 60.294393, time 0.74 sec - åˆ†å¼€ æˆ‘æƒ³è¦ä½ æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸è¦å†æƒ³ æˆ‘ - ä¸åˆ†å¼€ æˆ‘æƒ³è¦ä½  ä½ æœ‰äº† åˆ«ä¸æˆ‘çš„å¯çˆ±å¥³äºº ååçš„è®©æˆ‘ç–¯ç‹‚çš„å¯çˆ±å¥³äºº ååçš„è®©æˆ‘ç–¯ç‹‚çš„å¯çˆ±å¥³äºº ååçš„è®©æˆ‘epoch 100, perplexity 7.141162, time 0.72 sec - åˆ†å¼€ æˆ‘å·²è¦å†çˆ± æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸è¦å†æƒ³ æˆ‘ä¸ æˆ‘ä¸ æˆ‘ä¸è¦ çˆ±æƒ…æˆ‘çš„è§å¿«å°±åƒé¾™å·é£ ç¦»èƒ½å¼€ - ä¸åˆ†å¼€æŸ³ ä½ å¤©é»„ä¸€ä¸ªæ£ åçŸ¥å“ˆå…® å¿«ä½¿ç”¨åŒæˆªæ£ å“¼å“¼å“ˆå…® å¿«ä½¿ç”¨åŒæˆªæ£ å“¼å“¼å“ˆå…® å¿«ä½¿ç”¨åŒæˆªæ£ å“¼å“¼å“ˆå…® epoch 150, perplexity 2.090277, time 0.73 sec - åˆ†å¼€ æˆ‘å·²è¦è¿™æ˜¯ä½ åœ¨è‘— ä¸æƒ³æˆ‘éƒ½åšå¾—åˆ° ä½†é‚£ä¸ªäººå·²ç»ä¸æ˜¯æˆ‘ æ²¡æœ‰ä½ åœ¨ æˆ‘å´å¤šéš¾ç†¬  æ²¡æœ‰ä½ åœ¨æˆ‘æœ‰å¤šéš¾ç†¬å¤š - ä¸åˆ†å¼€è§‰ ä½ å·²ç»ç¦» æˆ‘æƒ³å†å¥½ è¿™æ ·å¿ƒä¸­ æˆ‘ä¸€å®šå¸¦æˆ‘ æˆ‘çš„å®Œç©º ä¸ä½ æ˜¯é£ ä¸€ä¸€å½©çºµ åœ¨äººå¿ƒä¸­ æˆ‘ä¸€å®šå¸¦æˆ‘å¦ˆèµ°epoch 200, perplexity 1.305391, time 0.77 sec - åˆ†å¼€ æˆ‘å·²è¦è¿™æ ·ç‰µçœ‹ä½ çš„æ‰‹ å®ƒä¸€å®šå®ç°å®ƒä¸€å®šåƒç° è½½è‘—ä½  å½·å½¿è½½è‘—é˜³å…‰ ä¸ç®¡åˆ°ä½ ç•™éƒ½æ˜¯æ™´å¤© è´è¶è‡ªåœ¨é£åŠ› - ä¸åˆ†å¼€è§‰ ä½ å·²ç»ç¦»å¼€æˆ‘ ä¸çŸ¥ä¸è§‰ æˆ‘è·Ÿäº†è¿™èŠ‚å¥ åçŸ¥åè§‰ åˆè¿‡äº†ä¸€ä¸ªç§‹ åçŸ¥åè§‰ æˆ‘è¯¥å¥½å¥½ç”Ÿæ´» æˆ‘è¯¥å¥½å¥½ç”Ÿepoch 250, perplexity 1.230800, time 0.79 sec - åˆ†å¼€ æˆ‘ä¸è¦ æ˜¯ä½ çœ‹çš„å¤ªå¿«äº†æ‚²æ…¢ æ‹…å¿ƒä»Šæ‰‹èº«ä¼šå¤§æ—© å…¶ä¹ˆæˆ‘ä¹Ÿç¡ä¸ç€  æ˜¨æ™šæ¢¦é‡Œä½ æ¥æ‰¾ æˆ‘æ‰  åŸæ¥æˆ‘åªæƒ³ - ä¸åˆ†å¼€è§‰ ä½ åœ¨ç»ç¦»å¼€æˆ‘ ä¸çŸ¥ä¸è§‰ ä½ çŸ¥äº†æœ‰èŠ‚å¥ åçŸ¥åè§‰ åçŸ¥äº†ä¸€ä¸ªç§‹ åçŸ¥åè§‰ æˆ‘è¯¥å¥½å¥½ç”Ÿæ´» æˆ‘è¯¥å¥½å¥½ç”Ÿ</code></pre><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„-pytorch-ç®€æ´å®ç°"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„-pytorch-ç®€æ´å®ç°" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„ pytorch ç®€æ´å®ç°"></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„ pytorch ç®€æ´å®ç°</h2><h3 id="å®šä¹‰æ¨¡å‹-1"><a href="#å®šä¹‰æ¨¡å‹-1" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>æˆ‘ä»¬ä½¿ç”¨Pytorchä¸­çš„<code>nn.RNN</code>æ¥æ„é€ å¾ªç¯ç¥ç»ç½‘ç»œã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨<code>nn.RNN</code>çš„ä»¥ä¸‹å‡ ä¸ªæ„é€ å‡½æ•°å‚æ•°ï¼š</p><ul><li><code>input_size</code> - The number of expected features in the input x</li><li><code>hidden_size</code> â€“ The number of features in the hidden state h</li><li><code>nonlinearity</code> â€“ The non-linearity to use. Can be either â€˜tanhâ€™ or â€˜reluâ€™. Default: â€˜tanhâ€™</li><li><code>batch_first</code> â€“ If True, then the input and output tensors are provided as (batch_size, num_steps, input_size). Default: False</li></ul><p>è¿™é‡Œçš„<code>batch_first</code>å†³å®šäº†è¾“å…¥çš„å½¢çŠ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å‚æ•°<code>False</code>ï¼Œå¯¹åº”çš„è¾“å…¥å½¢çŠ¶æ˜¯ (num_steps, batch_size, input_size)ã€‚</p><p><code>forward</code>å‡½æ•°çš„å‚æ•°ä¸ºï¼š</p><ul><li><code>input</code> of shape (num_steps, batch_size, input_size): tensor containing the features of the input sequence. ï¼ˆä¸‰ç»´ï¼‰</li><li><code>h_0</code> of shape (num_layers * num_directions, batch_size, hidden_size): tensor containing the initial hidden state for each element in the batch. Defaults to zero if not provided. If the RNN is bidirectional, num_directions should be 2, else it should be 1. ï¼ˆ<code>h_0</code>å¯¹åº”çš„æ˜¯ RNN ä¸­çš„åˆå§‹ stateï¼‰<br>ï¼ˆnum_layersä¸»è¦å’Œæ·±åº¦ RNN æœ‰å…³ï¼Œnum_directionsä¸»è¦å’ŒåŒå‘ RNN æœ‰å…³ï¼Œæ­¤å¤„ <code>num_layers ä¹˜ä»¥ num_directions</code> = 1ï¼‰</li></ul><p><code>forward</code>å‡½æ•°çš„è¿”å›å€¼æ˜¯ï¼š</p><ul><li><code>output</code> of shape (num_steps, batch_size, num_directions * hidden_size): tensor containing the output features (h_t) from the last layer of the RNN, for each t.</li><li><code>h_n</code> of shape (num_layers * num_directions, batch_size, hidden_size): tensor containing the hidden state for t = num_steps. ï¼ˆæœ€åä¸€ä¸ªæ—¶é—´æ­¥ï¼Œéšè—çŠ¶æ€çš„å€¼ï¼‰</li></ul><p>ç°åœ¨æˆ‘ä»¬æ„é€ ä¸€ä¸ª<code>nn.RNN</code>å®ä¾‹ï¼Œå¹¶ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹è¾“å‡ºçš„å½¢çŠ¶ã€‚</p><pre><code class="lang-python">rnn_layer = nn.RNN(input_size=vocab_size, hidden_size=num_hiddens)num_steps, batch_size = 35, 2X = torch.rand(num_steps, batch_size, vocab_size)state = NoneY, state_new = rnn_layer(X, state)print(Y.shape, state_new.shape)</code></pre><pre><code>torch.Size([35, 2, 256]) torch.Size([1, 2, 256])</code></pre><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®Œæ•´çš„åŸºäºå¾ªç¯ç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹ã€‚</p><pre><code class="lang-python">class RNNModel(nn.Module):    def __init__(self, rnn_layer, vocab_size):        super(RNNModel, self).__init__()        self.rnn = rnn_layer  # ä¸€ä¸ª rnn å®ä¾‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª LSTM å®ä¾‹        self.hidden_size = rnn_layer.hidden_size * (2 if rnn_layer.bidirectional else 1)         self.vocab_size = vocab_size        self.dense = nn.Linear(self.hidden_size, vocab_size)  #çº¿æ€§å±‚ä½œä¸ºè¾“å‡ºå±‚    def forward(self, inputs, state):        # inputs.shape: (batch_size, num_steps)        X = to_onehot(inputs, vocab_size)        X = torch.stack(X)  # X.shape: (num_steps, batch_size, vocab_size)        hiddens, state = self.rnn(X, state)        hiddens = hiddens.view(-1, hiddens.shape[-1])  # hiddens.shape: (num_steps * batch_size, hidden_size)        output = self.dense(hiddens)  # ç”¨Linearçº¿æ€§å‡½æ•°ä½œè¾“å‡º        return output, state</code></pre><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª<code>é¢„æµ‹å‡½æ•°</code>ï¼Œä¸å‰é¢çš„åŒºåˆ«åœ¨äºå‰å‘è®¡ç®—å’Œåˆå§‹åŒ–éšè—çŠ¶æ€ã€‚</p><pre><code class="lang-python">def predict_rnn_pytorch(prefix, num_chars, model, vocab_size, device, idx_to_char,                      char_to_idx):    state = None    output = [char_to_idx[prefix[0]]]  # outputè®°å½•prefixåŠ ä¸Šé¢„æµ‹çš„num_charsä¸ªå­—ç¬¦    for t in range(num_chars + len(prefix) - 1):        X = torch.tensor([output[-1]], device=device).view(1, 1)        (Y, state) = model(X, state)  # å‰å‘è®¡ç®—ä¸éœ€è¦ä¼ å…¥æ¨¡å‹å‚æ•°        if t &lt; len(prefix) - 1:            output.append(char_to_idx[prefix[t + 1]])        else:            output.append(Y.argmax(dim=1).item())    return &#39;&#39;.join([idx_to_char[i] for i in output])</code></pre><p>ä½¿ç”¨æƒé‡ä¸ºéšæœºå€¼çš„æ¨¡å‹æ¥é¢„æµ‹ä¸€æ¬¡ã€‚</p><pre><code class="lang-python">model = RNNModel(rnn_layer, vocab_size).to(device)predict_rnn_pytorch(&#39;åˆ†å¼€&#39;, 10, model, vocab_size, device, idx_to_char, char_to_idx)</code></pre><pre><code>&#39;åˆ†å¼€è€å¿§å¿§è€é’©å¿§è€å¿§å¿§è€&#39;</code></pre><p>æ¥ä¸‹æ¥å®ç°<code>è®­ç»ƒå‡½æ•°</code>ï¼Œè¿™é‡Œåªä½¿ç”¨äº†ç›¸é‚»é‡‡æ ·ã€‚</p><pre><code class="lang-python">def train_and_predict_rnn_pytorch(model, num_hiddens, vocab_size, device,                                corpus_indices, idx_to_char, char_to_idx,                                num_epochs, num_steps, lr, clipping_theta,                                batch_size, pred_period, pred_len, prefixes):    loss = nn.CrossEntropyLoss()    optimizer = torch.optim.Adam(model.parameters(), lr=lr)    model.to(device)    for epoch in range(num_epochs):        l_sum, n, start = 0.0, 0, time.time()        data_iter = d2l.data_iter_consecutive(corpus_indices, batch_size, num_steps, device) # ç›¸é‚»é‡‡æ ·        state = None        for X, Y in data_iter:            if state is not None:                # ä½¿ç”¨detachå‡½æ•°ä»è®¡ç®—å›¾åˆ†ç¦»éšè—çŠ¶æ€                if isinstance (state, tuple): # LSTM, state:(h, c)                      state[0].detach_()                    state[1].detach_()                else:                     state.detach_()            (output, state) = model(X, state) # output.shape: (num_steps * batch_size, vocab_size)            y = torch.flatten(Y.T)            l = loss(output, y.long())            optimizer.zero_grad()            l.backward()            grad_clipping(model.parameters(), clipping_theta, device)            optimizer.step()            l_sum += l.item() * y.shape[0]            n += y.shape[0]        if (epoch + 1) % pred_period == 0:            print(&#39;epoch %d, perplexity %f, time %.2f sec&#39; % (                epoch + 1, math.exp(l_sum / n), time.time() - start))            for prefix in prefixes:                print(&#39; -&#39;, predict_rnn_pytorch(                    prefix, pred_len, model, vocab_size, device, idx_to_char,                    char_to_idx))</code></pre><p>è®­ç»ƒæ¨¡å‹ã€‚</p><pre><code class="lang-python">num_epochs, batch_size, lr, clipping_theta = 250, 32, 1e-3, 1e-2pred_period, pred_len, prefixes = 50, 50, [&#39;åˆ†å¼€&#39;, &#39;ä¸åˆ†å¼€&#39;]train_and_predict_rnn_pytorch(model, num_hiddens, vocab_size, device,                            corpus_indices, idx_to_char, char_to_idx,                            num_epochs, num_steps, lr, clipping_theta,                            batch_size, pred_period, pred_len, prefixes)</code></pre><pre><code>epoch 50, perplexity 10.107632, time 0.58 sec - åˆ†å¼€ æˆ‘ä¸äº†å£  ä¸€å®š æˆ‘çš„èµ°  æœ‰ä¸€é¢—å››é¢— è¿æˆçº¿èƒŒè‘—èƒŒé»˜é»˜è®¸ä¸‹å¿ƒæ„¿ åœ¨å°æ‘å¤–çš„æºªè¾¹æ²³å£ é»˜é»˜é»˜é»˜ æˆ‘ - ä¸åˆ†å¼€ æˆ‘æƒ³è¦ä½ çš„æ‰‹ æˆ‘æœ‰å¤šçƒ¦æ¼  è¯´ä½ ä½ ä½ ä¸æˆ‘  æƒ³è¦ä½ çš„è®©æˆ‘é¢çº¢çš„å¯çˆ±å¥³äºº ååçš„è®©æˆ‘ç–¯ç‹‚çš„å¯çˆ±å¥³äºº epoch 100, perplexity 1.234571, time 0.56 sec - åˆ†å¼€ æˆ‘é¢å¿ƒäº‹ çˆ±æ¥ä¸€ è“è‰²çœ¼ç›çš„å‡¯è¨ç³å…¬ä¸» ä¸“åƒ æœ‰ABè¡€å‹çš„å…¬è€é¼  æææƒšæƒš æ˜¯è°çš„è„šæ­¥ é“¶åˆ¶èŒ¶å£¶  - ä¸åˆ†å¼€ æˆ‘æ²¡æœ‰è¯ä¸æƒ³å°±å¤šçƒ¦æ¼å¤šéš¾ç†¬  è¯´ä½ å†çˆ¸ä¸ä¼šä¸ å¤šæƒ³å°±è¿™æ ·æ²¡æ‹…ä½  æˆ‘ç€ä½ çš„æƒ³æ´» è¯´æƒ³è¦ä½ çš„å¾®ç¬‘æ¯å¤©éƒ½epoch 150, perplexity 1.060467, time 0.57 sec - åˆ†å¼€ æˆ‘é¢å¿ƒäº‹ ä»æ¥å¼€ æˆ‘å¦ˆå¦ˆæ²¡æœ‰ä½  æˆ‘æœ‰å¤šçƒ¦æ¼  æ²¡æœ‰ä½ çƒ¦æˆ‘æœ‰å¤šçƒ¦æ¼å¤šéš¾ç†¬  ç©¿è¿‡äº‘å±‚ æˆ‘è¯•è‘—åŠªåŠ›å‘ä½  - ä¸åˆ†å¼€ äº†æ²¡æœ‰å¤šéš¾è¿‡ æ˜¯ä»€ä¹ˆ å¹²ä»€ä¹ˆ æˆ‘æƒ³æƒ³å’Œä½ è¯´ä½ å¬çš„è®©æˆ‘çš„å¬ä½ å°±åˆ° æˆ‘æƒ³ä½ è¯´ä½  æˆ‘ä¸äº†å£è®©å¥¹çŸ¥é“ å°±æ˜¯epoch 200, perplexity 1.030212, time 0.64 sec - åˆ†å¼€ æˆ‘é¢å¿ƒå¤– ç›¸æ¥å¼€  å®¶åº­ä½  ä½ æ‰“æˆ‘ä¸è¦ æƒ³  ç©¿ä»€ä¹ˆ ä½ å°±æƒ³ä¸€æˆ‘ ä½ è¿™æ ·æ‰“æˆ‘å¦ˆ ä½ è·Ÿä½  æ²¡æœ‰ æˆ‘ä¸ - ä¸åˆ†å¼€ äº†æˆ‘ä¸çŸ¥ä¸è¦ è¿™æ ·çš„ç”œèœœ è®©æˆ‘å¼€å§‹æƒ³ç›¸ å‘½å’Œä½ å½“è®¸åœ¨è¿™é‡Œåœ¨å¬é£å°±ä¸€ç‰‡ è¯´æœ‰ä¸€ä¸ªé£æ…¢çš„è€æ–‘é¸  å°åœ°å®‰epoch 250, perplexity 1.020210, time 0.60 sec - åˆ†å¼€ æˆ‘é¢å¿ƒä»ª ç›¸æ¥æ–¹ ä¸çŸ¥é“è¿™ æµæ°´ä¼Š å¦å ¡ å´åªæƒ³ä½ å’Œæ±‰å ¡ æˆ‘æƒ³è¦ä½ çš„å¾®ç¬‘æ¯å¤©éƒ½èƒ½çœ‹åˆ°  æˆ‘çŸ¥é“è¿™é‡Œ - ä¸åˆ†å¼€ äº†æˆ‘æ°´ä¹Ÿç¡æ´» æˆ‘æƒ³å¤šå—å°±èƒ½å†è¿™æ ·çš„èŠ‚å¥ è°éƒ½æ— å¯å¥ˆä½• æ²¡æœ‰ä½ ä»¥å æˆ‘çµé­‚å¤±æ§ é»‘äº‘åœ¨é™è½ æˆ‘è¢«å®ƒæ‹–</code></pre><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VkgpT.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> NLP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (å…­):è¯­è¨€æ¨¡å‹</title>
      <link href="/2020/02/19/dl-notes6-lang-model/"/>
      <url>/2020/02/19/dl-notes6-lang-model/</url>
      
        <content type="html"><![CDATA[<h1 id="è¯­è¨€æ¨¡å‹"><a href="#è¯­è¨€æ¨¡å‹" class="headerlink" title="è¯­è¨€æ¨¡å‹"></a>è¯­è¨€æ¨¡å‹</h1><p>ä¸€æ®µè‡ªç„¶è¯­è¨€æ–‡æœ¬å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç¦»æ•£æ—¶é—´åºåˆ—ï¼Œç»™å®šä¸€ä¸ªé•¿åº¦ä¸º$T$çš„è¯çš„åºåˆ—$w_1, w_2, \ldots, w_T$ï¼Œè¯­è¨€æ¨¡å‹çš„ç›®æ ‡å°±æ˜¯è¯„ä¼°è¯¥åºåˆ—æ˜¯å¦åˆç†ï¼Œå³è®¡ç®—è¯¥åºåˆ—çš„æ¦‚ç‡ï¼š</p><script type="math/tex; mode=display">P(w_1, w_2, \ldots, w_T).</script><p>æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»åŸºäºç»Ÿè®¡çš„è¯­è¨€æ¨¡å‹ï¼Œä¸»è¦æ˜¯$n$å…ƒè¯­æ³•ï¼ˆ$n$-gramï¼‰ã€‚åœ¨åç»­å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç»åŸºäºç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹ã€‚</p><h2 id="è¯­è¨€æ¨¡å‹-1"><a href="#è¯­è¨€æ¨¡å‹-1" class="headerlink" title="è¯­è¨€æ¨¡å‹"></a>è¯­è¨€æ¨¡å‹</h2><p>å‡è®¾åºåˆ—$w_1, w_2, \ldots, w_T$ä¸­çš„æ¯ä¸ªè¯æ˜¯ä¾æ¬¡ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬æœ‰</p><script type="math/tex; mode=display">\begin{aligned}P\left(w_{1}, w_{2}, \ldots, w_{T}\right) &=\prod_{t=1}^{T} P\left(w_{t} | w_{1}, \ldots, w_{t-1}\right) \\&=P\left(w_{1}\right) P\left(w_{2} | w_{1}\right) \cdots P\left(w_{T} | w_{1} w_{2} \cdots w_{T-1}\right)\end{aligned}</script><p>ä¾‹å¦‚ï¼Œä¸€æ®µå«æœ‰4ä¸ªè¯çš„æ–‡æœ¬åºåˆ—çš„æ¦‚ç‡</p><script type="math/tex; mode=display">P(w_1, w_2, w_3, w_4) =  P(w_1) P(w_2 \mid w_1) P(w_3 \mid w_1, w_2) P(w_4 \mid w_1, w_2, w_3).</script><p>è¯­è¨€æ¨¡å‹çš„å‚æ•°å°±æ˜¯è¯çš„æ¦‚ç‡ä»¥åŠç»™å®šå‰å‡ ä¸ªè¯æƒ…å†µä¸‹çš„æ¡ä»¶æ¦‚ç‡ã€‚è®¾è®­ç»ƒæ•°æ®é›†ä¸ºä¸€ä¸ªå¤§å‹æ–‡æœ¬è¯­æ–™åº“ï¼Œå¦‚ç»´åŸºç™¾ç§‘çš„æ‰€æœ‰æ¡ç›®ï¼Œè¯çš„æ¦‚ç‡å¯ä»¥é€šè¿‡è¯¥è¯åœ¨è®­ç»ƒæ•°æ®é›†ä¸­çš„ç›¸å¯¹è¯é¢‘æ¥è®¡ç®—ï¼Œä¾‹å¦‚ï¼Œ$w_1$çš„æ¦‚ç‡å¯ä»¥è®¡ç®—ä¸ºï¼š</p><script type="math/tex; mode=display">\hat P(w_1) = \frac{n(w_1)}{n}</script><p>å…¶ä¸­$n(w_1)$ä¸ºè¯­æ–™åº“ä¸­ä»¥$w_1$ä½œä¸ºç¬¬ä¸€ä¸ªè¯çš„æ–‡æœ¬çš„æ•°é‡ï¼Œ$n$ä¸ºè¯­æ–™åº“ä¸­æ–‡æœ¬çš„æ€»æ•°é‡ã€‚</p><p>ç±»ä¼¼çš„ï¼Œç»™å®š$w_1$æƒ…å†µä¸‹ï¼Œ$w_2$çš„æ¡ä»¶æ¦‚ç‡å¯ä»¥è®¡ç®—ä¸ºï¼š</p><script type="math/tex; mode=display">\hat P(w_2 \mid w_1) = \frac{n(w_1, w_2)}{n(w_1)}</script><p>å…¶ä¸­$n(w_1, w_2)$ä¸ºè¯­æ–™åº“ä¸­ä»¥$w_1$ä½œä¸ºç¬¬ä¸€ä¸ªè¯ï¼Œ$w_2$ä½œä¸ºç¬¬äºŒä¸ªè¯çš„æ–‡æœ¬çš„æ•°é‡ã€‚</p><h2 id="nå…ƒè¯­æ³•"><a href="#nå…ƒè¯­æ³•" class="headerlink" title="nå…ƒè¯­æ³•"></a>nå…ƒè¯­æ³•</h2><p>åºåˆ—é•¿åº¦å¢åŠ ï¼Œè®¡ç®—å’Œå­˜å‚¨å¤šä¸ªè¯å…±åŒå‡ºç°çš„æ¦‚ç‡çš„å¤æ‚åº¦ä¼šå‘ˆæŒ‡æ•°çº§å¢åŠ ã€‚$n$å…ƒè¯­æ³•é€šè¿‡é©¬å°”å¯å¤«å‡è®¾ç®€åŒ–æ¨¡å‹ï¼Œ<code>é©¬å°”ç§‘å¤«å‡è®¾</code>æ˜¯æŒ‡ä¸€ä¸ªè¯çš„å‡ºç°<code>åªä¸å‰é¢nä¸ªè¯ç›¸å…³</code>ï¼Œå³$n$é˜¶é©¬å°”å¯å¤«é“¾ï¼ˆMarkov chain of order $n$ï¼‰ï¼Œå¦‚æœ$n=1$ï¼Œé‚£ä¹ˆæœ‰$P(w_3 \mid w_1, w_2) = P(w_3 \mid w_2)$ã€‚åŸºäº$n-1$é˜¶é©¬å°”å¯å¤«é“¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯­è¨€æ¨¡å‹æ”¹å†™ä¸º</p><script type="math/tex; mode=display">P(w_1, w_2, \ldots, w_T) = \prod_{t=1}^T P(w_t \mid w_{t-(n-1)}, \ldots, w_{t-1}) .</script><p>ä»¥ä¸Šä¹Ÿå«<code>nå…ƒè¯­æ³•</code>ï¼ˆ$n$-gramsï¼‰ï¼Œå®ƒæ˜¯åŸºäº<code>n - 1é˜¶é©¬å°”å¯å¤«é“¾</code>çš„æ¦‚ç‡è¯­è¨€æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œå½“$n=2$æ—¶ï¼Œå«æœ‰4ä¸ªè¯çš„æ–‡æœ¬åºåˆ—çš„æ¦‚ç‡å°±å¯ä»¥æ”¹å†™ä¸ºï¼š</p><script type="math/tex; mode=display">\begin{aligned}P\left(w_{1}, w_{2}, w_{3}, w_{4}\right) &=P\left(w_{1}\right) P\left(w_{2} | w_{1}\right) P\left(w_{3} | w_{1}, w_{2}\right) P\left(w_{4} | w_{1}, w_{2}, w_{3}\right) \\&=P\left(w_{1}\right) P\left(w_{2} | w_{1}\right) P\left(w_{3} | w_{2}\right) P\left(w_{4} | w_{3}\right)\end{aligned}</script><p>å½“$n$åˆ†åˆ«ä¸º1ã€2å’Œ3æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åˆ†åˆ«ç§°ä½œä¸€å…ƒè¯­æ³•ï¼ˆunigramï¼‰ã€äºŒå…ƒè¯­æ³•ï¼ˆbigramï¼‰å’Œä¸‰å…ƒè¯­æ³•ï¼ˆtrigramï¼‰ã€‚ä¾‹å¦‚ï¼Œé•¿åº¦ä¸º4çš„åºåˆ—$w_1, w_2, w_3, w_4$åœ¨ä¸€å…ƒè¯­æ³•ã€äºŒå…ƒè¯­æ³•å’Œä¸‰å…ƒè¯­æ³•ä¸­çš„æ¦‚ç‡åˆ†åˆ«ä¸º</p><script type="math/tex; mode=display">\begin{aligned}P(w_1, w_2, w_3, w_4) &=  P(w_1) P(w_2) P(w_3) P(w_4) ,\\P(w_1, w_2, w_3, w_4) &=  P(w_1) P(w_2 \mid w_1) P(w_3 \mid w_2) P(w_4 \mid w_3) ,\\P(w_1, w_2, w_3, w_4) &=  P(w_1) P(w_2 \mid w_1) P(w_3 \mid w_1, w_2) P(w_4 \mid w_2, w_3) .\end{aligned}</script><p>å½“$n$è¾ƒå°æ—¶ï¼Œ$n$å…ƒè¯­æ³•å¾€å¾€å¹¶ä¸å‡†ç¡®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€å…ƒè¯­æ³•ä¸­ï¼Œç”±ä¸‰ä¸ªè¯ç»„æˆçš„å¥å­â€œä½ èµ°å…ˆâ€å’Œâ€œä½ å…ˆèµ°â€çš„æ¦‚ç‡æ˜¯ä¸€æ ·çš„ã€‚ç„¶è€Œï¼Œå½“$n$è¾ƒå¤§æ—¶ï¼Œ$n$å…ƒè¯­æ³•éœ€è¦è®¡ç®—å¹¶å­˜å‚¨å¤§é‡çš„è¯é¢‘å’Œå¤šè¯ç›¸é‚»é¢‘ç‡ã€‚</p><p>æ€è€ƒï¼š$n$å…ƒè¯­æ³•å¯èƒ½æœ‰å“ªäº›ç¼ºé™·ï¼Ÿ</p><ol><li>å‚æ•°ç©ºé—´è¿‡å¤§</li><li>æ•°æ®ç¨€ç–</li></ol><h1 id="è¯­è¨€æ¨¡å‹æ•°æ®é›†"><a href="#è¯­è¨€æ¨¡å‹æ•°æ®é›†" class="headerlink" title="è¯­è¨€æ¨¡å‹æ•°æ®é›†"></a>è¯­è¨€æ¨¡å‹æ•°æ®é›†</h1><h2 id="è¯»å–æ•°æ®é›†"><a href="#è¯»å–æ•°æ®é›†" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h2><pre><code class="lang-python">with open(&#39;/home/kesci/input/jaychou_lyrics4703/jaychou_lyrics.txt&#39;) as f:    corpus_chars = f.read()print(len(corpus_chars))print(corpus_chars[: 40])corpus_chars = corpus_chars.replace(&#39;\n&#39;, &#39; &#39;).replace(&#39;\r&#39;, &#39; &#39;)corpus_chars = corpus_chars[: 10000]</code></pre><pre><code>63282æƒ³è¦æœ‰ç›´å‡æœºæƒ³è¦å’Œä½ é£åˆ°å®‡å®™å»æƒ³è¦å’Œä½ èåŒ–åœ¨ä¸€èµ·èåŒ–åœ¨å®‡å®™é‡Œæˆ‘æ¯å¤©æ¯å¤©æ¯</code></pre><h2 id="å»ºç«‹å­—ç¬¦ç´¢å¼•"><a href="#å»ºç«‹å­—ç¬¦ç´¢å¼•" class="headerlink" title="å»ºç«‹å­—ç¬¦ç´¢å¼•"></a>å»ºç«‹å­—ç¬¦ç´¢å¼•</h2><pre><code class="lang-python">idx_to_char = list(set(corpus_chars)) # å»é‡ï¼Œå¾—åˆ°ç´¢å¼•åˆ°å­—ç¬¦çš„æ˜ å°„char_to_idx = {char: i for i, char in enumerate(idx_to_char)} # å­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„vocab_size = len(char_to_idx)print(vocab_size)corpus_indices = [char_to_idx[char] for char in corpus_chars]  # å°†æ¯ä¸ªå­—ç¬¦è½¬åŒ–ä¸ºç´¢å¼•ï¼Œå¾—åˆ°ä¸€ä¸ªç´¢å¼•çš„åºåˆ—sample = corpus_indices[: 20]print(&#39;chars:&#39;, &#39;&#39;.join([idx_to_char[idx] for idx in sample]))print(&#39;indices:&#39;, sample)</code></pre><pre><code>1027chars: æƒ³è¦æœ‰ç›´å‡æœº æƒ³è¦å’Œä½ é£åˆ°å®‡å®™å» æƒ³è¦å’Œindices: [153, 983, 692, 753, 789, 806, 502, 153, 983, 312, 582, 908, 664, 965, 211, 857, 502, 153, 983, 312]</code></pre><p>å®šä¹‰å‡½æ•°<code>load_data_jay_lyrics</code>ï¼Œåœ¨åç»­ç« èŠ‚ä¸­ç›´æ¥è°ƒç”¨ã€‚</p><pre><code class="lang-python">def load_data_jay_lyrics():    with open(&#39;/home/kesci/input/jaychou_lyrics4703/jaychou_lyrics.txt&#39;) as f:        corpus_chars = f.read()    corpus_chars = corpus_chars.replace(&#39;\n&#39;, &#39; &#39;).replace(&#39;\r&#39;, &#39; &#39;)    corpus_chars = corpus_chars[0:10000]    idx_to_char = list(set(corpus_chars))    char_to_idx = dict([(char, i) for i, char in enumerate(idx_to_char)])    vocab_size = len(char_to_idx)    corpus_indices = [char_to_idx[char] for char in corpus_chars]    return corpus_indices, char_to_idx, idx_to_char, vocab_size</code></pre><h2 id="æ—¶åºæ•°æ®çš„é‡‡æ ·"><a href="#æ—¶åºæ•°æ®çš„é‡‡æ ·" class="headerlink" title="æ—¶åºæ•°æ®çš„é‡‡æ ·"></a>æ—¶åºæ•°æ®çš„é‡‡æ ·</h2><p>åœ¨è®­ç»ƒä¸­æˆ‘ä»¬éœ€è¦æ¯æ¬¡éšæœºè¯»å–å°æ‰¹é‡æ ·æœ¬å’Œæ ‡ç­¾ã€‚ä¸ä¹‹å‰ç« èŠ‚çš„å®éªŒæ•°æ®ä¸åŒçš„æ˜¯ï¼Œæ—¶åºæ•°æ®çš„ä¸€ä¸ªæ ·æœ¬é€šå¸¸åŒ…å«è¿ç»­çš„å­—ç¬¦ã€‚å‡è®¾æ—¶é—´æ­¥æ•°ä¸º5ï¼Œæ ·æœ¬åºåˆ—ä¸º5ä¸ªå­—ç¬¦ï¼Œå³â€œæƒ³â€â€œè¦â€â€œæœ‰â€â€œç›´â€â€œå‡â€ã€‚è¯¥æ ·æœ¬çš„æ ‡ç­¾åºåˆ—ä¸ºè¿™äº›å­—ç¬¦åˆ†åˆ«åœ¨è®­ç»ƒé›†ä¸­çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå³â€œè¦â€â€œæœ‰â€â€œç›´â€â€œå‡â€â€œæœºâ€ï¼Œå³$X$=â€œæƒ³è¦æœ‰ç›´å‡â€ï¼Œ$Y$=â€œè¦æœ‰ç›´å‡æœºâ€ã€‚</p><p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘åºåˆ—â€œæƒ³è¦æœ‰ç›´å‡æœºï¼Œæƒ³è¦å’Œä½ é£åˆ°å®‡å®™å»â€ï¼Œå¦‚æœæ—¶é—´æ­¥æ•°ä¸º5ï¼Œæœ‰ä»¥ä¸‹å¯èƒ½çš„æ ·æœ¬å’Œæ ‡ç­¾ï¼š</p><ul><li>$X$ï¼šâ€œæƒ³è¦æœ‰ç›´å‡â€ï¼Œ$Y$ï¼šâ€œè¦æœ‰ç›´å‡æœºâ€</li><li>$X$ï¼šâ€œè¦æœ‰ç›´å‡æœºâ€ï¼Œ$Y$ï¼šâ€œæœ‰ç›´å‡æœºï¼Œâ€</li><li>$X$ï¼šâ€œæœ‰ç›´å‡æœºï¼Œâ€ï¼Œ$Y$ï¼šâ€œç›´å‡æœºï¼Œæƒ³â€</li><li>â€¦</li><li>$X$ï¼šâ€œè¦å’Œä½ é£åˆ°â€ï¼Œ$Y$ï¼šâ€œå’Œä½ é£åˆ°å®‡â€</li><li>$X$ï¼šâ€œå’Œä½ é£åˆ°å®‡â€ï¼Œ$Y$ï¼šâ€œä½ é£åˆ°å®‡å®™â€</li><li>$X$ï¼šâ€œä½ é£åˆ°å®‡å®™â€ï¼Œ$Y$ï¼šâ€œé£åˆ°å®‡å®™å»â€</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåºåˆ—çš„é•¿åº¦ä¸º$T$ï¼Œæ—¶é—´æ­¥æ•°ä¸º$n$ï¼Œé‚£ä¹ˆä¸€å…±æœ‰$T-n$ä¸ªåˆæ³•çš„æ ·æœ¬ï¼Œä½†æ˜¯è¿™äº›æ ·æœ¬æœ‰å¤§é‡çš„é‡åˆï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨æ›´åŠ é«˜æ•ˆçš„é‡‡æ ·æ–¹å¼ã€‚æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯¹æ—¶åºæ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œåˆ†åˆ«æ˜¯éšæœºé‡‡æ ·å’Œç›¸é‚»é‡‡æ ·ã€‚</p><h3 id="éšæœºé‡‡æ ·"><a href="#éšæœºé‡‡æ ·" class="headerlink" title="éšæœºé‡‡æ ·"></a>éšæœºé‡‡æ ·</h3><p>ä¸‹é¢çš„ä»£ç æ¯æ¬¡ä»æ•°æ®é‡Œéšæœºé‡‡æ ·ä¸€ä¸ªå°æ‰¹é‡ã€‚å…¶ä¸­æ‰¹é‡å¤§å°<code>batch_size</code>æ˜¯æ¯ä¸ªå°æ‰¹é‡çš„æ ·æœ¬æ•°ï¼Œ<code>num_steps</code>æ˜¯æ¯ä¸ªæ ·æœ¬æ‰€åŒ…å«çš„æ—¶é—´æ­¥æ•°ã€‚<br>åœ¨éšæœºé‡‡æ ·ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬æ˜¯åŸå§‹åºåˆ—ä¸Šä»»æ„æˆªå–çš„ä¸€æ®µåºåˆ—ï¼Œç›¸é‚»çš„ä¸¤ä¸ªéšæœºå°æ‰¹é‡åœ¨åŸå§‹åºåˆ—ä¸Šçš„ä½ç½®ä¸ä¸€å®šç›¸æ¯—é‚»ã€‚</p><pre><code class="lang-python">import torchimport randomdef data_iter_random(corpus_indices, batch_size, num_steps, device=None):    # å‡1æ˜¯å› ä¸ºå¯¹äºé•¿åº¦ä¸ºnçš„åºåˆ—ï¼ŒXæœ€å¤šåªæœ‰åŒ…å«å…¶ä¸­çš„å‰n - 1ä¸ªå­—ç¬¦    num_examples = (len(corpus_indices) - 1) // num_steps  # ä¸‹å–æ•´ï¼Œå¾—åˆ°ä¸é‡å æƒ…å†µä¸‹çš„æ ·æœ¬ä¸ªæ•°    example_indices = [i * num_steps for i in range(num_examples)]  # æ¯ä¸ªæ ·æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨corpus_indicesä¸­çš„ä¸‹æ ‡    random.shuffle(example_indices)    def _data(i):        # è¿”å›ä»iå¼€å§‹çš„é•¿ä¸ºnum_stepsçš„åºåˆ—        return corpus_indices[i: i + num_steps]    if device is None:        device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)    for i in range(0, num_examples, batch_size):        # æ¯æ¬¡é€‰å‡ºbatch_sizeä¸ªéšæœºæ ·æœ¬        batch_indices = example_indices[i: i + batch_size]  # å½“å‰batchçš„å„ä¸ªæ ·æœ¬çš„é¦–å­—ç¬¦çš„ä¸‹æ ‡        X = [_data(j) for j in batch_indices]        Y = [_data(j + 1) for j in batch_indices]        yield torch.tensor(X, device=device), torch.tensor(Y, device=device)</code></pre><p>æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è¾“å…¥ä»0åˆ°29çš„è¿ç»­æ•´æ•°ä½œä¸ºä¸€ä¸ªäººå·¥åºåˆ—ï¼Œè®¾æ‰¹é‡å¤§å°å’Œæ—¶é—´æ­¥æ•°åˆ†åˆ«ä¸º2å’Œ6ï¼Œæ‰“å°éšæœºé‡‡æ ·æ¯æ¬¡è¯»å–çš„å°æ‰¹é‡æ ·æœ¬çš„è¾“å…¥<code>X</code>å’Œæ ‡ç­¾<code>Y</code>ã€‚</p><pre><code class="lang-python">my_seq = list(range(30))for X, Y in data_iter_random(my_seq, batch_size=2, num_steps=6):    #batch_size ä¸º 2ï¼ˆæ¯ä¸ª batch æœ‰ä¸¤è¡Œ), num_steps æ—¶é—´æ­¥æ•°ä¸º 6 (æ¯è¡Œæœ‰ 5 ä¸ªå…ƒç´ ) batch_num ä¸º 2ï¼Œä¸€å…±ä¸¤ä¸ª batch    print(&#39;X: &#39;, X, &#39;\nY:&#39;, Y, &#39;\n&#39;)</code></pre><pre><code>X:  tensor([[18, 19, 20, 21, 22, 23],        [12, 13, 14, 15, 16, 17]]) Y: tensor([[19, 20, 21, 22, 23, 24],        [13, 14, 15, 16, 17, 18]]) X:  tensor([[ 6,  7,  8,  9, 10, 11],        [ 0,  1,  2,  3,  4,  5]]) Y: tensor([[ 7,  8,  9, 10, 11, 12],        [ 1,  2,  3,  4,  5,  6]]) </code></pre><h3 id="ç›¸é‚»é‡‡æ ·"><a href="#ç›¸é‚»é‡‡æ ·" class="headerlink" title="ç›¸é‚»é‡‡æ ·"></a>ç›¸é‚»é‡‡æ ·</h3><p>åœ¨ç›¸é‚»é‡‡æ ·ä¸­ï¼Œç›¸é‚»çš„ä¸¤ä¸ªéšæœºå°æ‰¹é‡åœ¨åŸå§‹åºåˆ—ä¸Šçš„ä½ç½®ç›¸æ¯—é‚».ï¼ˆäº¤æ›¿å‡ºç°ï¼‰<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VSeKI.png" alt=""></p><pre><code class="lang-python">def data_iter_consecutive(corpus_indices, batch_size, num_steps, device=None):    # bach_size ä¸º n, æ•°æ®å°±ä¼šè¢«æ‹†æˆ n å—    if device is None:        device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)    corpus_len = len(corpus_indices) // batch_size * batch_size  # ä¿ç•™ä¸‹æ¥çš„åºåˆ—çš„é•¿åº¦    corpus_indices = corpus_indices[: corpus_len]  # ä»…ä¿ç•™å‰corpus_lenä¸ªå­—ç¬¦ ä¿è¯å¯ä»¥æ•´é™¤æ‰¹é‡å¤§å°    indices = torch.tensor(corpus_indices, device=device)    indices = indices.view(batch_size, -1)  # resizeæˆ(batch_size, )    batch_num = (indices.shape[1] - 1) // num_steps   # -1 æ˜¯å› ä¸ºä¸èƒ½åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå› ä¸ºæœ€åä¸€ä¸ªå°±æ²¡æœ‰æ ‡ç­¾äº†    for i in range(batch_num):  # æ¯æ¬¡æ„å»ºä¸€ä¸ªæ‰¹é‡        i = i * num_steps        X = indices[:, i: i + num_steps]        Y = indices[:, i + 1: i + num_steps + 1]        yield X, Y</code></pre><p>åŒæ ·çš„è®¾ç½®ä¸‹ï¼Œæ‰“å°ç›¸é‚»é‡‡æ ·æ¯æ¬¡è¯»å–çš„å°æ‰¹é‡æ ·æœ¬çš„è¾“å…¥<code>X</code>å’Œæ ‡ç­¾<code>Y</code>ã€‚ç›¸é‚»çš„ä¸¤ä¸ªéšæœºå°æ‰¹é‡åœ¨åŸå§‹åºåˆ—ä¸Šçš„ä½ç½®ç›¸æ¯—é‚»ã€‚<br>X çš„æ ‡ç­¾ Y å°±æ˜¯å®ƒçš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><pre><code class="lang-python">for X, Y in data_iter_consecutive(my_seq, batch_size=2, num_steps=6):    print(&#39;X: &#39;, X, &#39;\nY:&#39;, Y, &#39;\n&#39;)my_seq = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]for X, Y in data_iter_consecutive(my_seq, batch_size=2, num_steps=2):    print(&#39;X: &#39;, X, &#39;\nY:&#39;, Y, &#39;\n&#39;)</code></pre><pre><code>X:  tensor([[ 0,  1,  2,  3,  4,  5],        [15, 16, 17, 18, 19, 20]]) Y: tensor([[ 1,  2,  3,  4,  5,  6],        [16, 17, 18, 19, 20, 21]]) X:  tensor([[ 6,  7,  8,  9, 10, 11],        [21, 22, 23, 24, 25, 26]]) Y: tensor([[ 7,  8,  9, 10, 11, 12],        [22, 23, 24, 25, 26, 27]]) X:  tensor([[0, 1],        [5, 6]]) Y: tensor([[1, 2],        [6, 7]]) X:  tensor([[2, 3],        [7, 8]]) Y: tensor([[3, 4],        [8, 9]]) </code></pre><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/RlvJN7BnbPGfp2Y.png" alt="è¯­è¨€æ¨¡å‹"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> NLP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (äº”):æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸</title>
      <link href="/2020/02/19/dl-notes5-grad/"/>
      <url>/2020/02/19/dl-notes5-grad/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸ä»¥åŠKaggleæˆ¿ä»·é¢„æµ‹"><a href="#æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸ä»¥åŠKaggleæˆ¿ä»·é¢„æµ‹" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸ä»¥åŠKaggleæˆ¿ä»·é¢„æµ‹"></a>æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸ä»¥åŠKaggleæˆ¿ä»·é¢„æµ‹</h1><ol><li>æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</li><li>è€ƒè™‘åˆ°ç¯å¢ƒå› ç´ çš„å…¶ä»–é—®é¢˜</li><li>Kaggleæˆ¿ä»·é¢„æµ‹</li></ol><h1 id="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"><a href="#æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"></a>æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</h1><p>æ·±åº¦æ¨¡å‹æœ‰å…³æ•°å€¼ç¨³å®šæ€§çš„å…¸å‹é—®é¢˜æ˜¯æ¶ˆå¤±ï¼ˆvanishingï¼‰å’Œçˆ†ç‚¸ï¼ˆexplosionï¼‰ã€‚</p><p><strong>å½“ç¥ç»ç½‘ç»œçš„å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¨¡å‹çš„æ•°å€¼ç¨³å®šæ€§å®¹æ˜“å˜å·®ã€‚</strong></p><p>å‡è®¾ä¸€ä¸ªå±‚æ•°ä¸º$L$çš„å¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬$l$å±‚$\boldsymbol{H}^{(l)}$çš„æƒé‡å‚æ•°ä¸º$\boldsymbol{W}^{(l)}$ï¼Œè¾“å‡ºå±‚$\boldsymbol{H}^{(L)}$çš„æƒé‡å‚æ•°ä¸º$\boldsymbol{W}^{(L)}$ã€‚ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œä¸è€ƒè™‘åå·®å‚æ•°ï¼Œä¸”è®¾æ‰€æœ‰éšè—å±‚çš„æ¿€æ´»å‡½æ•°ä¸ºæ’ç­‰æ˜ å°„ï¼ˆidentity mappingï¼‰$\phi(x) = x$ã€‚ç»™å®šè¾“å…¥$\boldsymbol{X}$ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬$l$å±‚çš„è¾“å‡º$\boldsymbol{H}^{(l)} = \boldsymbol{X} \boldsymbol{W}^{(1)} \boldsymbol{W}^{(2)} \ldots \boldsymbol{W}^{(l)}$ã€‚æ­¤æ—¶ï¼Œå¦‚æœå±‚æ•°$l$è¾ƒå¤§ï¼Œ$\boldsymbol{H}^{(l)}$çš„è®¡ç®—å¯èƒ½ä¼šå‡ºç°è¡°å‡æˆ–çˆ†ç‚¸ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è¾“å…¥å’Œæ‰€æœ‰å±‚çš„æƒé‡å‚æ•°éƒ½æ˜¯æ ‡é‡ï¼Œå¦‚æƒé‡å‚æ•°ä¸º0.2å’Œ5ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬30å±‚è¾“å‡ºä¸ºè¾“å…¥$\boldsymbol{X}$åˆ†åˆ«ä¸$0.2^{30} \approx 1 \times 10^{-21}$ï¼ˆæ¶ˆå¤±ï¼‰å’Œ$5^{30} \approx 9 \times 10^{20}$ï¼ˆçˆ†ç‚¸ï¼‰çš„ä¹˜ç§¯ã€‚å½“å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¢¯åº¦çš„è®¡ç®—ä¹Ÿå®¹æ˜“å‡ºç°æ¶ˆå¤±æˆ–çˆ†ç‚¸ã€‚</p><h1 id="éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°</h1><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œé€šå¸¸éœ€è¦éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è§£é‡Šè¿™æ ·åšçš„åŸå› ã€‚</p><p>å›é¡¾å¤šå±‚æ„ŸçŸ¥æœºä¸€èŠ‚æè¿°çš„å¤šå±‚æ„ŸçŸ¥æœºã€‚ä¸ºäº†æ–¹ä¾¿è§£é‡Šï¼Œå‡è®¾è¾“å‡ºå±‚åªä¿ç•™ä¸€ä¸ªè¾“å‡ºå•å…ƒ$o_1$ï¼ˆåˆ å»$o_2$å’Œ$o_3$ä»¥åŠæŒ‡å‘å®ƒä»¬çš„ç®­å¤´ï¼‰ï¼Œä¸”éšè—å±‚ä½¿ç”¨ç›¸åŒçš„æ¿€æ´»å‡½æ•°ã€‚å¦‚æœå°†æ¯ä¸ªéšè—å•å…ƒçš„å‚æ•°éƒ½åˆå§‹åŒ–ä¸ºç›¸ç­‰çš„å€¼ï¼Œé‚£ä¹ˆåœ¨æ­£å‘ä¼ æ’­æ—¶æ¯ä¸ªéšè—å•å…ƒå°†æ ¹æ®ç›¸åŒçš„è¾“å…¥è®¡ç®—å‡ºç›¸åŒçš„å€¼ï¼Œå¹¶ä¼ é€’è‡³è¾“å‡ºå±‚ã€‚åœ¨åå‘ä¼ æ’­ä¸­ï¼Œæ¯ä¸ªéšè—å•å…ƒçš„å‚æ•°æ¢¯åº¦å€¼ç›¸ç­‰ã€‚å› æ­¤ï¼Œè¿™äº›å‚æ•°åœ¨ä½¿ç”¨åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–ç®—æ³•è¿­ä»£åå€¼ä¾ç„¶ç›¸ç­‰ã€‚ä¹‹åçš„è¿­ä»£ä¹Ÿæ˜¯å¦‚æ­¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºéšè—å•å…ƒæœ‰å¤šå°‘ï¼Œéšè—å±‚æœ¬è´¨ä¸Šåªæœ‰1ä¸ªéšè—å•å…ƒåœ¨å‘æŒ¥ä½œç”¨ã€‚å› æ­¤ï¼Œæ­£å¦‚åœ¨å‰é¢çš„å®éªŒä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬é€šå¸¸å°†ç¥ç»ç½‘ç»œçš„æ¨¡å‹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯æƒé‡å‚æ•°ï¼Œè¿›è¡Œéšæœºåˆå§‹åŒ–ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/Yvn1aRXFSdqm5ED.png" alt=""></p><h3 id="PyTorchçš„é»˜è®¤éšæœºåˆå§‹åŒ–"><a href="#PyTorchçš„é»˜è®¤éšæœºåˆå§‹åŒ–" class="headerlink" title="PyTorchçš„é»˜è®¤éšæœºåˆå§‹åŒ–"></a>PyTorchçš„é»˜è®¤éšæœºåˆå§‹åŒ–</h3><p>éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚åœ¨çº¿æ€§å›å½’çš„ç®€æ´å®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>torch.nn.init.normal_()</code>ä½¿æ¨¡å‹<code>net</code>çš„æƒé‡å‚æ•°é‡‡ç”¨æ­£æ€åˆ†å¸ƒçš„éšæœºåˆå§‹åŒ–æ–¹å¼ã€‚ä¸è¿‡ï¼ŒPyTorchä¸­<code>nn.Module</code>çš„æ¨¡å—å‚æ•°éƒ½é‡‡å–äº†è¾ƒä¸ºåˆç†çš„åˆå§‹åŒ–ç­–ç•¥ï¼ˆä¸åŒç±»å‹çš„layerå…·ä½“é‡‡æ ·çš„å“ªä¸€ç§åˆå§‹åŒ–æ–¹æ³•çš„å¯å‚è€ƒ<a href="https://github.com/pytorch/pytorch/tree/master/torch/nn/modules" target="_blank" rel="noopener">æºä»£ç </a>ï¼‰ï¼Œå› æ­¤ä¸€èˆ¬ä¸ç”¨æˆ‘ä»¬è€ƒè™‘ã€‚</p><h3 id="Xavieréšæœºåˆå§‹åŒ–"><a href="#Xavieréšæœºåˆå§‹åŒ–" class="headerlink" title="Xavieréšæœºåˆå§‹åŒ–"></a>Xavieréšæœºåˆå§‹åŒ–</h3><p>è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„éšæœºåˆå§‹åŒ–æ–¹æ³•å«ä½œXavieréšæœºåˆå§‹åŒ–ã€‚<br>å‡è®¾æŸå…¨è¿æ¥å±‚çš„è¾“å…¥ä¸ªæ•°ä¸º$a$ï¼Œè¾“å‡ºä¸ªæ•°ä¸º$b$ï¼ŒXavieréšæœºåˆå§‹åŒ–å°†ä½¿è¯¥å±‚ä¸­æƒé‡å‚æ•°çš„æ¯ä¸ªå…ƒç´ éƒ½éšæœºé‡‡æ ·äºå‡åŒ€åˆ†å¸ƒ</p><script type="math/tex; mode=display">U\left(-\sqrt{\frac{6}{a+b}}, \sqrt{\frac{6}{a+b}}\right).</script><p>å®ƒçš„è®¾è®¡ä¸»è¦è€ƒè™‘åˆ°ï¼Œæ¨¡å‹å‚æ•°åˆå§‹åŒ–åï¼Œæ¯å±‚è¾“å‡ºçš„æ–¹å·®ä¸è¯¥å—è¯¥å±‚è¾“å…¥ä¸ªæ•°å½±å“ï¼Œä¸”æ¯å±‚æ¢¯åº¦çš„æ–¹å·®ä¹Ÿä¸è¯¥å—è¯¥å±‚è¾“å‡ºä¸ªæ•°å½±å“ã€‚</p><h1 id="è€ƒè™‘ç¯å¢ƒå› ç´ "><a href="#è€ƒè™‘ç¯å¢ƒå› ç´ " class="headerlink" title="è€ƒè™‘ç¯å¢ƒå› ç´ "></a>è€ƒè™‘ç¯å¢ƒå› ç´ </h1><h2 id="åå˜é‡åç§»"><a href="#åå˜é‡åç§»" class="headerlink" title="åå˜é‡åç§»"></a>åå˜é‡åç§»</h2><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼Œè™½ç„¶è¾“å…¥çš„åˆ†å¸ƒå¯èƒ½éšæ—¶é—´è€Œæ”¹å˜ï¼Œä½†æ˜¯æ ‡è®°å‡½æ•°ï¼Œå³æ¡ä»¶åˆ†å¸ƒPï¼ˆyâˆ£xï¼‰ä¸ä¼šæ”¹å˜ã€‚è™½ç„¶è¿™ä¸ªé—®é¢˜å®¹æ˜“ç†è§£ï¼Œä½†åœ¨å®è·µä¸­ä¹Ÿå®¹æ˜“å¿½è§†ã€‚</p><p>æƒ³æƒ³åŒºåˆ†çŒ«å’Œç‹—çš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ä½¿ç”¨çš„æ˜¯çŒ«å’Œç‹—çš„çœŸå®çš„ç…§ç‰‡ï¼Œä½†æ˜¯åœ¨æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬è¢«è¦æ±‚å¯¹çŒ«å’Œç‹—çš„å¡é€šå›¾ç‰‡è¿›è¡Œåˆ†ç±»ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VWGV0.png" alt="åå˜é‡åç§»"></p><p>æ˜¾ç„¶ï¼Œè¿™ä¸å¤ªå¯èƒ½å¥æ•ˆã€‚è®­ç»ƒé›†ç”±ç…§ç‰‡ç»„æˆï¼Œè€Œæµ‹è¯•é›†åªåŒ…å«å¡é€šã€‚åœ¨ä¸€ä¸ªçœ‹èµ·æ¥ä¸æµ‹è¯•é›†æœ‰ç€æœ¬è´¨ä¸åŒçš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œè€Œä¸è€ƒè™‘å¦‚ä½•é€‚åº”æ–°çš„æƒ…å†µï¼Œè¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é™·é˜±ã€‚</p><p>ç»Ÿè®¡å­¦å®¶ç§°è¿™ç§åå˜é‡å˜åŒ–æ˜¯å› ä¸ºé—®é¢˜çš„æ ¹æºåœ¨äºç‰¹å¾åˆ†å¸ƒçš„å˜åŒ–ï¼ˆå³åå˜é‡çš„å˜åŒ–ï¼‰ã€‚æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¯´Pï¼ˆxï¼‰æ”¹å˜äº†ï¼Œä½†Pï¼ˆyâˆ£xï¼‰ä¿æŒä¸å˜ã€‚å°½ç®¡å®ƒçš„æœ‰ç”¨æ€§å¹¶ä¸å±€é™äºæ­¤ï¼Œå½“æˆ‘ä»¬è®¤ä¸ºxå¯¼è‡´yæ—¶ï¼Œåå˜é‡ç§»ä½é€šå¸¸æ˜¯æ­£ç¡®çš„å‡è®¾ã€‚</p><h2 id="æ ‡ç­¾åç§»"><a href="#æ ‡ç­¾åç§»" class="headerlink" title="æ ‡ç­¾åç§»"></a>æ ‡ç­¾åç§»</h2><p>å½“æˆ‘ä»¬è®¤ä¸ºå¯¼è‡´åç§»çš„æ˜¯æ ‡ç­¾Pï¼ˆyï¼‰ä¸Šçš„è¾¹ç¼˜åˆ†å¸ƒçš„å˜åŒ–ï¼Œä½†ç±»æ¡ä»¶åˆ†å¸ƒæ˜¯ä¸å˜çš„Pï¼ˆxâˆ£yï¼‰æ—¶ï¼Œå°±ä¼šå‡ºç°ç›¸åçš„é—®é¢˜ã€‚å½“æˆ‘ä»¬è®¤ä¸ºyå¯¼è‡´xæ—¶ï¼Œæ ‡ç­¾åç§»æ˜¯ä¸€ä¸ªåˆç†çš„å‡è®¾ã€‚ä¾‹å¦‚ï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›æ ¹æ®å…¶è¡¨ç°æ¥é¢„æµ‹è¯Šæ–­ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸ºè¯Šæ–­å¼•èµ·çš„è¡¨ç°ï¼Œå³ç–¾ç—…å¼•èµ·çš„ç—‡çŠ¶ã€‚æœ‰æ—¶æ ‡ç­¾åç§»å’Œåå˜é‡ç§»ä½å‡è®¾å¯ä»¥åŒæ—¶æˆç«‹ã€‚ä¾‹å¦‚ï¼Œå½“çœŸæ­£çš„æ ‡ç­¾å‡½æ•°æ˜¯ç¡®å®šçš„å’Œä¸å˜çš„ï¼Œé‚£ä¹ˆåå˜é‡åç§»å°†å§‹ç»ˆä¿æŒï¼ŒåŒ…æ‹¬å¦‚æœæ ‡ç­¾åç§»ä¹Ÿä¿æŒã€‚æœ‰è¶£çš„æ˜¯ï¼Œå½“æˆ‘ä»¬æœŸæœ›æ ‡ç­¾åç§»å’Œåå˜é‡åç§»ä¿æŒæ—¶ï¼Œä½¿ç”¨æ¥è‡ªæ ‡ç­¾åç§»å‡è®¾çš„æ–¹æ³•é€šå¸¸æ˜¯æœ‰åˆ©çš„ã€‚è¿™æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•å€¾å‘äºæ“ä½œçœ‹èµ·æ¥åƒæ ‡ç­¾çš„å¯¹è±¡ï¼Œè¿™ï¼ˆåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼‰ä¸å¤„ç†çœ‹èµ·æ¥åƒè¾“å…¥çš„å¯¹è±¡ï¼ˆåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼‰ç›¸æ¯”ç›¸å¯¹å®¹æ˜“ä¸€äº›ã€‚</p><p>ç—…å› ï¼ˆè¦é¢„æµ‹çš„è¯Šæ–­ç»“æœï¼‰å¯¼è‡´ ç—‡çŠ¶ï¼ˆè§‚å¯Ÿåˆ°çš„ç»“æœï¼‰ã€‚  </p><p>è®­ç»ƒæ•°æ®é›†ï¼Œæ•°æ®å¾ˆå°‘åªåŒ…å«æµæ„Ÿp(y)çš„æ ·æœ¬ã€‚  </p><p>è€Œæµ‹è¯•æ•°æ®é›†æœ‰æµæ„Ÿp(y)å’Œæµæ„Ÿq(y)ï¼Œå…¶ä¸­ä¸å˜çš„æ˜¯æµæ„Ÿç—‡çŠ¶p(x|y)ã€‚</p><h2 id="æ¦‚å¿µåç§»"><a href="#æ¦‚å¿µåç§»" class="headerlink" title="æ¦‚å¿µåç§»"></a>æ¦‚å¿µåç§»</h2><p>å¦ä¸€ä¸ªç›¸å…³çš„é—®é¢˜å‡ºç°åœ¨æ¦‚å¿µè½¬æ¢ä¸­ï¼Œå³æ ‡ç­¾æœ¬èº«çš„å®šä¹‰å‘ç”Ÿå˜åŒ–çš„æƒ…å†µã€‚è¿™å¬èµ·æ¥å¾ˆå¥‡æ€ªï¼Œæ¯•ç«ŸçŒ«å°±æ˜¯çŒ«ã€‚çš„ç¡®ï¼ŒçŒ«çš„å®šä¹‰å¯èƒ½ä¸ä¼šæ”¹å˜ï¼Œä½†æˆ‘ä»¬èƒ½ä¸èƒ½å¯¹è½¯é¥®æ–™ä¹Ÿè¿™ä¹ˆè¯´å‘¢ï¼Ÿäº‹å®è¯æ˜ï¼Œå¦‚æœæˆ‘ä»¬å‘¨æ¸¸ç¾å›½ï¼ŒæŒ‰åœ°ç†ä½ç½®è½¬ç§»æ•°æ®æ¥æºï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå³ä½¿æ˜¯å¦‚å›¾æ‰€ç¤ºçš„è¿™ä¸ªç®€å•æœ¯è¯­çš„å®šä¹‰ä¹Ÿä¼šå‘ç”Ÿç›¸å½“å¤§çš„æ¦‚å¿µè½¬å˜ã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/XZM92uq4EvNQmYT.png" alt="ç¾å›½è½¯é¥®æ–™åç§°çš„æ¦‚å¿µè½¬å˜"></p><p>å¦‚æœæˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªæœºå™¨ç¿»è¯‘ç³»ç»Ÿï¼Œåˆ†å¸ƒPï¼ˆyâˆ£xï¼‰å¯èƒ½å› æˆ‘ä»¬çš„ä½ç½®è€Œå¼‚ã€‚è¿™ä¸ªé—®é¢˜å¾ˆéš¾å‘ç°ã€‚å¦ä¸€ä¸ªå¯å–ä¹‹å¤„æ˜¯Pï¼ˆyâˆ£xï¼‰é€šå¸¸åªæ˜¯é€æ¸å˜åŒ–ã€‚</p><h1 id="Kaggle-æˆ¿ä»·é¢„æµ‹å®æˆ˜"><a href="#Kaggle-æˆ¿ä»·é¢„æµ‹å®æˆ˜" class="headerlink" title="Kaggle æˆ¿ä»·é¢„æµ‹å®æˆ˜"></a>Kaggle æˆ¿ä»·é¢„æµ‹å®æˆ˜</h1><p>ä½œä¸ºæ·±åº¦å­¦ä¹ åŸºç¡€ç¯‡ç« çš„æ€»ç»“ï¼Œæˆ‘ä»¬å°†å¯¹æœ¬ç« å†…å®¹å­¦ä»¥è‡´ç”¨ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬åŠ¨æ‰‹å®æˆ˜ä¸€ä¸ªKaggleæ¯”èµ›ï¼šæˆ¿ä»·é¢„æµ‹ã€‚æœ¬èŠ‚å°†æä¾›æœªç»è°ƒä¼˜çš„æ•°æ®çš„é¢„å¤„ç†ã€æ¨¡å‹çš„è®¾è®¡å’Œè¶…å‚æ•°çš„é€‰æ‹©ã€‚æˆ‘ä»¬å¸Œæœ›è¯»è€…é€šè¿‡åŠ¨æ‰‹æ“ä½œã€ä»”ç»†è§‚å¯Ÿå®éªŒç°è±¡ã€è®¤çœŸåˆ†æå®éªŒç»“æœå¹¶ä¸æ–­è°ƒæ•´æ–¹æ³•ï¼Œå¾—åˆ°ä»¤è‡ªå·±æ»¡æ„çš„ç»“æœã€‚</p><pre><code class="lang-python">%matplotlib inlineimport torchimport torch.nn as nnimport numpy as npimport pandas as pdimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)torch.set_default_tensor_type(torch.FloatTensor)</code></pre><pre><code>1.3.0</code></pre><h2 id="è·å–å’Œè¯»å–æ•°æ®é›†"><a href="#è·å–å’Œè¯»å–æ•°æ®é›†" class="headerlink" title="è·å–å’Œè¯»å–æ•°æ®é›†"></a>è·å–å’Œè¯»å–æ•°æ®é›†</h2><p>æ¯”èµ›æ•°æ®åˆ†ä¸ºè®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ã€‚ä¸¤ä¸ªæ•°æ®é›†éƒ½åŒ…æ‹¬æ¯æ ‹æˆ¿å­çš„ç‰¹å¾ï¼Œå¦‚è¡—é“ç±»å‹ã€å»ºé€ å¹´ä»½ã€æˆ¿é¡¶ç±»å‹ã€åœ°ä¸‹å®¤çŠ¶å†µç­‰ç‰¹å¾å€¼ã€‚è¿™äº›ç‰¹å¾å€¼æœ‰è¿ç»­çš„æ•°å­—ã€ç¦»æ•£çš„æ ‡ç­¾ç”šè‡³æ˜¯ç¼ºå¤±å€¼â€œnaâ€ã€‚åªæœ‰è®­ç»ƒæ•°æ®é›†åŒ…æ‹¬äº†æ¯æ ‹æˆ¿å­çš„ä»·æ ¼ï¼Œä¹Ÿå°±æ˜¯æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥è®¿é—®æ¯”èµ›ç½‘é¡µï¼Œç‚¹å‡»â€œDataâ€æ ‡ç­¾ï¼Œå¹¶ä¸‹è½½è¿™äº›æ•°æ®é›†ã€‚</p><p>æˆ‘ä»¬å°†é€šè¿‡<code>pandas</code>åº“è¯»å…¥å¹¶å¤„ç†æ•°æ®ã€‚åœ¨å¯¼å…¥æœ¬èŠ‚éœ€è¦çš„åŒ…å‰è¯·ç¡®ä¿å·²å®‰è£…<code>pandas</code>åº“ã€‚<br>å‡è®¾è§£å‹åçš„æ•°æ®ä½äº<code>/home/kesci/input/houseprices2807/</code>ç›®å½•ï¼Œå®ƒåŒ…æ‹¬ä¸¤ä¸ªcsvæ–‡ä»¶ã€‚ä¸‹é¢ä½¿ç”¨<code>pandas</code>è¯»å–è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><pre><code class="lang-python">test_data = pd.read_csv(&quot;/home/kesci/input/houseprices2807/house-prices-advanced-regression-techniques/test.csv&quot;)train_data = pd.read_csv(&quot;/home/kesci/input/houseprices2807/house-prices-advanced-regression-techniques/train.csv&quot;)</code></pre><p>è®­ç»ƒæ•°æ®é›†åŒ…æ‹¬1460ä¸ªæ ·æœ¬ã€80ä¸ªç‰¹å¾å’Œ1ä¸ªæ ‡ç­¾ã€‚</p><pre><code class="lang-python">train_data.shape</code></pre><pre><code>(1460, 81)</code></pre><p>æµ‹è¯•æ•°æ®é›†åŒ…æ‹¬1459ä¸ªæ ·æœ¬å’Œ80ä¸ªç‰¹å¾ã€‚æˆ‘ä»¬éœ€è¦å°†æµ‹è¯•æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬çš„æ ‡ç­¾é¢„æµ‹å‡ºæ¥ã€‚</p><pre><code class="lang-python">test_data.shape</code></pre><pre><code>(1459, 80)</code></pre><p>è®©æˆ‘ä»¬æ¥æŸ¥çœ‹å‰4ä¸ªæ ·æœ¬çš„å‰4ä¸ªç‰¹å¾ã€å2ä¸ªç‰¹å¾å’Œæ ‡ç­¾ï¼ˆSalePriceï¼‰ï¼š</p><pre><code class="lang-python">train_data.iloc[0:4, [0, 1, 2, 3, -3, -2, -1]]</code></pre><div><style scoped>    .dataframe tbody tr th:only-of-type {        vertical-align: middle;    }    .dataframe tbody tr th {        vertical-align: top;    }    .dataframe thead th {        text-align: right;    }</style><table border="1" class="dataframe">  <thead>    <tr style="text-align: right;">      <th></th>      <th>Id</th>      <th>MSSubClass</th>      <th>MSZoning</th>      <th>LotFrontage</th>      <th>SaleType</th>      <th>SaleCondition</th>      <th>SalePrice</th>    </tr>  </thead>  <tbody>    <tr>      <td>0</td>      <td>1</td>      <td>60</td>      <td>RL</td>      <td>65.0</td>      <td>WD</td>      <td>Normal</td>      <td>208500</td>    </tr>    <tr>      <td>1</td>      <td>2</td>      <td>20</td>      <td>RL</td>      <td>80.0</td>      <td>WD</td>      <td>Normal</td>      <td>181500</td>    </tr>    <tr>      <td>2</td>      <td>3</td>      <td>60</td>      <td>RL</td>      <td>68.0</td>      <td>WD</td>      <td>Normal</td>      <td>223500</td>    </tr>    <tr>      <td>3</td>      <td>4</td>      <td>70</td>      <td>RL</td>      <td>60.0</td>      <td>WD</td>      <td>Abnorml</td>      <td>140000</td>    </tr>  </tbody></table></div><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªç‰¹å¾æ˜¯Idï¼Œå®ƒèƒ½å¸®åŠ©æ¨¡å‹è®°ä½æ¯ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œä½†éš¾ä»¥æ¨å¹¿åˆ°æµ‹è¯•æ ·æœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä½¿ç”¨å®ƒæ¥è®­ç»ƒã€‚æˆ‘ä»¬å°†æ‰€æœ‰çš„è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®çš„79ä¸ªç‰¹å¾æŒ‰æ ·æœ¬è¿ç»“ã€‚</p><pre><code class="lang-python">all_features = pd.concat((train_data.iloc[:, 1:-1], test_data.iloc[:, 1:]))</code></pre><h2 id="é¢„å¤„ç†æ•°æ®"><a href="#é¢„å¤„ç†æ•°æ®" class="headerlink" title="é¢„å¤„ç†æ•°æ®"></a>é¢„å¤„ç†æ•°æ®</h2><p>æˆ‘ä»¬å¯¹è¿ç»­æ•°å€¼çš„ç‰¹å¾åšæ ‡å‡†åŒ–ï¼ˆstandardizationï¼‰ï¼šè®¾è¯¥ç‰¹å¾åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šçš„å‡å€¼ä¸º$\mu$ï¼Œæ ‡å‡†å·®ä¸º$\sigma$ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥ç‰¹å¾çš„æ¯ä¸ªå€¼å…ˆå‡å»$\mu$å†é™¤ä»¥$\sigma$å¾—åˆ°æ ‡å‡†åŒ–åçš„æ¯ä¸ªç‰¹å¾å€¼ã€‚å¯¹äºç¼ºå¤±çš„ç‰¹å¾å€¼ï¼Œæˆ‘ä»¬å°†å…¶æ›¿æ¢æˆè¯¥ç‰¹å¾çš„å‡å€¼ã€‚</p><pre><code class="lang-python">numeric_features = all_features.dtypes[all_features.dtypes != &#39;object&#39;].indexall_features[numeric_features] = all_features[numeric_features].apply(    lambda x: (x - x.mean()) / (x.std()))# æ ‡å‡†åŒ–åï¼Œæ¯ä¸ªæ•°å€¼ç‰¹å¾çš„å‡å€¼å˜ä¸º0ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨0æ¥æ›¿æ¢ç¼ºå¤±å€¼all_features[numeric_features] = all_features[numeric_features].fillna(0)</code></pre><p>æ¥ä¸‹æ¥å°†ç¦»æ•£æ•°å€¼è½¬æˆæŒ‡ç¤ºç‰¹å¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç‰¹å¾MSZoningé‡Œé¢æœ‰ä¸¤ä¸ªä¸åŒçš„ç¦»æ•£å€¼RLå’ŒRMï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥è½¬æ¢å°†å»æ‰MSZoningç‰¹å¾ï¼Œå¹¶æ–°åŠ ä¸¤ä¸ªç‰¹å¾MSZoning_RLå’ŒMSZoning_RMï¼Œå…¶å€¼ä¸º0æˆ–1ã€‚å¦‚æœä¸€ä¸ªæ ·æœ¬åŸæ¥åœ¨MSZoningé‡Œçš„å€¼ä¸ºRLï¼Œé‚£ä¹ˆæœ‰MSZoning_RL=1ä¸”MSZoning_RM=0ã€‚</p><pre><code class="lang-python"># dummy_na=Trueå°†ç¼ºå¤±å€¼ä¹Ÿå½“ä½œåˆæ³•çš„ç‰¹å¾å€¼å¹¶ä¸ºå…¶åˆ›å»ºæŒ‡ç¤ºç‰¹å¾all_features = pd.get_dummies(all_features, dummy_na=True)all_features.shape</code></pre><pre><code>(2919, 331)</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™ä¸€æ­¥è½¬æ¢å°†ç‰¹å¾æ•°ä»79å¢åŠ åˆ°äº†331ã€‚</p><p>æœ€åï¼Œé€šè¿‡<code>values</code>å±æ€§å¾—åˆ°NumPyæ ¼å¼çš„æ•°æ®ï¼Œå¹¶è½¬æˆ<code>Tensor</code>æ–¹ä¾¿åé¢çš„è®­ç»ƒã€‚</p><pre><code class="lang-python">n_train = train_data.shape[0]train_features = torch.tensor(all_features[:n_train].values, dtype=torch.float)test_features = torch.tensor(all_features[n_train:].values, dtype=torch.float)train_labels = torch.tensor(train_data.SalePrice.values, dtype=torch.float).view(-1, 1)</code></pre><h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><pre><code class="lang-python">loss = torch.nn.MSELoss()def get_net(feature_num):    net = nn.Linear(feature_num, 1)    for param in net.parameters():        nn.init.normal_(param, mean=0, std=0.01)    return net</code></pre><p>ä¸‹é¢å®šä¹‰æ¯”èµ›ç”¨æ¥è¯„ä»·æ¨¡å‹çš„å¯¹æ•°å‡æ–¹æ ¹è¯¯å·®ã€‚ç»™å®šé¢„æµ‹å€¼$\hat y_1, \ldots, \hat y_n$å’Œå¯¹åº”çš„çœŸå®æ ‡ç­¾$y_1,\ldots, y_n$ï¼Œå®ƒçš„å®šä¹‰ä¸º</p><script type="math/tex; mode=display">\sqrt{\frac{1}{n}\sum_{i=1}^n\left(\log(y_i)-\log(\hat y_i)\right)^2}.</script><p>å¯¹æ•°å‡æ–¹æ ¹è¯¯å·®çš„å®ç°å¦‚ä¸‹ã€‚</p><pre><code class="lang-python">def log_rmse(net, features, labels):    with torch.no_grad():        # å°†å°äº1çš„å€¼è®¾æˆ1ï¼Œä½¿å¾—å–å¯¹æ•°æ—¶æ•°å€¼æ›´ç¨³å®š        clipped_preds = torch.max(net(features), torch.tensor(1.0))        rmse = torch.sqrt(2 * loss(clipped_preds.log(), labels.log()).mean())    return rmse.item()</code></pre><p>ä¸‹é¢çš„è®­ç»ƒå‡½æ•°è·Ÿæœ¬ç« ä¸­å‰å‡ èŠ‚çš„ä¸åŒåœ¨äºä½¿ç”¨äº†Adamä¼˜åŒ–ç®—æ³•ã€‚ç›¸å¯¹ä¹‹å‰ä½¿ç”¨çš„å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼Œå®ƒå¯¹å­¦ä¹ ç‡ç›¸å¯¹ä¸é‚£ä¹ˆæ•æ„Ÿã€‚æˆ‘ä»¬å°†åœ¨ä¹‹åçš„â€œä¼˜åŒ–ç®—æ³•â€ä¸€ç« é‡Œè¯¦ç»†ä»‹ç»å®ƒã€‚</p><pre><code class="lang-python">def train(net, train_features, train_labels, test_features, test_labels,          num_epochs, learning_rate, weight_decay, batch_size):    train_ls, test_ls = [], []    dataset = torch.utils.data.TensorDataset(train_features, train_labels)    train_iter = torch.utils.data.DataLoader(dataset, batch_size, shuffle=True)    # è¿™é‡Œä½¿ç”¨äº†Adamä¼˜åŒ–ç®—æ³•    optimizer = torch.optim.Adam(params=net.parameters(), lr=learning_rate, weight_decay=weight_decay)     net = net.float()    for epoch in range(num_epochs):        for X, y in train_iter:            l = loss(net(X.float()), y.float())            optimizer.zero_grad()            l.backward()            optimizer.step()        train_ls.append(log_rmse(net, train_features, train_labels))        if test_labels is not None:            test_ls.append(log_rmse(net, test_features, test_labels))    return train_ls, test_ls</code></pre><h2 id="KæŠ˜äº¤å‰éªŒè¯"><a href="#KæŠ˜äº¤å‰éªŒè¯" class="headerlink" title="KæŠ˜äº¤å‰éªŒè¯"></a>KæŠ˜äº¤å‰éªŒè¯</h2><p>æˆ‘ä»¬åœ¨æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆä¸­ä»‹ç»äº†$K$æŠ˜äº¤å‰éªŒè¯ã€‚å®ƒå°†è¢«ç”¨æ¥é€‰æ‹©æ¨¡å‹è®¾è®¡å¹¶è°ƒèŠ‚è¶…å‚æ•°ã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›ç¬¬<code>i</code>æŠ˜äº¤å‰éªŒè¯æ—¶æ‰€éœ€è¦çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®ã€‚</p><pre><code class="lang-python">def get_k_fold_data(k, i, X, y):    # è¿”å›ç¬¬iæŠ˜äº¤å‰éªŒè¯æ—¶æ‰€éœ€è¦çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®    assert k &gt; 1    fold_size = X.shape[0] // k    X_train, y_train = None, None    for j in range(k):        idx = slice(j * fold_size, (j + 1) * fold_size)        X_part, y_part = X[idx, :], y[idx]        if j == i:            X_valid, y_valid = X_part, y_part        elif X_train is None:            X_train, y_train = X_part, y_part        else:            X_train = torch.cat((X_train, X_part), dim=0)            y_train = torch.cat((y_train, y_part), dim=0)    return X_train, y_train, X_valid, y_valid</code></pre><p>åœ¨$K$æŠ˜äº¤å‰éªŒè¯ä¸­æˆ‘ä»¬è®­ç»ƒ$K$æ¬¡å¹¶è¿”å›è®­ç»ƒå’ŒéªŒè¯çš„å¹³å‡è¯¯å·®</p><pre><code class="lang-python">def k_fold(k, X_train, y_train, num_epochs,           learning_rate, weight_decay, batch_size):    train_l_sum, valid_l_sum = 0, 0    for i in range(k):        data = get_k_fold_data(k, i, X_train, y_train)        net = get_net(X_train.shape[1])        train_ls, valid_ls = train(net, *data, num_epochs, learning_rate,                                   weight_decay, batch_size)        train_l_sum += train_ls[-1]        valid_l_sum += valid_ls[-1]        if i == 0:            d2l.semilogy(range(1, num_epochs + 1), train_ls, &#39;epochs&#39;, &#39;rmse&#39;,                         range(1, num_epochs + 1), valid_ls,                         [&#39;train&#39;, &#39;valid&#39;])        print(&#39;fold %d, train rmse %f, valid rmse %f&#39; % (i, train_ls[-1], valid_ls[-1]))    return train_l_sum / k, valid_l_sum / k</code></pre><h2 id="æ¨¡å‹é€‰æ‹©"><a href="#æ¨¡å‹é€‰æ‹©" class="headerlink" title="æ¨¡å‹é€‰æ‹©"></a>æ¨¡å‹é€‰æ‹©</h2><p>æˆ‘ä»¬ä½¿ç”¨ä¸€ç»„æœªç»è°ƒä¼˜çš„è¶…å‚æ•°å¹¶è®¡ç®—äº¤å‰éªŒè¯è¯¯å·®ã€‚å¯ä»¥æ”¹åŠ¨è¿™äº›è¶…å‚æ•°æ¥å°½å¯èƒ½å‡å°å¹³å‡æµ‹è¯•è¯¯å·®ã€‚<br>æœ‰æ—¶å€™ä½ ä¼šå‘ç°ä¸€ç»„å‚æ•°çš„è®­ç»ƒè¯¯å·®å¯ä»¥è¾¾åˆ°å¾ˆä½ï¼Œä½†æ˜¯åœ¨$K$æŠ˜äº¤å‰éªŒè¯ä¸Šçš„è¯¯å·®å¯èƒ½åè€Œè¾ƒé«˜ã€‚è¿™ç§ç°è±¡å¾ˆå¯èƒ½æ˜¯ç”±è¿‡æ‹Ÿåˆé€ æˆçš„ã€‚å› æ­¤ï¼Œå½“è®­ç»ƒè¯¯å·®é™ä½æ—¶ï¼Œæˆ‘ä»¬è¦è§‚å¯Ÿ$K$æŠ˜äº¤å‰éªŒè¯ä¸Šçš„è¯¯å·®æ˜¯å¦ä¹Ÿç›¸åº”é™ä½ã€‚</p><pre><code class="lang-python">k, num_epochs, lr, weight_decay, batch_size = 5, 100, 5, 0, 64train_l, valid_l = k_fold(k, train_features, train_labels, num_epochs, lr, weight_decay, batch_size)print(&#39;%d-fold validation: avg train rmse %f, avg valid rmse %f&#39; % (k, train_l, valid_l))</code></pre><pre><code>fold 0, train rmse 0.241365, valid rmse 0.223083fold 1, train rmse 0.229118, valid rmse 0.267488fold 2, train rmse 0.232072, valid rmse 0.237995fold 3, train rmse 0.238050, valid rmse 0.218671fold 4, train rmse 0.231004, valid rmse 0.2591855-fold validation: avg train rmse 0.234322, avg valid rmse 0.241284</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://s2.ax1x.com/2020/02/19/3VfyOs.png" alt="æŸå¤±ä¸æ–­ä¸‹é™"></p><h1 id="é¢„æµ‹å¹¶åœ¨Kaggleä¸­æäº¤ç»“æœ"><a href="#é¢„æµ‹å¹¶åœ¨Kaggleä¸­æäº¤ç»“æœ" class="headerlink" title="é¢„æµ‹å¹¶åœ¨Kaggleä¸­æäº¤ç»“æœ"></a>é¢„æµ‹å¹¶åœ¨Kaggleä¸­æäº¤ç»“æœ</h1><p>ä¸‹é¢å®šä¹‰é¢„æµ‹å‡½æ•°ã€‚åœ¨é¢„æµ‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å®Œæ•´çš„è®­ç»ƒæ•°æ®é›†æ¥é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œå¹¶å°†é¢„æµ‹ç»“æœå­˜æˆæäº¤æ‰€éœ€è¦çš„æ ¼å¼ã€‚</p><pre><code class="lang-python">def train_and_pred(train_features, test_features, train_labels, test_data,                   num_epochs, lr, weight_decay, batch_size):    net = get_net(train_features.shape[1])    train_ls, _ = train(net, train_features, train_labels, None, None,                        num_epochs, lr, weight_decay, batch_size)    d2l.semilogy(range(1, num_epochs + 1), train_ls, &#39;epochs&#39;, &#39;rmse&#39;)    print(&#39;train rmse %f&#39; % train_ls[-1])    preds = net(test_features).detach().numpy()    test_data[&#39;SalePrice&#39;] = pd.Series(preds.reshape(1, -1)[0])    submission = pd.concat([test_data[&#39;Id&#39;], test_data[&#39;SalePrice&#39;]], axis=1)    submission.to_csv(&#39;./submission.csv&#39;, index=False)    # sample_submission_data = pd.read_csv(&quot;../input/house-prices-advanced-regression-techniques/sample_submission.csv&quot;)</code></pre><p>è®¾è®¡å¥½æ¨¡å‹å¹¶è°ƒå¥½è¶…å‚æ•°ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¯¹æµ‹è¯•æ•°æ®é›†ä¸Šçš„æˆ¿å±‹æ ·æœ¬åšä»·æ ¼é¢„æµ‹ã€‚å¦‚æœæˆ‘ä»¬å¾—åˆ°ä¸äº¤å‰éªŒè¯æ—¶å·®ä¸å¤šçš„è®­ç»ƒè¯¯å·®ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æœå¾ˆå¯èƒ½æ˜¯ç†æƒ³çš„ï¼Œå¯ä»¥åœ¨Kaggleä¸Šæäº¤ç»“æœã€‚</p><pre><code class="lang-python">train_and_pred(train_features, test_features, train_labels, test_data, num_epochs, lr, weight_decay, batch_size)</code></pre><p>å¸Œæœ›å¤§å®¶è‡ªå·±åŠ¨æ‰‹å®Œæˆæˆ¿ä»·é¢„æµ‹çš„å®ç°ï¼Œå¤šå‚ä¸è®¨è®ºã€‚</p><h1 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h1><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/GJjuZ5mLcKX7Hsd.png" alt="(1)"></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/qAFfVdXbyMgrHkj.png" alt="(2)"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (å››):è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ</title>
      <link href="/2020/02/14/dl-notes4-ov-und-fit/"/>
      <url>/2020/02/14/dl-notes4-ov-und-fit/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿‡æ‹Ÿåˆã€æ¬ æ‹ŸåˆåŠå…¶è§£å†³æ–¹æ¡ˆ"><a href="#è¿‡æ‹Ÿåˆã€æ¬ æ‹ŸåˆåŠå…¶è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è¿‡æ‹Ÿåˆã€æ¬ æ‹ŸåˆåŠå…¶è§£å†³æ–¹æ¡ˆ"></a>è¿‡æ‹Ÿåˆã€æ¬ æ‹ŸåˆåŠå…¶è§£å†³æ–¹æ¡ˆ</h1><ol><li>è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆçš„æ¦‚å¿µ</li><li>æƒé‡è¡°å‡</li><li>ä¸¢å¼ƒæ³•</li></ol><h1 id="æ¨¡å‹é€‰æ‹©ã€è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#æ¨¡å‹é€‰æ‹©ã€è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="æ¨¡å‹é€‰æ‹©ã€è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>æ¨¡å‹é€‰æ‹©ã€è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h1><h2 id="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"><a href="#è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®" class="headerlink" title="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"></a>è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®</h2><p>åœ¨è§£é‡Šä¸Šè¿°ç°è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†è®­ç»ƒè¯¯å·®ï¼ˆtraining errorï¼‰å’Œæ³›åŒ–è¯¯å·®ï¼ˆgeneralization errorï¼‰ã€‚é€šä¿—æ¥è®²ï¼Œå‰è€…æŒ‡æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šè¡¨ç°å‡ºçš„è¯¯å·®ï¼Œåè€…æŒ‡æ¨¡å‹åœ¨ä»»æ„ä¸€ä¸ªæµ‹è¯•æ•°æ®æ ·æœ¬ä¸Šè¡¨ç°å‡ºçš„è¯¯å·®çš„æœŸæœ›ï¼Œå¹¶å¸¸å¸¸é€šè¿‡æµ‹è¯•æ•°æ®é›†ä¸Šçš„è¯¯å·®æ¥è¿‘ä¼¼ã€‚è®¡ç®—è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®å¯ä»¥ä½¿ç”¨ä¹‹å‰ä»‹ç»è¿‡çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚çº¿æ€§å›å½’ç”¨åˆ°çš„å¹³æ–¹æŸå¤±å‡½æ•°å’Œsoftmaxå›å½’ç”¨åˆ°çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚</p><p>æœºå™¨å­¦ä¹ æ¨¡å‹åº”å…³æ³¨é™ä½æ³›åŒ–è¯¯å·®ã€‚</p><h2 id="æ¨¡å‹é€‰æ‹©"><a href="#æ¨¡å‹é€‰æ‹©" class="headerlink" title="æ¨¡å‹é€‰æ‹©"></a>æ¨¡å‹é€‰æ‹©</h2><h3 id="éªŒè¯æ•°æ®é›†"><a href="#éªŒè¯æ•°æ®é›†" class="headerlink" title="éªŒè¯æ•°æ®é›†"></a>éªŒè¯æ•°æ®é›†</h3><p>ä»ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œæµ‹è¯•é›†åªèƒ½åœ¨æ‰€æœ‰è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°é€‰å®šåä½¿ç”¨ä¸€æ¬¡ã€‚ä¸å¯ä»¥ä½¿ç”¨æµ‹è¯•æ•°æ®é€‰æ‹©æ¨¡å‹ï¼Œå¦‚è°ƒå‚ã€‚ç”±äºæ— æ³•ä»è®­ç»ƒè¯¯å·®ä¼°è®¡æ³›åŒ–è¯¯å·®ï¼Œå› æ­¤ä¹Ÿä¸åº”åªä¾èµ–è®­ç»ƒæ•°æ®é€‰æ‹©æ¨¡å‹ã€‚é‰´äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é¢„ç•™ä¸€éƒ¨åˆ†åœ¨è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ä»¥å¤–çš„æ•°æ®æ¥è¿›è¡Œæ¨¡å‹é€‰æ‹©ã€‚è¿™éƒ¨åˆ†æ•°æ®è¢«ç§°ä¸ºéªŒè¯æ•°æ®é›†ï¼Œç®€ç§°éªŒè¯é›†ï¼ˆvalidation setï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç»™å®šçš„è®­ç»ƒé›†ä¸­éšæœºé€‰å–ä¸€å°éƒ¨åˆ†ä½œä¸ºéªŒè¯é›†ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºçœŸæ­£çš„è®­ç»ƒé›†ã€‚</p><h3 id="KæŠ˜äº¤å‰éªŒè¯"><a href="#KæŠ˜äº¤å‰éªŒè¯" class="headerlink" title="KæŠ˜äº¤å‰éªŒè¯"></a>KæŠ˜äº¤å‰éªŒè¯</h3><p>ç”±äºéªŒè¯æ•°æ®é›†ä¸å‚ä¸æ¨¡å‹è®­ç»ƒï¼Œå½“è®­ç»ƒæ•°æ®ä¸å¤Ÿç”¨æ—¶ï¼Œé¢„ç•™å¤§é‡çš„éªŒè¯æ•°æ®æ˜¾å¾—å¤ªå¥¢ä¾ˆã€‚ä¸€ç§æ”¹å–„çš„æ–¹æ³•æ˜¯KæŠ˜äº¤å‰éªŒè¯ï¼ˆK-fold cross-validationï¼‰ã€‚åœ¨KæŠ˜äº¤å‰éªŒè¯ä¸­ï¼Œæˆ‘ä»¬æŠŠåŸå§‹è®­ç»ƒæ•°æ®é›†åˆ†å‰²æˆKä¸ªä¸é‡åˆçš„å­æ•°æ®é›†ï¼Œç„¶åæˆ‘ä»¬åšKæ¬¡æ¨¡å‹è®­ç»ƒå’ŒéªŒè¯ã€‚æ¯ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå­æ•°æ®é›†éªŒè¯æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨å…¶ä»–K-1ä¸ªå­æ•°æ®é›†æ¥è®­ç»ƒæ¨¡å‹ã€‚åœ¨è¿™Kæ¬¡è®­ç»ƒå’ŒéªŒè¯ä¸­ï¼Œæ¯æ¬¡ç”¨æ¥éªŒè¯æ¨¡å‹çš„å­æ•°æ®é›†éƒ½ä¸åŒã€‚æœ€åï¼Œæˆ‘ä»¬å¯¹è¿™Kæ¬¡è®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®åˆ†åˆ«æ±‚å¹³å‡ã€‚</p><h2 id="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢ç©¶æ¨¡å‹è®­ç»ƒä¸­ç»å¸¸å‡ºç°çš„ä¸¤ç±»å…¸å‹é—®é¢˜ï¼š</p><ul><li>ä¸€ç±»æ˜¯æ¨¡å‹æ— æ³•å¾—åˆ°è¾ƒä½çš„è®­ç»ƒè¯¯å·®ï¼Œæˆ‘ä»¬å°†è¿™ä¸€ç°è±¡ç§°ä½œæ¬ æ‹Ÿåˆï¼ˆunderfittingï¼‰ï¼›</li><li>å¦ä¸€ç±»æ˜¯æ¨¡å‹çš„è®­ç»ƒè¯¯å·®è¿œå°äºå®ƒåœ¨æµ‹è¯•æ•°æ®é›†ä¸Šçš„è¯¯å·®ï¼Œæˆ‘ä»¬ç§°è¯¥ç°è±¡ä¸ºè¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ã€‚<br>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬è¦å°½å¯èƒ½åŒæ—¶åº”å¯¹æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆã€‚è™½ç„¶æœ‰å¾ˆå¤šå› ç´ å¯èƒ½å¯¼è‡´è¿™ä¸¤ç§æ‹Ÿåˆé—®é¢˜ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºä¸¤ä¸ªå› ç´ ï¼šæ¨¡å‹å¤æ‚åº¦å’Œè®­ç»ƒæ•°æ®é›†å¤§å°ã€‚</li></ul><h3 id="æ¨¡å‹å¤æ‚åº¦"><a href="#æ¨¡å‹å¤æ‚åº¦" class="headerlink" title="æ¨¡å‹å¤æ‚åº¦"></a>æ¨¡å‹å¤æ‚åº¦</h3><p>ä¸ºäº†è§£é‡Šæ¨¡å‹å¤æ‚åº¦ï¼Œæˆ‘ä»¬ä»¥å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆä¸ºä¾‹ã€‚ç»™å®šä¸€ä¸ªç”±æ ‡é‡æ•°æ®ç‰¹å¾$x$å’Œå¯¹åº”çš„æ ‡é‡æ ‡ç­¾$y$ç»„æˆçš„è®­ç»ƒæ•°æ®é›†ï¼Œå¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆçš„ç›®æ ‡æ˜¯æ‰¾ä¸€ä¸ª$K$é˜¶å¤šé¡¹å¼å‡½æ•°</p><script type="math/tex; mode=display"> \hat{y} = b + \sum_{k=1}^K x^k w_k</script><p>æ¥è¿‘ä¼¼ $y$ã€‚åœ¨ä¸Šå¼ä¸­ï¼Œ$w_k$æ˜¯æ¨¡å‹çš„æƒé‡å‚æ•°ï¼Œ$b$æ˜¯åå·®å‚æ•°ã€‚ä¸çº¿æ€§å›å½’ç›¸åŒï¼Œå¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆä¹Ÿä½¿ç”¨å¹³æ–¹æŸå¤±å‡½æ•°ã€‚ç‰¹åˆ«åœ°ï¼Œä¸€é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆåˆå«çº¿æ€§å‡½æ•°æ‹Ÿåˆã€‚</p><p>ç»™å®šè®­ç»ƒæ•°æ®é›†ï¼Œæ¨¡å‹å¤æ‚åº¦å’Œè¯¯å·®ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5jc27wxoj.png?imageView2/0/w/960/h/960" alt="Image Name"></p><h3 id="è®­ç»ƒæ•°æ®é›†å¤§å°"><a href="#è®­ç»ƒæ•°æ®é›†å¤§å°" class="headerlink" title="è®­ç»ƒæ•°æ®é›†å¤§å°"></a>è®­ç»ƒæ•°æ®é›†å¤§å°</h3><p>å½±å“æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆçš„å¦ä¸€ä¸ªé‡è¦å› ç´ æ˜¯è®­ç»ƒæ•°æ®é›†çš„å¤§å°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœè®­ç»ƒæ•°æ®é›†ä¸­æ ·æœ¬æ•°è¿‡å°‘ï¼Œç‰¹åˆ«æ˜¯æ¯”æ¨¡å‹å‚æ•°æ•°é‡ï¼ˆæŒ‰å…ƒç´ è®¡ï¼‰æ›´å°‘æ—¶ï¼Œè¿‡æ‹Ÿåˆæ›´å®¹æ˜“å‘ç”Ÿã€‚æ­¤å¤–ï¼Œæ³›åŒ–è¯¯å·®ä¸ä¼šéšè®­ç»ƒæ•°æ®é›†é‡Œæ ·æœ¬æ•°é‡å¢åŠ è€Œå¢å¤§ã€‚å› æ­¤ï¼Œåœ¨è®¡ç®—èµ„æºå…è®¸çš„èŒƒå›´ä¹‹å†…ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›è®­ç»ƒæ•°æ®é›†å¤§ä¸€äº›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å‹å¤æ‚åº¦è¾ƒé«˜æ—¶ï¼Œä¾‹å¦‚å±‚æ•°è¾ƒå¤šçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p><h1 id="å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ"><a href="#å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ" class="headerlink" title="å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ"></a>å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ</h1><pre><code class="lang-python">%matplotlib inlineimport torchimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h2 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h2><pre><code class="lang-python">n_train, n_test, true_w, true_b = 100, 100, [1.2, -3.4, 5.6], 5features = torch.randn((n_train + n_test, 1))poly_features = torch.cat((features, torch.pow(features, 2), torch.pow(features, 3)), 1) labels = (true_w[0] * poly_features[:, 0] + true_w[1] * poly_features[:, 1]          + true_w[2] * poly_features[:, 2] + true_b)labels += torch.tensor(np.random.normal(0, 0.01, size=labels.size()), dtype=torch.float)</code></pre><pre><code class="lang-python">features[:2], poly_features[:2], labels[:2]</code></pre><pre><code>(tensor([[-0.8589],         [-0.2534]]), tensor([[-0.8589,  0.7377, -0.6335],         [-0.2534,  0.0642, -0.0163]]), tensor([-2.0794,  4.4039]))</code></pre><h2 id="å®šä¹‰ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹"><a href="#å®šä¹‰ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹" class="headerlink" title="å®šä¹‰ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹"></a>å®šä¹‰ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹</h2><pre><code class="lang-python">def semilogy(x_vals, y_vals, x_label, y_label, x2_vals=None, y2_vals=None,             legend=None, figsize=(3.5, 2.5)):    # d2l.set_figsize(figsize)    d2l.plt.xlabel(x_label)    d2l.plt.ylabel(y_label)    d2l.plt.semilogy(x_vals, y_vals)    if x2_vals and y2_vals:        d2l.plt.semilogy(x2_vals, y2_vals, linestyle=&#39;:&#39;)        d2l.plt.legend(legend)</code></pre><pre><code class="lang-python">num_epochs, loss = 100, torch.nn.MSELoss()def fit_and_plot(train_features, test_features, train_labels, test_labels):    # åˆå§‹åŒ–ç½‘ç»œæ¨¡å‹    net = torch.nn.Linear(train_features.shape[-1], 1)    # é€šè¿‡Linearæ–‡æ¡£å¯çŸ¥ï¼Œpytorchå·²ç»å°†å‚æ•°åˆå§‹åŒ–äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±ä¸æ‰‹åŠ¨åˆå§‹åŒ–äº†    # è®¾ç½®æ‰¹é‡å¤§å°    batch_size = min(10, train_labels.shape[0])        dataset = torch.utils.data.TensorDataset(train_features, train_labels)      # è®¾ç½®æ•°æ®é›†    train_iter = torch.utils.data.DataLoader(dataset, batch_size, shuffle=True) # è®¾ç½®è·å–æ•°æ®æ–¹å¼    optimizer = torch.optim.SGD(net.parameters(), lr=0.01)                      # è®¾ç½®ä¼˜åŒ–å‡½æ•°ï¼Œä½¿ç”¨çš„æ˜¯éšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–    train_ls, test_ls = [], []    for _ in range(num_epochs):        for X, y in train_iter:                                                 # å–ä¸€ä¸ªæ‰¹é‡çš„æ•°æ®            l = loss(net(X), y.view(-1, 1))                                     # è¾“å…¥åˆ°ç½‘ç»œä¸­è®¡ç®—è¾“å‡ºï¼Œå¹¶å’Œæ ‡ç­¾æ¯”è¾ƒæ±‚å¾—æŸå¤±å‡½æ•°            optimizer.zero_grad()                                               # æ¢¯åº¦æ¸…é›¶ï¼Œé˜²æ­¢æ¢¯åº¦ç´¯åŠ å¹²æ‰°ä¼˜åŒ–            l.backward()                                                        # æ±‚æ¢¯åº¦            optimizer.step()                                                    # è¿­ä»£ä¼˜åŒ–å‡½æ•°ï¼Œè¿›è¡Œå‚æ•°ä¼˜åŒ–        train_labels = train_labels.view(-1, 1)        test_labels = test_labels.view(-1, 1)        train_ls.append(loss(net(train_features), train_labels).item())         # å°†è®­ç»ƒæŸå¤±ä¿å­˜åˆ°train_lsä¸­        test_ls.append(loss(net(test_features), test_labels).item())            # å°†æµ‹è¯•æŸå¤±ä¿å­˜åˆ°test_lsä¸­    print(&#39;final epoch: train loss&#39;, train_ls[-1], &#39;test loss&#39;, test_ls[-1])        semilogy(range(1, num_epochs + 1), train_ls, &#39;epochs&#39;, &#39;loss&#39;,             range(1, num_epochs + 1), test_ls, [&#39;train&#39;, &#39;test&#39;])    print(&#39;weight:&#39;, net.weight.data,          &#39;\nbias:&#39;, net.bias.data)</code></pre><h2 id="ä¸‰é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆï¼ˆæ­£å¸¸ï¼‰"><a href="#ä¸‰é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆï¼ˆæ­£å¸¸ï¼‰" class="headerlink" title="ä¸‰é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆï¼ˆæ­£å¸¸ï¼‰"></a>ä¸‰é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆï¼ˆæ­£å¸¸ï¼‰</h2><pre><code class="lang-python">fit_and_plot(poly_features[:n_train, :], poly_features[n_train:, :], labels[:n_train], labels[n_train:])</code></pre><pre><code>final epoch: train loss 8887.298828125 test loss 1145.94287109375weight: tensor([[-8.5120, 19.0351, 12.8616]]) bias: tensor([-5.4607])</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/CD685B472B744329A1CFC47C9F0B5E89/q5jf5azjcn.png"></p><h2 id="çº¿æ€§å‡½æ•°æ‹Ÿåˆï¼ˆæ¬ æ‹Ÿåˆï¼‰"><a href="#çº¿æ€§å‡½æ•°æ‹Ÿåˆï¼ˆæ¬ æ‹Ÿåˆï¼‰" class="headerlink" title="çº¿æ€§å‡½æ•°æ‹Ÿåˆï¼ˆæ¬ æ‹Ÿåˆï¼‰"></a>çº¿æ€§å‡½æ•°æ‹Ÿåˆï¼ˆæ¬ æ‹Ÿåˆï¼‰</h2><pre><code class="lang-python">fit_and_plot(features[:n_train, :], features[n_train:, :], labels[:n_train], labels[n_train:])</code></pre><pre><code>final epoch: train loss 781.689453125 test loss 329.79852294921875weight: tensor([[26.8753]]) bias: tensor([6.1426])</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/33AD626DA0B94DB7A28D47697312B45D/q5jf5al2tv.png"></p><h2 id="è®­ç»ƒæ ·æœ¬ä¸è¶³ï¼ˆè¿‡æ‹Ÿåˆï¼‰"><a href="#è®­ç»ƒæ ·æœ¬ä¸è¶³ï¼ˆè¿‡æ‹Ÿåˆï¼‰" class="headerlink" title="è®­ç»ƒæ ·æœ¬ä¸è¶³ï¼ˆè¿‡æ‹Ÿåˆï¼‰"></a>è®­ç»ƒæ ·æœ¬ä¸è¶³ï¼ˆè¿‡æ‹Ÿåˆï¼‰</h2><pre><code class="lang-python">fit_and_plot(poly_features[0:2, :], poly_features[n_train:, :], labels[0:2], labels[n_train:])</code></pre><pre><code>final epoch: train loss 6.23520565032959 test loss 409.9844665527344weight: tensor([[ 0.9729, -0.9612,  0.7259]]) bias: tensor([1.6334])</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/AB13F65A70A9484788F8004E427EC290/q5jf5bd11u.png"></p><h1 id="æƒé‡è¡°å‡"><a href="#æƒé‡è¡°å‡" class="headerlink" title="æƒé‡è¡°å‡"></a>æƒé‡è¡°å‡</h1><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>æƒé‡è¡°å‡ç­‰ä»·äº $L_2$ èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰ã€‚æ­£åˆ™åŒ–é€šè¿‡ä¸ºæ¨¡å‹æŸå¤±å‡½æ•°æ·»åŠ æƒ©ç½šé¡¹ä½¿å­¦å‡ºçš„æ¨¡å‹å‚æ•°å€¼è¾ƒå°ï¼Œæ˜¯åº”å¯¹è¿‡æ‹Ÿåˆçš„å¸¸ç”¨æ‰‹æ®µã€‚</p><h2 id="L2-èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰"><a href="#L2-èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰" class="headerlink" title="L2 èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰"></a>L2 èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰</h2><p>$L_2$èŒƒæ•°æ­£åˆ™åŒ–åœ¨æ¨¡å‹åŸæŸå¤±å‡½æ•°åŸºç¡€ä¸Šæ·»åŠ $L_2$èŒƒæ•°æƒ©ç½šé¡¹ï¼Œä»è€Œå¾—åˆ°è®­ç»ƒæ‰€éœ€è¦æœ€å°åŒ–çš„å‡½æ•°ã€‚$L_2$èŒƒæ•°æƒ©ç½šé¡¹æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡å‚æ•°æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹å’Œä¸ä¸€ä¸ªæ­£çš„å¸¸æ•°çš„ä¹˜ç§¯ã€‚ä»¥çº¿æ€§å›å½’ä¸­çš„çº¿æ€§å›å½’æŸå¤±å‡½æ•°ä¸ºä¾‹</p><script type="math/tex; mode=display"> \ell(w_1, w_2, b) = \frac{1}{n} \sum_{i=1}^n \frac{1}{2}\left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right)^2</script><p>å…¶ä¸­$w_1, w_2$æ˜¯æƒé‡å‚æ•°ï¼Œ$b$æ˜¯åå·®å‚æ•°ï¼Œæ ·æœ¬$i$çš„è¾“å…¥ä¸º$x_1^{(i)}, x_2^{(i)}$ï¼Œæ ‡ç­¾ä¸º$y^{(i)}$ï¼Œæ ·æœ¬æ•°ä¸º$n$ã€‚å°†æƒé‡å‚æ•°ç”¨å‘é‡$\boldsymbol{w} = [w_1, w_2]$è¡¨ç¤ºï¼Œå¸¦æœ‰$L_2$èŒƒæ•°æƒ©ç½šé¡¹çš„æ–°æŸå¤±å‡½æ•°ä¸º</p><script type="math/tex; mode=display">\ell(w_1, w_2, b) + \frac{\lambda}{2n} |\boldsymbol{w}|^2,</script><p>å…¶ä¸­è¶…å‚æ•°$\lambda &gt; 0$ã€‚å½“æƒé‡å‚æ•°å‡ä¸º0æ—¶ï¼Œæƒ©ç½šé¡¹æœ€å°ã€‚å½“$\lambda$è¾ƒå¤§æ—¶ï¼Œæƒ©ç½šé¡¹åœ¨æŸå¤±å‡½æ•°ä¸­çš„æ¯”é‡è¾ƒå¤§ï¼Œè¿™é€šå¸¸ä¼šä½¿å­¦åˆ°çš„æƒé‡å‚æ•°çš„å…ƒç´ è¾ƒæ¥è¿‘0ã€‚å½“$\lambda$è®¾ä¸º0æ—¶ï¼Œæƒ©ç½šé¡¹å®Œå…¨ä¸èµ·ä½œç”¨ã€‚ä¸Šå¼ä¸­$L_2$èŒƒæ•°å¹³æ–¹$|\boldsymbol{w}|^2$å±•å¼€åå¾—åˆ°$w_1^2 + w_2^2$ã€‚<br>æœ‰äº†$L_2$èŒƒæ•°æƒ©ç½šé¡¹åï¼Œåœ¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ä¸­ï¼Œæˆ‘ä»¬å°†çº¿æ€§å›å½’ä¸€èŠ‚ä¸­æƒé‡$w_1$å’Œ$w_2$çš„è¿­ä»£æ–¹å¼æ›´æ”¹ä¸º</p><script type="math/tex; mode=display"> \begin{aligned} w_1 &\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_1 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_1^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right),\\ w_2 &\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_2 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_2^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right). \end{aligned}</script><p>å¯è§ï¼Œ$L_2$èŒƒæ•°æ­£åˆ™åŒ–ä»¤æƒé‡$w_1$å’Œ$w_2$å…ˆè‡ªä¹˜å°äº1çš„æ•°ï¼Œå†å‡å»ä¸å«æƒ©ç½šé¡¹çš„æ¢¯åº¦ã€‚å› æ­¤ï¼Œ$L_2$èŒƒæ•°æ­£åˆ™åŒ–åˆå«æƒé‡è¡°å‡ã€‚æƒé‡è¡°å‡é€šè¿‡æƒ©ç½šç»å¯¹å€¼è¾ƒå¤§çš„æ¨¡å‹å‚æ•°ä¸ºéœ€è¦å­¦ä¹ çš„æ¨¡å‹å¢åŠ äº†é™åˆ¶ï¼Œè¿™å¯èƒ½å¯¹è¿‡æ‹Ÿåˆæœ‰æ•ˆã€‚</p><h2 id="é«˜ç»´çº¿æ€§å›å½’å®éªŒä»é›¶å¼€å§‹çš„å®ç°"><a href="#é«˜ç»´çº¿æ€§å›å½’å®éªŒä»é›¶å¼€å§‹çš„å®ç°" class="headerlink" title="é«˜ç»´çº¿æ€§å›å½’å®éªŒä»é›¶å¼€å§‹çš„å®ç°"></a>é«˜ç»´çº¿æ€§å›å½’å®éªŒä»é›¶å¼€å§‹çš„å®ç°</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»¥é«˜ç»´çº¿æ€§å›å½’ä¸ºä¾‹æ¥å¼•å…¥ä¸€ä¸ªè¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå¹¶ä½¿ç”¨æƒé‡è¡°å‡æ¥åº”å¯¹è¿‡æ‹Ÿåˆã€‚è®¾æ•°æ®æ ·æœ¬ç‰¹å¾çš„ç»´åº¦ä¸º$p$ã€‚å¯¹äºè®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ä¸­ç‰¹å¾ä¸º$x_1, x_2, \ldots, x_p$çš„ä»»ä¸€æ ·æœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„çº¿æ€§å‡½æ•°æ¥ç”Ÿæˆè¯¥æ ·æœ¬çš„æ ‡ç­¾ï¼š</p><script type="math/tex; mode=display"> y = 0.05 + \sum_{i = 1}^p 0.01x_i + \epsilon</script><p>å…¶ä¸­å™ªå£°é¡¹$\epsilon$æœä»å‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º0.01çš„æ­£æ€åˆ†å¸ƒã€‚ä¸ºäº†è¾ƒå®¹æ˜“åœ°è§‚å¯Ÿè¿‡æ‹Ÿåˆï¼Œæˆ‘ä»¬è€ƒè™‘é«˜ç»´çº¿æ€§å›å½’é—®é¢˜ï¼Œå¦‚è®¾ç»´åº¦$p=200$ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬ç‰¹æ„æŠŠè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬æ•°è®¾ä½ï¼Œå¦‚20ã€‚</p><pre><code class="lang-python">%matplotlib inlineimport torchimport torch.nn as nnimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h2 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h2><p>ä¸å‰é¢è§‚å¯Ÿè¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆç°è±¡çš„æ—¶å€™ç›¸ä¼¼ï¼Œåœ¨è¿™é‡Œä¸å†è§£é‡Šã€‚</p><pre><code class="lang-python">n_train, n_test, num_inputs = 20, 100, 200true_w, true_b = torch.ones(num_inputs, 1) * 0.01, 0.05features = torch.randn((n_train + n_test, num_inputs))labels = torch.matmul(features, true_w) + true_blabels += torch.tensor(np.random.normal(0, 0.01, size=labels.size()), dtype=torch.float)train_features, test_features = features[:n_train, :], features[n_train:, :]train_labels, test_labels = labels[:n_train], labels[n_train:]</code></pre><pre><code class="lang-python"># å®šä¹‰å‚æ•°åˆå§‹åŒ–å‡½æ•°ï¼Œåˆå§‹åŒ–æ¨¡å‹å‚æ•°å¹¶ä¸”é™„ä¸Šæ¢¯åº¦def init_params():    w = torch.randn((num_inputs, 1), requires_grad=True)    b = torch.zeros(1, requires_grad=True)    return [w, b]</code></pre><h2 id="å®šä¹‰L2èŒƒæ•°æƒ©ç½šé¡¹"><a href="#å®šä¹‰L2èŒƒæ•°æƒ©ç½šé¡¹" class="headerlink" title="å®šä¹‰L2èŒƒæ•°æƒ©ç½šé¡¹"></a>å®šä¹‰L2èŒƒæ•°æƒ©ç½šé¡¹</h2><pre><code class="lang-python">def l2_penalty(w):    return (w**2).sum() / 2</code></pre><h2 id="å®šä¹‰è®­ç»ƒå’Œæµ‹è¯•"><a href="#å®šä¹‰è®­ç»ƒå’Œæµ‹è¯•" class="headerlink" title="å®šä¹‰è®­ç»ƒå’Œæµ‹è¯•"></a>å®šä¹‰è®­ç»ƒå’Œæµ‹è¯•</h2><pre><code class="lang-python">batch_size, num_epochs, lr = 1, 100, 0.003net, loss = d2l.linreg, d2l.squared_lossdataset = torch.utils.data.TensorDataset(train_features, train_labels)train_iter = torch.utils.data.DataLoader(dataset, batch_size, shuffle=True)def fit_and_plot(lambd):    w, b = init_params()    train_ls, test_ls = [], []    for _ in range(num_epochs):        for X, y in train_iter:            # æ·»åŠ äº†L2èŒƒæ•°æƒ©ç½šé¡¹            l = loss(net(X, w, b), y) + lambd * l2_penalty(w)            l = l.sum()            if w.grad is not None:                w.grad.data.zero_()                b.grad.data.zero_()            l.backward()            d2l.sgd([w, b], lr, batch_size)        train_ls.append(loss(net(train_features, w, b), train_labels).mean().item())        test_ls.append(loss(net(test_features, w, b), test_labels).mean().item())    d2l.semilogy(range(1, num_epochs + 1), train_ls, &#39;epochs&#39;, &#39;loss&#39;,                 range(1, num_epochs + 1), test_ls, [&#39;train&#39;, &#39;test&#39;])    print(&#39;L2 norm of w:&#39;, w.norm().item())</code></pre><h2 id="è§‚å¯Ÿè¿‡æ‹Ÿåˆ"><a href="#è§‚å¯Ÿè¿‡æ‹Ÿåˆ" class="headerlink" title="è§‚å¯Ÿè¿‡æ‹Ÿåˆ"></a>è§‚å¯Ÿè¿‡æ‹Ÿåˆ</h2><pre><code class="lang-python">fit_and_plot(lambd=0)</code></pre><pre><code>L2 norm of w: 11.6444091796875</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/C27406AAA0FD41C6801D55ED4B25D5EA/q5jf5cs7lp.svg"></p><h2 id="ä½¿ç”¨æƒé‡è¡°å‡"><a href="#ä½¿ç”¨æƒé‡è¡°å‡" class="headerlink" title="ä½¿ç”¨æƒé‡è¡°å‡"></a>ä½¿ç”¨æƒé‡è¡°å‡</h2><pre><code class="lang-python">fit_and_plot(lambd=3)</code></pre><pre><code>L2 norm of w: 0.04063604772090912</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/0770D8C23B8144C59D13D24390E471F0/q5jf5d4mwp.svg"></p><h2 id="ç®€æ´å®ç°"><a href="#ç®€æ´å®ç°" class="headerlink" title="ç®€æ´å®ç°"></a>ç®€æ´å®ç°</h2><pre><code class="lang-python">def fit_and_plot_pytorch(wd):    # å¯¹æƒé‡å‚æ•°è¡°å‡ã€‚æƒé‡åç§°ä¸€èˆ¬æ˜¯ä»¥weightç»“å°¾    net = nn.Linear(num_inputs, 1)    nn.init.normal_(net.weight, mean=0, std=1)    nn.init.normal_(net.bias, mean=0, std=1)    optimizer_w = torch.optim.SGD(params=[net.weight], lr=lr, weight_decay=wd) # å¯¹æƒé‡å‚æ•°è¡°å‡    optimizer_b = torch.optim.SGD(params=[net.bias], lr=lr)  # ä¸å¯¹åå·®å‚æ•°è¡°å‡    train_ls, test_ls = [], []    for _ in range(num_epochs):        for X, y in train_iter:            l = loss(net(X), y).mean()            optimizer_w.zero_grad()            optimizer_b.zero_grad()            l.backward()            # å¯¹ä¸¤ä¸ªoptimizerå®ä¾‹åˆ†åˆ«è°ƒç”¨stepå‡½æ•°ï¼Œä»è€Œåˆ†åˆ«æ›´æ–°æƒé‡å’Œåå·®            optimizer_w.step()            optimizer_b.step()        train_ls.append(loss(net(train_features), train_labels).mean().item())        test_ls.append(loss(net(test_features), test_labels).mean().item())    d2l.semilogy(range(1, num_epochs + 1), train_ls, &#39;epochs&#39;, &#39;loss&#39;,                 range(1, num_epochs + 1), test_ls, [&#39;train&#39;, &#39;test&#39;])    print(&#39;L2 norm of w:&#39;, net.weight.data.norm().item())</code></pre><pre><code class="lang-python">fit_and_plot_pytorch(0)</code></pre><pre><code>L2 norm of w: 13.361410140991211</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/525D01167F0E40509495588D6B0A0FB9/q5jf5e5i21.svg"></p><pre><code class="lang-python">fit_and_plot_pytorch(3)</code></pre><pre><code>L2 norm of w: 0.051789578050374985</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/3FAACA854B9545A8ADADDEB6EE17A680/q5jf5fa51u.svg"></p><h1 id="ä¸¢å¼ƒæ³•"><a href="#ä¸¢å¼ƒæ³•" class="headerlink" title="ä¸¢å¼ƒæ³•"></a>ä¸¢å¼ƒæ³•</h1><p>å¤šå±‚æ„ŸçŸ¥æœºä¸­ç¥ç»ç½‘ç»œå›¾æè¿°äº†ä¸€ä¸ªå•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºã€‚å…¶ä¸­è¾“å…¥ä¸ªæ•°ä¸º4ï¼Œéšè—å•å…ƒä¸ªæ•°ä¸º5ï¼Œä¸”éšè—å•å…ƒ$h_i$ï¼ˆ$i=1, \ldots, 5$ï¼‰çš„è®¡ç®—è¡¨è¾¾å¼ä¸º</p><script type="math/tex; mode=display"> h_i = \phi\left(x_1 w_{1i} + x_2 w_{2i} + x_3 w_{3i} + x_4 w_{4i} + b_i\right)</script><p>è¿™é‡Œ$\phi$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$x_1, \ldots, x_4$æ˜¯è¾“å…¥ï¼Œéšè—å•å…ƒ$i$çš„æƒé‡å‚æ•°ä¸º$w_{1i}, \ldots, w_{4i}$ï¼Œåå·®å‚æ•°ä¸º$b_i$ã€‚å½“å¯¹è¯¥éšè—å±‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶ï¼Œè¯¥å±‚çš„éšè—å•å…ƒå°†æœ‰ä¸€å®šæ¦‚ç‡è¢«ä¸¢å¼ƒæ‰ã€‚è®¾ä¸¢å¼ƒæ¦‚ç‡ä¸º$p$ï¼Œé‚£ä¹ˆæœ‰$p$çš„æ¦‚ç‡$h_i$ä¼šè¢«æ¸…é›¶ï¼Œæœ‰$1-p$çš„æ¦‚ç‡$h_i$ä¼šé™¤ä»¥$1-p$åšæ‹‰ä¼¸ã€‚ä¸¢å¼ƒæ¦‚ç‡æ˜¯ä¸¢å¼ƒæ³•çš„è¶…å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œè®¾éšæœºå˜é‡$\xi_i$ä¸º0å’Œ1çš„æ¦‚ç‡åˆ†åˆ«ä¸º$p$å’Œ$1-p$ã€‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶æˆ‘ä»¬è®¡ç®—æ–°çš„éšè—å•å…ƒ$h_iâ€™$</p><script type="math/tex; mode=display"> h_i' = \frac{\xi_i}{1-p} h_i</script><p>ç”±äº$E(\xi_i) = 1-p$ï¼Œå› æ­¤</p><script type="math/tex; mode=display"> E(h_i') = \frac{E(\xi_i)}{1-p}h_i = h_i</script><p>å³ä¸¢å¼ƒæ³•ä¸æ”¹å˜å…¶è¾“å…¥çš„æœŸæœ›å€¼ã€‚è®©æˆ‘ä»¬å¯¹ä¹‹å‰å¤šå±‚æ„ŸçŸ¥æœºçš„ç¥ç»ç½‘ç»œä¸­çš„éšè—å±‚ä½¿ç”¨ä¸¢å¼ƒæ³•ï¼Œä¸€ç§å¯èƒ½çš„ç»“æœå¦‚å›¾æ‰€ç¤ºï¼Œå…¶ä¸­$h_2$å’Œ$h_5$è¢«æ¸…é›¶ã€‚è¿™æ—¶è¾“å‡ºå€¼çš„è®¡ç®—ä¸å†ä¾èµ–$h_2$å’Œ$h_5$ï¼Œåœ¨åå‘ä¼ æ’­æ—¶ï¼Œä¸è¿™ä¸¤ä¸ªéšè—å•å…ƒç›¸å…³çš„æƒé‡çš„æ¢¯åº¦å‡ä¸º0ã€‚ç”±äºåœ¨è®­ç»ƒä¸­éšè—å±‚ç¥ç»å…ƒçš„ä¸¢å¼ƒæ˜¯éšæœºçš„ï¼Œå³$h_1, \ldots, h_5$éƒ½æœ‰å¯èƒ½è¢«æ¸…é›¶ï¼Œè¾“å‡ºå±‚çš„è®¡ç®—æ— æ³•è¿‡åº¦ä¾èµ–$h_1, \ldots, h_5$ä¸­çš„ä»»ä¸€ä¸ªï¼Œä»è€Œåœ¨è®­ç»ƒæ¨¡å‹æ—¶èµ·åˆ°æ­£åˆ™åŒ–çš„ä½œç”¨ï¼Œå¹¶å¯ä»¥ç”¨æ¥åº”å¯¹è¿‡æ‹Ÿåˆã€‚åœ¨æµ‹è¯•æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†æ‹¿åˆ°æ›´åŠ ç¡®å®šæ€§çš„ç»“æœï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ä¸¢å¼ƒæ³•</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5jd69in3m.png?imageView2/0/w/960/h/960" alt="Image Name"></p><h2 id="ä¸¢å¼ƒæ³•ä»é›¶å¼€å§‹çš„å®ç°"><a href="#ä¸¢å¼ƒæ³•ä»é›¶å¼€å§‹çš„å®ç°" class="headerlink" title="ä¸¢å¼ƒæ³•ä»é›¶å¼€å§‹çš„å®ç°"></a>ä¸¢å¼ƒæ³•ä»é›¶å¼€å§‹çš„å®ç°</h2><pre><code class="lang-python">%matplotlib inlineimport torchimport torch.nn as nnimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><pre><code class="lang-python">def dropout(X, drop_prob):    X = X.float()    assert 0 &lt;= drop_prob &lt;= 1    keep_prob = 1 - drop_prob    # è¿™ç§æƒ…å†µä¸‹æŠŠå…¨éƒ¨å…ƒç´ éƒ½ä¸¢å¼ƒ    if keep_prob == 0:        return torch.zeros_like(X)    mask = (torch.rand(X.shape) &lt; keep_prob).float()    return mask * X / keep_prob</code></pre><pre><code class="lang-python">X = torch.arange(16).view(2, 8)dropout(X, 0)</code></pre><pre><code>tensor([[ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.],        [ 8.,  9., 10., 11., 12., 13., 14., 15.]])</code></pre><pre><code class="lang-python">dropout(X, 0.5)</code></pre><pre><code>tensor([[ 0.,  0.,  0.,  6.,  8., 10.,  0., 14.],        [ 0.,  0., 20.,  0.,  0.,  0., 28.,  0.]])</code></pre><pre><code class="lang-python">dropout(X, 1.0)</code></pre><pre><code>tensor([[0., 0., 0., 0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0., 0., 0., 0.]])</code></pre><pre><code class="lang-python"># å‚æ•°çš„åˆå§‹åŒ–num_inputs, num_outputs, num_hiddens1, num_hiddens2 = 784, 10, 256, 256W1 = torch.tensor(np.random.normal(0, 0.01, size=(num_inputs, num_hiddens1)), dtype=torch.float, requires_grad=True)b1 = torch.zeros(num_hiddens1, requires_grad=True)W2 = torch.tensor(np.random.normal(0, 0.01, size=(num_hiddens1, num_hiddens2)), dtype=torch.float, requires_grad=True)b2 = torch.zeros(num_hiddens2, requires_grad=True)W3 = torch.tensor(np.random.normal(0, 0.01, size=(num_hiddens2, num_outputs)), dtype=torch.float, requires_grad=True)b3 = torch.zeros(num_outputs, requires_grad=True)params = [W1, b1, W2, b2, W3, b3]</code></pre><pre><code class="lang-python">drop_prob1, drop_prob2 = 0.2, 0.5def net(X, is_training=True):    X = X.view(-1, num_inputs)    H1 = (torch.matmul(X, W1) + b1).relu()    if is_training:  # åªåœ¨è®­ç»ƒæ¨¡å‹æ—¶ä½¿ç”¨ä¸¢å¼ƒæ³•        H1 = dropout(H1, drop_prob1)  # åœ¨ç¬¬ä¸€å±‚å…¨è¿æ¥åæ·»åŠ ä¸¢å¼ƒå±‚    H2 = (torch.matmul(H1, W2) + b2).relu()    if is_training:        H2 = dropout(H2, drop_prob2)  # åœ¨ç¬¬äºŒå±‚å…¨è¿æ¥åæ·»åŠ ä¸¢å¼ƒå±‚    return torch.matmul(H2, W3) + b3</code></pre><pre><code class="lang-python">def evaluate_accuracy(data_iter, net):    acc_sum, n = 0.0, 0    for X, y in data_iter:        if isinstance(net, torch.nn.Module):            net.eval() # è¯„ä¼°æ¨¡å¼, è¿™ä¼šå…³é—­dropout            acc_sum += (net(X).argmax(dim=1) == y).float().sum().item()            net.train() # æ”¹å›è®­ç»ƒæ¨¡å¼        else: # è‡ªå®šä¹‰çš„æ¨¡å‹            if(&#39;is_training&#39; in net.__code__.co_varnames): # å¦‚æœæœ‰is_trainingè¿™ä¸ªå‚æ•°                # å°†is_trainingè®¾ç½®æˆFalse                acc_sum += (net(X, is_training=False).argmax(dim=1) == y).float().sum().item()             else:                acc_sum += (net(X).argmax(dim=1) == y).float().sum().item()         n += y.shape[0]    return acc_sum / n</code></pre><pre><code class="lang-python">num_epochs, lr, batch_size = 5, 100.0, 256  # è¿™é‡Œçš„å­¦ä¹ ç‡è®¾ç½®çš„å¾ˆå¤§ï¼ŒåŸå› ä¸ä¹‹å‰ç›¸åŒã€‚loss = torch.nn.CrossEntropyLoss()train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, root=&#39;/home/kesci/input/FashionMNIST2065&#39;)d2l.train_ch3(    net,    train_iter,    test_iter,    loss,    num_epochs,    batch_size,    params,    lr)</code></pre><pre><code>epoch 1, loss 0.0046, train acc 0.549, test acc 0.704epoch 2, loss 0.0023, train acc 0.785, test acc 0.737epoch 3, loss 0.0019, train acc 0.825, test acc 0.834epoch 4, loss 0.0017, train acc 0.842, test acc 0.763epoch 5, loss 0.0016, train acc 0.848, test acc 0.813</code></pre><h2 id="ç®€æ´å®ç°-1"><a href="#ç®€æ´å®ç°-1" class="headerlink" title="ç®€æ´å®ç°"></a>ç®€æ´å®ç°</h2><pre><code class="lang-python">net = nn.Sequential(        d2l.FlattenLayer(),        nn.Linear(num_inputs, num_hiddens1),        nn.ReLU(),        nn.Dropout(drop_prob1),        nn.Linear(num_hiddens1, num_hiddens2),         nn.ReLU(),        nn.Dropout(drop_prob2),        nn.Linear(num_hiddens2, 10)        )for param in net.parameters():    nn.init.normal_(param, mean=0, std=0.01)</code></pre><pre><code class="lang-python">optimizer = torch.optim.SGD(net.parameters(), lr=0.5)d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, None, None, optimizer)</code></pre><pre><code>epoch 1, loss 0.0046, train acc 0.553, test acc 0.736epoch 2, loss 0.0023, train acc 0.785, test acc 0.803epoch 3, loss 0.0019, train acc 0.818, test acc 0.756epoch 4, loss 0.0018, train acc 0.835, test acc 0.829epoch 5, loss 0.0016, train acc 0.848, test acc 0.851</code></pre><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li><p>æ¬ æ‹Ÿåˆç°è±¡ï¼šæ¨¡å‹æ— æ³•è¾¾åˆ°ä¸€ä¸ªè¾ƒä½çš„è¯¯å·®</p></li><li><p>è¿‡æ‹Ÿåˆç°è±¡ï¼šè®­ç»ƒè¯¯å·®è¾ƒä½ä½†æ˜¯æ³›åŒ–è¯¯å·®ä¾ç„¶è¾ƒé«˜ï¼ŒäºŒè€…ç›¸å·®è¾ƒå¤§</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (ä¸‰):å¤šå±‚æ„ŸçŸ¥æœº</title>
      <link href="/2020/02/14/dl-notes3-mlp/"/>
      <url>/2020/02/14/dl-notes3-mlp/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤šå±‚æ„ŸçŸ¥æœº"><a href="#å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœº"></a>å¤šå±‚æ„ŸçŸ¥æœº</h1><ol><li>å¤šå±‚æ„ŸçŸ¥æœºçš„åŸºæœ¬çŸ¥è¯†</li><li>ä½¿ç”¨å¤šå±‚æ„ŸçŸ¥æœºå›¾åƒåˆ†ç±»çš„ä»é›¶å¼€å§‹çš„å®ç°</li><li>ä½¿ç”¨pytorchçš„ç®€æ´å®ç°</li></ol><h2 id="å¤šå±‚æ„ŸçŸ¥æœºçš„åŸºæœ¬çŸ¥è¯†"><a href="#å¤šå±‚æ„ŸçŸ¥æœºçš„åŸºæœ¬çŸ¥è¯†" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœºçš„åŸºæœ¬çŸ¥è¯†"></a>å¤šå±‚æ„ŸçŸ¥æœºçš„åŸºæœ¬çŸ¥è¯†</h2><p>æ·±åº¦å­¦ä¹ ä¸»è¦å…³æ³¨å¤šå±‚æ¨¡å‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä»¥å¤šå±‚æ„ŸçŸ¥æœºï¼ˆmultilayer perceptronï¼ŒMLPï¼‰ä¸ºä¾‹ï¼Œä»‹ç»å¤šå±‚ç¥ç»ç½‘ç»œçš„æ¦‚å¿µã€‚</p><h3 id="éšè—å±‚"><a href="#éšè—å±‚" class="headerlink" title="éšè—å±‚"></a>éšè—å±‚</h3><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºçš„ç¥ç»ç½‘ç»œå›¾ï¼Œå®ƒå«æœ‰ä¸€ä¸ªéšè—å±‚ï¼Œè¯¥å±‚ä¸­æœ‰5ä¸ªéšè—å•å…ƒã€‚</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5ho684jmh.png" alt="Image Name"></p><h3 id="è¡¨è¾¾å…¬å¼"><a href="#è¡¨è¾¾å…¬å¼" class="headerlink" title="è¡¨è¾¾å…¬å¼"></a>è¡¨è¾¾å…¬å¼</h3><p>å…·ä½“æ¥è¯´ï¼Œç»™å®šä¸€ä¸ªå°æ‰¹é‡æ ·æœ¬$\boldsymbol{X} \in \mathbb{R}^{n \times d}$ï¼Œå…¶æ‰¹é‡å¤§å°ä¸º$n$ï¼Œè¾“å…¥ä¸ªæ•°ä¸º$d$ã€‚å‡è®¾å¤šå±‚æ„ŸçŸ¥æœºåªæœ‰ä¸€ä¸ªéšè—å±‚ï¼Œå…¶ä¸­éšè—å•å…ƒä¸ªæ•°ä¸º$h$ã€‚è®°éšè—å±‚çš„è¾“å‡ºï¼ˆä¹Ÿç§°ä¸ºéšè—å±‚å˜é‡æˆ–éšè—å˜é‡ï¼‰ä¸º$\boldsymbol{H}$ï¼Œæœ‰$\boldsymbol{H} \in \mathbb{R}^{n \times h}$ã€‚å› ä¸ºéšè—å±‚å’Œè¾“å‡ºå±‚å‡æ˜¯å…¨è¿æ¥å±‚ï¼Œå¯ä»¥è®¾éšè—å±‚çš„æƒé‡å‚æ•°å’Œåå·®å‚æ•°åˆ†åˆ«ä¸º$\boldsymbol{W}_h \in \mathbb{R}^{d \times h}$å’Œ $\boldsymbol{b}_h \in \mathbb{R}^{1 \times h}$ï¼Œè¾“å‡ºå±‚çš„æƒé‡å’Œåå·®å‚æ•°åˆ†åˆ«ä¸º$\boldsymbol{W}_o \in \mathbb{R}^{h \times q}$å’Œ$\boldsymbol{b}_o \in \mathbb{R}^{1 \times q}$ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ç§å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºçš„è®¾è®¡ã€‚å…¶è¾“å‡º$\boldsymbol{O} \in \mathbb{R}^{n \times q}$çš„è®¡ç®—ä¸º</p><script type="math/tex; mode=display"> \begin{aligned} \boldsymbol{H} &= \boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h,\\ \boldsymbol{O} &= \boldsymbol{H} \boldsymbol{W}_o + \boldsymbol{b}_o, \end{aligned}</script><p>ä¹Ÿå°±æ˜¯å°†éšè—å±‚çš„è¾“å‡ºç›´æ¥ä½œä¸ºè¾“å‡ºå±‚çš„è¾“å…¥ã€‚å¦‚æœå°†ä»¥ä¸Šä¸¤ä¸ªå¼å­è”ç«‹èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display"> \boldsymbol{O} = (\boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h)\boldsymbol{W}_o + \boldsymbol{b}_o = \boldsymbol{X} \boldsymbol{W}_h\boldsymbol{W}_o + \boldsymbol{b}_h \boldsymbol{W}_o + \boldsymbol{b}_o.</script><p>ä»è”ç«‹åçš„å¼å­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶ç¥ç»ç½‘ç»œå¼•å…¥äº†éšè—å±‚ï¼Œå´ä¾ç„¶ç­‰ä»·äºä¸€ä¸ªå•å±‚ç¥ç»ç½‘ç»œï¼šå…¶ä¸­è¾“å‡ºå±‚æƒé‡å‚æ•°ä¸º$\boldsymbol{W}_h\boldsymbol{W}_o$ï¼Œåå·®å‚æ•°ä¸º$\boldsymbol{b}_h \boldsymbol{W}_o + \boldsymbol{b}_o$ã€‚ä¸éš¾å‘ç°ï¼Œå³ä¾¿å†æ·»åŠ æ›´å¤šçš„éšè—å±‚ï¼Œä»¥ä¸Šè®¾è®¡ä¾ç„¶åªèƒ½ä¸ä»…å«è¾“å‡ºå±‚çš„å•å±‚ç¥ç»ç½‘ç»œç­‰ä»·ã€‚</p><h3 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h3><p>ä¸Šè¿°é—®é¢˜çš„æ ¹æºåœ¨äºå…¨è¿æ¥å±‚åªæ˜¯å¯¹æ•°æ®åšä»¿å°„å˜æ¢ï¼ˆaffine transformationï¼‰ï¼Œè€Œå¤šä¸ªä»¿å°„å˜æ¢çš„å åŠ ä»ç„¶æ˜¯ä¸€ä¸ªä»¿å°„å˜æ¢ã€‚è§£å†³é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å¼•å…¥éçº¿æ€§å˜æ¢ï¼Œä¾‹å¦‚å¯¹éšè—å˜é‡ä½¿ç”¨æŒ‰å…ƒç´ è¿ç®—çš„éçº¿æ€§å‡½æ•°è¿›è¡Œå˜æ¢ï¼Œç„¶åå†ä½œä¸ºä¸‹ä¸€ä¸ªå…¨è¿æ¥å±‚çš„è¾“å…¥ã€‚è¿™ä¸ªéçº¿æ€§å‡½æ•°è¢«ç§°ä¸ºæ¿€æ´»å‡½æ•°ï¼ˆactivation functionï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ï¼š</p><h4 id="ReLUå‡½æ•°"><a href="#ReLUå‡½æ•°" class="headerlink" title="ReLUå‡½æ•°"></a>ReLUå‡½æ•°</h4><p>ReLUï¼ˆrectified linear unitï¼‰å‡½æ•°æä¾›äº†ä¸€ä¸ªå¾ˆç®€å•çš„éçº¿æ€§å˜æ¢ã€‚ç»™å®šå…ƒç´ $x$ï¼Œè¯¥å‡½æ•°å®šä¹‰ä¸º</p><script type="math/tex; mode=display">\text{ReLU}(x) = \max(x, 0).</script><p>å¯ä»¥çœ‹å‡ºï¼ŒReLUå‡½æ•°åªä¿ç•™æ­£æ•°å…ƒç´ ï¼Œå¹¶å°†è´Ÿæ•°å…ƒç´ æ¸…é›¶ã€‚ä¸ºäº†ç›´è§‚åœ°è§‚å¯Ÿè¿™ä¸€éçº¿æ€§å˜æ¢ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªç»˜å›¾å‡½æ•°xyplotã€‚</p><pre><code class="lang-python">%matplotlib inlineimport torchimport numpy as npimport matplotlib.pyplot as pltimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><pre><code class="lang-python">def xyplot(x_vals, y_vals, name):    # d2l.set_figsize(figsize=(5, 2.5))    plt.plot(x_vals.detach().numpy(), y_vals.detach().numpy())    plt.xlabel(&#39;x&#39;)    plt.ylabel(name + &#39;(x)&#39;)</code></pre><pre><code class="lang-python">x = torch.arange(-8.0, 8.0, 0.1, requires_grad=True)y = x.relu()xyplot(x, y, &#39;relu&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/070825B6A382411DA5BD7D14E67E8D54/q5hv7cdtna.png"></p><pre><code class="lang-python">y.sum().backward()xyplot(x, x.grad, &#39;grad of relu&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/BFB05150DBD1474D9A9ECCB9CDF1DD39/q5hv7c3pxb.png"></p><h4 id="Sigmoidå‡½æ•°"><a href="#Sigmoidå‡½æ•°" class="headerlink" title="Sigmoidå‡½æ•°"></a>Sigmoidå‡½æ•°</h4><p>sigmoidå‡½æ•°å¯ä»¥å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°0å’Œ1ä¹‹é—´ï¼š</p><script type="math/tex; mode=display">\text{sigmoid}(x) = \frac{1}{1 + \exp(-x)}.</script><pre><code class="lang-python">y = x.sigmoid()xyplot(x, y, &#39;sigmoid&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/68FCB4E8142144458F13128B370D1C91/q5hv7dor11.png"></p><p>ä¾æ®é“¾å¼æ³•åˆ™ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°</p><script type="math/tex; mode=display">\text{sigmoid}'(x) = \text{sigmoid}(x)\left(1-\text{sigmoid}(x)\right).</script><p>ä¸‹é¢ç»˜åˆ¶äº†sigmoidå‡½æ•°çš„å¯¼æ•°ã€‚å½“è¾“å…¥ä¸º0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼0.25ï¼›å½“è¾“å…¥è¶Šåç¦»0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚</p><pre><code class="lang-python">x.grad.zero_()y.sum().backward()xyplot(x, x.grad, &#39;grad of sigmoid&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/878C7B8823304F72860965E119A21412/q5hv7dpse9.png"></p><h4 id="tanhå‡½æ•°"><a href="#tanhå‡½æ•°" class="headerlink" title="tanhå‡½æ•°"></a>tanhå‡½æ•°</h4><p>tanhï¼ˆåŒæ›²æ­£åˆ‡ï¼‰å‡½æ•°å¯ä»¥å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°-1å’Œ1ä¹‹é—´ï¼š</p><script type="math/tex; mode=display">\text{tanh}(x) = \frac{1 - \exp(-2x)}{1 + \exp(-2x)}.</script><p>æˆ‘ä»¬æ¥ç€ç»˜åˆ¶tanhå‡½æ•°ã€‚å½“è¾“å…¥æ¥è¿‘0æ—¶ï¼Œtanhå‡½æ•°æ¥è¿‘çº¿æ€§å˜æ¢ã€‚è™½ç„¶è¯¥å‡½æ•°çš„å½¢çŠ¶å’Œsigmoidå‡½æ•°çš„å½¢çŠ¶å¾ˆåƒï¼Œä½†tanhå‡½æ•°åœ¨åæ ‡ç³»çš„åŸç‚¹ä¸Šå¯¹ç§°ã€‚</p><pre><code class="lang-python">y = x.tanh()xyplot(x, y, &#39;tanh&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/92D16076309F42169482834C0B6ABB24/q5hv7dfeso.png"></p><p>ä¾æ®é“¾å¼æ³•åˆ™ï¼Œtanhå‡½æ•°çš„å¯¼æ•°</p><script type="math/tex; mode=display">\text{tanh}'(x) = 1 - \text{tanh}^2(x).</script><p>ä¸‹é¢ç»˜åˆ¶äº†tanhå‡½æ•°çš„å¯¼æ•°ã€‚å½“è¾“å…¥ä¸º0æ—¶ï¼Œtanhå‡½æ•°çš„å¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼1ï¼›å½“è¾“å…¥è¶Šåç¦»0æ—¶ï¼Œtanhå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚</p><pre><code class="lang-python">x.grad.zero_()y.sum().backward()xyplot(x, x.grad, &#39;grad of tanh&#39;)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/CB16F4B33E664E14BCE8E52D8B37C47F/q5hv7ejc8y.png"></p><h3 id="å…³äºæ¿€æ´»å‡½æ•°çš„é€‰æ‹©"><a href="#å…³äºæ¿€æ´»å‡½æ•°çš„é€‰æ‹©" class="headerlink" title="å…³äºæ¿€æ´»å‡½æ•°çš„é€‰æ‹©"></a>å…³äºæ¿€æ´»å‡½æ•°çš„é€‰æ‹©</h3><p>ReLuå‡½æ•°æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œç›®å‰åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ã€‚ä½†æ˜¯ï¼ŒReLUå‡½æ•°åªèƒ½åœ¨éšè—å±‚ä¸­ä½¿ç”¨ã€‚</p><p>ç”¨äºåˆ†ç±»å™¨æ—¶ï¼Œsigmoidå‡½æ•°åŠå…¶ç»„åˆé€šå¸¸æ•ˆæœæ›´å¥½ã€‚ç”±äºæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œæœ‰æ—¶è¦é¿å…ä½¿ç”¨sigmoidå’Œtanhå‡½æ•°ã€‚  </p><p>åœ¨ç¥ç»ç½‘ç»œå±‚æ•°è¾ƒå¤šçš„æ—¶å€™ï¼Œæœ€å¥½ä½¿ç”¨ReLuå‡½æ•°ï¼ŒReLuå‡½æ•°æ¯”è¾ƒç®€å•è®¡ç®—é‡å°‘ï¼Œè€Œsigmoidå’Œtanhå‡½æ•°è®¡ç®—é‡å¤§å¾ˆå¤šã€‚</p><p>åœ¨é€‰æ‹©æ¿€æ´»å‡½æ•°çš„æ—¶å€™å¯ä»¥å…ˆé€‰ç”¨ReLuå‡½æ•°å¦‚æœæ•ˆæœä¸ç†æƒ³å¯ä»¥å°è¯•å…¶ä»–æ¿€æ´»å‡½æ•°ã€‚</p><h3 id="å¤šå±‚æ„ŸçŸ¥æœº-1"><a href="#å¤šå±‚æ„ŸçŸ¥æœº-1" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœº"></a>å¤šå±‚æ„ŸçŸ¥æœº</h3><p>å¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯å«æœ‰è‡³å°‘ä¸€ä¸ªéšè—å±‚çš„ç”±å…¨è¿æ¥å±‚ç»„æˆçš„ç¥ç»ç½‘ç»œï¼Œä¸”æ¯ä¸ªéšè—å±‚çš„è¾“å‡ºé€šè¿‡æ¿€æ´»å‡½æ•°è¿›è¡Œå˜æ¢ã€‚å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚æ•°å’Œå„éšè—å±‚ä¸­éšè—å•å…ƒä¸ªæ•°éƒ½æ˜¯è¶…å‚æ•°ã€‚ä»¥å•éšè—å±‚ä¸ºä¾‹å¹¶æ²¿ç”¨æœ¬èŠ‚ä¹‹å‰å®šä¹‰çš„ç¬¦å·ï¼Œå¤šå±‚æ„ŸçŸ¥æœºæŒ‰ä»¥ä¸‹æ–¹å¼è®¡ç®—è¾“å‡ºï¼š</p><script type="math/tex; mode=display"> \begin{aligned} \boldsymbol{H} &= \phi(\boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h),\\ \boldsymbol{O} &= \boldsymbol{H} \boldsymbol{W}_o + \boldsymbol{b}_o, \end{aligned}</script><p>å…¶ä¸­$\phi$è¡¨ç¤ºæ¿€æ´»å‡½æ•°ã€‚</p><h2 id="å¤šå±‚æ„ŸçŸ¥æœºä»é›¶å¼€å§‹çš„å®ç°"><a href="#å¤šå±‚æ„ŸçŸ¥æœºä»é›¶å¼€å§‹çš„å®ç°" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœºä»é›¶å¼€å§‹çš„å®ç°"></a>å¤šå±‚æ„ŸçŸ¥æœºä»é›¶å¼€å§‹çš„å®ç°</h2><pre><code class="lang-python">import torchimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h3 id="è·å–è®­ç»ƒé›†"><a href="#è·å–è®­ç»ƒé›†" class="headerlink" title="è·å–è®­ç»ƒé›†"></a>è·å–è®­ç»ƒé›†</h3><pre><code class="lang-python">batch_size = 256train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size,root=&#39;/home/kesci/input/FashionMNIST2065&#39;)</code></pre><h3 id="å®šä¹‰æ¨¡å‹å‚æ•°"><a href="#å®šä¹‰æ¨¡å‹å‚æ•°" class="headerlink" title="å®šä¹‰æ¨¡å‹å‚æ•°"></a>å®šä¹‰æ¨¡å‹å‚æ•°</h3><pre><code class="lang-python">num_inputs, num_outputs, num_hiddens = 784, 10, 256W1 = torch.tensor(np.random.normal(0, 0.01, (num_inputs, num_hiddens)), dtype=torch.float)b1 = torch.zeros(num_hiddens, dtype=torch.float)W2 = torch.tensor(np.random.normal(0, 0.01, (num_hiddens, num_outputs)), dtype=torch.float)b2 = torch.zeros(num_outputs, dtype=torch.float)params = [W1, b1, W2, b2]for param in params:    param.requires_grad_(requires_grad=True)</code></pre><h3 id="å®šä¹‰æ¿€æ´»å‡½æ•°"><a href="#å®šä¹‰æ¿€æ´»å‡½æ•°" class="headerlink" title="å®šä¹‰æ¿€æ´»å‡½æ•°"></a>å®šä¹‰æ¿€æ´»å‡½æ•°</h3><pre><code class="lang-python">def relu(X):    return torch.max(input=X, other=torch.tensor(0.0))</code></pre><h3 id="å®šä¹‰ç½‘ç»œ"><a href="#å®šä¹‰ç½‘ç»œ" class="headerlink" title="å®šä¹‰ç½‘ç»œ"></a>å®šä¹‰ç½‘ç»œ</h3><pre><code class="lang-python">def net(X):    X = X.view((-1, num_inputs))    H = relu(torch.matmul(X, W1) + b1)    return torch.matmul(H, W2) + b2</code></pre><h3 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><pre><code class="lang-python">loss = torch.nn.CrossEntropyLoss()</code></pre><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><pre><code class="lang-python">num_epochs, lr = 5, 100.0# def train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size,#               params=None, lr=None, optimizer=None):#     for epoch in range(num_epochs):#         train_l_sum, train_acc_sum, n = 0.0, 0.0, 0#         for X, y in train_iter:#             y_hat = net(X)#             l = loss(y_hat, y).sum()#             #             # æ¢¯åº¦æ¸…é›¶#             if optimizer is not None:#                 optimizer.zero_grad()#             elif params is not None and params[0].grad is not None:#                 for param in params:#                     param.grad.data.zero_()#            #             l.backward()#             if optimizer is None:#                 d2l.sgd(params, lr, batch_size)#             else:#                 optimizer.step()  # â€œsoftmaxå›å½’çš„ç®€æ´å®ç°â€ä¸€èŠ‚å°†ç”¨åˆ°#             #             #             train_l_sum += l.item()#             train_acc_sum += (y_hat.argmax(dim=1) == y).sum().item()#             n += y.shape[0]#         test_acc = evaluate_accuracy(test_iter, net)#         print(&#39;epoch %d, loss %.4f, train acc %.3f, test acc %.3f&#39;#               % (epoch + 1, train_l_sum / n, train_acc_sum / n, test_acc))d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, params, lr)</code></pre><pre><code>epoch 1, loss 0.0030, train acc 0.712, test acc 0.806epoch 2, loss 0.0019, train acc 0.821, test acc 0.806epoch 3, loss 0.0017, train acc 0.847, test acc 0.825epoch 4, loss 0.0015, train acc 0.856, test acc 0.834epoch 5, loss 0.0015, train acc 0.863, test acc 0.847</code></pre><h2 id="å¤šå±‚æ„ŸçŸ¥æœºpytorchå®ç°"><a href="#å¤šå±‚æ„ŸçŸ¥æœºpytorchå®ç°" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœºpytorchå®ç°"></a>å¤šå±‚æ„ŸçŸ¥æœºpytorchå®ç°</h2><pre><code class="lang-python">import torchfrom torch import nnfrom torch.nn import initimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h3 id="åˆå§‹åŒ–æ¨¡å‹å’Œå„ä¸ªå‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å’Œå„ä¸ªå‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å’Œå„ä¸ªå‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å’Œå„ä¸ªå‚æ•°</h3><pre><code class="lang-python">num_inputs, num_outputs, num_hiddens = 784, 10, 256net = nn.Sequential(        d2l.FlattenLayer(),        nn.Linear(num_inputs, num_hiddens),        nn.ReLU(),        nn.Linear(num_hiddens, num_outputs),         )for params in net.parameters():    init.normal_(params, mean=0, std=0.01)</code></pre><h3 id="è®­ç»ƒ-1"><a href="#è®­ç»ƒ-1" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><pre><code class="lang-python">batch_size = 256train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size,root=&#39;/home/kesci/input/FashionMNIST2065&#39;)loss = torch.nn.CrossEntropyLoss()optimizer = torch.optim.SGD(net.parameters(), lr=0.5)num_epochs = 5d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, None, None, optimizer)</code></pre><pre><code>epoch 1, loss 0.0031, train acc 0.701, test acc 0.774epoch 2, loss 0.0019, train acc 0.821, test acc 0.806epoch 3, loss 0.0017, train acc 0.841, test acc 0.805epoch 4, loss 0.0015, train acc 0.855, test acc 0.834epoch 5, loss 0.0014, train acc 0.866, test acc 0.840</code></pre><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/amdb6W3tQBRyuXE.png" alt=""></p><p>256x256x1000 + 1000x10 = 65546000</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (äºŒ):Softmax</title>
      <link href="/2020/02/14/dl-notes2-softmax/"/>
      <url>/2020/02/14/dl-notes2-softmax/</url>
      
        <content type="html"><![CDATA[<h1 id="softmaxå’Œåˆ†ç±»æ¨¡å‹"><a href="#softmaxå’Œåˆ†ç±»æ¨¡å‹" class="headerlink" title="softmaxå’Œåˆ†ç±»æ¨¡å‹"></a>softmaxå’Œåˆ†ç±»æ¨¡å‹</h1><p>å†…å®¹åŒ…å«ï¼š</p><ol><li>softmaxå›å½’çš„åŸºæœ¬æ¦‚å¿µ</li><li>å¦‚ä½•è·å–Fashion-MNISTæ•°æ®é›†å’Œè¯»å–æ•°æ®</li><li>softmaxå›å½’æ¨¡å‹çš„ä»é›¶å¼€å§‹å®ç°ï¼Œå®ç°ä¸€ä¸ªå¯¹Fashion-MNISTè®­ç»ƒé›†ä¸­çš„å›¾åƒæ•°æ®è¿›è¡Œåˆ†ç±»çš„æ¨¡å‹</li><li>ä½¿ç”¨pytorché‡æ–°å®ç°softmaxå›å½’æ¨¡å‹</li></ol><h2 id="softmaxçš„åŸºæœ¬æ¦‚å¿µ"><a href="#softmaxçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="softmaxçš„åŸºæœ¬æ¦‚å¿µ"></a>softmaxçš„åŸºæœ¬æ¦‚å¿µ</h2><ul><li><p>åˆ†ç±»é—®é¢˜<br>ä¸€ä¸ªç®€å•çš„å›¾åƒåˆ†ç±»é—®é¢˜ï¼Œè¾“å…¥å›¾åƒçš„é«˜å’Œå®½å‡ä¸º2åƒç´ ï¼Œè‰²å½©ä¸ºç°åº¦ã€‚<br>å›¾åƒä¸­çš„4åƒç´ åˆ†åˆ«è®°ä¸º$x_1, x_2, x_3, x_4$ã€‚<br>å‡è®¾çœŸå®æ ‡ç­¾ä¸ºç‹—ã€çŒ«æˆ–è€…é¸¡ï¼Œè¿™äº›æ ‡ç­¾å¯¹åº”çš„ç¦»æ•£å€¼ä¸º$y_1, y_2, y_3$ã€‚<br>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç¦»æ•£çš„æ•°å€¼æ¥è¡¨ç¤ºç±»åˆ«ï¼Œä¾‹å¦‚$y_1=1, y_2=2, y_3=3$ã€‚</p></li><li><p>æƒé‡çŸ¢é‡  </p><script type="math/tex; mode=display">\begin{aligned} o_1 &= x_1 w_{11} + x_2 w_{21} + x_3 w_{31} + x_4 w_{41} + b_1 \end{aligned}</script></li></ul><script type="math/tex; mode=display"> \begin{aligned} o_2 &= x_1 w_{12} + x_2 w_{22} + x_3 w_{32} + x_4 w_{42} + b_2 \end{aligned}</script><script type="math/tex; mode=display"> \begin{aligned} o_3 &= x_1 w_{13} + x_2 w_{23} + x_3 w_{33} + x_4 w_{43} + b_3 \end{aligned}</script><ul><li>ç¥ç»ç½‘ç»œå›¾<br>ä¸‹å›¾ç”¨ç¥ç»ç½‘ç»œå›¾æç»˜äº†ä¸Šé¢çš„è®¡ç®—ã€‚softmaxå›å½’åŒçº¿æ€§å›å½’ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå•å±‚ç¥ç»ç½‘ç»œã€‚ç”±äºæ¯ä¸ªè¾“å‡º$o_1, o_2, o_3$çš„è®¡ç®—éƒ½è¦ä¾èµ–äºæ‰€æœ‰çš„è¾“å…¥$x_1, x_2, x_3, x_4$ï¼Œsoftmaxå›å½’çš„è¾“å‡ºå±‚ä¹Ÿæ˜¯ä¸€ä¸ªå…¨è¿æ¥å±‚ã€‚</li></ul><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/upload/image/q5hmymezog.png" alt="Image Name"></p><script type="math/tex; mode=display">\begin{aligned}softmaxå›å½’æ˜¯ä¸€ä¸ªå•å±‚ç¥ç»ç½‘ç»œ\end{aligned}</script><p>æ—¢ç„¶åˆ†ç±»é—®é¢˜éœ€è¦å¾—åˆ°ç¦»æ•£çš„é¢„æµ‹è¾“å‡ºï¼Œä¸€ä¸ªç®€å•çš„åŠæ³•æ˜¯å°†è¾“å‡ºå€¼$o_i$å½“ä½œé¢„æµ‹ç±»åˆ«æ˜¯$i$çš„ç½®ä¿¡åº¦ï¼Œå¹¶å°†å€¼æœ€å¤§çš„è¾“å‡ºæ‰€å¯¹åº”çš„ç±»ä½œä¸ºé¢„æµ‹è¾“å‡ºï¼Œå³è¾“å‡º $\underset{i}{\arg\max} o_i$ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ$o_1,o_2,o_3$åˆ†åˆ«ä¸º$0.1,10,0.1$ï¼Œç”±äº$o_2$æœ€å¤§ï¼Œé‚£ä¹ˆé¢„æµ‹ç±»åˆ«ä¸º2ï¼Œå…¶ä»£è¡¨çŒ«ã€‚</p><ul><li>è¾“å‡ºé—®é¢˜<br>ç›´æ¥ä½¿ç”¨è¾“å‡ºå±‚çš„è¾“å‡ºæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š<ol><li>ä¸€æ–¹é¢ï¼Œç”±äºè¾“å‡ºå±‚çš„è¾“å‡ºå€¼çš„èŒƒå›´ä¸ç¡®å®šï¼Œæˆ‘ä»¬éš¾ä»¥ç›´è§‚ä¸Šåˆ¤æ–­è¿™äº›å€¼çš„æ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œåˆšæ‰ä¸¾çš„ä¾‹å­ä¸­çš„è¾“å‡ºå€¼10è¡¨ç¤ºâ€œå¾ˆç½®ä¿¡â€å›¾åƒç±»åˆ«ä¸ºçŒ«ï¼Œå› ä¸ºè¯¥è¾“å‡ºå€¼æ˜¯å…¶ä»–ä¸¤ç±»çš„è¾“å‡ºå€¼çš„100å€ã€‚ä½†å¦‚æœ$o_1=o_3=10^3$ï¼Œé‚£ä¹ˆè¾“å‡ºå€¼10å´åˆè¡¨ç¤ºå›¾åƒç±»åˆ«ä¸ºçŒ«çš„æ¦‚ç‡å¾ˆä½ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œç”±äºçœŸå®æ ‡ç­¾æ˜¯ç¦»æ•£å€¼ï¼Œè¿™äº›ç¦»æ•£å€¼ä¸ä¸ç¡®å®šèŒƒå›´çš„è¾“å‡ºå€¼ä¹‹é—´çš„è¯¯å·®éš¾ä»¥è¡¡é‡ã€‚</li></ol></li></ul><p>softmaxè¿ç®—ç¬¦ï¼ˆsoftmax operatorï¼‰è§£å†³äº†ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚å®ƒé€šè¿‡ä¸‹å¼å°†è¾“å‡ºå€¼å˜æ¢æˆå€¼ä¸ºæ­£ä¸”å’Œä¸º1çš„æ¦‚ç‡åˆ†å¸ƒï¼š</p><script type="math/tex; mode=display"> \hat{y}_1, \hat{y}_2, \hat{y}_3 = \text{softmax}(o_1, o_2, o_3)</script><p>å…¶ä¸­</p><script type="math/tex; mode=display"> \hat{y}1 = \frac{ \exp(o_1)}{\sum_{i=1}^3 \exp(o_i)},\quad \hat{y}2 = \frac{ \exp(o_2)}{\sum_{i=1}^3 \exp(o_i)},\quad \hat{y}3 = \frac{ \exp(o_3)}{\sum_{i=1}^3 \exp(o_i)}.</script><p>å®¹æ˜“çœ‹å‡º$\hat{y}_1 + \hat{y}_2 + \hat{y}_3 = 1$ä¸”$0 \leq \hat{y}_1, \hat{y}_2, \hat{y}_3 \leq 1$ï¼Œå› æ­¤$\hat{y}_1, \hat{y}_2, \hat{y}_3$æ˜¯ä¸€ä¸ªåˆæ³•çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™æ—¶å€™ï¼Œå¦‚æœ$\hat{y}_2=0.8$ï¼Œä¸ç®¡$\hat{y}_1$å’Œ$\hat{y}_3$çš„å€¼æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å›¾åƒç±»åˆ«ä¸ºçŒ«çš„æ¦‚ç‡æ˜¯80%ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°</p><script type="math/tex; mode=display"> \underset{i}{\arg\max} o_i = \underset{i}{\arg\max} \hat{y}_i</script><p>å› æ­¤softmaxè¿ç®—ä¸æ”¹å˜é¢„æµ‹ç±»åˆ«è¾“å‡ºã€‚</p><ul><li>è®¡ç®—æ•ˆç‡<ul><li>å•æ ·æœ¬çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼<br>ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å•æ ·æœ¬åˆ†ç±»é€šè¿‡çŸ¢é‡è®¡ç®—æ¥è¡¨è¾¾ã€‚åœ¨ä¸Šé¢çš„å›¾åƒåˆ†ç±»é—®é¢˜ä¸­ï¼Œå‡è®¾softmaxå›å½’çš„æƒé‡å’Œåå·®å‚æ•°åˆ†åˆ«ä¸º</li></ul></li></ul><script type="math/tex; mode=display"> \boldsymbol{W} = \begin{bmatrix} w_{11} & w_{12} & w_{13} \\ w_{21} & w_{22} & w_{23} \\ w_{31} & w_{32} & w_{33} \\ w_{41} & w_{42} & w_{43} \end{bmatrix},\quad \boldsymbol{b} = \begin{bmatrix} b_1 & b_2 & b_3 \end{bmatrix},</script><p>è®¾é«˜å’Œå®½åˆ†åˆ«ä¸º2ä¸ªåƒç´ çš„å›¾åƒæ ·æœ¬$i$çš„ç‰¹å¾ä¸º</p><script type="math/tex; mode=display">\boldsymbol{x}^{(i)} = \begin{bmatrix}x_1^{(i)} & x_2^{(i)} & x_3^{(i)} & x_4^{(i)}\end{bmatrix},</script><p>è¾“å‡ºå±‚çš„è¾“å‡ºä¸º</p><script type="math/tex; mode=display">\boldsymbol{o}^{(i)} = \begin{bmatrix}o_1^{(i)} & o_2^{(i)} & o_3^{(i)}\end{bmatrix},</script><p>é¢„æµ‹ä¸ºç‹—ã€çŒ«æˆ–é¸¡çš„æ¦‚ç‡åˆ†å¸ƒä¸º</p><script type="math/tex; mode=display">\boldsymbol{\hat{y}}^{(i)} = \begin{bmatrix}\hat{y}_1^{(i)} & \hat{y}_2^{(i)} & \hat{y}_3^{(i)}\end{bmatrix}.</script><p>softmaxå›å½’å¯¹æ ·æœ¬$i$åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼ä¸º</p><script type="math/tex; mode=display"> \begin{aligned} \boldsymbol{o}^{(i)} &= \boldsymbol{x}^{(i)} \boldsymbol{W} + \boldsymbol{b},\\ \boldsymbol{\hat{y}}^{(i)} &= \text{softmax}(\boldsymbol{o}^{(i)}). \end{aligned}</script><ul><li>å°æ‰¹é‡çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼<br>  ä¸ºäº†è¿›ä¸€æ­¥æå‡è®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬é€šå¸¸å¯¹å°æ‰¹é‡æ•°æ®åšçŸ¢é‡è®¡ç®—ã€‚å¹¿ä¹‰ä¸Šè®²ï¼Œç»™å®šä¸€ä¸ªå°æ‰¹é‡æ ·æœ¬ï¼Œå…¶æ‰¹é‡å¤§å°ä¸º$n$ï¼Œè¾“å…¥ä¸ªæ•°ï¼ˆç‰¹å¾æ•°ï¼‰ä¸º$d$ï¼Œè¾“å‡ºä¸ªæ•°ï¼ˆç±»åˆ«æ•°ï¼‰ä¸º$q$ã€‚è®¾æ‰¹é‡ç‰¹å¾ä¸º$\boldsymbol{X} \in \mathbb{R}^{n \times d}$ã€‚å‡è®¾softmaxå›å½’çš„æƒé‡å’Œåå·®å‚æ•°åˆ†åˆ«ä¸º$\boldsymbol{W} \in \mathbb{R}^{d \times q}$å’Œ$\boldsymbol{b} \in \mathbb{R}^{1 \times q}$ã€‚softmaxå›å½’çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼ä¸º</li></ul><script type="math/tex; mode=display"> \begin{aligned} \boldsymbol{O} &= \boldsymbol{X} \boldsymbol{W} + \boldsymbol{b},\\ \boldsymbol{\hat{Y}} &= \text{softmax}(\boldsymbol{O}), \end{aligned}</script><p>å…¶ä¸­çš„åŠ æ³•è¿ç®—ä½¿ç”¨äº†å¹¿æ’­æœºåˆ¶ï¼Œ$\boldsymbol{O}, \boldsymbol{\hat{Y}} \in \mathbb{R}^{n \times q}$ä¸”è¿™ä¸¤ä¸ªçŸ©é˜µçš„ç¬¬$i$è¡Œåˆ†åˆ«ä¸ºæ ·æœ¬$i$çš„è¾“å‡º$\boldsymbol{o}^{(i)}$å’Œæ¦‚ç‡åˆ†å¸ƒ$\boldsymbol{\hat{y}}^{(i)}$ã€‚</p><h2 id="äº¤å‰ç†µæŸå¤±å‡½æ•°"><a href="#äº¤å‰ç†µæŸå¤±å‡½æ•°" class="headerlink" title="äº¤å‰ç†µæŸå¤±å‡½æ•°"></a>äº¤å‰ç†µæŸå¤±å‡½æ•°</h2><p>å¯¹äºæ ·æœ¬$i$ï¼Œæˆ‘ä»¬æ„é€ å‘é‡$\boldsymbol{y}^{(i)}\in \mathbb{R}^{q}$ ï¼Œä½¿å…¶ç¬¬$y^{(i)}$ï¼ˆæ ·æœ¬$i$ç±»åˆ«çš„ç¦»æ•£æ•°å€¼ï¼‰ä¸ªå…ƒç´ ä¸º1ï¼Œå…¶ä½™ä¸º0ã€‚è¿™æ ·æˆ‘ä»¬çš„è®­ç»ƒç›®æ ‡å¯ä»¥è®¾ä¸ºä½¿é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒ$\boldsymbol{\hat y}^{(i)}$å°½å¯èƒ½æ¥è¿‘çœŸå®çš„æ ‡ç­¾æ¦‚ç‡åˆ†å¸ƒ$\boldsymbol{y}^{(i)}$ã€‚</p><ul><li>å¹³æ–¹æŸå¤±ä¼°è®¡  </li></ul><script type="math/tex; mode=display">\begin{aligned}Loss = |\boldsymbol{\hat y}^{(i)}-\boldsymbol{y}^{(i)}|^2/2\end{aligned}</script><p>ç„¶è€Œï¼Œæƒ³è¦é¢„æµ‹åˆ†ç±»ç»“æœæ­£ç¡®ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦é¢„æµ‹æ¦‚ç‡å®Œå…¨ç­‰äºæ ‡ç­¾æ¦‚ç‡ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾åƒåˆ†ç±»çš„ä¾‹å­é‡Œï¼Œå¦‚æœ$y^{(i)}=3$ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦$\hat{y}^{(i)}_3$æ¯”å…¶ä»–ä¸¤ä¸ªé¢„æµ‹å€¼$\hat{y}^{(i)}_1$å’Œ$\hat{y}^{(i)}_2$å¤§å°±è¡Œäº†ã€‚å³ä½¿$\hat{y}^{(i)}_3$å€¼ä¸º0.6ï¼Œä¸ç®¡å…¶ä»–ä¸¤ä¸ªé¢„æµ‹å€¼ä¸ºå¤šå°‘ï¼Œç±»åˆ«é¢„æµ‹å‡æ­£ç¡®ã€‚è€Œå¹³æ–¹æŸå¤±åˆ™è¿‡äºä¸¥æ ¼ï¼Œä¾‹å¦‚$\hat y^{(i)}_1=\hat y^{(i)}_2=0.2$æ¯”$\hat y^{(i)}_1=0, \hat y^{(i)}_2=0.4$çš„æŸå¤±è¦å°å¾ˆå¤šï¼Œè™½ç„¶ä¸¤è€…éƒ½æœ‰åŒæ ·æ­£ç¡®çš„åˆ†ç±»é¢„æµ‹ç»“æœã€‚</p><p>æ”¹å–„ä¸Šè¿°é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨æ›´é€‚åˆè¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒå·®å¼‚çš„æµ‹é‡å‡½æ•°ã€‚å…¶ä¸­ï¼Œäº¤å‰ç†µï¼ˆcross entropyï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è¡¡é‡æ–¹æ³•ï¼š</p><script type="math/tex; mode=display">H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ) = -\sum_{j=1}^q y_j^{(i)} \log \hat y_j^{(i)},</script><p>å…¶ä¸­å¸¦ä¸‹æ ‡çš„$y_j^{(i)}$æ˜¯å‘é‡$\boldsymbol y^{(i)}$ä¸­é0å³1çš„å…ƒç´ ï¼Œéœ€è¦æ³¨æ„å°†å®ƒä¸æ ·æœ¬$i$ç±»åˆ«çš„ç¦»æ•£æ•°å€¼ï¼Œå³ä¸å¸¦ä¸‹æ ‡çš„$y^{(i)}$åŒºåˆ†ã€‚åœ¨ä¸Šå¼ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å‘é‡$\boldsymbol y^{(i)}$ä¸­åªæœ‰ç¬¬$y^{(i)}$ä¸ªå…ƒç´ $y^{(i)}{y^{(i)}}$ä¸º1ï¼Œå…¶ä½™å…¨ä¸º0ï¼Œäºæ˜¯$H(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}) = -\log \hat y_{y^{(i)}}^{(i)}$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäº¤å‰ç†µåªå…³å¿ƒå¯¹æ­£ç¡®ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ï¼Œå› ä¸ºåªè¦å…¶å€¼è¶³å¤Ÿå¤§ï¼Œå°±å¯ä»¥ç¡®ä¿åˆ†ç±»ç»“æœæ­£ç¡®ã€‚å½“ç„¶ï¼Œé‡åˆ°ä¸€ä¸ªæ ·æœ¬æœ‰å¤šä¸ªæ ‡ç­¾æ—¶ï¼Œä¾‹å¦‚å›¾åƒé‡Œå«æœ‰ä¸æ­¢ä¸€ä¸ªç‰©ä½“æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åšè¿™ä¸€æ­¥ç®€åŒ–ã€‚ä½†å³ä¾¿å¯¹äºè¿™ç§æƒ…å†µï¼Œäº¤å‰ç†µåŒæ ·åªå…³å¿ƒå¯¹å›¾åƒä¸­å‡ºç°çš„ç‰©ä½“ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ã€‚</p><p>å‡è®¾è®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬æ•°ä¸º$n$ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°å®šä¹‰ä¸º </p><script type="math/tex; mode=display">\ell(\boldsymbol{\Theta}) = \frac{1}{n} \sum_{i=1}^n H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ),</script><p>å…¶ä¸­$\boldsymbol{\Theta}$ä»£è¡¨æ¨¡å‹å‚æ•°ã€‚åŒæ ·åœ°ï¼Œå¦‚æœæ¯ä¸ªæ ·æœ¬åªæœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆäº¤å‰ç†µæŸå¤±å¯ä»¥ç®€å†™æˆ$\ell(\boldsymbol{\Theta}) = -(1/n) \sum_{i=1}^n \log \hat y_{y^{(i)}}^{(i)}$ã€‚ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çŸ¥é“æœ€å°åŒ–$\ell(\boldsymbol{\Theta})$ç­‰ä»·äºæœ€å¤§åŒ–$\exp(-n\ell(\boldsymbol{\Theta}))=\prod_{i=1}^n \hat y_{y^{(i)}}^{(i)}$ï¼Œå³æœ€å°åŒ–äº¤å‰ç†µæŸå¤±å‡½æ•°ç­‰ä»·äºæœ€å¤§åŒ–è®­ç»ƒæ•°æ®é›†æ‰€æœ‰æ ‡ç­¾ç±»åˆ«çš„è”åˆé¢„æµ‹æ¦‚ç‡ã€‚</p><h2 id="æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹"><a href="#æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹" class="headerlink" title="æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹"></a>æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹</h2><p>åœ¨è®­ç»ƒå¥½softmaxå›å½’æ¨¡å‹åï¼Œç»™å®šä»»ä¸€æ ·æœ¬ç‰¹å¾ï¼Œå°±å¯ä»¥é¢„æµ‹æ¯ä¸ªè¾“å‡ºç±»åˆ«çš„æ¦‚ç‡ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠé¢„æµ‹æ¦‚ç‡æœ€å¤§çš„ç±»åˆ«ä½œä¸ºè¾“å‡ºç±»åˆ«ã€‚å¦‚æœå®ƒä¸çœŸå®ç±»åˆ«ï¼ˆæ ‡ç­¾ï¼‰ä¸€è‡´ï¼Œè¯´æ˜è¿™æ¬¡é¢„æµ‹æ˜¯æ­£ç¡®çš„ã€‚åœ¨3.6èŠ‚çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰æ¥è¯„ä»·æ¨¡å‹çš„è¡¨ç°ã€‚å®ƒç­‰äºæ­£ç¡®é¢„æµ‹æ•°é‡ä¸æ€»é¢„æµ‹æ•°é‡ä¹‹æ¯”ã€‚</p><h1 id="è·å–Fashion-MNISTè®­ç»ƒé›†å’Œè¯»å–æ•°æ®"><a href="#è·å–Fashion-MNISTè®­ç»ƒé›†å’Œè¯»å–æ•°æ®" class="headerlink" title="è·å–Fashion-MNISTè®­ç»ƒé›†å’Œè¯»å–æ•°æ®"></a>è·å–Fashion-MNISTè®­ç»ƒé›†å’Œè¯»å–æ•°æ®</h1><p>åœ¨ä»‹ç»softmaxå›å½’çš„å®ç°å‰æˆ‘ä»¬å…ˆå¼•å…¥ä¸€ä¸ªå¤šç±»å›¾åƒåˆ†ç±»æ•°æ®é›†ã€‚å®ƒå°†åœ¨åé¢çš„ç« èŠ‚ä¸­è¢«å¤šæ¬¡ä½¿ç”¨ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿæ¯”è¾ƒç®—æ³•ä¹‹é—´åœ¨æ¨¡å‹ç²¾åº¦å’Œè®¡ç®—æ•ˆç‡ä¸Šçš„åŒºåˆ«ã€‚å›¾åƒåˆ†ç±»æ•°æ®é›†ä¸­æœ€å¸¸ç”¨çš„æ˜¯æ‰‹å†™æ•°å­—è¯†åˆ«æ•°æ®é›†MNIST[1]ã€‚ä½†å¤§éƒ¨åˆ†æ¨¡å‹åœ¨MNISTä¸Šçš„åˆ†ç±»ç²¾åº¦éƒ½è¶…è¿‡äº†95%ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°è§‚å¯Ÿç®—æ³•ä¹‹é—´çš„å·®å¼‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå›¾åƒå†…å®¹æ›´åŠ å¤æ‚çš„æ•°æ®é›†Fashion-MNIST[2]ã€‚</p><p>æˆ‘è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨torchvisionåŒ…ï¼Œå®ƒæ˜¯æœåŠ¡äºPyTorchæ·±åº¦å­¦ä¹ æ¡†æ¶çš„ï¼Œä¸»è¦ç”¨æ¥æ„å»ºè®¡ç®—æœºè§†è§‰æ¨¡å‹ã€‚torchvisionä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†æ„æˆï¼š</p><ol><li>torchvision.datasets: ä¸€äº›åŠ è½½æ•°æ®çš„å‡½æ•°åŠå¸¸ç”¨çš„æ•°æ®é›†æ¥å£ï¼›</li><li>torchvision.models: åŒ…å«å¸¸ç”¨çš„æ¨¡å‹ç»“æ„ï¼ˆå«é¢„è®­ç»ƒæ¨¡å‹ï¼‰ï¼Œä¾‹å¦‚AlexNetã€VGGã€ResNetç­‰ï¼›</li><li>torchvision.transforms: å¸¸ç”¨çš„å›¾ç‰‡å˜æ¢ï¼Œä¾‹å¦‚è£å‰ªã€æ—‹è½¬ç­‰ï¼›</li><li>torchvision.utils: å…¶ä»–çš„ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ã€‚</li></ol><pre><code class="lang-python"># import needed package%matplotlib inlinefrom IPython import displayimport matplotlib.pyplot as pltimport torchimport torchvisionimport torchvision.transforms as transformsimport timeimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)print(torchvision.__version__)</code></pre><pre><code>---------------------------------------------------------------------------ModuleNotFoundError                       Traceback (most recent call last)&lt;ipython-input-1-e3b06ab588d2&gt; in &lt;module&gt;      4 import matplotlib.pyplot as plt      5 ----&gt; 6 import torch      7 import torchvision      8 import torchvision.transforms as transformsModuleNotFoundError: No module named &#39;torch&#39;</code></pre><h2 id="get-dataset"><a href="#get-dataset" class="headerlink" title="get dataset"></a>get dataset</h2><pre><code class="lang-python">mnist_train = torchvision.datasets.FashionMNIST(root=&#39;/home/kesci/input/FashionMNIST2065&#39;, train=True, download=True, transform=transforms.ToTensor())mnist_test = torchvision.datasets.FashionMNIST(root=&#39;/home/kesci/input/FashionMNIST2065&#39;, train=False, download=True, transform=transforms.ToTensor())</code></pre><p>class torchvision.datasets.FashionMNIST(root, train=True, transform=None, target_transform=None, download=False)</p><ul><li>rootï¼ˆstringï¼‰â€“ æ•°æ®é›†çš„æ ¹ç›®å½•ï¼Œå…¶ä¸­å­˜æ”¾processed/training.ptå’Œprocessed/test.ptæ–‡ä»¶ã€‚</li><li>trainï¼ˆbool, å¯é€‰ï¼‰â€“ å¦‚æœè®¾ç½®ä¸ºTrueï¼Œä»training.ptåˆ›å»ºæ•°æ®é›†ï¼Œå¦åˆ™ä»test.ptåˆ›å»ºã€‚</li><li>downloadï¼ˆbool, å¯é€‰ï¼‰â€“ å¦‚æœè®¾ç½®ä¸ºTrueï¼Œä»äº’è”ç½‘ä¸‹è½½æ•°æ®å¹¶æ”¾åˆ°rootæ–‡ä»¶å¤¹ä¸‹ã€‚å¦‚æœrootç›®å½•ä¸‹å·²ç»å­˜åœ¨æ•°æ®ï¼Œä¸ä¼šå†æ¬¡ä¸‹è½½ã€‚</li><li>transformï¼ˆå¯è¢«è°ƒç”¨ , å¯é€‰ï¼‰â€“ ä¸€ç§å‡½æ•°æˆ–å˜æ¢ï¼Œè¾“å…¥PILå›¾ç‰‡ï¼Œè¿”å›å˜æ¢ä¹‹åçš„æ•°æ®ã€‚å¦‚ï¼štransforms.RandomCropã€‚</li><li>target_transformï¼ˆå¯è¢«è°ƒç”¨ , å¯é€‰ï¼‰â€“ ä¸€ç§å‡½æ•°æˆ–å˜æ¢ï¼Œè¾“å…¥ç›®æ ‡ï¼Œè¿›è¡Œå˜æ¢ã€‚</li></ul><pre><code class="lang-python"># show result print(type(mnist_train))print(len(mnist_train), len(mnist_test))</code></pre><pre><code>&lt;class &#39;torchvision.datasets.mnist.FashionMNIST&#39;&gt;60000 10000</code></pre><pre><code class="lang-python"># æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®ä»»æ„ä¸€ä¸ªæ ·æœ¬feature, label = mnist_train[0]print(feature.shape, label)  # Channel x Height x Width</code></pre><pre><code>torch.Size([1, 28, 28]) 9</code></pre><p>å¦‚æœä¸åšå˜æ¢è¾“å…¥çš„æ•°æ®æ˜¯å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å›¾ç‰‡çš„ç±»å‹å‚æ•°ï¼š</p><pre><code class="lang-python">mnist_PIL = torchvision.datasets.FashionMNIST(root=&#39;/home/kesci/input/FashionMNIST2065&#39;, train=True, download=True)PIL_feature, label = mnist_PIL[0]print(PIL_feature)</code></pre><pre><code>&lt;PIL.Image.Image image mode=L size=28x28 at 0x7F54A41612E8&gt;</code></pre><pre><code class="lang-python"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨def get_fashion_mnist_labels(labels):    text_labels = [&#39;t-shirt&#39;, &#39;trouser&#39;, &#39;pullover&#39;, &#39;dress&#39;, &#39;coat&#39;,                   &#39;sandal&#39;, &#39;shirt&#39;, &#39;sneaker&#39;, &#39;bag&#39;, &#39;ankle boot&#39;]    return [text_labels[int(i)] for i in labels]</code></pre><pre><code class="lang-python">def show_fashion_mnist(images, labels):    d2l.use_svg_display()    # è¿™é‡Œçš„_è¡¨ç¤ºæˆ‘ä»¬å¿½ç•¥ï¼ˆä¸ä½¿ç”¨ï¼‰çš„å˜é‡    _, figs = plt.subplots(1, len(images), figsize=(12, 12))    for f, img, lbl in zip(figs, images, labels):        f.imshow(img.view((28, 28)).numpy())        f.set_title(lbl)        f.axes.get_xaxis().set_visible(False)        f.axes.get_yaxis().set_visible(False)    plt.show()</code></pre><pre><code class="lang-python">X, y = [], []for i in range(10):    X.append(mnist_train[i][0]) # å°†ç¬¬iä¸ªfeatureåŠ åˆ°Xä¸­    y.append(mnist_train[i][1]) # å°†ç¬¬iä¸ªlabelåŠ åˆ°yä¸­show_fashion_mnist(X, get_fashion_mnist_labels(y))</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/056F457B00454FFD81A3CB6AD966C508/q5j7ehijw7.svg"></p><pre><code class="lang-python"># è¯»å–æ•°æ®batch_size = 256num_workers = 4train_iter = torch.utils.data.DataLoader(mnist_train, batch_size=batch_size, shuffle=True, num_workers=num_workers)test_iter = torch.utils.data.DataLoader(mnist_test, batch_size=batch_size, shuffle=False, num_workers=num_workers)</code></pre><pre><code class="lang-python">start = time.time()for X, y in train_iter:    continueprint(&#39;%.2f sec&#39; % (time.time() - start))</code></pre><pre><code>4.95 sec</code></pre><h1 id="softmaxä»é›¶å¼€å§‹çš„å®ç°"><a href="#softmaxä»é›¶å¼€å§‹çš„å®ç°" class="headerlink" title="softmaxä»é›¶å¼€å§‹çš„å®ç°"></a>softmaxä»é›¶å¼€å§‹çš„å®ç°</h1><pre><code class="lang-python">import torchimport torchvisionimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)print(torchvision.__version__)</code></pre><pre><code>1.3.00.4.1a0+d94043a</code></pre><h2 id="è·å–è®­ç»ƒé›†æ•°æ®å’Œæµ‹è¯•é›†æ•°æ®"><a href="#è·å–è®­ç»ƒé›†æ•°æ®å’Œæµ‹è¯•é›†æ•°æ®" class="headerlink" title="è·å–è®­ç»ƒé›†æ•°æ®å’Œæµ‹è¯•é›†æ•°æ®"></a>è·å–è®­ç»ƒé›†æ•°æ®å’Œæµ‹è¯•é›†æ•°æ®</h2><pre><code class="lang-python">batch_size = 256train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, root=&#39;/home/kesci/input/FashionMNIST2065&#39;)</code></pre><h2 id="æ¨¡å‹å‚æ•°åˆå§‹åŒ–"><a href="#æ¨¡å‹å‚æ•°åˆå§‹åŒ–" class="headerlink" title="æ¨¡å‹å‚æ•°åˆå§‹åŒ–"></a>æ¨¡å‹å‚æ•°åˆå§‹åŒ–</h2><pre><code class="lang-python">num_inputs = 784print(28*28)num_outputs = 10W = torch.tensor(np.random.normal(0, 0.01, (num_inputs, num_outputs)), dtype=torch.float)b = torch.zeros(num_outputs, dtype=torch.float)</code></pre><pre><code>784</code></pre><pre><code class="lang-python">W.requires_grad_(requires_grad=True)b.requires_grad_(requires_grad=True)</code></pre><pre><code>tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], requires_grad=True)</code></pre><h2 id="å¯¹å¤šç»´TensoræŒ‰ç»´åº¦æ“ä½œ"><a href="#å¯¹å¤šç»´TensoræŒ‰ç»´åº¦æ“ä½œ" class="headerlink" title="å¯¹å¤šç»´TensoræŒ‰ç»´åº¦æ“ä½œ"></a>å¯¹å¤šç»´TensoræŒ‰ç»´åº¦æ“ä½œ</h2><pre><code class="lang-python">X = torch.tensor([[1, 2, 3], [4, 5, 6]])print(X.sum(dim=0, keepdim=True))  # dimä¸º0ï¼ŒæŒ‰ç…§ç›¸åŒçš„åˆ—æ±‚å’Œï¼Œå¹¶åœ¨ç»“æœä¸­ä¿ç•™åˆ—ç‰¹å¾print(X.sum(dim=1, keepdim=True))  # dimä¸º1ï¼ŒæŒ‰ç…§ç›¸åŒçš„è¡Œæ±‚å’Œï¼Œå¹¶åœ¨ç»“æœä¸­ä¿ç•™è¡Œç‰¹å¾print(X.sum(dim=0, keepdim=False)) # dimä¸º0ï¼ŒæŒ‰ç…§ç›¸åŒçš„åˆ—æ±‚å’Œï¼Œä¸åœ¨ç»“æœä¸­ä¿ç•™åˆ—ç‰¹å¾print(X.sum(dim=1, keepdim=False)) # dimä¸º1ï¼ŒæŒ‰ç…§ç›¸åŒçš„è¡Œæ±‚å’Œï¼Œä¸åœ¨ç»“æœä¸­ä¿ç•™è¡Œç‰¹å¾</code></pre><pre><code>tensor([[5, 7, 9]])tensor([[ 6],        [15]])tensor([5, 7, 9])tensor([ 6, 15])</code></pre><h2 id="å®šä¹‰softmaxæ“ä½œ"><a href="#å®šä¹‰softmaxæ“ä½œ" class="headerlink" title="å®šä¹‰softmaxæ“ä½œ"></a>å®šä¹‰softmaxæ“ä½œ</h2><script type="math/tex; mode=display"> \hat{y}_j = \frac{ \exp(o_j)}{\sum_{i=1}^3 \exp(o_i)}</script><pre><code class="lang-python">def softmax(X):    X_exp = X.exp()    partition = X_exp.sum(dim=1, keepdim=True)    # print(&quot;X size is &quot;, X_exp.size())    # print(&quot;partition size is &quot;, partition, partition.size())    return X_exp / partition  # è¿™é‡Œåº”ç”¨äº†å¹¿æ’­æœºåˆ¶</code></pre><pre><code class="lang-python">X = torch.rand((2, 5))X_prob = softmax(X)print(X_prob, &#39;\n&#39;, X_prob.sum(dim=1))</code></pre><pre><code>tensor([[0.2253, 0.1823, 0.1943, 0.2275, 0.1706],        [0.1588, 0.2409, 0.2310, 0.1670, 0.2024]])  tensor([1.0000, 1.0000])</code></pre><h2 id="softmaxå›å½’æ¨¡å‹"><a href="#softmaxå›å½’æ¨¡å‹" class="headerlink" title="softmaxå›å½’æ¨¡å‹"></a>softmaxå›å½’æ¨¡å‹</h2><script type="math/tex; mode=display"> \begin{aligned} \boldsymbol{o}^{(i)} &= \boldsymbol{x}^{(i)} \boldsymbol{W} + \boldsymbol{b},\\ \boldsymbol{\hat{y}}^{(i)} &= \text{softmax}(\boldsymbol{o}^{(i)}). \end{aligned}</script><pre><code class="lang-python">def net(X):    return softmax(torch.mm(X.view((-1, num_inputs)), W) + b)</code></pre><h2 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h2><script type="math/tex; mode=display">H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ) = -\sum_{j=1}^q y_j^{(i)} \log \hat y_j^{(i)},</script><script type="math/tex; mode=display">\ell(\boldsymbol{\Theta}) = \frac{1}{n} \sum_{i=1}^n H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ),</script><script type="math/tex; mode=display">\ell(\boldsymbol{\Theta}) = -(1/n) \sum_{i=1}^n \log \hat y_{y^{(i)}}^{(i)}</script><pre><code class="lang-python">y_hat = torch.tensor([[0.1, 0.3, 0.6], [0.3, 0.2, 0.5]])y = torch.LongTensor([0, 2])y_hat.gather(1, y.view(-1, 1))</code></pre><pre><code>tensor([[0.1000],        [0.5000]])</code></pre><pre><code class="lang-python">def cross_entropy(y_hat, y):    return - torch.log(y_hat.gather(1, y.view(-1, 1)))</code></pre><h2 id="å®šä¹‰å‡†ç¡®ç‡"><a href="#å®šä¹‰å‡†ç¡®ç‡" class="headerlink" title="å®šä¹‰å‡†ç¡®ç‡"></a>å®šä¹‰å‡†ç¡®ç‡</h2><p>æˆ‘ä»¬æ¨¡å‹è®­ç»ƒå®Œäº†è¿›è¡Œæ¨¡å‹é¢„æµ‹çš„æ—¶å€™ï¼Œä¼šç”¨åˆ°æˆ‘ä»¬è¿™é‡Œå®šä¹‰çš„å‡†ç¡®ç‡ã€‚</p><pre><code class="lang-python">def accuracy(y_hat, y):    return (y_hat.argmax(dim=1) == y).float().mean().item()</code></pre><pre><code class="lang-python">print(accuracy(y_hat, y))</code></pre><pre><code>0.5</code></pre><pre><code class="lang-python"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚è¯¥å‡½æ•°å°†è¢«é€æ­¥æ”¹è¿›ï¼šå®ƒçš„å®Œæ•´å®ç°å°†åœ¨â€œå›¾åƒå¢å¹¿â€ä¸€èŠ‚ä¸­æè¿°def evaluate_accuracy(data_iter, net):    acc_sum, n = 0.0, 0    for X, y in data_iter:        acc_sum += (net(X).argmax(dim=1) == y).float().sum().item()        n += y.shape[0]    return acc_sum / n</code></pre><pre><code class="lang-python">print(evaluate_accuracy(test_iter, net))</code></pre><pre><code>0.1445</code></pre><h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><pre><code class="lang-python">num_epochs, lr = 5, 0.1# æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨def train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size,              params=None, lr=None, optimizer=None):    for epoch in range(num_epochs):        train_l_sum, train_acc_sum, n = 0.0, 0.0, 0        for X, y in train_iter:            y_hat = net(X)            l = loss(y_hat, y).sum()            # æ¢¯åº¦æ¸…é›¶            if optimizer is not None:                optimizer.zero_grad()            elif params is not None and params[0].grad is not None:                for param in params:                    param.grad.data.zero_()            l.backward()            if optimizer is None:                d2l.sgd(params, lr, batch_size)            else:                optimizer.step()             train_l_sum += l.item()            train_acc_sum += (y_hat.argmax(dim=1) == y).sum().item()            n += y.shape[0]        test_acc = evaluate_accuracy(test_iter, net)        print(&#39;epoch %d, loss %.4f, train acc %.3f, test acc %.3f&#39;              % (epoch + 1, train_l_sum / n, train_acc_sum / n, test_acc))train_ch3(net, train_iter, test_iter, cross_entropy, num_epochs, batch_size, [W, b], lr)</code></pre><pre><code>epoch 1, loss 0.7851, train acc 0.750, test acc 0.791epoch 2, loss 0.5704, train acc 0.814, test acc 0.810epoch 3, loss 0.5258, train acc 0.825, test acc 0.819epoch 4, loss 0.5014, train acc 0.832, test acc 0.824epoch 5, loss 0.4865, train acc 0.836, test acc 0.827</code></pre><h2 id="æ¨¡å‹é¢„æµ‹"><a href="#æ¨¡å‹é¢„æµ‹" class="headerlink" title="æ¨¡å‹é¢„æµ‹"></a>æ¨¡å‹é¢„æµ‹</h2><p>ç°åœ¨æˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒå®Œäº†ï¼Œå¯ä»¥è¿›è¡Œä¸€ä¸‹é¢„æµ‹ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªæ¨¡å‹è®­ç»ƒçš„åˆ°åº•å‡†ç¡®ä¸å‡†ç¡®ã€‚<br>ç°åœ¨å°±å¯ä»¥æ¼”ç¤ºå¦‚ä½•å¯¹å›¾åƒè¿›è¡Œåˆ†ç±»äº†ã€‚ç»™å®šä¸€ç³»åˆ—å›¾åƒï¼ˆç¬¬ä¸‰è¡Œå›¾åƒè¾“å‡ºï¼‰ï¼Œæˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬çš„çœŸå®æ ‡ç­¾ï¼ˆç¬¬ä¸€è¡Œæ–‡æœ¬è¾“å‡ºï¼‰å’Œæ¨¡å‹é¢„æµ‹ç»“æœï¼ˆç¬¬äºŒè¡Œæ–‡æœ¬è¾“å‡ºï¼‰ã€‚</p><pre><code class="lang-python">X, y = iter(test_iter).next()true_labels = d2l.get_fashion_mnist_labels(y.numpy())pred_labels = d2l.get_fashion_mnist_labels(net(X).argmax(dim=1).numpy())titles = [true + &#39;\n&#39; + pred for true, pred in zip(true_labels, pred_labels)]d2l.show_fashion_mnist(X[0:9], titles[0:9])</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/1DA8927186304BEBA2B3DCC4A9E027DD/q5j7fq2jer.svg"></p><h1 id="softmaxçš„ç®€æ´å®ç°"><a href="#softmaxçš„ç®€æ´å®ç°" class="headerlink" title="softmaxçš„ç®€æ´å®ç°"></a>softmaxçš„ç®€æ´å®ç°</h1><pre><code class="lang-python"># åŠ è½½å„ç§åŒ…æˆ–è€…æ¨¡å—import torchfrom torch import nnfrom torch.nn import initimport numpy as npimport syssys.path.append(&quot;/home/kesci/input&quot;)import d2lzh1981 as d2lprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h2 id="åˆå§‹åŒ–å‚æ•°å’Œè·å–æ•°æ®"><a href="#åˆå§‹åŒ–å‚æ•°å’Œè·å–æ•°æ®" class="headerlink" title="åˆå§‹åŒ–å‚æ•°å’Œè·å–æ•°æ®"></a>åˆå§‹åŒ–å‚æ•°å’Œè·å–æ•°æ®</h2><pre><code class="lang-python">batch_size = 256train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size, root=&#39;/home/kesci/input/FashionMNIST2065&#39;)</code></pre><h2 id="å®šä¹‰ç½‘ç»œæ¨¡å‹"><a href="#å®šä¹‰ç½‘ç»œæ¨¡å‹" class="headerlink" title="å®šä¹‰ç½‘ç»œæ¨¡å‹"></a>å®šä¹‰ç½‘ç»œæ¨¡å‹</h2><pre><code class="lang-python">num_inputs = 784num_outputs = 10class LinearNet(nn.Module):    def __init__(self, num_inputs, num_outputs):        super(LinearNet, self).__init__()        self.linear = nn.Linear(num_inputs, num_outputs)    def forward(self, x): # x çš„å½¢çŠ¶: (batch, 1, 28, 28)        y = self.linear(x.view(x.shape[0], -1))        return y# net = LinearNet(num_inputs, num_outputs)class FlattenLayer(nn.Module):    def __init__(self):        super(FlattenLayer, self).__init__()    def forward(self, x): # x çš„å½¢çŠ¶: (batch, *, *, ...)        return x.view(x.shape[0], -1)from collections import OrderedDictnet = nn.Sequential(        # FlattenLayer(),        # LinearNet(num_inputs, num_outputs)         OrderedDict([           (&#39;flatten&#39;, FlattenLayer()),           (&#39;linear&#39;, nn.Linear(num_inputs, num_outputs))]) # æˆ–è€…å†™æˆæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ LinearNet(num_inputs, num_outputs) ä¹Ÿå¯ä»¥        )</code></pre><h2 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h2><pre><code class="lang-python">init.normal_(net.linear.weight, mean=0, std=0.01)init.constant_(net.linear.bias, val=0)</code></pre><pre><code>Parameter containing:tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], requires_grad=True)</code></pre><h2 id="å®šä¹‰æŸå¤±å‡½æ•°-1"><a href="#å®šä¹‰æŸå¤±å‡½æ•°-1" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h2><pre><code class="lang-python">loss = nn.CrossEntropyLoss() # ä¸‹é¢æ˜¯ä»–çš„å‡½æ•°åŸå‹# class torch.nn.CrossEntropyLoss(weight=None, size_average=None, ignore_index=-100, reduce=None, reduction=&#39;mean&#39;)</code></pre><h2 id="å®šä¹‰ä¼˜åŒ–å‡½æ•°"><a href="#å®šä¹‰ä¼˜åŒ–å‡½æ•°" class="headerlink" title="å®šä¹‰ä¼˜åŒ–å‡½æ•°"></a>å®šä¹‰ä¼˜åŒ–å‡½æ•°</h2><pre><code class="lang-python">optimizer = torch.optim.SGD(net.parameters(), lr=0.1) # ä¸‹é¢æ˜¯å‡½æ•°åŸå‹# class torch.optim.SGD(params, lr=, momentum=0, dampening=0, weight_decay=0, nesterov=False)</code></pre><h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><pre><code class="lang-python">num_epochs = 5d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, None, None, optimizer)</code></pre><pre><code>epoch 1, loss 0.0031, train acc 0.751, test acc 0.795epoch 2, loss 0.0022, train acc 0.813, test acc 0.809epoch 3, loss 0.0021, train acc 0.825, test acc 0.806epoch 4, loss 0.0020, train acc 0.833, test acc 0.813epoch 5, loss 0.0019, train acc 0.837, test acc 0.822</code></pre><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/cwADXPBIbdjvGhN.png" alt=""></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/8pOqEmTBAYGcWMs.png" alt="è§£æ"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ‰‹æ·±åº¦å­¦ä¹ (ä¸€):çº¿æ€§å›å½’</title>
      <link href="/2020/02/14/dl-notes1-lin-re/"/>
      <url>/2020/02/14/dl-notes1-lin-re/</url>
      
        <content type="html"><![CDATA[<h1 id="çº¿æ€§å›å½’"><a href="#çº¿æ€§å›å½’" class="headerlink" title="çº¿æ€§å›å½’"></a>çº¿æ€§å›å½’</h1><p>ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼š</p><ol><li>çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ </li><li>çº¿æ€§å›å½’æ¨¡å‹ä»é›¶å¼€å§‹çš„å®ç°</li><li>çº¿æ€§å›å½’æ¨¡å‹ä½¿ç”¨pytorchçš„ç®€æ´å®ç°</li></ol><h2 id="çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ "><a href="#çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ " class="headerlink" title="çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ "></a>çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ </h2><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ä»·æ ¼åªå–å†³äºæˆ¿å±‹çŠ¶å†µçš„ä¸¤ä¸ªå› ç´ ï¼Œå³é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰å’Œæˆ¿é¾„ï¼ˆå¹´ï¼‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¸Œæœ›æ¢ç´¢ä»·æ ¼ä¸è¿™ä¸¤ä¸ªå› ç´ çš„å…·ä½“å…³ç³»ã€‚çº¿æ€§å›å½’å‡è®¾è¾“å‡ºä¸å„ä¸ªè¾“å…¥ä¹‹é—´æ˜¯çº¿æ€§å…³ç³»:</p><script type="math/tex; mode=display">\mathrm{price} = w_{\mathrm{area}} \cdot \mathrm{area} + w_{\mathrm{age}} \cdot \mathrm{age} + b</script><h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p>æˆ‘ä»¬é€šå¸¸æ”¶é›†ä¸€ç³»åˆ—çš„çœŸå®æ•°æ®ï¼Œä¾‹å¦‚å¤šæ ‹æˆ¿å±‹çš„çœŸå®å”®å‡ºä»·æ ¼å’Œå®ƒä»¬å¯¹åº”çš„é¢ç§¯å’Œæˆ¿é¾„ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨è¿™ä¸ªæ•°æ®ä¸Šé¢å¯»æ‰¾æ¨¡å‹å‚æ•°æ¥ä½¿æ¨¡å‹çš„é¢„æµ‹ä»·æ ¼ä¸çœŸå®ä»·æ ¼çš„è¯¯å·®æœ€å°ã€‚åœ¨æœºå™¨å­¦ä¹ æœ¯è¯­é‡Œï¼Œè¯¥æ•°æ®é›†è¢«ç§°ä¸ºè®­ç»ƒæ•°æ®é›†ï¼ˆtraining data setï¼‰æˆ–è®­ç»ƒé›†ï¼ˆtraining setï¼‰ï¼Œä¸€æ ‹æˆ¿å±‹è¢«ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰ï¼Œå…¶çœŸå®å”®å‡ºä»·æ ¼å«ä½œæ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œç”¨æ¥é¢„æµ‹æ ‡ç­¾çš„ä¸¤ä¸ªå› ç´ å«ä½œç‰¹å¾ï¼ˆfeatureï¼‰ã€‚ç‰¹å¾ç”¨æ¥è¡¨å¾æ ·æœ¬çš„ç‰¹ç‚¹ã€‚</p><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>åœ¨æ¨¡å‹è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¡¡é‡ä»·æ ¼é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„è¯¯å·®ã€‚é€šå¸¸æˆ‘ä»¬ä¼šé€‰å–ä¸€ä¸ªéè´Ÿæ•°ä½œä¸ºè¯¯å·®ï¼Œä¸”æ•°å€¼è¶Šå°è¡¨ç¤ºè¯¯å·®è¶Šå°ã€‚ä¸€ä¸ªå¸¸ç”¨çš„é€‰æ‹©æ˜¯å¹³æ–¹å‡½æ•°ã€‚ å®ƒåœ¨è¯„ä¼°ç´¢å¼•ä¸º $i$ çš„æ ·æœ¬è¯¯å·®çš„è¡¨è¾¾å¼ä¸º</p><script type="math/tex; mode=display">l^{(i)}(\mathbf{w}, b) = \frac{1}{2} \left(\hat{y}^{(i)} - y^{(i)}\right)^2,</script><script type="math/tex; mode=display">L(\mathbf{w}, b) =\frac{1}{n}\sum_{i=1}^n l^{(i)}(\mathbf{w}, b) =\frac{1}{n} \sum_{i=1}^n \frac{1}{2}\left(\mathbf{w}^\top \mathbf{x}^{(i)} + b - y^{(i)}\right)^2.</script><h3 id="ä¼˜åŒ–å‡½æ•°-éšæœºæ¢¯åº¦ä¸‹é™"><a href="#ä¼˜åŒ–å‡½æ•°-éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="ä¼˜åŒ–å‡½æ•° - éšæœºæ¢¯åº¦ä¸‹é™"></a>ä¼˜åŒ–å‡½æ•° - éšæœºæ¢¯åº¦ä¸‹é™</h3><p>å½“æ¨¡å‹å’ŒæŸå¤±å‡½æ•°å½¢å¼è¾ƒä¸ºç®€å•æ—¶ï¼Œä¸Šé¢çš„è¯¯å·®æœ€å°åŒ–é—®é¢˜çš„è§£å¯ä»¥ç›´æ¥ç”¨å…¬å¼è¡¨è¾¾å‡ºæ¥ã€‚è¿™ç±»è§£å«ä½œè§£æè§£ï¼ˆanalytical solutionï¼‰ã€‚æœ¬èŠ‚ä½¿ç”¨çš„çº¿æ€§å›å½’å’Œå¹³æ–¹è¯¯å·®åˆšå¥½å±äºè¿™ä¸ªèŒƒç•´ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹å¹¶æ²¡æœ‰è§£æè§£ï¼Œåªèƒ½é€šè¿‡ä¼˜åŒ–ç®—æ³•æœ‰é™æ¬¡è¿­ä»£æ¨¡å‹å‚æ•°æ¥å°½å¯èƒ½é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚è¿™ç±»è§£å«ä½œæ•°å€¼è§£ï¼ˆnumerical solutionï¼‰ã€‚</p><p>åœ¨æ±‚æ•°å€¼è§£çš„ä¼˜åŒ–ç®—æ³•ä¸­ï¼Œå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆmini-batch stochastic gradient descentï¼‰åœ¨æ·±åº¦å­¦ä¹ ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒçš„ç®—æ³•å¾ˆç®€å•ï¼šå…ˆé€‰å–ä¸€ç»„æ¨¡å‹å‚æ•°çš„åˆå§‹å€¼ï¼Œå¦‚éšæœºé€‰å–ï¼›æ¥ä¸‹æ¥å¯¹å‚æ•°è¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼Œä½¿æ¯æ¬¡è¿­ä»£éƒ½å¯èƒ½é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œå…ˆéšæœºå‡åŒ€é‡‡æ ·ä¸€ä¸ªç”±å›ºå®šæ•°ç›®è®­ç»ƒæ•°æ®æ ·æœ¬æ‰€ç»„æˆçš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰$\mathcal{B}$ï¼Œç„¶åæ±‚å°æ‰¹é‡ä¸­æ•°æ®æ ·æœ¬çš„å¹³å‡æŸå¤±æœ‰å…³æ¨¡å‹å‚æ•°çš„å¯¼æ•°ï¼ˆæ¢¯åº¦ï¼‰ï¼Œæœ€åç”¨æ­¤ç»“æœä¸é¢„å…ˆè®¾å®šçš„ä¸€ä¸ªæ­£æ•°çš„ä¹˜ç§¯ä½œä¸ºæ¨¡å‹å‚æ•°åœ¨æœ¬æ¬¡è¿­ä»£çš„å‡å°é‡ã€‚   </p><script type="math/tex; mode=display">(\mathbf{w},b) \leftarrow (\mathbf{w},b) - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}} \partial_{(\mathbf{w},b)} l^{(i)}(\mathbf{w},b)</script><p>å­¦ä¹ ç‡: $\eta$ä»£è¡¨åœ¨æ¯æ¬¡ä¼˜åŒ–ä¸­ï¼Œèƒ½å¤Ÿå­¦ä¹ çš„æ­¥é•¿çš„å¤§å°<br>æ‰¹é‡å¤§å°: $\mathcal{B}$æ˜¯å°æ‰¹é‡è®¡ç®—ä¸­çš„æ‰¹é‡å¤§å°batch size   </p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä¼˜åŒ–å‡½æ•°çš„æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>(i)åˆå§‹åŒ–æ¨¡å‹å‚æ•°ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨éšæœºåˆå§‹åŒ–ï¼›</li><li>(ii)æˆ‘ä»¬åœ¨æ•°æ®ä¸Šè¿­ä»£å¤šæ¬¡ï¼Œé€šè¿‡åœ¨è´Ÿæ¢¯åº¦æ–¹å‘ç§»åŠ¨å‚æ•°æ¥æ›´æ–°æ¯ä¸ªå‚æ•°ã€‚</li></ul><h2 id="çŸ¢é‡è®¡ç®—"><a href="#çŸ¢é‡è®¡ç®—" class="headerlink" title="çŸ¢é‡è®¡ç®—"></a>çŸ¢é‡è®¡ç®—</h2><p>åœ¨æ¨¡å‹è®­ç»ƒæˆ–é¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåŒæ—¶å¤„ç†å¤šä¸ªæ•°æ®æ ·æœ¬å¹¶ç”¨åˆ°çŸ¢é‡è®¡ç®—ã€‚åœ¨ä»‹ç»çº¿æ€§å›å½’çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè€ƒè™‘å¯¹ä¸¤ä¸ªå‘é‡ç›¸åŠ çš„ä¸¤ç§æ–¹æ³•ã€‚</p><ol><li>å‘é‡ç›¸åŠ çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå°†è¿™ä¸¤ä¸ªå‘é‡æŒ‰å…ƒç´ é€ä¸€åšæ ‡é‡åŠ æ³•ã€‚</li><li>å‘é‡ç›¸åŠ çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå°†è¿™ä¸¤ä¸ªå‘é‡ç›´æ¥åšçŸ¢é‡åŠ æ³•ã€‚</li></ol><pre><code class="lang-python">import torchimport time# init variable a, b as 1000 dimension vectorn = 1000a = torch.ones(n)b = torch.ones(n)</code></pre><pre><code class="lang-python"># define a timer class to record timeclass Timer(object):    &quot;&quot;&quot;Record multiple running times.&quot;&quot;&quot;    def __init__(self):        self.times = []        self.start()    def start(self):        # start the timer        self.start_time = time.time()    def stop(self):        # stop the timer and record time into a list        self.times.append(time.time() - self.start_time)        return self.times[-1]    def avg(self):        # calculate the average and return        return sum(self.times)/len(self.times)    def sum(self):        # return the sum of recorded time        return sum(self.times)</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•äº†ã€‚é¦–å…ˆå°†ä¸¤ä¸ªå‘é‡ä½¿ç”¨forå¾ªç¯æŒ‰å…ƒç´ é€ä¸€åšæ ‡é‡åŠ æ³•ã€‚</p><pre><code class="lang-python">timer = Timer()c = torch.zeros(n)for i in range(n):    c[i] = a[i] + b[i]&#39;%.5f sec&#39; % timer.stop()</code></pre><pre><code>&#39;0.01162 sec&#39;</code></pre><p>å¦å¤–æ˜¯ä½¿ç”¨torchæ¥å°†ä¸¤ä¸ªå‘é‡ç›´æ¥åšçŸ¢é‡åŠ æ³•ï¼š</p><pre><code class="lang-python">timer.start()d = a + b&#39;%.5f sec&#39; % timer.stop()</code></pre><pre><code>&#39;0.00027 sec&#39;</code></pre><p>ç»“æœå¾ˆæ˜æ˜¾,åè€…æ¯”å‰è€…è¿ç®—é€Ÿåº¦æ›´å¿«ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½é‡‡ç”¨çŸ¢é‡è®¡ç®—ï¼Œä»¥æå‡è®¡ç®—æ•ˆç‡ã€‚</p><h2 id="çº¿æ€§å›å½’æ¨¡å‹ä»é›¶å¼€å§‹çš„å®ç°"><a href="#çº¿æ€§å›å½’æ¨¡å‹ä»é›¶å¼€å§‹çš„å®ç°" class="headerlink" title="çº¿æ€§å›å½’æ¨¡å‹ä»é›¶å¼€å§‹çš„å®ç°"></a>çº¿æ€§å›å½’æ¨¡å‹ä»é›¶å¼€å§‹çš„å®ç°</h2><pre><code class="lang-python"># import packages and modules%matplotlib inlineimport torchfrom IPython import displayfrom matplotlib import pyplot as pltimport numpy as npimport randomprint(torch.__version__)</code></pre><pre><code>1.3.0</code></pre><h3 id="ç”Ÿæˆæ•°æ®é›†"><a href="#ç”Ÿæˆæ•°æ®é›†" class="headerlink" title="ç”Ÿæˆæ•°æ®é›†"></a>ç”Ÿæˆæ•°æ®é›†</h3><p>ä½¿ç”¨çº¿æ€§æ¨¡å‹æ¥ç”Ÿæˆæ•°æ®é›†ï¼Œç”Ÿæˆä¸€ä¸ª1000ä¸ªæ ·æœ¬çš„æ•°æ®é›†ï¼Œä¸‹é¢æ˜¯ç”¨æ¥ç”Ÿæˆæ•°æ®çš„çº¿æ€§å…³ç³»ï¼š</p><script type="math/tex; mode=display">\mathrm{price} = w_{\mathrm{area}} \cdot \mathrm{area} + w_{\mathrm{age}} \cdot \mathrm{age} + b</script><pre><code class="lang-python"># set input feature number num_inputs = 2# set example numbernum_examples = 1000# set true weight and bias in order to generate corresponded labeltrue_w = [2, -3.4]true_b = 4.2features = torch.randn(num_examples, num_inputs,                      dtype=torch.float32)labels = true_w[0] * features[:, 0] + true_w[1] * features[:, 1] + true_blabels += torch.tensor(np.random.normal(0, 0.01, size=labels.size()),   # ä¸å¯èƒ½ä¸¥æ ¼çº¿æ€§åˆ†å¸ƒï¼ŒåŠ ä¸€ä¸ªåå·®                       dtype=torch.float32)</code></pre><h3 id="ä½¿ç”¨å›¾åƒæ¥å±•ç¤ºç”Ÿæˆçš„æ•°æ®"><a href="#ä½¿ç”¨å›¾åƒæ¥å±•ç¤ºç”Ÿæˆçš„æ•°æ®" class="headerlink" title="ä½¿ç”¨å›¾åƒæ¥å±•ç¤ºç”Ÿæˆçš„æ•°æ®"></a>ä½¿ç”¨å›¾åƒæ¥å±•ç¤ºç”Ÿæˆçš„æ•°æ®</h3><pre><code class="lang-python">plt.scatter(features[:, 1].numpy(), labels.numpy(), 1)</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://cdn.kesci.com/rt_upload/8E2E1E16060241C6A33E4CF1EC65DF1D/q5mgua7bvt.png"></p><h3 id="è¯»å–æ•°æ®é›†"><a href="#è¯»å–æ•°æ®é›†" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><pre><code class="lang-python">def data_iter(batch_size, features, labels):    num_examples = len(features)    indices = list(range(num_examples))    random.shuffle(indices)  # random read 10 samples é¡ºåºæ‰“ä¹±è¯»å–    for i in range(0, num_examples, batch_size):        # the last time may be not enough for a whole batch é˜²æ­¢è¶Šç•Œ        j = torch.LongTensor(indices[i: min(i + batch_size, num_examples)]) #æ¯æ¬¡è·³è·ƒ b_size        yield features.index_select(0, j), labels.index_select(0, j)   # è¿”å›ä¸€ä¸ªå°±é€€å‡º</code></pre><pre><code class="lang-python">batch_size = 10for X, y in data_iter(batch_size, features, labels):    print(X, &#39;\n&#39;, y)    break</code></pre><pre><code>tensor([[ 0.6802, -0.1529],        [-1.1139, -1.0506],        [ 1.1355,  0.6313],        [ 0.9057,  1.4527],        [-0.7477, -0.4656],        [-0.4012, -0.1810],        [ 0.0038, -1.3701],        [-0.9438, -1.6571],        [ 0.4016,  0.4233],        [ 0.8824, -1.0067]])  tensor([6.0793, 5.5343, 4.3112, 1.0657, 4.2856, 4.0040, 8.8709, 7.9642, 3.5696,        9.3887])</code></pre><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><pre><code class="lang-python">w = torch.tensor(np.random.normal(0, 0.01, (num_inputs, 1)), dtype=torch.float32)b = torch.zeros(1, dtype=torch.float32)w.requires_grad_(requires_grad=True)  # è¦æ±‚æ¢¯åº¦b.requires_grad_(requires_grad=True)</code></pre><pre><code>tensor([0.], requires_grad=True)</code></pre><h3 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>å®šä¹‰ç”¨æ¥è®­ç»ƒå‚æ•°çš„è®­ç»ƒæ¨¡å‹ï¼š</p><script type="math/tex; mode=display">\mathrm{price} = w_{\mathrm{area}} \cdot \mathrm{area} + w_{\mathrm{age}} \cdot \mathrm{age} + b</script><pre><code class="lang-python">def linreg(X, w, b):    return torch.mm(X, w) + b   # mm ç›¸ä¹˜</code></pre><h3 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼š</p><script type="math/tex; mode=display">l^{(i)}(\mathbf{w}, b) = \frac{1}{2} \left(\hat{y}^{(i)} - y^{(i)}\right)^2,</script><pre><code class="lang-python">def squared_loss(y_hat, y):     return (y_hat - y.view(y_hat.size())) ** 2 / 2   # view è¡¨ç¤ºæ•°æ®ç›¸åŒï¼Œå¤§å°ä¸åŒ# s = squared_loss(2.33,3.14) + squared_loss(1.07,0.98) + squared_loss(1.23,1.32)y_hat = torch.tensor([[2.33],        [ 1.07],        [ 1.23]])y = torch.tensor([3.14, 0.98, 1.32])s = squared_loss(y_hat, y)print(s.mean())</code></pre><pre><code>tensor(0.1121)</code></pre><h3 id="å®šä¹‰ä¼˜åŒ–å‡½æ•°"><a href="#å®šä¹‰ä¼˜åŒ–å‡½æ•°" class="headerlink" title="å®šä¹‰ä¼˜åŒ–å‡½æ•°"></a>å®šä¹‰ä¼˜åŒ–å‡½æ•°</h3><p>åœ¨è¿™é‡Œä¼˜åŒ–å‡½æ•°ä½¿ç”¨çš„æ˜¯å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼š</p><script type="math/tex; mode=display">(\mathbf{w},b) \leftarrow (\mathbf{w},b) - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}} \partial_{(\mathbf{w},b)} l^{(i)}(\mathbf{w},b)</script><pre><code class="lang-python">def sgd(params, lr, batch_size):     # params : [w, b]    for param in params:        # åœ¨æ¢¯åº¦çš„è´Ÿæ–¹å‘ç´¯åŠ ä¸€ä¸ªå€¼ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„æ•ˆæœï¼ˆè¶‹äºè°·åº•ï¼‰        param.data -= lr * param.grad / batch_size # ues .data to operate param without gradient track</code></pre><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>å½“æ•°æ®é›†ã€æ¨¡å‹ã€æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å‡½æ•°å®šä¹‰å®Œäº†ä¹‹åå°±å¯æ¥å‡†å¤‡è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒäº†ã€‚</p><pre><code class="lang-python"># super parameters initlr = 0.03  # lr å­¦ä¹ ç‡num_epochs = 5net = linregloss = squared_loss# trainingfor epoch in range(num_epochs):  # training repeats num_epochs times    # in each epoch, all the samples in dataset will be used once    # X is the feature and y is the label of a batch sample    for X, y in data_iter(batch_size, features, labels):        l = loss(net(X, w, b), y).sum()          # calculate the gradient of batch sample loss         l.backward()          # using small batch random gradient descent to iter model parameters        sgd([w, b], lr, batch_size)          # reset parameter gradient        w.grad.data.zero_()  # æ¯ä¸€æ¬¡è¿ç®—åéƒ½éœ€è¦å°†ä¸Šä¸€æ¬¡çš„æ¢¯åº¦è®°å½•æ¸…ç©º        b.grad.data.zero_()    train_l = loss(net(features, w, b), labels)    print(&#39;epoch %d, loss %f&#39; % (epoch + 1, train_l.mean().item()))</code></pre><h2 id="çº¿æ€§å›å½’æ¨¡å‹ä½¿ç”¨pytorchçš„ç®€æ´å®ç°"><a href="#çº¿æ€§å›å½’æ¨¡å‹ä½¿ç”¨pytorchçš„ç®€æ´å®ç°" class="headerlink" title="çº¿æ€§å›å½’æ¨¡å‹ä½¿ç”¨pytorchçš„ç®€æ´å®ç°"></a>çº¿æ€§å›å½’æ¨¡å‹ä½¿ç”¨pytorchçš„ç®€æ´å®ç°</h2><pre><code class="lang-python">import torchfrom torch import nnimport numpy as nptorch.manual_seed(1)   # åŒæ ·çš„éšæœºåˆå§‹åŒ–ç§å­,ä¿è¯ç»“æœå¯ä»¥å¤ç°print(torch.__version__)torch.set_default_tensor_type(&#39;torch.FloatTensor&#39;)</code></pre><pre><code>1.3.0</code></pre><h3 id="ç”Ÿæˆæ•°æ®é›†-1"><a href="#ç”Ÿæˆæ•°æ®é›†-1" class="headerlink" title="ç”Ÿæˆæ•°æ®é›†"></a>ç”Ÿæˆæ•°æ®é›†</h3><p>åœ¨è¿™é‡Œç”Ÿæˆæ•°æ®é›†è·Ÿä»é›¶å¼€å§‹çš„å®ç°ä¸­æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><pre><code class="lang-python">num_inputs = 2num_examples = 1000true_w = [2, -3.4]true_b = 4.2features = torch.tensor(np.random.normal(0, 1, (num_examples, num_inputs)), dtype=torch.float)labels = true_w[0] * features[:, 0] + true_w[1] * features[:, 1] + true_blabels += torch.tensor(np.random.normal(0, 0.01, size=labels.size()), dtype=torch.float)</code></pre><h3 id="è¯»å–æ•°æ®é›†-1"><a href="#è¯»å–æ•°æ®é›†-1" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><pre><code class="lang-python">import torch.utils.data as Databatch_size = 10# combine featues and labels of datasetdataset = Data.TensorDataset(features, labels)# put dataset into DataLoaderdata_iter = Data.DataLoader(    dataset=dataset,            # torch TensorDataset format    batch_size=batch_size,      # mini batch size    shuffle=True,               # whether shuffle the data or not    num_workers=2,              # read data in multithreading)</code></pre><pre><code class="lang-python">for X, y in data_iter:    print(X, &#39;\n&#39;, y)    break</code></pre><pre><code>tensor([[ 0.2134,  0.7981],        [-0.3899, -0.4544],        [ 1.4472, -1.2160],        [-0.7354,  1.2216],        [-1.3233,  0.6937],        [-0.2810,  0.5505],        [-1.6620, -0.1457],        [-0.7635,  0.7058],        [ 0.6079, -0.7497],        [ 0.4924, -0.1376]])  tensor([ 1.9045,  4.9770, 11.2503, -1.4180, -0.8159,  1.7737,  1.3910,  0.2721,         7.9648,  5.6408])</code></pre><h3 id="å®šä¹‰æ¨¡å‹-1"><a href="#å®šä¹‰æ¨¡å‹-1" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><pre><code class="lang-python">class LinearNet(nn.Module):    def __init__(self, n_feature):        super(LinearNet, self).__init__()      # call father function to init         self.linear = nn.Linear(n_feature, 1)  # function prototype: `torch.nn.Linear(in_features, out_features, bias=True)`    def forward(self, x):        y = self.linear(x)        return ynet = LinearNet(num_inputs)print(net)</code></pre><pre><code>LinearNet(  (linear): Linear(in_features=2, out_features=1, bias=True))</code></pre><pre><code class="lang-python"># ways to init a multilayer network# method onenet = nn.Sequential(   # ä¸€ä¸ªæ—¶åºå®¹å™¨ï¼ŒModules ä¼šä»¥ä»–ä»¬ä¼ å…¥çš„é¡ºåºè¢«æ·»åŠ åˆ°å®¹å™¨ä¸­    nn.Linear(num_inputs, 1)    # other layers can be added here    )# method twonet = nn.Sequential()net.add_module(&#39;linear&#39;, nn.Linear(num_inputs, 1))# net.add_module ......# method threefrom collections import OrderedDictnet = nn.Sequential(OrderedDict([          (&#39;linear&#39;, nn.Linear(num_inputs, 1))          # ......        ]))print(net[0].weight)print(net[0].bias)# print(net)</code></pre><pre><code>Parameter containing:tensor([[0.6652, 0.1260]], requires_grad=True)Parameter containing:tensor([0.5704], requires_grad=True)</code></pre><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><pre><code class="lang-python">from torch.nn import initinit.normal_(net[0].weight, mean=0.0, std=0.01)  # weighté‡æ–°ç”Ÿæˆinit.constant_(net[0].bias, val=0.0)  # bias[ è¢«èµ‹å€¼ä¸º 0print(net[0].weight)print(net[0].bias)</code></pre><pre><code>Parameter containing:tensor([[0.0016, 0.0029]], requires_grad=True)Parameter containing:tensor([0.], requires_grad=True)</code></pre><pre><code class="lang-python">for param in net.parameters():    print(param)  # param å°±æ˜¯ä¸Šé¢çš„ weight å’Œ bias</code></pre><pre><code>Parameter containing:tensor([[0.0016, 0.0029]], requires_grad=True)Parameter containing:tensor([0.], requires_grad=True)</code></pre><h3 id="å®šä¹‰æŸå¤±å‡½æ•°-1"><a href="#å®šä¹‰æŸå¤±å‡½æ•°-1" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><pre><code class="lang-python">loss = nn.MSELoss()    # nn built-in squared loss function   é‡‡ç”¨è®¡ç®— MSE çš„ loss                       # function prototype: `torch.nn.MSELoss(size_average=None, reduce=None, reduction=&#39;mean&#39;)`</code></pre><h3 id="å®šä¹‰ä¼˜åŒ–å‡½æ•°-1"><a href="#å®šä¹‰ä¼˜åŒ–å‡½æ•°-1" class="headerlink" title="å®šä¹‰ä¼˜åŒ–å‡½æ•°"></a>å®šä¹‰ä¼˜åŒ–å‡½æ•°</h3><pre><code class="lang-python">import torch.optim as optimoptimizer = optim.SGD(net.parameters(), lr=0.03)   # built-in random gradient descent functionprint(optimizer)  # function prototype: `torch.optim.SGD(params, lr=, momentum=0, dampening=0, weight_decay=0, nesterov=False)`</code></pre><pre><code>SGD (Parameter Group 0    dampening: 0    lr: 0.03    momentum: 0    nesterov: False    weight_decay: 0)</code></pre><h3 id="è®­ç»ƒ-1"><a href="#è®­ç»ƒ-1" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><pre><code class="lang-python">num_epochs = 3for epoch in range(1, num_epochs + 1):    for X, y in data_iter:        output = net(X)        l = loss(output, y.view(-1, 1))        optimizer.zero_grad() # reset gradient, equal to net.zero_grad()        l.backward()        optimizer.step()    print(&#39;epoch %d, loss: %f&#39; % (epoch, l.item()))</code></pre><pre><code>epoch 1, loss: 0.000299epoch 2, loss: 0.000058epoch 3, loss: 0.000051</code></pre><pre><code class="lang-python"># result comparisiondense = net[0]print(true_w, dense.weight.data)print(true_b, dense.bias.data)</code></pre><pre><code>[2, -3.4] tensor([[ 2.0007, -3.3992]])4.2 tensor([4.1989])</code></pre><h2 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h2><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/19/XkyKfEtjT1l95wp.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±åº¦å­¦ä¹ åŸºç¡€</title>
      <link href="/2020/02/14/dl-notes/"/>
      <url>/2020/02/14/dl-notes/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo è¸©å‘è®°å½•</title>
      <link href="/2020/02/09/hexo-experience/"/>
      <url>/2020/02/09/hexo-experience/</url>
      
        <content type="html"><![CDATA[<h1 id="Hexo-è¸©å‘è®°å½•"><a href="#Hexo-è¸©å‘è®°å½•" class="headerlink" title="Hexo è¸©å‘è®°å½•"></a>Hexo è¸©å‘è®°å½•</h1><p>Hexo ä½œä¸€ä¸ªä¼˜ç§€çš„åšå®¢æ¡†æ¶ï¼Œæœ¬äººä¹Ÿæ˜¯ä¸€ç›´å‚è€ƒç€ç½‘ä¸Šé›¶é›¶ç¢ç¢çš„åšæ–‡ä¸€æ­¥æ­¥æ­å»ºçš„ï¼Œä¸­é—´é‡åˆ°ä¸å°‘å‘ã€‚æ¯æ¬¡åšä¸€ä¸ªç¨å¤§çš„é¡¹ç›®éƒ½è¦ç»å†è¿™ç§æŠ˜è…¾ï¼Œä»Šåå†³å®šæŠŠè¿™äº›ç»éªŒè®°å½•ä¸‹æ¥æ²‰æ·€ï¼Œæœ‰æœªå®Œæˆçš„ä¹Ÿç•™ç»™ä»¥åæ€è€ƒã€‚</p><h3 id="1-git-åˆ†æ”¯æœªçŸ¥å‡ºé”™"><a href="#1-git-åˆ†æ”¯æœªçŸ¥å‡ºé”™" class="headerlink" title="1. git åˆ†æ”¯æœªçŸ¥å‡ºé”™"></a>1. git åˆ†æ”¯æœªçŸ¥å‡ºé”™</h3><p>ä¿®æ”¹ matery.css çš„æ—¶å€™æ€»æ˜¯æ²¡æ³•åŒæ­¥åˆ° <a href="https://cdn.jsdelivr.net/gh/hopenx/hopenx.github.io" target="_blank" rel="noopener">https://cdn.jsdelivr.net/gh/hopenx/hopenx.github.io</a>â€¦ çš„è¿œç«¯ï¼Œåæ¥å‘ç°å­˜åœ¨åˆ†æ”¯çš„é—®é¢˜ï¼Œäºæ˜¯åœ¨ä¸»é¢˜çš„ config.yml ä¸­æ·»åŠ ä¸€ä¸ª <code>@master</code>:</p><pre><code class="lang-yml">jsDelivr:  url: https://cdn.jsdelivr.net/gh/hopenx/hopenx.github.io@master</code></pre><p>æ›´æ”¹çš„å†…å®¹éƒ¨åˆ†å¯ä»¥ç”Ÿæ•ˆï¼Œä½†ä»ç„¶æœ‰ä¸€äº›å†¥é¡½ä¸åŒ–çš„é…è‰²ï¼Œæœ¬åœ°å·²ç»æ¸²æŸ“å‡ºæ¥äº†ï¼Œè¿œç«¯ jsdelivr æ­»æ´»ä¸æ”¹å˜ï¼ŒåŠ äº† @master ä¹Ÿä¸å˜ï¼Œäºæ˜¯ç›´æ¥åœ¨ post/post-detail.ejs é¡µé¢ä¸­æ·»åŠ  css ä»£ç å¼ºè¡Œä¿®æ”¹:</p><pre><code class="lang-css">#articleContent a {    color: #267871; !important;}#artDetail .post-cate a {    color: #267871; !important;}blockquote {    border-left: 5px solid #267871; !important;}#artDetail .reprint a {    color: #267871; !important;}</code></pre><p>æŒ–ä¸ªå‘ï¼Œå¸Œæœ›ä»Šåå¯ä»¥å¥½å¥½ç ”ç©¶ä¸€ä¸‹ git</p><h3 id="2-Hexo-æ— æ³•è§£æä»£ç å—"><a href="#2-Hexo-æ— æ³•è§£æä»£ç å—" class="headerlink" title="2. Hexo æ— æ³•è§£æä»£ç å—"></a>2. Hexo æ— æ³•è§£æä»£ç å—</h3><p>æ¯”å¦‚ä¸Šé¢çš„ css ä»£ç å—ï¼ŒHexo åœ¨è§£æçš„æ—¶å€™ä¼šæŠŠå®ƒè¯†åˆ«æˆç½‘é¡µ css çš„å†…å®¹ï¼Œæœ€åæ²¡æœ‰æ˜¾ç¤ºï¼Œåªèƒ½ä¸»åŠ¨é€‚åº” Hexo è¿™ç§æ–¹å¼ï¼š</p><ol><li>ä¸æ·»åŠ  <code>&lt;style type=&quot;text/css&quot;&gt;</code>è¿™ç§ä¼šä¸ç½‘é¡µæ··æ·†çš„å†…å®¹</li><li>ä»£ç å—ä¸­ä¸æ·»åŠ (1) (2) åºå·</li></ol><h3 id="3-Hexo-ä»£ç å—æ— æ³•é«˜äº®çš„é—®é¢˜"><a href="#3-Hexo-ä»£ç å—æ— æ³•é«˜äº®çš„é—®é¢˜" class="headerlink" title="3. Hexo ä»£ç å—æ— æ³•é«˜äº®çš„é—®é¢˜"></a>3. Hexo ä»£ç å—æ— æ³•é«˜äº®çš„é—®é¢˜</h3><ol><li><p>ä¸»è¦çŸ›ç›¾ï¼š<br>hexo å¯¹äº mathjax çš„æ˜¾ç¤ºæ”¯æŒæœ‰é—®é¢˜ï¼Œéœ€è¦å®‰è£…æ–°çš„ kmarked æ’ä»¶ï¼Œä¿®æ”¹å¯¹äº<code>{, (</code>ç­‰ç­‰çš„è§£æè§„åˆ™ï¼Œè€Œä¿®æ”¹è§„åˆ™æ”¯æŒ Mathjax åï¼Œprism çš„é«˜äº®åŠŸèƒ½åˆä¼šå¤±æ•ˆï¼Œç®€è€Œè¨€ä¹‹ä¸å¯å…¼å¾—</p></li><li><p>è§£å†³ï¼š<br>æˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">hexo-matery</a>ä¸»é¢˜ï¼Œä½¿ç”¨äº†å¤§å®¶æ¨èçš„ hexo-prism-plugin ä¸»é¢˜ï¼Œä½†æ˜¯å‡ºç°å’Œ prism é«˜äº®å’Œ Mathjax è¯­æ³•ä¸å…¼å®¹çš„é—®é¢˜ã€‚ä»£ç ä¸èƒ½é«˜äº®ç®€ç›´å¤±å»äº†åšå®¢å†™ä»£ç çš„æ„ä¹‰ã€‚æœ€åä½¿ç”¨ <a href="https://highlightjs.org/" target="_blank" rel="noopener">highlight.js</a>æˆåŠŸå®ç°ä»£ç é«˜äº®ï¼Œå‚è€ƒä»¥ä¸‹è¿™ä½åšä¸»çš„è®¾ç½®ï¼š<a href="http://cps.ninja/2019/03/25/add-highlightjs-to-hexo-blog/" target="_blank" rel="noopener">ä½¿ç”¨ Highlight.js ä¼˜åŒ–ä»£ç å—é«˜äº®æ•ˆæœ</a></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å­¦åŸºç¡€å¤‡å¿˜å½•</title>
      <link href="/2020/02/07/math-notes/"/>
      <url>/2020/02/07/math-notes/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°å­¦åŸºç¡€å¤‡å¿˜å½•"><a href="#æ•°å­¦åŸºç¡€å¤‡å¿˜å½•" class="headerlink" title="æ•°å­¦åŸºç¡€å¤‡å¿˜å½•"></a>æ•°å­¦åŸºç¡€å¤‡å¿˜å½•</h1><h2 id="æ’åˆ—ç»„åˆå…¬å¼"><a href="#æ’åˆ—ç»„åˆå…¬å¼" class="headerlink" title="æ’åˆ—ç»„åˆå…¬å¼"></a>æ’åˆ—ç»„åˆå…¬å¼</h2><p>(A_{n}^{m}=n(n-1) \cdots(n-m+1))  mä¸ªæ•°é€’å‡ç›¸ä¹˜<br>(C_{n}^{m}=\frac{A_{n}^{m}}{m !}=\frac{n !}{m !(n-m) !}=C_{n}^{n-m})</p><p>$A^4_4 = 4\times3\times2\times1 = 24$</p><p>$A^4_4$ è®¡ç®—æ–¹æ³•ï¼šä»4 å¼€å§‹ï¼Œä» 4 åˆ° 3 åˆ° 2â€¦è¿ç»­ä¹˜ 4 ä¸ªæ•°ã€‚<br>$C^3_4$ è®¡ç®—æ–¹æ³•ï¼šï¼ˆå…ˆè®¡ç®— $A^3_4$ å†å¾—åˆ° $C^3_4$ ï¼‰$C^3_4 = \frac{A^3_4}{3!} = \frac{4\times3\times2}{3\times2\times1} = 24\div6 = 4$</p><p>æ¯”å¦‚ $A^2_4$ è¡¨ç¤ºä» 4 ä¸ªä¸œè¥¿ä¸œè¥¿ä¸­æŠ½å–ä»»æ„ 2 æ ·ï¼Œä¸€å…±æœ‰ $4\times3 = 12$ <code>æ’åˆ—</code>æ–¹å¼ã€‚<br>$C^3_4$ è¡¨ç¤ºä» 4 ä¸ªä¸œè¥¿ä¸œè¥¿ä¸­æŠ½å–ä»»æ„ 3 æ ·ï¼Œä¸€å…±æœ‰ $\frac{4\times3\times2}{3\times2\times1} = 24\div6 = 4$ ä¸¤ç§<code>ç»„æˆ</code>æ–¹å¼ã€‚</p><p>A è¡¨ç¤ºæ’åˆ—ï¼Œæ˜¯æœ‰åºçš„ï¼Œè€Œ C è¡¨ç¤ºç»„åˆï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ç§<code>ç»„æˆ</code>æ–¹å¼ï¼Œåªçœ‹æˆå‘˜ï¼Œä¸çœ‹é¡ºåºã€‚</p><p>å¯¹äº Aï¼ˆæ’åˆ—ï¼‰æ¥è¯´ï¼Œ<code>4 3 1</code>å’Œ<code>1 3 4</code>æ˜¯ä¸¤ç§æ„æˆï¼Œè€Œå¯¹äº Cï¼ˆç»„åˆï¼‰æ¥è¯´ï¼Œ<code>4 3 1</code>å’Œ<code>1 3 4</code>å°±æ˜¯åŒä¸€å›äº‹ã€‚</p><p>$C^3_5$ = å¤šå°‘ï¼Ÿ </p>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ åŸºç¡€(ä¸€) æ¦‚è¿°</title>
      <link href="/2020/02/06/ml-study-notes/"/>
      <url>/2020/02/06/ml-study-notes/</url>
      
        <content type="html"><![CDATA[<h1 id="æœºå™¨å­¦ä¹ æ¦‚è¿°"><a href="#æœºå™¨å­¦ä¹ æ¦‚è¿°" class="headerlink" title="æœºå™¨å­¦ä¹ æ¦‚è¿°"></a>æœºå™¨å­¦ä¹ æ¦‚è¿°</h1><h2 id="æœºå™¨å­¦ä¹ åˆ†ç±»"><a href="#æœºå™¨å­¦ä¹ åˆ†ç±»" class="headerlink" title="æœºå™¨å­¦ä¹ åˆ†ç±»"></a>æœºå™¨å­¦ä¹ åˆ†ç±»</h2><ol><li>ç›‘ç£å­¦ä¹ ï¼šå·²ç»æœ‰æ•°æ®ï¼Œå’Œæ•°æ®å¯¹åº”çš„æ ‡ç­¾ã€‚</li><li>éç›‘ç£å­¦ä¹ ï¼šç»™å®šçš„æ ·æœ¬æ— éœ€è¾“å‡º/æ ‡ç­¾ï¼Œè®©æœºå™¨è‡ªå·±å­¦ä¹ æ ·æœ¬ä¸­éšå«çš„å†…éƒ¨ç»“æ„ã€‚</li><li>åŠç›‘ç£å­¦ä¹ ï¼šäºŒè€…ç»“åˆã€‚</li><li>å¼ºåŒ–å­¦ä¹ ï¼šé€šè¿‡æ‰“åˆ†/è¯„ä»·çš„å½¢å¼ï¼Œç±»ä¼¼äºç›‘ç£å­¦ä¹ ä¸­çš„æ ‡ç­¾ã€‚</li></ol><h2 id="æœºå™¨å­¦ä¹ æ¨¡å‹"><a href="#æœºå™¨å­¦ä¹ æ¨¡å‹" class="headerlink" title="æœºå™¨å­¦ä¹ æ¨¡å‹"></a>æœºå™¨å­¦ä¹ æ¨¡å‹</h2><p>æœºå™¨å­¦ä¹  = æ•°æ® data + æ¨¡å‹ model + ä¼˜åŒ–æ–¹æ³• optimal strategy</p><h2 id="åå·®-æ–¹å·®æƒè¡¡"><a href="#åå·®-æ–¹å·®æƒè¡¡" class="headerlink" title="åå·®/æ–¹å·®æƒè¡¡"></a>åå·®/æ–¹å·®æƒè¡¡</h2><p>variance å’Œ biasï¼Œåˆ†åˆ«å¯¹åº”è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</p><p>æ¥è‡ª Wikipediaï¼š</p><blockquote><p>åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œå¦‚æœèƒ½å°†æ¨¡å‹çš„æ–¹å·®ä¸è¯¯å·®æƒè¡¡å¥½ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¯¥æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½ï¼ˆå¯¹äºæ–°æ•°æ®ï¼‰å°†ä¼šè¡¨ç°å‡ºå¥½çš„ç»“æœã€‚</p><p>åå·®åˆ»ç”»çš„æ˜¯ç®—æ³•æœ¬èº«çš„æ€§èƒ½ã€‚é«˜åå·®å°†ä¼šé€ æˆæ¬ æ‹Ÿåˆ(Underfitting) [miss the relevant relations between features and target outputs]ã€‚æ¢å¥è¯è¯´ï¼Œæ¨¡å‹è¶Šå¤æ‚åå·®å°±è¶Šå°ï¼›è€Œæ¨¡å‹è¶Šç®€å•ï¼Œåå·®å°±è¶Šå¤§ã€‚</p><p>æ–¹å·®ç”¨æ¥è¡¡é‡å› è®­ç»ƒé›†æ•°æ®æ³¢åŠ¨(fluctuations)è€Œé€ æˆçš„è¯¯å·®å½±å“ã€‚é«˜æ–¹å·®å°†ä¼šé€ æˆè¿‡æ‹Ÿåˆ(Overfitting)ã€‚</p></blockquote><p>åœ¨å‘¨å¿—åè€å¸ˆ&lt;æœºå™¨å­¦ä¹ &gt;ä¹¦ä¸­æ˜¯è¿™æ ·é˜è¿°çš„ï¼š</p><blockquote><p><em>åå·®</em> åº¦é‡äº†å­¦ä¹ ç®—æ³•çš„æœŸæœ›é¢„æµ‹ä¸çœŸå®ç»“æœçš„åç¦»ç¨‹åº¦ï¼Œå³åˆ»ç”»äº†ç®—æ³•æœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›ï¼›</p><p><em>æ–¹å·®</em> åº¦é‡äº†åŒæ ·å¤§å°çš„è®­ç»ƒé›†çš„å˜åŠ¨æ‰€å¯¼è‡´çš„å­¦ä¹ æ€§èƒ½çš„å˜åŒ–ï¼Œå³åˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“(åœ¨ä¸åŒæ•°æ®é›†ä¸Šè¡¨ç°å¾ˆä¸ç¨³å®š);</p><p><em>å™ªå£°</em> åˆ™è¡¨è¾¾äº†åœ¨å½“å‰ä»»åŠ¡ä¸Šä»»ä½•å­¦ä¹ ç®—æ³•æ‰€èƒ½è¾¾åˆ°çš„æœŸæœ›æ³›åŒ–è¯¯å·®çš„ä¸‹ç•Œï¼Œå³åˆ»ç”»äº†å­¦ä¹ é—®é¢˜çš„æœ¬èº«éš¾åº¦</p><p>åå·®-æ–¹å·®åˆ†è§£è¯´æ˜ï¼Œæ³›åŒ–æ€§èƒ½æ˜¯ç”±å­¦ä¹ ç®—æ³•çš„èƒ½åŠ›ã€æ•°æ®çš„å……åˆ†æ€§ä»¥åŠå­¦ä¹ ä»»åŠ¡æœ¬èº«çš„éš¾åº¦æ‰€å…±åŒå†³å®šçš„ã€‚ç»™å®šçš„å­¦ä¹ ä»»åŠ¡ï¼Œä¸ºäº†å–å¾—å¥½çš„æ³›åŒ–æ€§èƒ½ï¼Œåˆ™éœ€ä½¿åå·®è¾ƒå°ï¼Œå³èƒ½å¤Ÿå……åˆ†æ‹Ÿåˆæ•°æ®ï¼Œå¹¶ä¸”ä½¿æ–¹å·®è¾ƒå°ï¼Œå³ä½¿æ•°æ®æ‰°åŠ¨äº§ç”Ÿçš„å½±å“å°ã€‚ä¸€èˆ¬æ¥è¯´æ–¹å·®ä¸åå·®æ˜¯æœ‰å†²çªçš„ï¼Œè¿™ç§°ä¸ºæ–¹å·®-åå·®çª˜å¢ƒã€‚</p></blockquote><h2 id="å¸¸è§æœºå™¨å­¦ä¹ ç®—æ³•æ¦‚è§ˆ"><a href="#å¸¸è§æœºå™¨å­¦ä¹ ç®—æ³•æ¦‚è§ˆ" class="headerlink" title="å¸¸è§æœºå™¨å­¦ä¹ ç®—æ³•æ¦‚è§ˆ"></a>å¸¸è§æœºå™¨å­¦ä¹ ç®—æ³•æ¦‚è§ˆ</h2><h3 id="1-Linear-Algorithm-çº¿æ€§ç®—æ³•"><a href="#1-Linear-Algorithm-çº¿æ€§ç®—æ³•" class="headerlink" title="1. Linear Algorithm çº¿æ€§ç®—æ³•"></a>1. Linear Algorithm çº¿æ€§ç®—æ³•</h3><ol><li><p><strong>Linear Regression çº¿æ€§å›å½’</strong>ï¼šä½¿ç”¨æœ€å°äºŒä¹˜æ³• Least Squares æ‹Ÿåˆä¸€æ¡ç›´çº¿ â†’ è®¡ç®— R<sup>2</sup> â†’ è®¡ç®— R<sup>2</sup> çš„ p å€¼ã€‚R<sup>2</sup> è¡¨ç¤º x èƒ½å¤šå¤§ç¨‹åº¦åæ˜  y çš„å˜åŒ–ï¼Œp å€¼è¡¨ç¤ºå¯é ç¨‹åº¦ã€‚æ‹Ÿåˆç›´çº¿çš„è¿‡ç¨‹ä½¿ç”¨ã€Œéšæœºæ¢¯åº¦ä¸‹é™ã€ï¼ˆSGDï¼‰</p></li><li><p><strong>Lasso å›å½’ å’Œ Ridge å›å½’</strong>ï¼šéƒ½å¯ä»¥å‡å°‘å…±çº¿æ€§å¸¦æ¥çš„å½±å“ï¼Œå³ X è‡ªå˜é‡ä¹‹é—´æœ‰ç›¸äº’å…³è”ã€‚åŒºåˆ«å¯ä»¥å½’ç»“ä¸ºL2å’ŒL1æ­£åˆ™åŒ–çš„æ€§è´¨å·®å¼‚ã€‚</p></li><li><p><strong>Polynomial Regression å¤šé¡¹å¼å›å½’</strong>ï¼šèƒ½å¤Ÿæ¨¡æ‹Ÿéçº¿æ€§å¯åˆ†çš„æ•°æ®ï¼ˆæ›²çº¿ï¼‰ï¼Œçº¿æ€§å›å½’ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚ä½†å®¹æ˜“è¿‡æ‹Ÿåˆã€‚</p></li><li><p><strong>Logistic Regression é€»è¾‘å›å½’</strong>ï¼šåˆ¤æ–­ True or Falseï¼ŒY å€¼ä¸º 0-1 è¡¨ç¤ºæ¦‚ç‡ï¼Œç”¨äºåˆ†ç±»ã€‚çº¿æ€§å›å½’ä½¿ç”¨ã€ŒResidual åå·®ã€ï¼Œè€Œé€»è¾‘å›å½’ä½¿ç”¨ã€Œmaximum likelihood æœ€å¤§ä¼¼ç„¶ã€</p></li></ol><h4 id="é€»è¾‘å›å½’å›é¡¾"><a href="#é€»è¾‘å›å½’å›é¡¾" class="headerlink" title="é€»è¾‘å›å½’å›é¡¾"></a>é€»è¾‘å›å½’å›é¡¾</h4><ul><li>é€»è¾‘å›å½’æ˜¯ä¸€ç§äºŒåˆ†ç±»æ¨¡å‹, ç»™å‡ºçš„æ˜¯åˆ’åˆ†ä¸º (0, 1) çš„æ¦‚ç‡. é€šè¿‡$\theta^Tx$é€šè¿‡ä¸€ä¸ª sigmoid å‡½æ•°æ˜ å°„åˆ° 0-1 èŒƒå›´å†…. sigmoid å°†ä¸€ä¸ªå¾—åˆ†è½¬åŒ–ä¸ºæ¦‚ç‡è¾“å‡º. è®¾ç½®ä¸€ä¸ªé˜ˆå€¼$h$, å¤§äº$h$åˆ™åˆ¤æ–­ä¸º 1.</li></ul><script type="math/tex; mode=display">\begin{array}{l}p_{\theta}(y=1 | x)=\sigma\left(\theta^{T} x\right)=\frac{1}{1+e^{-\theta^{T} x}} \\p_{\theta}(y=0 | x)=\frac{e^{-\theta^{T} x}}{1+e^{-\theta^{T} x}}\end{array}</script><ul><li>å‡æ–¹è¯¯å·® MSE<script type="math/tex; mode=display">M S E=\frac{1}{n} \sum_{i}^{n}\left(\hat{y}_{i}-y_{i}\right)^{2}</script>æ ‡å‡†å·® RMSE <script type="math/tex">RMSE=\sqrt{MSE}</script></li></ul><blockquote><p>ä½¿ç”¨MSEçš„ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å…¶åå¯¼å€¼åœ¨è¾“å‡ºæ¦‚ç‡å€¼æ¥è¿‘0æˆ–è€…æ¥è¿‘1çš„æ—¶å€™éå¸¸å°ï¼Œè¿™å¯èƒ½ä¼šé€ æˆæ¨¡å‹åˆšå¼€å§‹è®­ç»ƒæ—¶ï¼Œåå¯¼å€¼å‡ ä¹æ¶ˆå¤±. è¿™å¯¼è‡´æ¨¡å‹åœ¨ä¸€å¼€å§‹å­¦ä¹ çš„æ—¶å€™é€Ÿç‡éå¸¸æ…¢ï¼Œè€Œä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°åˆ™ä¸ä¼šå¯¼è‡´è¿™æ ·çš„æƒ…å†µå‘ç”Ÿ.</p></blockquote><ul><li>äº¤å‰ç†µæŸå¤±å‡½æ•°<br>è¯¥å‡½æ•°æ˜¯<code>å‡¸å‡½æ•°</code>ï¼Œæ±‚å¯¼æ—¶èƒ½å¤Ÿå¾—åˆ°å…¨å±€æœ€ä¼˜å€¼. (è®°å¾—å‰é¢æœ‰ä¸€ä¸ªè´Ÿå·)<br>å¤šåˆ†ç±»æƒ…å†µä¸‹:<script type="math/tex; mode=display">L=\frac{1}{N} \sum_{i} L_{i}=\frac{1}{N} \sum_{i}-\sum_{c=1}^{M} y_{i c} \log \left(p_{i c}\right)</script>åœ¨äºŒåˆ†çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹æœ€åéœ€è¦é¢„æµ‹çš„ç»“æœåªæœ‰ä¸¤ç§æƒ…å†µï¼Œå¯¹äºæ¯ä¸ªç±»åˆ«æˆ‘ä»¬çš„é¢„æµ‹å¾—åˆ°çš„æ¦‚ç‡ä¸º p å’Œ 1-p. æ­¤æ—¶è¡¨è¾¾å¼ä¸ºï¼š<script type="math/tex; mode=display">L=\frac{1}{N} \sum_{i} L_{i}=\frac{1}{N} \sum_{i}-\left[y_{i} \cdot \log \left(p_{i}\right)+\left(1-y_{i}\right) \cdot \log \left(1-p_{i}\right)\right]</script>å…¶ä¸­ï¼š<br>$y_i$ â€”â€” è¡¨ç¤ºæ ·æœ¬içš„labelï¼Œæ­£ç±»ä¸º1ï¼Œè´Ÿç±»ä¸º0<br>$p_i$ â€”â€” è¡¨ç¤ºæ ·æœ¬ié¢„æµ‹ä¸ºæ­£çš„æ¦‚ç‡<br><code>pi</code> å°±æ˜¯ sigmoid å‡½æ•°è¾“å‡ºçš„ç»“æœ, ä¹Ÿå¯ä»¥å†™ä½œä¸º:<script type="math/tex; mode=display">\mathcal{L}\left(y, x, p_{\theta}\right)=-y \log \sigma\left(\theta^{T} x\right)-(1-y) \log \left(1-\sigma\left(\theta^{T} x\right)\right)</script>å¯¹åº”çš„æ¢¯åº¦å‡½æ•°(å¯¼æ•°):<script type="math/tex; mode=display">\frac{\partial \mathcal{L}\left(y, x, p_{\theta}\right)}{\partial \theta}=(\sigma(\theta^{T} x)-y) x</script>ç»™å®šä¸€ä¸ªå­¦ä¹ ç‡ $\eta$, æ­¥é•¿ = æ¢¯åº¦ x å­¦ä¹ ç‡, é‚£ä¹ˆ $\theta$ å­¦ä¹ /æ›´æ–°çš„è¿‡ç¨‹å°±æ˜¯:<script type="math/tex; mode=display">\theta \leftarrow \theta+\eta\left(y-\sigma\left(\theta^{T} x\right)\right) x</script></li><li>é€»è¾‘å›å½’æ‰“åˆ†å‡½æ•°:<script type="math/tex; mode=display">s(x)=\theta_0+\theta_1x_1+\theta_2x_2</script>ä¹Ÿå°±æ˜¯$\theta^{T} x$ ,ä¹Ÿå°±æ˜¯ $b+w^Tx$ . åœ¨ç›´çº¿çš„ä¸Šæ–¹, å‡½æ•°å€¼å°±ä¼šå¤§äº 0, sigmoid çš„å‡½æ•°å€¼å°±ä¼šè¶Šæ¥è¿‘ 1, åˆ†ç±»å½’ä¸º 1. æ‰“åˆ†è¶Šé«˜, è¶Šè¿œç¦»å†³ç­–è¾¹ç•Œ, å…·æœ‰æ›´é«˜çš„åˆ†ç±»<code>ç½®ä¿¡åº¦</code>.</li></ul><h3 id="2-Decision-Tree-å†³ç­–æ ‘"><a href="#2-Decision-Tree-å†³ç­–æ ‘" class="headerlink" title="2. Decision Tree å†³ç­–æ ‘"></a>2. Decision Tree å†³ç­–æ ‘</h3><ol><li><p><strong>ID3</strong>: è®¡ç®—ã€Œä¿¡æ¯ç†µã€ $Entropy(D)$ï¼Œå€¼è¶Šå°ï¼Œè¯´æ˜æ ·æœ¬é›†åˆDçš„çº¯åº¦å°±è¶Šé«˜ï¼Œè¿›è€Œé€‰æ‹©ç”¨æ ·æœ¬çš„æŸä¸€ä¸ªå±æ€§aæ¥åˆ’åˆ†æ ·æœ¬é›†åˆDæ—¶ï¼Œå°±å¯ä»¥å¾—å‡ºç”¨å±æ€§aå¯¹æ ·æœ¬Dè¿›è¡Œåˆ’åˆ†æ‰€å¸¦æ¥çš„ã€Œä¿¡æ¯å¢ç›Šã€ $Gain(D, a)$ï¼Œå€¼è¶Šå¤§ï¼Œè¯´æ˜å¦‚æœç”¨å±æ€§aæ¥åˆ’åˆ†æ ·æœ¬é›†åˆDï¼Œé‚£ä¹ˆçº¯åº¦ä¼šæå‡ã€‚ <script type="math/tex">Entropy(t)=-\sum_{k} p\left(c_{k} | t\right) \log p\left(c_{k} | t\right)</script>  <script type="math/tex">Classificationerror (t)=1-\max _{k}\left[p\left(c_{k} | t\right)\right]</script></p></li><li><p><strong>C4.5</strong>: æå‡ºGainratio ã€Œå¢ç›Šç‡ã€ï¼Œè§£å†³ID3å†³ç­–æ ‘çš„ä¸€ä¸ªç¼ºç‚¹ï¼Œå½“ä¸€ä¸ªå±æ€§çš„å¯å–å€¼æ•°ç›®è¾ƒå¤šæ—¶ï¼Œé‚£ä¹ˆå¯èƒ½åœ¨è¿™ä¸ªå±æ€§å¯¹åº”çš„å¯å–å€¼ä¸‹çš„æ ·æœ¬åªæœ‰ä¸€ä¸ªæˆ–è€…æ˜¯å¾ˆå°‘ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å®ƒçš„ä¿¡æ¯å¢ç›Šæ˜¯éå¸¸é«˜çš„ï¼Œè¿™ä¸ªæ—¶å€™çº¯åº¦å¾ˆé«˜ï¼ŒID3å†³ç­–æ ‘ä¼šè®¤ä¸ºè¿™ä¸ªå±æ€§å¾ˆé€‚åˆåˆ’åˆ†ï¼Œä½†æ˜¯è¾ƒå¤šå–å€¼çš„å±æ€§æ¥è¿›è¡Œåˆ’åˆ†å¸¦æ¥çš„é—®é¢˜æ˜¯å®ƒçš„æ³›åŒ–èƒ½åŠ›æ¯”è¾ƒå¼±ã€‚ç”¨ $I(Â·)$ è¡¨ç¤ºä¸çº¯åº¦â€”â€”å¯ä»¥æ˜¯ç†µå¯ä»¥æ˜¯åŸºå°¼ï¼Œä¿¡æ¯å¢ç›Šï¼š<script type="math/tex">\Delta=I(\text { parent })-\sum_{i=1}^{n} \frac{N\left(a_{i}\right)}{N} I\left(a_{i}\right)</script>ä¿¡æ¯å¢ç›Šç‡ï¼š<script type="math/tex">Gainratio =\frac{\Delta}{Entropy({parent})}</script></p></li><li><p><strong>CART(Classification and Regression Tree)</strong>: é€šè¿‡è®¡ç®— Gini åŸºå°¼ç³»æ•°ï¼ˆå°½å¯èƒ½å°ï¼‰ï¼Œåˆ¤æ–­ impurity ä¸çº¯æ´åº¦ã€‚ç¦»æ•£æ•°æ®ç”¨ã€Œæ˜¯å¦ã€åˆ’åˆ†å­æ ‘ï¼Œè¿ç»­æ•°æ®å¯ä»¥ç”¨ã€Œä¸¤ä¸¤ä¹‹é—´å¹³å‡å€¼ã€åˆ’åˆ†å­æ ‘ã€‚<script type="math/tex">{Gini}(t)=1-\sum_{k}\left[p\left(c_{k} | t\right)\right]^{2}</script>D åˆ†è£‚ä¸º DL å’Œ DRï¼Œåˆ†è£‚åçš„ä¿¡æ¯å¢ç›Š<script type="math/tex">Gain(D, A)=\frac{\left|D_{L}\right|}{|D|} \operatorname{Gini}\left(D_{L}\right)+\frac{\left|D_{R}\right|}{|D|} \operatorname{Gini}\left(D_{R}\right)</script></p></li></ol><h3 id="3-SVM-æ”¯æŒå‘é‡æœº"><a href="#3-SVM-æ”¯æŒå‘é‡æœº" class="headerlink" title="3. SVM æ”¯æŒå‘é‡æœº"></a>3. SVM æ”¯æŒå‘é‡æœº</h3><h4 id="æ‰¾åˆ°æœ€å°é—´éš”"><a href="#æ‰¾åˆ°æœ€å°é—´éš”" class="headerlink" title="æ‰¾åˆ°æœ€å°é—´éš”"></a>æ‰¾åˆ°æœ€å°é—´éš”</h4><ul><li>$y_i$ å– -1 æˆ– 1</li><li>æ€æƒ³: æ‰¾åˆ°ç¦» decision boundry æœ€è¿‘çš„ç‚¹, æ‰¾åˆ° w å’Œ b, è®©æœ€å°çš„ margin è·å¾—æ¯”è¾ƒå¤§çš„å€¼. <code>æœ€å¤§åŒ–æœ€å°çš„å‡ ä½•é—´éš”</code></li><li>ç‚¹åˆ°ç›´çº¿çš„è·ç¦»:<script type="math/tex; mode=display">d=\frac{\left|A x_{0}+B y_{0}+C\right|}{\sqrt{A^{2}+B^{2}}}</script>å³<script type="math/tex; mode=display">d=\frac{\left|(A, B)\left(\begin{array}{c}x 0 \\y 0\end{array}\right)+C\right|}{\|(A, B)\|}</script>å¦‚æœæ•°æ®æ˜¯ n ç»´æ—¶ï¼Œæ­¤æ—¶ç›´çº¿å°±å˜æˆäº†å¹³é¢ï¼Œç”¨ $w$ è¡¨ç¤ºå¹³é¢çš„æ³•å‘é‡å¾—ï¼š<script type="math/tex; mode=display">d=\frac{|w \cdot x+b|}{\|w\|}</script></li><li><strong>å‡½æ•°é—´éš”</strong>:<br>ç”±äºåˆ†æ¯${|w|}$éƒ½æ˜¯ç›¸åŒçš„, æˆ‘ä»¬åªéœ€æ¯”è¾ƒåˆ†å­, äºæ˜¯æœ‰äº†å‡½æ•°é—´éš”<script type="math/tex; mode=display">\hat{\gamma}^{(i)}=y^{(i)}\left(w^{T} x^{(i)}+b\right).</script>ä¹˜ä»¥ $y^{(i)}$ æ˜¯ä¸ºäº†<code>å–ç»å¯¹å€¼</code>, é -1 å³ 1</li><li><p><strong>å‡ ä½•é—´éš”</strong>:<br>w å’Œ b çš„èµ‹å€¼å¯ä»¥åŒæ—¶æ”¹å˜, æ¯”å¦‚åŒæ—¶$*2$, $\hat{y}^{(i)}$ å€¼ä¼šå˜å¤§, ä½†æ˜¯åˆ†å‰²è¶…å¹³é¢ä¸ä¼šå˜åŒ– (å› ä¸º=0çš„è§£æ˜¯ä¸€æ ·çš„)<br>æ‰€ä»¥éœ€è¦å¯¹æ³•å‘é‡åŠ æŸäº›çº¦æŸ, æˆ‘ä»¬å¯ä»¥é™¤ä»¥ä¸€ä¸ª||w||, ä½œä¸º normalizaiton<code>å½’ä¸€åŒ–</code>, ä½¿å¾—<code>å‡½æ•°é—´éš” -&gt; å‡ ä½•é—´éš”</code>. å³å¯¹ $w$ ä½¿ç”¨<code>L2èŒƒæ•°</code>è¿›è¡Œè§„èŒƒåŒ–ï¼Œä½¿å¾—é—´éš”æ˜¯ç¡®å®šçš„.</p><script type="math/tex; mode=display">\hat{\gamma}^{(i)}=y^{(i)}\left[\left(\frac{w}{\|w\|}\right)^{T} x^{(i)}+\frac{b}{\|w\|}\right]</script><p>ç»™å®šä¸€ä¸ªè®­ç»ƒé›†, å°±å¯ä»¥ä¾æ¬¡è®¡ç®— $\hat{\gamma}^{(i)}$, é€‰å‡ºæœ€å°çš„å‡ ä½•é—´éš” ${\gamma}$, ä½œä¸ºæ•´ä¸ªæ•°æ®é›†åˆ°è¶…å¹³é¢çš„å‡ ä½•é—´éš”. æ»¡è¶³è¿™ä¸ªå‡ ä½•é—´éš”çš„ç‚¹, å°±æ˜¯<code>æ”¯æ’‘å‘é‡</code>.</p></li><li><p><strong>ä¼˜åŒ–ç›®æ ‡</strong>:<br>å¯¹äºå‡ ä½•é—´éš”</p><script type="math/tex; mode=display">\begin{aligned}&\max _{\gamma, \omega, b} \gamma\\&\text { s.t. } \quad y^{(i)}\left(w^{T} x^{(i)}+b\right) \geq \gamma, \quad i=1, \dots, m\\\end{aligned}</script><p>é™å®šçš„æ¡ä»¶æ˜¯ $||w||=1$, ä¹Ÿå°±æ˜¯ w åœ¨ä¸€ä¸ªç¯ä¸Š, ä¸æ˜¯ä¸€ä¸ªå‡¸é›†, æ‰€ä»¥æ˜¯ä¸€ä¸ª<code>éå‡¸çº¦æŸ</code>.<br>ç­‰åŒäºä¼˜åŒ–ä¸€ä¸ª<code>éå‡¸çš„ç›®æ ‡å‡½æ•°</code>, è¿™ç§æƒ…å†µä¸‹,  $||w||$ ä½œä¸ºåˆ†æ¯, ä»ç„¶æ˜¯ä¸€ä¸ªéå‡¸å‡½æ•°.(å¦‚æœæ˜¯åˆ†å­, å°±æ˜¯å‡¸å‡½æ•°)</p><script type="math/tex; mode=display">\begin{aligned}&\max _{\gamma, w, b} {\frac{\hat{\gamma}}{\|w\|}}\\&\text { s.t. } \quad y^{(i)}\left(w^{T} x^{(i)}+b\right) \geq \hat{\gamma}, \quad i=1, \ldots, m\end{aligned}</script></li><li><p>è°ƒæ•´åçš„ç›®æ ‡å‡½æ•°:<br>ç”±äºåˆ†ç±»é—´éš”çš„å˜åŒ–, å³ w, b çš„æ”¾ç¼©ä¸ä¼šå½±å“å†³ç­–è¾¹ç•Œ, å°†å‡½æ•°é—´éš”<code>å›ºå®šä¸º 1</code>, å³$\hat{\gamma}=1$, ç›®æ ‡å‡½æ•°é‡å†™ä¸º (äºŒæ¬¡è§„åˆ’)</p><script type="math/tex; mode=display">\max _{w, b} \frac{1}{\|w\|}</script><p>ç­‰åŒäº</p><script type="math/tex; mode=display">\begin{aligned}&\min _{w, b} \frac{1}{2}{\|w\|}^2\\&\text { s.t. } \quad y^{(i)}\left(w^{T} x^{(i)}+b\right) \geq \hat{\gamma}, \quad i=1, \ldots, m\end{aligned}</script><blockquote><p>ç”¨ç›´çº¿ç”»å‡ºæ¥çš„åŒºåŸŸ/å‡½æ•°ä¸€å®šæ˜¯ä¸€ä¸ªå‡¸é›†</p></blockquote></li></ul><h4 id="æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•"><a href="#æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•" class="headerlink" title="æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•"></a>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•</h4><p>å¯¹äºå‡¸ä¼˜åŒ–é—®é¢˜</p><script type="math/tex; mode=display">\begin{array}{ll}\min _{w} & f(w) \\\text { s.t. } & h_{i}(w)=0, \quad i=1, \dots, l\end{array}</script><p>æ‹‰æ ¼æœ—æ—¥å‡½æ•°å®šä¹‰ä¸º</p><script type="math/tex; mode=display">\mathcal{L}(w, \beta)=f(w)+\sum_{i=1}^{l} \beta_{i} h_{i}(w)</script><blockquote><p>å…¶ä¸­ $\beta_{i}$ ç§°ä¹‹ä¸ºæ‹‰æ ¼æœ—æ—¥ä¹˜å­</p></blockquote><p>é—®é¢˜çš„è§£, å¯¹ $w$ å’Œ $\beta$ åˆ†åˆ«æ±‚å¯¼ =0 å³å¯</p><script type="math/tex; mode=display">\frac{\partial \mathcal{L}(w, \beta)}{\partial w}=0 \quad \frac{\partial \mathcal{L}(w, \beta)}{\partial \beta}=0</script><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/27/WFAhMKzVsPD7xZJ.png" alt="æ‹‰æ ¼æœ—æ—¥æ³•-åŸç†è§£æ"><br>è§£æ±‚å¾—çš„ç‚¹, å°±æ˜¯ $h(w)=0$ ä¸ç­‰é«˜çº¿çš„ä¸€ä¸ªåˆ‡ç‚¹, åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹, $f(w)$ éƒ½ä¼šæ›´å¤§. åœ¨è¿™é‡Œ, $f(w)$ å³ä¸º $ \frac{1}{2}{|w|}^2$</p><h4 id="é€šç”¨å‡¸ä¼˜åŒ–é—®é¢˜"><a href="#é€šç”¨å‡¸ä¼˜åŒ–é—®é¢˜" class="headerlink" title="é€šç”¨å‡¸ä¼˜åŒ–é—®é¢˜"></a>é€šç”¨å‡¸ä¼˜åŒ–é—®é¢˜</h4><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/28/97GTvousRYj8S1y.png" alt="å‡¸ä¼˜åŒ–é—®é¢˜"><br>æ»¡è¶³çº¦æŸæ¡ä»¶çš„æƒ…å†µä¸‹, åé¢ä¸¤ä¸ªå¼å­ä¸€å®š $=0$, å½“çº¦æŸæ¡ä»¶ä¸æ»¡è¶³æ¡ä»¶ä¸‹, ä¸€å®šèƒ½å– $\alpha_{i}$ å’Œ $\beta_{i}$, æœ€ç»ˆæ‹‰æ ¼æœ—æ—¥å‡½æ•° $=+\infty$<br>æœ€ååŸå§‹é—®é¢˜å³ä¸º:</p><script type="math/tex; mode=display">\theta_{\mathcal{P}}(w)=\left\{\begin{array}{ll}f(w) & \text w æ»¡è¶³åŸå§‹é—®é¢˜çº¦æŸ \\+\infty & å…¶ä»–\end{array}\right.</script><p>å‡½æ•°æœ€å°åŒ–é—®é¢˜</p><script type="math/tex; mode=display">\min _{w} {\theta}_{\mathcal{P}}(w)=\min _{w} \max _{\alpha, \beta: \alpha_{i} \geq 0} \mathcal{L}(w, \alpha, \beta)</script><p>ç­‰åŒäºåŸæ¥çš„ä¼˜åŒ–ä»»åŠ¡</p><script type="math/tex; mode=display">\begin{array}{ll}\min _{w} & f(w) \\\text { s.t. } & g_{i}(w) \leq 0, \quad i=1, \ldots, k \\& h_{i}(w)=0, \quad i=1, \ldots, l\end{array}</script><p>åŸå§‹é—®é¢˜çš„è§£å³ä¸º</p><script type="math/tex; mode=display">p^\star=\min _{w} \theta_{\mathcal{P}}(w)</script><p>æ±‚è§£ $f(w)$ ä¹‹æ‰€ä»¥æ·»åŠ ä¸€ä¸ª $\theta_{\mathcal{P}}(w)$, å°±æ˜¯ä¸ºäº†çœç•¥æ‰ $g_{i}(w)$ å’Œ $h_{i}(w)=0$ è¿™äº›é™åˆ¶æ¡ä»¶, æœ€åç®€æ´åœ°è¡¨ç¤ºæˆä¸€ä¸ªå‡½æ•°.</p><h4 id="å¯¹å¶é—®é¢˜-amp-KKT"><a href="#å¯¹å¶é—®é¢˜-amp-KKT" class="headerlink" title="å¯¹å¶é—®é¢˜ &amp; KKT"></a>å¯¹å¶é—®é¢˜ &amp; KKT</h4><p>å°†ç ”ç©¶çš„å‚æ•°è½¬åŒ–ä¸º $\alpha$ å’Œ $\beta$</p><script type="math/tex; mode=display">\max _{\alpha, \beta: \alpha_{i} \geq 0} \theta_{\mathcal{D}}(\alpha, \beta)=\max _{\alpha, \beta: \alpha_{i} \geq 0} \min _{w} \mathcal{L}(w, \alpha, \beta)</script><p>å¯¹å¶é—®é¢˜çš„è§£ä¸º</p><script type="math/tex; mode=display">d^\star=\max _{\alpha, \beta: \alpha_{i} \geq 0} \min _{w} \mathcal{L}(w, \alpha, \beta)</script><p>ä¸¤è€…ä¹‹é—´çš„å…³ç³» (æ’æˆç«‹)</p><script type="math/tex; mode=display">d^\star=\max _{\alpha, \beta: \alpha_{i} \geq 0} \min _{w} \mathcal{L}(w, \alpha, \beta) \leq \min _{w} \max _{\alpha, \beta: \alpha_{i} \geq 0} \mathcal{L}(w, \alpha, \beta)=p^\star</script><p>æ»¡è¶³ä¸€å®šæ¡ä»¶, å¯ä»¥ä½¿ $d^ \star =p^ \star $, å³ <code>KKT æ¡ä»¶</code><br>å‰æ:</p><ul><li>å‡è®¾ $f$ ä»¥åŠ $g_i$ æ˜¯å‡¸å‡½æ•°,å¹¶ä¸” $h_i$ ä¸ºä»¿å°„å‡½æ•°,ä¸” $g_i$ ä¸¥æ ¼æ»¡è¶³å¯è¡ŒåŸŸ</li><li>å¿…ç„¶å­˜åœ¨ $(w^\star ,\alpha^\star ,\beta^\star )$, æ»¡è¶³: $w_\star $ æ˜¯åŸå§‹é—®é¢˜çš„è§£, $\alpha^\star $ , $\beta^\star $ æ˜¯å¯¹å¶é—®é¢˜çš„è§£, ä¸”ä¸¤ä¸ªé—®é¢˜çš„è§£æ•°å€¼ç›¸ç­‰$d^ \star =p^ \star $</li><li>åŒæ—¶, $(w^\star ,\alpha^\star ,\beta^\star )$ æ»¡è¶³KKTæ¡ä»¶<script type="math/tex; mode=display">\begin{aligned}&\frac{\partial}{\partial w_{i}} \mathcal{L}\left(w^{\star}, \alpha^{\star}, \beta^{\star}\right)=0, i=1, \dots, n\\&\frac{\partial}{\partial \beta_{i}} \mathcal{L}\left(w^{\star}, \alpha^{\star}, \beta^{\star}\right)=0, i=1, \ldots, l\\&\alpha_{i}^{\star} g_{i}\left(w^{\star}\right)=0, i=1, \dots, k\\&g_{i}\left(w^{\star}\right) \leq 0, i=1, \dots, k\\&{\alpha}^{\star} \geq 0, i=1, \ldots, k\end{aligned}</script></li></ul><p>å¯¹ $w$ å’Œ å¯¹ $\beta_i$ å¯¼æ•°å‡ä¸º 0, æ‰èƒ½è®©ä»–ä¿©çš„æ¢¯åº¦å…±çº¿, ä»è€Œæ‰¾åˆ°åˆ‡ç‚¹.<br>å…¶ä¸­ $\alpha_{i}^ \star  g_{i}\left(w^ \star \right)=0, i=1, \dots, k$ ç§°ä¸º<code>KKTå¯¹å¶äº’è¡¥æ¡ä»¶</code><br>å› ä¸ºåŸå§‹çš„çº¦æŸä¸­, $g_{i}\left(w^ \star \right)\leq0$, æ˜¯æœ‰å¯èƒ½ $&lt;0$ çš„, è¿™ä¸ªæ—¶å€™ $\alpha_i$ ä¸€å®šè¦ $=0$; å½“ $\alpha_i\ne0$,  è¿™ä¸ªæ—¶å€™ $g_{i}\left(w^ \star \right)$ ä¸€å®šè¦ $=0$</p><h4 id="SVM-æ±‚è§£æ¨å¯¼"><a href="#SVM-æ±‚è§£æ¨å¯¼" class="headerlink" title="SVM æ±‚è§£æ¨å¯¼"></a>SVM æ±‚è§£æ¨å¯¼</h4><ul><li><strong>ç¬¬ä¸€æ­¥: åˆ©ç”¨æ‹‰æ ¼æœ—æ—¥å¯¹å¶, ç¡®å®šç›®æ ‡å‡½æ•°</strong></li><li>ç›®æ ‡å‡½æ•°: <code>å¯»æ‰¾æœ€ä¼˜é—´éš”åˆ†ç±»å™¨</code><br>ç”±äºå·²ç»å›ºå®š $\hat{\gamma}=1$, ä¹Ÿå°±æ„å‘³ç€åˆ°è¶…å¹³é¢çš„è·ç¦»ä¸º1çš„ç‚¹éƒ½æ˜¯æ”¯æŒå‘é‡<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/28/kOjBcHx6t8zZFNa.png" alt="æ”¯æŒå‘é‡"><br>ä»£å…¥ $\hat{\gamma}=1$, é—®é¢˜å˜æˆ<script type="math/tex; mode=display">\begin{aligned}&\min _{w, b} \frac{1}{2}{\|w\|}^2\\&\text { s.t. } \quad y^{(i)}\left(w^{T} x^{(i)}+b\right) \geq 1, \quad i=1, \ldots, m\end{aligned}</script>æ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°<script type="math/tex; mode=display">L(w, b, \alpha)=\frac{1}{2}\|w\|^2-\sum_{i=1}^{n} \alpha_{i}\left(y_{i}\left(w \cdot x_{i}+b\right)-1\right), \alpha_{i} \geq 0</script></li><li>$\alpha&gt;0$ æˆç«‹çš„æ¡ä»¶, ä»…å½“ $x_i$ å¡åœ¨æ”¯æŒå‘é‡ä¸Š, å³ $g_{i}\left(w^\star\right)=0$ çš„æ—¶å€™, ä¹Ÿå³å‡½æ•°é—´éš” $\hat{\gamma}=1$ çš„æ—¶å€™. å…¶ä»–ç‚¹éƒ½æ²¡æœ‰å½±å“, å¯¹åº”çš„ $\alpha_i=0$. è¿™ä¹Ÿè¯´æ˜, åˆ†å‰²å¹³é¢ $w$ çš„ç¡®å®š, åªå–å†³äºå…¨å±€å‡½æ•°é—´éš”æœ€å°çš„è¿™å‡ ä¸ªç‚¹çš„ä½ç½®.</li><li>åªè¦æ»¡è¶³ KKT æ¡ä»¶, æ±‚è§£å¯¹å¶é—®é¢˜, ç›¸å½“äºé—´æ¥åœ°æ±‚è§£äº†åŸé—®é¢˜<br>ç°åœ¨éœ€è¦æœ€å¤§åŒ– $ L(w,b,\alpha )$ï¼Œæ‰€ä»¥é—®é¢˜å˜æˆ <script type="math/tex; mode=display">\min _{w, b} \max _{\alpha} L(w, b, \alpha)</script>æ ¹æ®æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§, é—®é¢˜å˜æˆ<script type="math/tex; mode=display">\max _{\alpha} \min _{w, b} L(w, b, \alpha)</script></li><li><p><strong>ç¬¬äºŒæ­¥: æ±‚  $ \mathop {\min }\limits_{w,b} L(w,b,\alpha )$</strong><br>è®©  $L(w,b,\alpha)$  åˆ†åˆ«å¯¹ $w,b$ æ±‚åå¯¼ï¼Œä½¿å¯¼æ•°ä¸º 0ï¼š<br>$ \frac{ {\partial L(w,b,\alpha )} }{ {\partial w} } = w - \sum\limits_{i = 1}^n { {\alpha _i}{y_i}{x_i} } = 0$  â€”â€”â€”â€”&gt;  $ w = \sum\limits_{i = 1}^n { {\alpha _i}{y_i}{x_i} }$<br>$ \frac{ {\partial L(w,b,\alpha )} }{ {\partial b} } = \sum\limits_{i = 1}^n { {\alpha _i}{y_i} } = 0$ â€”â€”â€”â€”â€”â€”â€”â€”-&gt; $\sum\limits_{i = 1}^n { {\alpha _i} {y_i} } = 0 $<br>ä»£å…¥åŸå¼$L(w, b, \alpha)$å¯å¾—</p><script type="math/tex; mode=display">\min _{w, b} L(w, b, \alpha)=-\frac{1}{2} \sum_{i=1}^{n} \sum_{j=1}^{n} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} x_{j}\right)+\sum_{i=1}^{n} \alpha_{i}</script></li><li><p><strong>ç¬¬ä¸‰æ­¥:  æ±‚ $ \mathop {\min }\limits_{w,b} L(w,b,\alpha )$ å¯¹ $ \alpha $ çš„æå¤§å€¼ - SMO</strong><br>é—®é¢˜å˜ä¸ºï¼š </p><script type="math/tex; mode=display">\mathop {\max }\limits_\alpha \ \ - \frac{1}{2}\sum\limits_{i = 1}^n {\sum\limits_{j = 1}^n { {\alpha _i}{\alpha _j}{y_i}{y_j}({x_i}{x_j})} } + \sum\limits_{i = 1}^n { {\alpha _i}}</script><p>çº¦æŸæ¡ä»¶ä¸ºï¼š <script type="math/tex">\sum\limits_{i = 1}^n { {\alpha _i}{y_i}} = 0ï¼Œ  {\alpha _i} \ge 0,i = 1,2...n</script><br>æ‰€ä»¥åªè¦çŸ¥é“ $ {\alpha }$ï¼Œ ä¹Ÿå°±çŸ¥é“äº†$w$. æˆ‘ä»¬ä½¿ç”¨ SMO ç®—æ³•, <code>å‡è®¾å·²ç»æ±‚å‡º</code>æœ€ä¼˜è§£ä¸º $ {\alpha^ \star  } = {(\alpha _1^ \star  ,\alpha _2^ \star  â€¦.\alpha _n^ \star  )^T}$</p></li><li><p><strong>ç¬¬å››æ­¥:  æ±‚ ${w^ \star }$ å’Œ $b^ \star $ å¾—åˆ°è¶…å¹³é¢</strong><br>å·²çŸ¥æœ€ä¼˜çš„ ${\alpha ^ \star }$, ç”±ç¬¬ä¸€æ­¥ $w=\sum\limits_{i = 1}^n {\alpha _i}{y_i}{x_i}$ å¯æ±‚å‡ºæœ€ä¼˜çš„ ${w^ \star  } $ </p><script type="math/tex; mode=display">{w^\star } = \sum\limits_{i = 1}^n {\alpha _i^ \star  {y_i}{x_i}}</script><p>ç”± KKT æ¡ä»¶ä¸­çš„<code>å¯¹å¶äº’è¡¥æ¡ä»¶</code>, è‡³å°‘å­˜åœ¨ä¸€ä¸ª $ \alpha _i^ \star &gt;0 $ ä½¿å¾— $\alpha_{i}^ \star  g_{i}\left(w^ \star \right)=0$, å³</p><script type="math/tex; mode=display">\alpha_{i}^ \star \left(y_{i}\left(w^ \star  \cdot x_{i}+b^ \star \right)-1\right)=0, i=1,2 \ldots n</script><p>å¯ä»¥è¯æ˜è‡³å°‘å­˜åœ¨ä¸€ä¸ª $\alpha _j^  \star &gt;0$ ä½¿ç­‰å¼æˆç«‹ï¼Œæ‰€ä»¥å¯å¾—ï¼š</p><script type="math/tex; mode=display">{y_j}({w^ \star }\cdot {x_j} + {b^ \star }) - 1 = 0</script><p>å› ä¸º $ {y_i} = \{ + 1, - 1\}$ ï¼Œæ‰€ä»¥ $\frac{1}{ { {y_i}}} = {y_i}$ è¿›è€Œå¾—åˆ°</p><script type="math/tex; mode=display">b^ \star =y_{j}-\sum_{i=1}^{n} \alpha_{i}^ \star  y_{i}\left(x_{i} \cdot x_{j}\right)</script><p>è‡³æ­¤ $ w^ \star  å’Œ  b^ \star  $ éƒ½å·²ç»å¾—åˆ°ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°<code>è¶…å¹³é¢</code>ï¼š$ {w^ \star }\cdot x + {b^ \star } = 0$</p></li></ul><h4 id="SMO-åºåˆ—æœ€å°ä¼˜åŒ–"><a href="#SMO-åºåˆ—æœ€å°ä¼˜åŒ–" class="headerlink" title="SMO åºåˆ—æœ€å°ä¼˜åŒ–"></a>SMO åºåˆ—æœ€å°ä¼˜åŒ–</h4><ul><li>ä¸Šé¢æˆ‘ä»¬åªæ˜¯å‡è®¾å·²ç»æ±‚å¾—äº† $ {\alpha ^ \star } = {(\alpha _1^ \star ,\alpha _2^ \star â€¦.\alpha _n^ \star )^T}$ï¼Œç”¨åˆ°çš„æ–¹æ³•æ˜¯<code>SMOï¼ˆSequential Minimal Optimizationï¼‰å³åºåˆ—æœ€å°ä¼˜åŒ–</code>ï¼Œæ„Ÿè§‰SMOå…¶å®ä¸å±äºæ”¯æŒå‘é‡æœºç®—æ³•çš„ä¸€éƒ¨åˆ†.</li><li>SMOçš„æ€æƒ³<br>æ‹‰æ ¼æœ—æ—¥ä¹˜å­ $\alpha$ æœ‰è®¸å¤šä¸ªï¼Œå¦‚æœé‡‡ç”¨å•ä¸ª $\alpha$ åæ ‡ä¸Šå‡æ³•, æ— æ³•æ»¡è¶³ $\sum_{i=1}^{m} \alpha_{i} y^{(i)}=0$ çš„æ¡ä»¶.<br>äºæ˜¯, æ¯æ¬¡åªé€‰æ‹©å…¶ä¸­<code>ä¸¤ä¸ª</code>å˜é‡ä½œä¸ºæœªçŸ¥é‡ï¼Œå…¶ä»–ä¹˜å­ä½œä¸ºå·²çŸ¥é‡ï¼Œå°†Nä¸ªé—®é¢˜è½¬å˜æˆä¸¤ä¸ªå˜é‡çš„æ±‚è§£é—®é¢˜. å½“ $W(\alpha)$ çš„å˜åŒ–å°äºä¸€ä¸ªé˜ˆå€¼, æ¯”å¦‚ 0.01, å¯ä»¥åˆ¤å®šä¸ºæ”¶æ•›. æ¯”å¦‚å¯¹äºçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºçš„ç›®æ ‡å‡½æ•°ï¼š<script type="math/tex; mode=display">\mathop {\max }\limits_\alpha \ \ - \frac{1}{2}\sum\limits_{i = 1}^n {\sum\limits_{j = 1}^n { {\alpha _i}{\alpha _j}{y_i}{y_j}({x_i}{x_j})} } + \sum\limits_{i = 1}^n { {\alpha _i}}</script>çº¦æŸæ¡ä»¶ä¸ºï¼š <script type="math/tex">\sum\limits_{i = 1}^n { {\alpha _i}{y_i}} = 0ï¼Œ  {\alpha _i} \ge 0,i = 1,2...n</script><br>ä¸€å¼€å§‹éšæœºé€‰å–ä¸¤ä¸ªå˜é‡ $ {\alpha _1},{\alpha _2} $ä½œä¸ºæœªçŸ¥é‡ï¼Œå…¶ä»–å› å­ ${\alpha _i}(i = 3,4â€¦n)$ å½“ä½œå·²çŸ¥æ¥æ±‚ç›®æ ‡å‡½æ•°çš„æœ€å°å€¼ï¼Œæ±‚å‡º ${\alpha _1},{\alpha _2}$ å†å¸¦å…¥è¿›å»ï¼Œå†é€‰å– $ {\alpha _3},{\alpha _4}$ æ±‚ç›®æ ‡å‡½æ•°æœ€å°å€¼ï¼Œæ±‚å‡ºåç»§ç»­å¸¦å…¥ï¼Œç›´åˆ°ç›®æ ‡å‡½æ•°æ”¶æ•›.<br>ç”±äºæ¯ä¸€å¯¹ $(\alpha_i, \alpha_j)$ éƒ½äº’ç›¸å¯ä»¥è¡¨ç¤ºå‡ºæ¥, æœ€ç»ˆè½¬åŒ–ä¸ºä»¥å•ä¸ªå˜é‡ $\alpha_j$ çš„äºŒæ¬¡å‡½æ•°ä¼˜åŒ–é—®é¢˜, ç”¨äºŒæ¬¡å‡½æ•°å³å¯æ±‚è§£.<script type="math/tex; mode=display">\begin{array}{c}\max _{\alpha_{2}} W\left(\alpha_{2}\right)=a \alpha_{2}^{2}+b \alpha_{2}+c \\\text { s.t. } 0 \leq \alpha_{2} \leq C\end{array}</script></li></ul><h4 id="æ ¸å‡½æ•°æ–¹æ³•-Kernel-Function"><a href="#æ ¸å‡½æ•°æ–¹æ³•-Kernel-Function" class="headerlink" title="æ ¸å‡½æ•°æ–¹æ³• Kernel Function"></a>æ ¸å‡½æ•°æ–¹æ³• Kernel Function</h4><ul><li>å¤„ç†çº¿æ€§ä¸å¯åˆ†çš„æƒ…å†µ, å¢åŠ ä¸€ä¸ª<code>æ¾å¼›å˜é‡</code> $\xi$, å…è®¸å‡½æ•°é—´éš”å°äº 1, ç”šè‡³å°äº 0. <script type="math/tex; mode=display">\begin{array}{l}\min _{w, b, \xi} \frac{1}{2}\|w\|^{2}+c \sum_{i=1}^{m} \xi_{i} \\\\\text { s.t. } y^{(i)}\left(w^{T} x^{(i)}+b\right) \geq 1-\xi_{i}, \quad i=1, \ldots, m \\\quad \xi_{i} \geq 0, \quad i=1, \ldots, m\end{array}</script></li><li>æ‹‰æ ¼æœ—æ—¥å‡½æ•°<script type="math/tex; mode=display">\mathcal{L}(w, b, \xi, \alpha, r)=\frac{1}{2} w^{T} w+C \sum_{i=1}^{m} \xi_{i}-\sum_{i=1}^{m} \alpha_{i}\left[y^{(i)}\left(x^{T} w+b\right)-1+\xi_{i}\right]-\sum_{i=1}^{m} r_{i} \xi_{i}</script></li><li>å¯¹å¶é—®é¢˜: æ­¤æ—¶ $\alpha$ ä¸å†æ˜¯ &gt;= 0, è€Œæ˜¯ $0 \leq \alpha \leq C$<script type="math/tex; mode=display">\begin{aligned}&\max _{\alpha} W(\alpha)=\sum_{i=1}^{m} \alpha_{i}-\frac{1}{2} \sum_{i, j=1}^{m} y^{(i)} y^{(j)} \alpha_{i} \alpha_{j} x^{(i)^{T}} x^{(j)}\\&\text { s.t. } 0 \leq \alpha_{i} \leq C, \quad i=1, \ldots, m\\&\sum_{i=1}^{m} \alpha_{i} y^{(i)}=0\end{aligned}</script></li><li>åŸºæœ¬æ€æƒ³: å°†åŸæ¥çš„ x ç©ºé—´ä¸­çš„ç‰¹å¾, æ˜ å°„åˆ° $\phi(x)$ é«˜ç»´ç©ºé—´ä¸­. åŸæœ¬åªç€çœ¼äºå†…ç§¯è¿ç®— $x^{(i)^{T}} x^{(j)}$, ç»™å®š $\phi(x)$, å˜æˆ<code>æ ¸å‡½æ•°</code>è¿ç®— <script type="math/tex; mode=display">K\left(x^{(i)}, x^{(j)}\right)=\phi\left(x^{(i)}\right)^{T} \phi\left(x^{(j)}\right)</script>ç›®æ ‡å‡½æ•°å˜æˆ<script type="math/tex; mode=display">W(\alpha)=\sum_{i=1}^{m} \alpha_{i}-\frac{1}{2} \sum_{i, j=1}^{m} y^{(i)} y^{(j)} \alpha_{i} \alpha_{j} K\left(x^{(i)}, x^{(j)}\right)</script></li><li><code>æ ¸æŠ€å·§</code> Kernel Trick<br>å¤šæ•°æƒ…å†µä¸‹, å¯ä»¥ç›´æ¥å®šä¹‰  $K\left(x^{(i)}, x^{(j)}\right)$ è€Œä¸éœ€è¦ $\phi(x)$, æ¯”å¦‚ç›´æ¥å‡å®š $K\left(x^{(i)}, x^{(j)}\right)=\left(x^{(i)^{T}} x^{(j)}\right)^{2}$<br>æ—¶é—´å¤æ‚åº¦å¯ä»¥æ˜æ˜¾é™ä½, æ¯”å¦‚ä» $O(n^2)$ é™ä½åˆ°  $O(n)$</li><li>ç»™å®šæ ¸å‡½æ•°, å†é€šè¿‡ SMO å³å¯æ±‚å¾— $\alpha$, å†é€šè¿‡ $\alpha$ æ±‚å¾— $w$ å’Œ $b$, $\phi(x)$ çš„è®¡ç®—è¢«çº¦å», å¾—åˆ°å‡½æ•°é—´éš”/ç›®æ ‡å‡½æ•°ä¸º<script type="math/tex; mode=display">\begin{aligned}w^{ \star  T} x+b^ \star  &=\left(\sum_{i=1}^{m} \alpha_{i} y^{(i)} \phi\left(x^{(i)}\right)\right)^{T} \phi(x)+b^ \star  \\&=\sum_{i=1}^{m} \alpha_{i} y^{(i)} K\left(x^{(i)}, x\right)+b^ \star \end{aligned}</script></li><li>é«˜æ–¯æ ¸å‡½æ•° - éå¸¸å¸¸ç”¨<br>å¯¹äº x å’Œ z ä¸¤ä¸ªæ ·ä¾‹, æˆ‘ä»¬éœ€è¦åˆ»ç”»å…¶<code>ç›¸ä¼¼æ€§åº¦é‡</code><script type="math/tex; mode=display">K(x, z)=\exp \left(-\frac{\|{x}-z \|^{2}}{2 \sigma^{2}}\right)</script>ä¹Ÿç§°ä¸º<code>å¾„å‘åŸºå‡½æ•°</code>(RBF)æ ¸. å°†å…¶ä¸­ä¸€ä¸ª x è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒçš„ä¸­å¿ƒç‚¹, è®¡ç®— z çš„æ¦‚ç‡å¯†åº¦</li><li>æ ¸çŸ©é˜µK<script type="math/tex; mode=display">\left\{K_{i, j}\right\}_{i, j=1, \ldots, m}</script></li><li>æœ‰æ•ˆæ ¸: ä¸€å®šèƒ½å†™æˆä¸¤ä¸ª $\phi(x)$ å‡½æ•°ç›¸ä¹˜, ä¸€å®šæ˜¯å¯¹ç§°çŸ©é˜µ, åŠæ­£å®šçŸ©é˜µ â€”&gt; å¯¹äºä»»ä½•å‘é‡ z, $z^TKz\geq0$. å¸¸è§çš„æœ‰ RBF æ ¸, å¤šé¡¹å¼æ ¸$K(x, z)=\left(x^{T} z\right)^{d}$, ä½™å¼¦ç›¸ä¼¼åº¦æ ¸$K(x, z)=\frac{x^{T} z}{|x| \cdot|z|}$, sigmoid æ ¸ç­‰. ä½¿ç”¨ Sigmoidæ ¸çš„ SVM, ç›¸ä¼¼äºäºä¸€ä¸ªäºŒå±‚çš„æ„ŸçŸ¥æœº.</li><li>æ ¸å‡½æ•°, åŒæ ·å¯ä»¥æ˜ å°„åˆ°<code>å¹¿ä¹‰çš„çº¿æ€§æ¨¡å‹</code>, åªè¦æ¶‰åŠåˆ°æ˜ å°„ $\phi(x)$, å°±å¯ä»¥é€šè¿‡ Kernel Trick å…å»è®¡ç®— ${\Phi}^{T} {\Phi}$, è€Œç›´æ¥è®¡ç®—æ ¸çŸ©é˜µ<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/gyzILRlJv1SjseU.png" alt="å¹¿ä¹‰çº¿æ€§æ¨¡å‹çš„æ ¸æŠ€å·§"></li></ul><h4 id="SVM-æ€»ç»“"><a href="#SVM-æ€»ç»“" class="headerlink" title="SVM æ€»ç»“"></a>SVM æ€»ç»“</h4><ul><li><p>SVM ç‹¬åˆ°çš„ç‰¹ç‚¹<br>ä¸éœ€è¦å»å…·ä½“è®¡ç®— $w$ å’Œ $b$ çš„å€¼æ˜¯å¤šå°‘, æ–°è¿›æ¥éœ€è¦é¢„æµ‹çš„ç‚¹, åªéœ€è¦è®¡ç®—<code>å’Œå·²çŸ¥çš„æ”¯æŒå‘é‡ç‚¹çš„å†…ç§¯</code>å³å¯, å³åªéœ€è¦è®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦, è€Œä¸éœ€è¦å»å…·ä½“è®¡ç®—æ”¯æŒå‘é‡æ˜¯ä»€ä¹ˆ.</p></li><li><p>SVM çš„æŸå¤±å‡½æ•°<br>ä½¿ç”¨é“°é“¾æŸå¤± <code>Hinge Loss</code>, åªå…³æ³¨å‡½æ•°é—´éš” &lt;=1 çš„æƒ…å†µ, &gt;1 çš„æƒ…å†µçš„ loss å¿½ç•¥ä¸º 0. è€Œé€»è¾‘å›å½’å³ä½¿è®¡ç®—æ‰€å¾—çš„ p å†é«˜, ä¹Ÿä¾ç„¶è¦è®¡ç®— loss.<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/28/OL46fhGWiAIQPgH.png" alt="æŸå¤±å‡½æ•°å¯¹æ¯”"></p></li><li><p>SVM åˆ†ç±»</p></li></ul><ol><li>ç¡¬é—´éš”æ”¯æŒå‘é‡æœºï¼ˆçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºï¼‰ï¼šå½“è®­ç»ƒæ•°æ®çº¿æ€§å¯åˆ†æ—¶ï¼Œå¯é€šè¿‡ç¡¬é—´éš”æœ€å¤§åŒ–å­¦å¾—ä¸€ä¸ªçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº</li><li>è½¯é—´éš”æ”¯æŒå‘é‡æœºï¼šå½“è®­ç»ƒæ•°æ®è¿‘ä¼¼çº¿æ€§å¯åˆ†æ—¶ï¼Œå¯é€šè¿‡è½¯é—´éš”æœ€å¤§åŒ–å¾—åˆ°ä¸€ä¸ªçº¿æ€§æ”¯æŒå‘é‡æœº</li><li>éçº¿æ€§æ”¯æŒå‘é‡æœºï¼šå½“è®­ç»ƒæ•°æ®çº¿æ€§ä¸å¯åˆ†æ—¶ï¼Œå¯é€šè¿‡æ ¸æ–¹æ³•ä»¥åŠè½¯é—´éš”æœ€å¤§åŒ–å¾—ä¸€ä¸ªéçº¿æ€§æ”¯æŒå‘é‡æœº</li></ol><ul><li><p>ä¼˜ç‚¹ï¼š<br>SVMåœ¨ä¸­å°é‡æ ·æœ¬è§„æ¨¡çš„æ—¶å€™å®¹æ˜“å¾—åˆ°æ•°æ®å’Œç‰¹å¾ä¹‹é—´çš„éçº¿æ€§å…³ç³»ï¼Œå¯ä»¥é¿å…ä½¿ç”¨ç¥ç»ç½‘ç»œç»“æ„é€‰æ‹©å’Œå±€éƒ¨æå°å€¼é—®é¢˜ï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œå¯ä»¥è§£å†³é«˜ç»´é—®é¢˜</p></li><li><p>ç¼ºç‚¹ï¼š<br>SVMå¯¹ç¼ºå¤±æ•°æ®æ•æ„Ÿï¼Œå¯¹éçº¿æ€§é—®é¢˜æ²¡æœ‰é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ ¸å‡½æ•°çš„æ­£ç¡®é€‰æ‹©ä¸å®¹æ˜“ï¼Œè®¡ç®—å¤æ‚åº¦é«˜ï¼Œä¸»æµçš„ç®—æ³•å¯ä»¥è¾¾åˆ°O(n2)O(n2)çš„å¤æ‚åº¦ï¼Œè¿™å¯¹å¤§è§„æ¨¡çš„æ•°æ®æ˜¯åƒä¸æ¶ˆçš„</p></li><li><p><a href="https://www.kaggle.com/zhpan92/boyu-svm" target="_blank" rel="noopener">ä»£ç å®è·µğŸ‘†(SMO ç­‰å…·ä½“ç»†èŠ‚)</a></p></li></ul><p>è°ƒç”¨ scikit-learn ä¸ºä¾‹, ä½¿ç”¨ rbf æ ¸å‡½æ•°</p><pre><code class="lang-py">from sklearn import svm# x, y = simple_synthetic_data(50, 5, 5)x, y = spiral_data()model = svm.SVC(kernel=&#39;rbf&#39;, gamma=50, tol=1e-6)model.fit(x, y)fig = plt.figure(figsize=(6,6))ax = fig.add_subplot(111)plot(ax, model.predict, x, &#39;SVM + RBF&#39;)plt.show()</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/29/KcCRFjglUkh3Gos.png" alt=""></p><h3 id="4-Naive-Bayes-Algorithms-æœ´ç´ è´å¶æ–¯"><a href="#4-Naive-Bayes-Algorithms-æœ´ç´ è´å¶æ–¯" class="headerlink" title="4. Naive Bayes Algorithms æœ´ç´ è´å¶æ–¯"></a>4. Naive Bayes Algorithms æœ´ç´ è´å¶æ–¯</h3><ol><li>Naive Bayes</li><li>Gaussian Naive Bayes</li><li>Multinomial Naive Bayes</li><li>Bayesian Belief Network (BBN)</li><li>Bayesian Network (BN)</li></ol><p>æœ´ç´ è´å¶æ–¯åŸºæœ¬å…¬å¼ï¼š$P(A|B) = \frac{P(B|A)P(A)}{P(B)}$<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/J46IjSoqFuD1vtW.png" alt="J46IjSoqFuD1vtW"></p><h3 id="5-KNN-k-NearestNeighbor-K-æœ€é‚»è¿‘ç®—æ³•"><a href="#5-KNN-k-NearestNeighbor-K-æœ€é‚»è¿‘ç®—æ³•" class="headerlink" title="5. KNN (k-NearestNeighbor) K æœ€é‚»è¿‘ç®—æ³•"></a>5. KNN (k-NearestNeighbor) K æœ€é‚»è¿‘ç®—æ³•</h3><p>ç”¨äºåˆ†ç±»</p><ol><li>è®¡ç®—æµ‹è¯•æ•°æ®ä¸å„ä¸ªè®­ç»ƒæ•°æ®ä¹‹é—´çš„è·ç¦»ï¼›</li><li>æŒ‰ç…§è·ç¦»çš„é€’å¢å…³ç³»è¿›è¡Œæ’åºï¼›</li><li>é€‰å–è·ç¦»æœ€å°çš„Kä¸ªç‚¹ï¼›</li><li>ç¡®å®šå‰Kä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡ï¼›</li><li>è¿”å›å‰Kä¸ªç‚¹ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºæµ‹è¯•æ•°æ®çš„é¢„æµ‹åˆ†ç±»</li></ol><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/ScAOKyPqMGWdrLH.png" alt="KNN ç®—æ³•"></p><h3 id="6-Clustering-Algorithm-èšç±»ç®—æ³•"><a href="#6-Clustering-Algorithm-èšç±»ç®—æ³•" class="headerlink" title="6. Clustering Algorithm èšç±»ç®—æ³•"></a>6. Clustering Algorithm èšç±»ç®—æ³•</h3><ol><li>k-Meansï¼šé€‰å–å¹³å‡å€¼</li><li>k-Mediansï¼šç”±é€‰å–å¹³å‡å€¼æ”¹ä¸ºé€‰å–ä¸­ä½æ•°</li><li>Expectation Maximisation (EM)ï¼šæœ‰éšå«éšæœºå˜é‡çš„æ¦‚ç‡æ¨¡å‹çš„å‚æ•°çš„ä¼°è®¡æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ç§æ— ç›‘ç£çš„ç®—æ³•</li><li><p>Hierarchical Clustering å±‚æ¬¡èšç±»ï¼š<br>ç®—æ³•å¦‚ä¸‹ï¼š</p><p>(1) å°†æ¯ä¸ªå¯¹è±¡çœ‹ä½œä¸€ç±»ï¼Œè®¡ç®—ä¸¤ä¸¤ä¹‹é—´çš„æœ€å°è·ç¦»ï¼›</p><p>(2) å°†è·ç¦»æœ€å°çš„ä¸¤ä¸ªç±»åˆå¹¶æˆä¸€ä¸ªæ–°ç±»ï¼›</p><p>(3) é‡æ–°è®¡ç®—æ–°ç±»ä¸æ‰€æœ‰ç±»ä¹‹é—´çš„è·ç¦»ï¼›</p><p>(4) é‡å¤(2)ã€(3)ï¼Œç›´åˆ°æ‰€æœ‰ç±»æœ€ååˆå¹¶æˆä¸€ç±»ã€‚</p></li></ol><h3 id="7-K-means-ç®—æ³•"><a href="#7-K-means-ç®—æ³•" class="headerlink" title="7. K-means ç®—æ³•"></a>7. K-means ç®—æ³•</h3><p>ç®—æ³•å¦‚ä¸‹ï¼š</p><pre><code>é€‰å–kä¸ªåˆå§‹è´¨å¿ƒ(ä½œä¸ºåˆå§‹cluster);repeat:    å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹ï¼Œè®¡ç®—å¾—åˆ°è·å…¶æœ€è¿‘çš„è´¨å¿ƒï¼Œå°†å…¶ç±»åˆ«æ ‡ä¸ºè¯¥è´¨å¿ƒæ‰€å¯¹åº”çš„cluster;    é‡æ–°è®¡ç®—kä¸ªcluserå¯¹åº”çš„è´¨å¿ƒ;until è´¨å¿ƒä¸å†å‘ç”Ÿå˜åŒ–</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/VLCReWo92QXSNP4.jpg" alt=" K-means"></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/05/11/xwHcWKXLUofrZdM.png" alt="KNN ä¸ K-means çš„åŒºåˆ«"></p><h3 id="8-Random-Forest-éšæœºæ£®æ—"><a href="#8-Random-Forest-éšæœºæ£®æ—" class="headerlink" title="8. Random Forest éšæœºæ£®æ—"></a>8. Random Forest éšæœºæ£®æ—</h3><h3 id="9-Dimensionality-Reduction-Algorithms-é™ç»´ç®—æ³•-PCA"><a href="#9-Dimensionality-Reduction-Algorithms-é™ç»´ç®—æ³•-PCA" class="headerlink" title="9. Dimensionality Reduction Algorithms é™ç»´ç®—æ³• PCA"></a>9. Dimensionality Reduction Algorithms é™ç»´ç®—æ³• PCA</h3><p>ç›®çš„: å°†æ•°æ®çš„æŸä¸€ç»´çš„ç‰¹å¾å·®å¼‚è¿›è¡Œæ”¾å¤§, å…¶ä»–ç»´åº¦è¿›è¡Œå‹ç¼©ç”šè‡³å¿½ç•¥. ä¹Ÿå¯ä»¥é€‰æ‹©é™åˆ° k ç»´.</p><h4 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h4><ol><li><p>å°†æ•°æ®é›†çš„ä¸­å¿ƒç§»åˆ° 0</p><script type="math/tex; mode=display">\mu=\frac{1}{m} \sum_{i=1}^{m} x^{(i)}</script><script type="math/tex; mode=display">x^{(i)} \leftarrow x^{(i)}-\mu</script></li><li><p>ç»Ÿä¸€æ¯ä¸ªå˜é‡çš„æ–¹å·®</p><script type="math/tex; mode=display">\sigma_{j}^{2}=\frac{1}{m} \sum_{i=1}^{m}\left(x_{j}^{(i)}\right)^{2}</script><script type="math/tex; mode=display">x_{j}^{(i)} \leftarrow x_{j}^{(i)} / \sigma_{j}</script></li></ol><h4 id="æ¨å¯¼è¿‡ç¨‹"><a href="#æ¨å¯¼è¿‡ç¨‹" class="headerlink" title="æ¨å¯¼è¿‡ç¨‹"></a>æ¨å¯¼è¿‡ç¨‹</h4><ul><li>åˆ©ç”¨ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡, æ‰¾åˆ°ä¸€ç»„æ ‡å‡†æ­£äº¤åŸº â€”-&gt; ä»è€Œå¯ä»¥å°†ä»»ä½•å‘é‡ç”¨æ ‡å‡†æ­£äº¤åŸºè¡¨ç¤º â€”-&gt; ä»è€Œå¯ä»¥å°†ä»»ä½•åæ–¹å·®çŸ©é˜µç”¨ $UWU^T$ å½¢å¼è¡¨ç¤º, U ä¸ºæ­£äº¤åŸºçŸ©é˜µ, W å°±æ˜¯æœ¬çŸ©é˜µçš„ç‰¹å¾å€¼.</li><li>PCA çš„ç›®çš„æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ–¹å‘ $v$, ä½¿å¾—åœ¨è¿™ä¸ªæ–¹å‘ä¸Šæ•°æ® X çš„æŠ•å½±çš„<code>æ–¹å·®æœ€å¤§</code>, æ–¹å·®è¶Šå¤§è¶Šèƒ½ä¿ç•™å°½å¯èƒ½å¤šçš„æœ‰æ•ˆä¿¡æ¯. ç”±äºå‡å€¼å·²ç»ä¸º 0, æ•°æ® $X$ åœ¨æ–¹å‘ $v$ çš„æ–¹å·®å°±æ˜¯ $||Xv||^2$. æœ€åæ¨ç®—çš„ç»“è®ºå°±æ˜¯, éœ€è¦<code>æœ€å¤§ç‰¹å¾å€¼</code>å¯¹åº”çš„<code>ç‰¹å¾å‘é‡</code>.</li><li>æœ€ç»ˆå¾—åˆ° X çš„ä¸»æˆåˆ†çŸ©é˜µä¸º $T=WX$, å…¶ä¸­ $W$ ä¸º$ X^TX$ çš„ç‰¹å¾å€¼çŸ©é˜µ<br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/03/01/wXQY5E4Vpfb9SWN.png" alt=""><br><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/03/01/pR8nGAxBsk7oNrv.png" alt=""></li></ul><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä¸»è¦æ­¥éª¤, ç»™å®šæ•°æ® X, è¿›è¡Œå‡å€¼å½’ 0, æ–¹å·®ç»Ÿä¸€å¤„ç†å, å¾—åˆ° Z. ç„¶åæ ¹æ®åæ–¹å·®çŸ©é˜µ $Z^TZ$ çš„ç‰¹å¾å€¼ä»å¤§åˆ°å°è¿›è¡Œæ’åº, å¾—åˆ°ç‰¹å¾å‘é‡çš„çŸ©é˜µ $V^ \star $. è®¡ç®— $Z^ \star  = ZV^ \star<br>$</p><p><a href="https://www.kaggle.com/coverdark/pca-principal-component-analysis/" target="_blank" rel="noopener">ğŸ‘†PCA å®ç°</a></p><pre><code class="lang-py">def pca_custom(X, k):    n, p = np.shape(X)    # è®¾ç½®å‡å€¼ä¸º 0    Z = X - np.mean(X, axis=0)    covZ = np.cov(Z.T) # åæ–¹å·®çŸ©é˜µæŒ‰åˆ—è®¡ç®—, éœ€è¦è½¬ç½®ä¸€ä¸‹    eigValue, eigVector = np.linalg.eig(covZ)  # è®¡ç®—ç‰¹å¾å€¼, ç‰¹å¾å‘é‡    index = np.argsort(-eigValue)    if k &gt; p:        print (&quot;k must lower than input data dimensionï¼&quot;)        return 1    else:        # è¦é™åˆ° k ç»´, é€‰æ‹©å‰ k ä¸ªæœ€å¤§çš„        selectVector = eigVector[:, index[:k]]        T = np.matmul(Z, selectVector)    return T, selectVector</code></pre><h3 id="10-Gradient-Boosting-algorithms-æ¢¯åº¦æå‡ç®—æ³•"><a href="#10-Gradient-Boosting-algorithms-æ¢¯åº¦æå‡ç®—æ³•" class="headerlink" title="10. Gradient Boosting algorithms æ¢¯åº¦æå‡ç®—æ³•"></a>10. Gradient Boosting algorithms æ¢¯åº¦æå‡ç®—æ³•</h3><ol><li>GBM</li><li>XGBoost</li><li>LightGBM</li><li>CatBoost</li></ol><h3 id="11-Deep-Learning-Algorithms-æ·±åº¦å­¦ä¹ "><a href="#11-Deep-Learning-Algorithms-æ·±åº¦å­¦ä¹ " class="headerlink" title="11. Deep Learning Algorithms æ·±åº¦å­¦ä¹ "></a>11. Deep Learning Algorithms æ·±åº¦å­¦ä¹ </h3><ol><li>Convolutional Neural Network (CNN)</li><li>Recurrent Neural Networks (RNNs)</li><li>Long Short-Term Memory Networks (LSTMs)</li><li>Stacked Auto-Encoders</li><li>Deep Boltzmann Machine (DBM)</li><li>Deep Belief Networks (DBN)</li></ol><hr><h2 id="æœºå™¨å­¦ä¹ æŸå¤±å‡½æ•°"><a href="#æœºå™¨å­¦ä¹ æŸå¤±å‡½æ•°" class="headerlink" title="æœºå™¨å­¦ä¹ æŸå¤±å‡½æ•°"></a>æœºå™¨å­¦ä¹ æŸå¤±å‡½æ•°</h2><ol><li>0-1æŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(y,f(x)) =\begin{cases}0, & \text{y = f(x)}  \\1, & \text{y $\neq$ f(x)}\end{cases}</script></li><li>ç»å¯¹å€¼æŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(y,f(x))=|y-f(x)|</script></li><li>å¹³æ–¹æŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(y,f(x))=(y-f(x))^2</script></li><li>logå¯¹æ•°æŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(y,f(x))=log(1+e^{-yf(x)})</script></li><li>æŒ‡æ•°æŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(y,f(x))=exp(-yf(x))</script></li><li>HingeæŸå¤±å‡½æ•°<script type="math/tex; mode=display">L(w,b)=max\{0,1-yf(x)\}</script></li></ol><hr><h2 id="æœºå™¨å­¦ä¹ ä¼˜åŒ–æ–¹æ³•"><a href="#æœºå™¨å­¦ä¹ ä¼˜åŒ–æ–¹æ³•" class="headerlink" title="æœºå™¨å­¦ä¹ ä¼˜åŒ–æ–¹æ³•"></a>æœºå™¨å­¦ä¹ ä¼˜åŒ–æ–¹æ³•</h2><p>æ¢¯åº¦ä¸‹é™æ˜¯æœ€å¸¸ç”¨çš„ä¼˜åŒ–æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒä½¿ç”¨æ¢¯åº¦çš„åæ–¹å‘ $ \nabla_\theta J(\theta) $ æ›´æ–°å‚æ•° $ \theta $ï¼Œä½¿å¾—ç›®æ ‡å‡½æ•°$J(\theta)$è¾¾åˆ°æœ€å°åŒ–çš„ä¸€ç§ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•æˆ‘ä»¬å«åšæ¢¯åº¦æ›´æ–°. </p><ol><li>(å…¨é‡)æ¢¯åº¦ä¸‹é™<script type="math/tex; mode=display">\theta=\theta-\eta\nabla_\theta J(\theta)</script></li><li>éšæœºæ¢¯åº¦ä¸‹é™<script type="math/tex; mode=display">\theta=\theta-\eta\nabla_\theta J(\theta;x^{(i)},y^{(i)})</script></li><li>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™<script type="math/tex; mode=display">\theta=\theta-\eta\nabla_\theta J(\theta;x^{(i:i+n)},y^{(i:i+n)})</script></li><li>å¼•å…¥åŠ¨é‡çš„æ¢¯åº¦ä¸‹é™<script type="math/tex; mode=display">\begin{cases}v_t=\gamma v_{t-1}+\eta \nabla_\theta J(\theta)  \\\theta=\theta-v_t\end{cases}</script></li><li>è‡ªé€‚åº”å­¦ä¹ ç‡çš„Adagradç®—æ³•<script type="math/tex; mode=display">\begin{cases}g_t= \nabla_\theta J(\theta)  \\\theta_{t+1}=\theta_{t,i}-\frac{\eta}{\sqrt{G_t+\varepsilon}} \cdot g_t\end{cases}</script></li><li><p>ç‰›é¡¿æ³•</p><script type="math/tex; mode=display">\theta_{t+1}=\theta_t-H^{-1}\nabla_\theta J(\theta_t)</script><p> å…¶ä¸­:<br> $t$: è¿­ä»£çš„è½®æ•°</p><p> $\eta$: å­¦ä¹ ç‡</p><p> $G_t$: å‰tæ¬¡è¿­ä»£çš„æ¢¯åº¦å’Œ</p><p> $\varepsilon:$å¾ˆå°çš„æ•°,é˜²æ­¢é™¤0é”™è¯¯</p><p> $H$: æŸå¤±å‡½æ•°ç›¸å½“äº$\theta$çš„HessionçŸ©é˜µåœ¨$\theta_t$å¤„çš„ä¼°è®¡</p></li></ol><hr><h2 id="æœºå™¨å­¦ä¹ çš„è¯„ä»·æŒ‡æ ‡"><a href="#æœºå™¨å­¦ä¹ çš„è¯„ä»·æŒ‡æ ‡" class="headerlink" title="æœºå™¨å­¦ä¹ çš„è¯„ä»·æŒ‡æ ‡"></a>æœºå™¨å­¦ä¹ çš„è¯„ä»·æŒ‡æ ‡</h2><ol><li>MSE(Mean Squared Error)<script type="math/tex; mode=display">MSE(y,f(x))=\frac{1}{N}\sum_{i=1}^{N}(y-f(x))^2</script></li><li>MAE(Mean Absolute Error)<script type="math/tex; mode=display">MSE(y,f(x))=\frac{1}{N}\sum_{i=1}^{N}|y-f(x)|</script></li><li>RMSE(Root Mean Squard Error)<script type="math/tex; mode=display">RMSE(y,f(x))=\frac{1}{1+MSE(y,f(x))}</script></li><li>Top-kå‡†ç¡®ç‡<script type="math/tex; mode=display">Top_k(y,pre_y)=\begin{cases}1, {y \in pre_y}  \\0, {y \notin pre_y}\end{cases}</script></li><li>æ··æ·†çŸ©é˜µ</li></ol><div class="table-container"><table><thead><tr><th style="text-align:center">æ··æ·†çŸ©é˜µ</th><th style="text-align:center">Predicted as Positive</th><th style="text-align:center">Predicted as Negative</th></tr></thead><tbody><tr><td style="text-align:center">Labeled as Positive</td><td style="text-align:center">True Positive(TP)</td><td style="text-align:center">False Negative(FN)</td></tr><tr><td style="text-align:center">Labeled as Negative</td><td style="text-align:center">False Positive(FP)</td><td style="text-align:center">True Negative(TN)</td></tr></tbody></table></div><ul><li>çœŸæ­£ä¾‹(True Positive, TP):çœŸå®ç±»åˆ«ä¸ºæ­£ä¾‹, é¢„æµ‹ç±»åˆ«ä¸ºæ­£ä¾‹</li><li>å‡è´Ÿä¾‹(False Negative, FN): çœŸå®ç±»åˆ«ä¸ºæ­£ä¾‹, é¢„æµ‹ç±»åˆ«ä¸ºè´Ÿä¾‹</li><li>å‡æ­£ä¾‹(False Positive, FP): çœŸå®ç±»åˆ«ä¸ºè´Ÿä¾‹, é¢„æµ‹ç±»åˆ«ä¸ºæ­£ä¾‹ </li><li><p>çœŸè´Ÿä¾‹(True Negative, TN): çœŸå®ç±»åˆ«ä¸ºè´Ÿä¾‹, é¢„æµ‹ç±»åˆ«ä¸ºè´Ÿä¾‹</p></li><li><p>çœŸæ­£ç‡(True Positive Rate, TPR): è¢«é¢„æµ‹ä¸ºæ­£çš„æ­£æ ·æœ¬æ•° / æ­£æ ·æœ¬å®é™…æ•°</p><script type="math/tex; mode=display">TPR=\frac{TP}{TP+FN}</script></li><li><p>å‡è´Ÿç‡(False Negative Rate, FNR): è¢«é¢„æµ‹ä¸ºè´Ÿçš„æ­£æ ·æœ¬æ•°/æ­£æ ·æœ¬å®é™…æ•°</p><script type="math/tex; mode=display">FNR=\frac{FN}{TP+FN}</script></li><li><p>å‡æ­£ç‡(False Positive Rate, FPR): è¢«é¢„æµ‹ä¸ºæ­£çš„è´Ÿæ ·æœ¬æ•°/è´Ÿæ ·æœ¬å®é™…æ•°ï¼Œ</p><script type="math/tex; mode=display">FPR=\frac{FP}{FP+TN}</script></li><li>çœŸè´Ÿç‡(True Negative Rate, TNR): è¢«é¢„æµ‹ä¸ºè´Ÿçš„è´Ÿæ ·æœ¬æ•°/è´Ÿæ ·æœ¬å®é™…æ•°ï¼Œ<script type="math/tex; mode=display">TNR=\frac{TN}{FP+TN}</script></li><li>å‡†ç¡®ç‡(Accuracy)<script type="math/tex; mode=display">ACC=\frac{TP+TN}{TP+FN+FP+TN}</script></li><li>ç²¾å‡†ç‡<script type="math/tex; mode=display">P=\frac{TP}{TP+FP}</script></li><li>å¬å›ç‡<script type="math/tex; mode=display">R=\frac{TP}{TP+FN}</script></li><li>F1-Score<script type="math/tex; mode=display">\frac{2}{F_1}=\frac{1}{P}+\frac{1}{R}</script></li><li><strong>ROC</strong></li></ul><p>ROCæ›²çº¿çš„æ¨ªè½´ä¸ºâ€œå‡æ­£ä¾‹ç‡â€ï¼Œçºµè½´ä¸ºâ€œçœŸæ­£ä¾‹ç‡â€. ä»¥FPRä¸ºæ¨ªåæ ‡ï¼ŒTPRä¸ºçºµåæ ‡ï¼Œé‚£ä¹ˆROCæ›²çº¿å°±æ˜¯æ”¹å˜å„ç§é˜ˆå€¼åå¾—åˆ°çš„æ‰€æœ‰åæ ‡ç‚¹ (FPR,TPR) çš„è¿çº¿ï¼Œç”»å‡ºæ¥å¦‚ä¸‹ã€‚çº¢çº¿æ˜¯éšæœºä¹±çŒœæƒ…å†µä¸‹çš„ROCï¼Œæ›²çº¿è¶Š<code>é å·¦ä¸Šè§’</code>ï¼Œåˆ†ç±»å™¨è¶Šä½³. </p><ul><li><strong>AUC(Area Under Curve)</strong></li></ul><p>AUCå°±æ˜¯ROCæ›²çº¿ä¸‹çš„é¢ç§¯. çœŸå®æƒ…å†µä¸‹ï¼Œç”±äºæ•°æ®æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ï¼Œé˜ˆå€¼è¢«ç¦»æ•£åŒ–ï¼Œå‘ˆç°çš„æ›²çº¿ä¾¿æ˜¯é”¯é½¿çŠ¶çš„ï¼Œå½“ç„¶æ•°æ®è¶Šå¤šï¼Œé˜ˆå€¼åˆ†çš„è¶Šç»†ï¼Œâ€æ›²çº¿â€è¶Šå…‰æ»‘. </p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/Ky4FT1MVe3PUYai.jpg" alt="Ky4FT1MVe3PUYai"></p><p>ç”¨AUC<code>åˆ¤æ–­åˆ†ç±»å™¨ï¼ˆé¢„æµ‹æ¨¡å‹ï¼‰ä¼˜åŠ£</code>çš„æ ‡å‡†:</p><ul><li>AUC = 1 æ˜¯å®Œç¾åˆ†ç±»å™¨ï¼Œé‡‡ç”¨è¿™ä¸ªé¢„æµ‹æ¨¡å‹æ—¶ï¼Œå­˜åœ¨è‡³å°‘ä¸€ä¸ªé˜ˆå€¼èƒ½å¾—å‡ºå®Œç¾é¢„æµ‹ã€‚ç»å¤§å¤šæ•°é¢„æµ‹çš„åœºåˆï¼Œä¸å­˜åœ¨å®Œç¾åˆ†ç±»å™¨.</li><li>0.5 &lt; AUC &lt; 1ï¼Œä¼˜äºéšæœºçŒœæµ‹ã€‚è¿™ä¸ªåˆ†ç±»å™¨ï¼ˆæ¨¡å‹ï¼‰å¦¥å–„è®¾å®šé˜ˆå€¼çš„è¯ï¼Œèƒ½æœ‰é¢„æµ‹ä»·å€¼.</li><li>AUC &lt; 0.5ï¼Œæ¯”éšæœºçŒœæµ‹è¿˜å·®ï¼›ä½†åªè¦æ€»æ˜¯åé¢„æµ‹è€Œè¡Œï¼Œå°±ä¼˜äºéšæœºçŒœæµ‹.</li></ul><h2 id="æœºå™¨å­¦ä¹ æ¨¡å‹é€‰æ‹©"><a href="#æœºå™¨å­¦ä¹ æ¨¡å‹é€‰æ‹©" class="headerlink" title="æœºå™¨å­¦ä¹ æ¨¡å‹é€‰æ‹©"></a>æœºå™¨å­¦ä¹ æ¨¡å‹é€‰æ‹©</h2><ol><li>äº¤å‰éªŒè¯</li></ol><p>æ‰€æœ‰æ•°æ®åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šè®­ç»ƒé›†ã€äº¤å‰éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚äº¤å‰éªŒè¯é›†ä¸ä»…åœ¨é€‰æ‹©æ¨¡å‹æ—¶æœ‰ç”¨ï¼Œåœ¨è¶…å‚æ•°é€‰æ‹©ã€æ­£åˆ™é¡¹å‚æ•° [å…¬å¼] å’Œè¯„ä»·æ¨¡å‹ä¸­ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p><ol><li>k-æŠ˜å äº¤å‰éªŒè¯</li></ol><ul><li>å‡è®¾è®­ç»ƒé›†ä¸ºS ï¼Œå°†è®­ç»ƒé›†ç­‰åˆ†ä¸ºkä»½:$\{S_1, S_2, â€¦, S_k\}$. </li><li>ç„¶åæ¯æ¬¡ä»é›†åˆä¸­æ‹¿å‡ºk-1ä»½è¿›è¡Œè®­ç»ƒ</li><li>åˆ©ç”¨é›†åˆä¸­å‰©ä¸‹çš„é‚£ä¸€ä»½æ¥è¿›è¡Œæµ‹è¯•å¹¶è®¡ç®—æŸå¤±å€¼</li><li>æœ€åå¾—åˆ°kæ¬¡æµ‹è¯•å¾—åˆ°çš„æŸå¤±å€¼ï¼Œå¹¶é€‰æ‹©å¹³å‡æŸå¤±å€¼æœ€å°çš„æ¨¡å‹</li></ul><ol><li>Biasä¸Varianceï¼Œæ¬ æ‹Ÿåˆä¸è¿‡æ‹Ÿåˆ</li></ol><p><strong>æ¬ æ‹Ÿåˆ</strong>ä¸€èˆ¬è¡¨ç¤ºæ¨¡å‹å¯¹æ•°æ®çš„è¡¨ç°èƒ½åŠ›ä¸è¶³ï¼Œé€šå¸¸æ˜¯æ¨¡å‹çš„å¤æ‚åº¦ä¸å¤Ÿï¼Œå¹¶ä¸”Biasé«˜ï¼Œè®­ç»ƒé›†çš„æŸå¤±å€¼é«˜ï¼Œæµ‹è¯•é›†çš„æŸå¤±å€¼ä¹Ÿé«˜.</p><p><strong>è¿‡æ‹Ÿåˆ</strong>ä¸€èˆ¬è¡¨ç¤ºæ¨¡å‹å¯¹æ•°æ®çš„è¡¨ç°èƒ½åŠ›è¿‡å¥½ï¼Œé€šå¸¸æ˜¯æ¨¡å‹çš„å¤æ‚åº¦è¿‡é«˜ï¼Œå¹¶ä¸”Varianceé«˜ï¼Œè®­ç»ƒé›†çš„æŸå¤±å€¼ä½ï¼Œæµ‹è¯•é›†çš„æŸå¤±å€¼é«˜.</p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/dIiSlJVkjFL6EpB.jpg" alt="dIiSlJVkjFL6EpB"></p><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/09/Dn5bB8wUVgmsIzC.jpg" alt="Dn5bB8wUVgmsIzC"></p><ol><li>è§£å†³æ–¹æ³•</li></ol><ul><li>å¢åŠ è®­ç»ƒæ ·æœ¬: è§£å†³é«˜Varianceæƒ…å†µ</li><li>å‡å°‘ç‰¹å¾ç»´æ•°: è§£å†³é«˜Varianceæƒ…å†µ</li><li>å¢åŠ ç‰¹å¾ç»´æ•°: è§£å†³é«˜Biasæƒ…å†µ</li><li>å¢åŠ æ¨¡å‹å¤æ‚åº¦: è§£å†³é«˜Biasæƒ…å†µ</li><li>å‡å°æ¨¡å‹å¤æ‚åº¦: è§£å†³é«˜Varianceæƒ…å†µ</li></ul><h2 id="æœºå™¨å­¦ä¹ å‚æ•°è°ƒä¼˜"><a href="#æœºå™¨å­¦ä¹ å‚æ•°è°ƒä¼˜" class="headerlink" title="æœºå™¨å­¦ä¹ å‚æ•°è°ƒä¼˜"></a>æœºå™¨å­¦ä¹ å‚æ•°è°ƒä¼˜</h2><ol><li>ç½‘æ ¼æœç´¢</li></ol><p>ä¸€ç§è°ƒå‚æ‰‹æ®µï¼›ç©·ä¸¾æœç´¢ï¼šåœ¨æ‰€æœ‰å€™é€‰çš„å‚æ•°é€‰æ‹©ä¸­ï¼Œé€šè¿‡å¾ªç¯éå†ï¼Œå°è¯•æ¯ä¸€ç§å¯èƒ½æ€§ï¼Œè¡¨ç°æœ€å¥½çš„å‚æ•°å°±æ˜¯æœ€ç»ˆçš„ç»“æœ</p><ol><li>éšæœºæœç´¢</li></ol><p>ä¸ç½‘æ ¼æœç´¢ç›¸æ¯”ï¼Œéšæœºæœç´¢å¹¶æœªå°è¯•æ‰€æœ‰å‚æ•°å€¼ï¼Œè€Œæ˜¯ä»æŒ‡å®šçš„åˆ†å¸ƒä¸­é‡‡æ ·å›ºå®šæ•°é‡çš„å‚æ•°è®¾ç½®ã€‚å®ƒçš„ç†è®ºä¾æ®æ˜¯ï¼Œå¦‚æœéšå³æ ·æœ¬ç‚¹é›†è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥æ‰¾åˆ°å…¨å±€çš„æœ€å¤§æˆ–æœ€å°å€¼ï¼Œæˆ–å®ƒä»¬çš„è¿‘ä¼¼å€¼ã€‚é€šè¿‡å¯¹æœç´¢èŒƒå›´çš„éšæœºå–æ ·ï¼Œéšæœºæœç´¢ä¸€èˆ¬ä¼šæ¯”ç½‘æ ¼æœç´¢è¦å¿«ä¸€äº›ã€‚</p><ol><li>è´å¶æ–¯ä¼˜åŒ–ç®—æ³•</li></ol><p>è´å¶æ–¯ä¼˜åŒ–ç”¨äºæœºå™¨å­¦ä¹ è°ƒå‚ç”±J. Snoek(2012)æå‡ºï¼Œä¸»è¦æ€æƒ³æ˜¯ï¼Œç»™å®šä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°(å¹¿ä¹‰çš„å‡½æ•°ï¼Œåªéœ€æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºå³å¯ï¼Œæ— éœ€çŸ¥é“å†…éƒ¨ç»“æ„ä»¥åŠæ•°å­¦æ€§è´¨)ï¼Œé€šè¿‡ä¸æ–­åœ°æ·»åŠ æ ·æœ¬ç‚¹æ¥æ›´æ–°ç›®æ ‡å‡½æ•°çš„åéªŒåˆ†å¸ƒ(é«˜æ–¯è¿‡ç¨‹,ç›´åˆ°åéªŒåˆ†å¸ƒåŸºæœ¬è´´åˆäºçœŸå®åˆ†å¸ƒã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯è€ƒè™‘äº†ä¸Šä¸€æ¬¡å‚æ•°çš„ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½çš„è°ƒæ•´å½“å‰çš„å‚æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OJ åšé¢˜ç¬”è®°</title>
      <link href="/2020/02/06/pat-advance/"/>
      <url>/2020/02/06/pat-advance/</url>
      
        <content type="html"><![CDATA[<h1 id="PAT-ç”²çº§-åšé¢˜ç¬”è®°"><a href="#PAT-ç”²çº§-åšé¢˜ç¬”è®°" class="headerlink" title="PAT-ç”²çº§ åšé¢˜ç¬”è®°"></a>PAT-ç”²çº§ åšé¢˜ç¬”è®°</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><h3 id="åŸºç¡€ç®—æ³•"><a href="#åŸºç¡€ç®—æ³•" class="headerlink" title="åŸºç¡€ç®—æ³•"></a>åŸºç¡€ç®—æ³•</h3><p>0000 <a href="#0000">åšé¢˜ Tips åŸºæœ¬ç»éªŒ</a><br>1010 <a href="#1010">Radix (è¿›åˆ¶è½¬æ¢/äºŒåˆ†æ³•)</a><br>1015 <a href="#1015">Reversible Primes (è¿›åˆ¶è½¬æ¢+åˆ¤æ–­ç´ æ•°: å¯å–ç”¨å‡½æ•°)</a><br>NK <a href="#NK-jzzh">10è¿›åˆ¶ VS 2è¿›åˆ¶ (ä»»æ„é•¿åº¦å­—ç¬¦ä¸²è¿›åˆ¶è½¬æ¢: å¯å–ç”¨å‡½æ•°)</a><br>1016 <a href="#1016">Phone Bills (æ—¥æœŸç±»è®¡ç®—)</a><br>NK <a href="#NK-dzs">å¤§æ•´æ•°ä¹˜é™¤æ³• æ‰‹å†™æ¨¡æ‹Ÿ</a></p><h3 id="æŸ¥æ‰¾-æ’åº-æ¨¡æ‹Ÿ"><a href="#æŸ¥æ‰¾-æ’åº-æ¨¡æ‹Ÿ" class="headerlink" title="æŸ¥æ‰¾/æ’åº/æ¨¡æ‹Ÿ"></a>æŸ¥æ‰¾/æ’åº/æ¨¡æ‹Ÿ</h3><p>1012 <a href="#1012">The Best Rank (åº”ç”¨é—®é¢˜ï¼Œæ•°æ®ç»“æ„è®¾è®¡ï¼Œå¤šç»´åº¦æ’åº)</a><br>1014 <a href="#1014">Waiting in Line (é˜Ÿåˆ—åº”ç”¨ï¼Œæ’é˜Ÿé—®é¢˜)</a><br>1044 <a href="#1044">Shopping in Mars (ç‰¹å®šå€¼å­åºåˆ—å’Œ, äºŒåˆ†æŸ¥æ‰¾)</a><br>1085 <a href="#1085">Perfect Sequence (äºŒåˆ†æŸ¥æ‰¾, upper-bound, åŒæŒ‡é’ˆ)</a><br>1071 <a href="#1071">Speech Patterns (è¯é¢‘ç»Ÿè®¡)</a><br>1067 <a href="#1067">Sort with Swap(0, i) (è´ªå¿ƒ, å…ƒç´ å½’ä½)</a><br>NK <a href="#NK-dcth">å•è¯æ›¿æ¢ (æ‰‹å†™ split å‡½æ•°)</a><br>NK <a href="#NK-sxzs">æ‰‡å½¢ç€è‰²é—®é¢˜</a></p><h3 id="åŠ¨æ€è§„åˆ’ç®—æ³•-DP"><a href="#åŠ¨æ€è§„åˆ’ç®—æ³•-DP" class="headerlink" title="åŠ¨æ€è§„åˆ’ç®—æ³• DP"></a>åŠ¨æ€è§„åˆ’ç®—æ³• DP</h3><p>NK <a href="#dp-set">å¸¸è§åŠ¨æ€è§„åˆ’ç®—æ³•åˆé›†</a><br>1007 <a href="#1007">Maximum Subsequence Sum(æœ€å¤§å­åºåˆ—å’Œ)</a><br>1040 <a href="#1040">Longest Symmetric String (æ±‚æœ€é•¿å¯¹ç§°å­ä¸², DP)</a><br>1045 <a href="#1045">Favorite Color Stripe (æœ€é•¿ä¸ä¸‹é™å­åºåˆ—, DP)</a><br>1068 <a href="#1068">Find More Coins (0-1 èƒŒåŒ…é—®é¢˜, DP)</a><br>HustOJ 1130 <a href="#H1130">åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„ (èƒŒåŒ…é—®é¢˜, DP)</a><br>TK 21802 <a href="#T21802">é‡‡è¯ (æœ€åŸºç¡€çš„å®¹é‡-ä»·å€¼æœ€å¤§åŒ–, èƒŒåŒ…é—®é¢˜, DP)</a><br>TK 1131 <a href="#T1131">åˆ†æ¢¨ (m ä¸ªæ¢¨å­è£…è¿› n ä¸ªç›˜å­, DP)</a><br>TK 1132 <a href="#T1132">æœ€é•¿å…¬å…±å­åºåˆ— LCS (å…¥é—¨ç»å…¸ DP)</a><br>TK 4861 <a href="#T4861">æœ€é•¿ä¸ä¸‹é™å­åºåˆ— (å…¥é—¨ç»å…¸ DP)</a><br>TK 5578 <a href="#T5578">æœ€å¤§çº¦æ•°å’Œ (DP)</a><br>TK 5579 <a href="#T5579">ç¯å½¢çŸ³å­åˆå¹¶é—®é¢˜ (åŒºé—´DP)</a></p><h3 id="æ ‘ç®—æ³•"><a href="#æ ‘ç®—æ³•" class="headerlink" title="æ ‘ç®—æ³•"></a>æ ‘ç®—æ³•</h3><p>1004 <a href="#1004">Counting Leaves (è®¡ç®—å¶èŠ‚ç‚¹æ•°ï¼ŒDFS/BFS æ ‘ç®—æ³•)</a><br>1020 <a href="#1020">Tree Traversals (å·²çŸ¥ååºå’Œä¸­åºï¼Œè½¬å‰åº/å±‚åº)</a><br>1021 <a href="#1021">Deepest Root (æ±‚æ ‘ä¸­æœ€é•¿çš„è·¯å¾„ï¼ŒDFSï¼Œè¿é€šåˆ†é‡)</a><br>1100 <a href="#1100">Complete Binary Tree (åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘ å±‚åºéå†)</a></p><h3 id="å›¾ç®—æ³•"><a href="#å›¾ç®—æ³•" class="headerlink" title="å›¾ç®—æ³•"></a>å›¾ç®—æ³•</h3><p>1003 <a href="#1003">Emergency (Dijkstra ç®—æ³•)</a><br>1013 <a href="#1013">Battle Over Cities (å›¾çš„éå†ï¼Œç»Ÿè®¡å¼ºè¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼ŒDFS)</a><br>1018 <a href="#1018">Public Bike Management (å›¾æœ€çŸ­è·¯å¾„ Dijkstra + DFS)</a><br>NK <a href="#NK-ctgc">ç•…é€šå·¥ç¨‹ (å¹¶æŸ¥é›†, æœ€å°ç”Ÿæˆæ ‘ Kruscal)</a><br>NK <a href="#NK-graph">å¸¸è§å›¾ç®—æ³•åˆé›†</a></p><hr><h2 id="0000-åšé¢˜-Tips-åŸºæœ¬ç»éªŒ"><a href="#0000-åšé¢˜-Tips-åŸºæœ¬ç»éªŒ" class="headerlink" title="0000 åšé¢˜ Tips åŸºæœ¬ç»éªŒ"></a>0000 åšé¢˜ Tips åŸºæœ¬ç»éªŒ<span id="0000"></span></h2><ol><li>æœ€ååƒä¸‡åˆ«æ ½åœ¨å¤´æ–‡ä»¶ä¸Šï¼Œæ¯”å¦‚ reverse() å±äº &lt; algorithm&gt;ï¼Œæ¯”å¦‚ memset å±äº string.h<br>ä¸€å®šè¦å¤šæ£€æŸ¥ corner case, æ¯”å¦‚ n=1, n=0</li><li>è®¾ç½®è¾“å‡ºå½¢å¼<pre><code class="lang-c++">cout &lt;&lt; setw(4) &lt;&lt; setfill(&#39;0&#39;) &lt;&lt; v[i];</code></pre></li><li><p>int æœ€å¤§èŒƒå›´ $-2^{31}$=-2147483648 åˆ° $2^{31}$-1=2147483647  (10 ä½æ•°)</p></li><li><p>INT_MAX å’Œ INT_MIN éƒ½åœ¨<code>#include &lt;limits.h&gt;</code>ä¸­å®šä¹‰çš„<br>å…¶ä¸­ INT_MAX å°±ç­‰äº<code>0x7fffffff</code>, ä¹Ÿå³<code>2147483647</code></p></li><li><p>è¾“å…¥ä¸€ä¸¤ä¸ªæ•°, ç”¨ cin æ— ä¼¤å¤§é›…, é‡åˆ°ä¸‹é¢è¿™ç§</p><pre><code class="lang-c++">for (int j = 0; j &lt; m; ++j) {     cin &gt;&gt; temp; }</code></pre><p>ç”±äº m å¯ä»¥è¾¾åˆ° $10^5$, cin å°±ä¼šæ˜¾å¾—å¾ˆè€—æ—¶, è¦ç”¨ scanf</p></li><li><p>ç»“æ„ä½“ä¸èƒ½ç›´æ¥æ•´ä¸ªèµ‹å€¼</p></li></ol><pre><code class="lang-cpp">station st = {0, 0};scanf(&quot;%lf %lf&quot;, &amp;st.price, &amp;st.dis);v.push_back(st);</code></pre><ol><li>scanf è¯»å–å­—ç¬¦ä¸²æ³¨æ„</li></ol><p>ä¸€å®šè¦é¢„å…ˆåˆ†é…å¥½ç©ºé—´ï¼Œå³ä½¿æ˜¯æ•°ç»„ä¹Ÿè¦. è€Œä¸” string a ä¸€å®šè¦ <code>&amp;a[0]</code></p><pre><code class="lang-cpp">int main(){    string a;    a.resize(100); //éœ€è¦é¢„å…ˆåˆ†é…ç©ºé—´    scanf(&quot;%s&quot;, &amp;a[0]);    puts(a.c_str());    return 0;}char str[20];scanf(&quot;%s&quot;,str);char* str=(char*)malloc(15*sizeof(char));scanf(&quot;%s&quot;,str);</code></pre><ol><li><p>map åˆå§‹åŒ–æ–¹æ³•</p><pre><code class="lang-cpp">map&lt;string, int&gt; getMonth{ {&quot;January&quot;,1 }, {&quot;February&quot;,2}, {&quot;March&quot;,3}}</code></pre></li><li><p>å­—ç¬¦ä¸²æ ¼å¼æŠ“æ¢</p><pre><code class="lang-cpp">scanf(&quot;%s&quot;, a); sscanf(a, &quot;%lf&quot;, &amp;temp); sprintf(b, &quot;%.2f&quot;,temp);</code></pre></li></ol><h3 id="é™„-ç”²çº§é¢˜ç›®åˆ†ç±»"><a href="#é™„-ç”²çº§é¢˜ç›®åˆ†ç±»" class="headerlink" title="é™„:ç”²çº§é¢˜ç›®åˆ†ç±»"></a>é™„:ç”²çº§é¢˜ç›®åˆ†ç±»</h3><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/06/Y49WNI6DpA3hSKX.png" alt="ç”²çº§é¢˜ç›®åˆ†ç±»"></h2><p><span id="1003"></span></p><h2 id="1003-Emergency-Dijkstra-ç®—æ³•"><a href="#1003-Emergency-Dijkstra-ç®—æ³•" class="headerlink" title="1003 Emergency (Dijkstra ç®—æ³•)"></a>1003 Emergency (Dijkstra ç®—æ³•)</h2><h3 id="1-é¢˜ç›®å¤§æ„"><a href="#1-é¢˜ç›®å¤§æ„" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>nä¸ªåŸå¸‚mæ¡è·¯ï¼Œæ¯ä¸ªåŸå¸‚æœ‰æ•‘æ´å°ç»„ï¼Œæ‰€æœ‰çš„è¾¹çš„è¾¹æƒå·²çŸ¥. ç»™å®šèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œæ±‚ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯å¾„æ¡æ•°ä»¥åŠæœ€çŸ­è·¯å¾„ä¸Šçš„æ•‘æ´å°ç»„æ•°ç›®ä¹‹å’Œ. å¦‚æœæœ‰å¤šæ¡å°±è¾“å‡ºç‚¹æƒï¼ˆåŸå¸‚æ•‘æ´å°ç»„æ•°ç›®ï¼‰æœ€å¤§çš„é‚£ä¸ª</p><h3 id="2-åˆ†æ"><a href="#2-åˆ†æ" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>ç”¨ä¸€éDijkstraç®—æ³•ï½æ•‘æ´å°ç»„ä¸ªæ•°ç›¸å½“äºç‚¹æƒï¼Œç”¨Dijkstraæ±‚è¾¹æƒæœ€å°çš„æœ€çŸ­è·¯å¾„çš„æ¡æ•°ï¼Œä»¥åŠè¿™äº›æœ€çŸ­è·¯å¾„ä¸­ç‚¹æƒæœ€å¤§çš„å€¼ï½dis[i]è¡¨ç¤ºä»å‡ºå‘ç‚¹åˆ°iç»“ç‚¹æœ€çŸ­è·¯å¾„çš„è·¯å¾„é•¿åº¦ï¼Œnum[i]è¡¨ç¤ºä»å‡ºå‘ç‚¹åˆ°iç»“ç‚¹æœ€çŸ­è·¯å¾„çš„æ¡æ•°ï¼Œw[i]è¡¨ç¤ºä»å‡ºå‘ç‚¹åˆ°iç‚¹æ•‘æ´é˜Ÿçš„æ•°ç›®ä¹‹å’Œï½å½“åˆ¤å®šdis[u] + e[u][v] &lt; dis[v]çš„æ—¶å€™ï¼Œä¸ä»…ä»…è¦æ›´æ–°dis[v]ï¼Œè¿˜è¦æ›´æ–°num[v] = num[u], w[v] = weight[v] + w[u]; å¦‚æœdis[u] + e[u][v] == dis[v]ï¼Œè¿˜è¦æ›´æ–°num[v] += num[u]ï¼Œè€Œä¸”åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æƒé‡w[v]æ›´å°ï¼Œå¦‚æœæ›´å°äº†å°±æ›´æ–°w[v] = weight[v] + w[u]</p><h3 id="3-ä¸ªäººä»£ç "><a href="#3-ä¸ªäººä»£ç " class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805523835109376" target="_blank" rel="noopener">PTA-1003</a></p><pre><code class="lang-c++">#include &lt;iostream&gt;#include &lt;algorithm&gt;using namespace std;//Dijkstra ç®—æ³•ï¼šå•æºæœ€çŸ­è·¯å¾„int n, m, c1, c2;int e[510][510], weight[510], dis[510], num[510], w[510];//è¾¹çš„é‚»æ¥çŸ©é˜µï¼Œæ¯ä¸ªç‚¹çš„æƒå€¼ï¼Œä»å‡ºå‘ç‚¹åˆ°içš„è·ç¦»ï¼Œæœ€çŸ­è·ç¦»è¾¹æ•°ï¼Œæœ€å¤§æƒé‡å’Œconst int Inf = 99999999;bool visit[510];int main(){    cin &gt;&gt; n &gt;&gt; m &gt;&gt; c1 &gt;&gt; c2;    for (int i = 0; i &lt; n; ++i) {        cin &gt;&gt; weight[i];    }    fill(e[0], e[0]+510*510, Inf);  //æ•´ä¸ªé‚»æ¥çŸ©é˜µå¡«æ­£æ— ç©·ï¼Œé»˜è®¤ä¸å¯è¾¾    fill(dis, dis+510, Inf);    int a,b,c;    for (int j = 0; j &lt; m; ++j) {        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;        e[a][b] = e[b][a] = c;  //ä¸€å®šè¦å¯¹ç§°    }    dis[c1] = 0;    num[c1] = 1;    w[c1] = weight[c1];  //åˆå§‹åŒ–    for (int i = 0; i &lt; n; ++i) {    //æ¯ä¸ªç‚¹éƒ½è¦ä½œä¸ºèµ·å§‹ç‚¹ å¼€å§‹ä¸€é        int u = -1, min_d = Inf;        //æ¯æ¬¡å¾ªç¯é‡ç½®        //æœ¬æ¬¡å¾ªç¯è¡¨ç¤ºä» i å‡ºå‘, i -&gt; j        for (int j = 0; j &lt; n; ++j) {            if(!visit[j] &amp;&amp; dis[j] &lt; min_d){   //æ‰¾ä»æœ¬ç‚¹å‡ºå‘çš„æœ€å°è¾¹                u = j;                min_d = dis[j];            }        }        if(u == -1) break;        visit[u] = true;        //å¾—åˆ°ä¸€æ¡ i-&gt;u, å³ dis[], ç”¨æ¥æ›´æ–°æœ€çŸ­è·¯å¾„        //ä¹‹å‰æ²¡æ›´æ–°çš„ã€åœ¨åç»­å¾—åˆ°æ›´æ–°ï¼Œè¾¾åˆ°æœ€ä¼˜        for (int v = 0; v &lt; n; ++v) {            if(!visit[v] &amp;&amp; e[u][v] != Inf){                if(dis[u] + e[u][v] &lt; dis[v]){                    dis[v] = dis[u] + e[u][v];                    w[v] = w[u] + weight[v];                    num[v] = num[u];                } else if(dis[u] + e[u][v] == dis[v]){                    num[v] += num[u];                    if(w[v] &lt; w[u]+weight[v])                        w[v] = w[u]+weight[v];   //æºå¸¦å°½å¯èƒ½å¤šçš„äºº                }            }        }    }    cout &lt;&lt; num[c2] &lt;&lt; &quot; &quot; &lt;&lt; w[c2];   //ä»å‡ºå‘ç‚¹åˆ°c2    return 0;}</code></pre><h3 id="4-å­¦ä¹ è¦ç‚¹"><a href="#4-å­¦ä¹ è¦ç‚¹" class="headerlink" title="4. å­¦ä¹ è¦ç‚¹"></a>4. å­¦ä¹ è¦ç‚¹</h3><blockquote><p>1.çœŸæ­£ç†è§£å•æºæœ€çŸ­è·¯å¾„ï¼Œæ¯ä¸€æ¬¡é€‰æ‹©çš„ dis éƒ½æ˜¯ç›¸å¯¹äºæºç‚¹çš„æœ€çŸ­è·¯å¾„<br>2.å¤§æ•°ç»„è¦è®¾ä¸ºå…¨å±€å˜é‡<br>3.å¤–å±‚å¾ªç¯ iï¼šn æ¬¡å¾ªç¯ï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªæ–°ç‚¹ï¼Œä¿è¯ n ä¸ªç‚¹å…¨è®¿é—®åˆ°ï¼›å†…å±‚å¾ªç¯ jï¼šç»§ç»­å¯»æ‰¾è¿˜æœªè®¿é—®çš„ç‚¹ï¼Œæ‰¾ dis æœ€å°çš„è®¿é—®ï¼›å†…å±‚å¾ªç¯ kï¼šæ›´æ–°æ‰€æœ‰èƒ½å¤Ÿæ›´æ–°çš„ dis</p></blockquote><hr><p><span id="1004"></span></p><h2 id="1004-Counting-Leaves-dfs-bfs-æ ‘ç®—æ³•"><a href="#1004-Counting-Leaves-dfs-bfs-æ ‘ç®—æ³•" class="headerlink" title="1004 Counting Leaves (dfs/bfs æ ‘ç®—æ³•)"></a>1004 Counting Leaves (dfs/bfs æ ‘ç®—æ³•)</h2><h3 id="1-é¢˜ç›®å¤§æ„-1"><a href="#1-é¢˜ç›®å¤§æ„-1" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å‡ºä¸€æ£µæ ‘ï¼Œé—®æ¯ä¸€å±‚å„æœ‰å¤šå°‘ä¸ªå¶å­ç»“ç‚¹</p><h3 id="2-å‘"><a href="#2-å‘" class="headerlink" title="2. å‘"></a>2. å‘</h3><pre><code>list[tmp].lev = list[fa].lev + 1;  //å‡ºé—®é¢˜,ä¸ä¸€å®šæŒ‰ç…§é¡ºåºè¾“å…¥</code></pre><p>æœ‰å¯èƒ½å…ˆ 03 å 01ï¼Œfa çš„ lev è¿˜æ²¡ç¡®å®šï¼Œä¸èƒ½ç»™å­©å­èŠ‚ç‚¹ +1</p><pre><code>3 203 1 0201 1 03</code></pre><h3 id="3-ä¸ªäººä»£ç -1"><a href="#3-ä¸ªäººä»£ç -1" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805521431773184" target="_blank" rel="noopener">PTA-1004</a></p><h3 id="4-æ­£ç¡®æ–¹æ³•"><a href="#4-æ­£ç¡®æ–¹æ³•" class="headerlink" title="4. æ­£ç¡®æ–¹æ³•"></a>4. æ­£ç¡®æ–¹æ³•</h3><pre><code class="lang-cpp">void dfs(int fa){    for (auto &amp;ch : list[fa].v) {        list[ch].lev = list[fa].lev + 1;        dfs(ch);    }}dfs(1);   //é€šè¿‡ DFS ä¸€å±‚å±‚ç»™å¶å­èŠ‚ç‚¹ lev+1</code></pre><hr><p><span id="1007"></span></p><h2 id="1007-Maximum-Subsequence-Sum-æœ€å¤§å­åºåˆ—å’Œ"><a href="#1007-Maximum-Subsequence-Sum-æœ€å¤§å­åºåˆ—å’Œ" class="headerlink" title="1007 Maximum Subsequence Sum (æœ€å¤§å­åºåˆ—å’Œ)"></a>1007 Maximum Subsequence Sum (æœ€å¤§å­åºåˆ—å’Œ)</h2><h3 id="1-é¢˜ç›®å¤§æ„-2"><a href="#1-é¢˜ç›®å¤§æ„-2" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>æ±‚æœ€å¤§è¿ç»­å­åºåˆ—å’Œï¼Œè¾“å‡ºæœ€å¤§çš„å’Œä»¥åŠè¿™ä¸ªå­åºåˆ—çš„å¼€å§‹å€¼å’Œç»“æŸå€¼. å¦‚æœæ‰€æœ‰æ•°éƒ½å°äº0ï¼Œé‚£ä¹ˆè®¤ä¸ºæœ€å¤§çš„å’Œä¸º0ï¼Œå¹¶ä¸”è¾“å‡ºé¦–å°¾å…ƒç´ </p><h3 id="2-åˆ†æ-1"><a href="#2-åˆ†æ-1" class="headerlink" title="2.åˆ†æ"></a>2.åˆ†æ</h3><p>æœ¬è´¨ä¸Šæ˜¯<strong>åŠ¨æ€è§„åˆ’</strong>çš„æ€æƒ³ï¼Œæ•°ç»„ä¸º<code>vec[]</code>ï¼Œè®¾<code>dp[i]</code> æ˜¯ä»¥<code>vec[i]</code>ç»“å°¾çš„å­æ•°ç»„çš„æœ€å¤§å’Œï¼Œå¯¹äºå…ƒç´ <code>vec[i+1]</code>, å®ƒæœ‰ä¸¤ç§é€‰æ‹©ï¼š<code>vec[i+1]</code>æ¥ç€å‰é¢çš„å­æ•°ç»„æ„æˆæœ€å¤§å’Œ; <code>vec[i+1]</code>è‡ªå·±å•ç‹¬æ„æˆå­æ•°ç»„. åˆ™<code>dp[i+1] = max{dp[i]+vec[i+1],  vec[i+1]}</code></p><p>ç®€åŒ–åˆ™ç”¨ä¸€ä¸ª temp_sum å’Œä¸€ä¸ª temp_first è§£å†³ï¼ŒçœŸæ­£æœ€å¤§å’Œä¸º sumï¼Œèµ·å§‹ç‚¹ä¸º first å’Œ lastï¼Œå»ºç«‹å±€éƒ¨å’Œå…¨å±€çš„å…³ç³». å¦‚æœ <code>temp_sum &lt; 0</code>, è¯´æ˜ç›®å‰è¿™ä¸€æ®µå¯¹åç»­çš„åºåˆ—å’Œå·²ç»æ²¡æœ‰åŠ æˆä½œç”¨ï¼Œå¯ä»¥èˆå¼ƒå¦ç«‹é—¨æˆ·ï¼Œä»¤<code>temp_sum = 0</code></p><h3 id="3-ä¸ªäººä»£ç -2"><a href="#3-ä¸ªäººä»£ç -2" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">//åˆå§‹å€¼è®¾ç½®å®¹æ˜“å‘ï¼šsumè¦ä¸º-1 æ‰èƒ½å¼€å§‹int sum=-1, temp_sum=0, first=0, last=k-1, temp_first=0;for (int j = 0; j &lt; k; ++j) {    temp_sum += a[j];    if(temp_sum &lt; 0){        temp_sum = 0;        temp_first = j+1;   //æœ¬æ®µå·²ç»å¯ä»¥èˆå¼ƒï¼Œå¼€å§‹æ–°ä¸€æ®µ    } else if(temp_sum &gt; sum){        sum = temp_sum;        first = temp_first;        last = j;    }}if(sum &lt; 0) sum = 0;  //å¦‚æœå…¨è´Ÿåˆ™ä¸º 0ï¼Œæ ¹æ®é¢˜ç›®è¦æ±‚ä¸è¦æ¼æƒ…å†µ</code></pre><h3 id="4-ç±»ä¼¼é¢˜"><a href="#4-ç±»ä¼¼é¢˜" class="headerlink" title="4. ç±»ä¼¼é¢˜"></a>4. ç±»ä¼¼é¢˜</h3><h5 id="1-æœ€é•¿æ— é‡å¤å­ä¸²"><a href="#1-æœ€é•¿æ— é‡å¤å­ä¸²" class="headerlink" title="1) æœ€é•¿æ— é‡å¤å­ä¸²"></a>1) <a href="https://www.cnblogs.com/grandyang/p/4480780.html" target="_blank" rel="noopener">æœ€é•¿æ— é‡å¤å­ä¸²</a></h5><h5 id="2-æ»¡è¶³-gt-k-çš„æœ€çŸ­è¿ç»­å­åºåˆ—"><a href="#2-æ»¡è¶³-gt-k-çš„æœ€çŸ­è¿ç»­å­åºåˆ—" class="headerlink" title="2) æ»¡è¶³ &gt;=k çš„æœ€çŸ­è¿ç»­å­åºåˆ—"></a>2) æ»¡è¶³ &gt;=k çš„æœ€çŸ­è¿ç»­å­åºåˆ—</h5><p>æ ¸å¿ƒæ€æƒ³: è¦æ±‚è¿ç»­, å¯ä»¥ç”¨<code>åŒæŒ‡é’ˆæ³•</code>, è®°å½• start å’Œ end, end ä½œä¸ºæ¢è·¯, start ä½œä¸ºåå¤‡, æ»¡è¶³ä¹‹å start å°±å¯ä»¥å‰ç§». æ•´ä¸ªè¿‡ç¨‹ä¸­é€šè¿‡ min æ²‰æ·€å‡ºæœ€çŸ­é•¿åº¦.</p><pre><code class="lang-cpp">int start = 0, end = 0, ans = n, sum = 0;while (end &lt; n){    if(sum &lt; k)        sum += a[end];    while (sum &gt;= k){   //ä¸€ç›´ç§»åˆ°å°äº k ä¸ºæ­¢, æ»¡è¶³ sum &gt;= k çš„å°±æœ‰è®¡æ•°èµ„æ ¼        ans = min(ans, end-start+1);        sum -= a[start++];   //start åç§»    }    end++;}cout &lt;&lt; ans;</code></pre><hr><p><span id="1010"></span></p><h2 id="1010-Radix-è¿›åˆ¶è½¬æ¢-äºŒåˆ†æ³•ï¼‰"><a href="#1010-Radix-è¿›åˆ¶è½¬æ¢-äºŒåˆ†æ³•ï¼‰" class="headerlink" title="1010 Radix (è¿›åˆ¶è½¬æ¢/äºŒåˆ†æ³•ï¼‰"></a>1010 Radix (è¿›åˆ¶è½¬æ¢/äºŒåˆ†æ³•ï¼‰</h2><h3 id="1-é¢˜ç›®å¤§æ„-3"><a href="#1-é¢˜ç›®å¤§æ„-3" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸¤ä¸ªç›¸ç­‰æ•°ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°çš„è¿›åˆ¶ï¼Œæ±‚å¦å¤–ä¸€ä¸ªæ•°çš„è¿›åˆ¶ï¼ˆradix-&gt;åŸºæ•°ï¼‰</p><h3 id="2-åˆ†æ-2"><a href="#2-åˆ†æ-2" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>é€šç”¨å‡½æ•°<code>cal(string str, int radix)</code>æŠŠä»»æ„è¿›åˆ¶çš„æ•°è½¬æ¢ä¸º 10 è¿›åˆ¶æ•°<br>åœ¨ä½¿ç”¨æœç´¢éå†ï¼Œæ‰¾åˆ°å¦ä¸€ä¸ªæ•°å¯¹åº”çš„è¿›åˆ¶</p><h3 id="3-ä¸ªäººä»£ç -3"><a href="#3-ä¸ªäººä»£ç -3" class="headerlink" title="3.ä¸ªäººä»£ç "></a>3.ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805507225665536" target="_blank" rel="noopener">PTA-1010</a></p><p>è½¬æ¢å‡½æ•°</p><pre><code class="lang-cpp">//ä»»æ„è¿›åˆ¶è½¬æ¢ä¸º 10 è¿›åˆ¶long long cal(string str, long long radix){    long long target=0, bak = 1;    reverse(str.begin(), str.end());    for (char c : str) {        if(isdigit(c))            target += (c - &#39;0&#39;) * bak;        else            target += (c - &#39;a&#39; + 10) * bak;        bak *= radix;  //ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;cmath&gt;çš„ pow()å‡½æ•°    }    return target;}</code></pre><p>æœç´¢å‡½æ•°</p><pre><code class="lang-cpp">long long find_radix(string str, long long tar){    char c = *max_element(str.begin(), str.end());  //æœ€å¤§å­—æ¯    //è¿›åˆ¶è‡³å°‘æ¯”æœ€å¤§å­—æ¯è¦å¤§    long long low = isdigit(c) ? c-&#39;0&#39; : c-&#39;a&#39;+10;    low += 1;  //å¿…é¡»è¦åŠ ä¸€,è‡³å°‘å¤š1    long long high = max(low, tar);  //è¿›åˆ¶æœ€å¤§ä¸ä¼šå¤§äºç›®æ ‡ tar    while (low &lt;= high){        long long mid = (low+high)/2;        long long tmp = cal(str, mid);        if(tmp &lt; 0 || tmp &gt; tar) high = mid - 1;  //å°äº 0 ä¹Ÿæ˜¯è¿›åˆ¶å¤ªå¤§        else if(tmp == tar) return mid;        else low = mid + 1;    }    return -1;}</code></pre><h3 id="4-å­¦ä¹ è¦ç‚¹-1"><a href="#4-å­¦ä¹ è¦ç‚¹-1" class="headerlink" title="4. å­¦ä¹ è¦ç‚¹"></a>4. å­¦ä¹ è¦ç‚¹</h3><blockquote><ol><li>è¿›åˆ¶è½¬æ¢è¿™ç§å¤§æ•°å­—çš„ä¹˜æ³•å¾ˆå®¹æ˜“æº¢å‡ºï¼Œå¿…é¡»è¦ç”¨ <code>long long</code></li><li>æš´åŠ›æœç´¢ï¼ˆä» 2 åˆ° âˆ å®¹æ˜“è¶…æ—¶ï¼‰æœ€å¥½ç”¨äºŒåˆ†æ³•ï¼Œå¹¶ä¸”é™å®šèŒƒå›´ï¼šæœ€å°æ˜¯ <code>low</code> è‡³å°‘æ˜¯æœ€å¤§çš„é‚£ä¸ªå­—æ¯+1ï¼Œæ¯”å¦‚ fff æœ€å°‘æ˜¯ 15+1=16 è¿›åˆ¶ï¼Œæœ€å¤§æ˜¯<code>high</code>ä¸è¶…è¿‡ç›®æ ‡ <code>tar</code></li><li>å¯ä»¥ä½¿ç”¨åå‘è¿­ä»£å™¨ <code>it = n.rbegin(); it != n.rend()</code>ä»£æ›¿<code>reverse()</code></li></ol></blockquote><hr><h2 id="1012-The-Best-Rank-æ•°æ®ç»“æ„è®¾è®¡-å¤šç»´åº¦æ’åº"><a href="#1012-The-Best-Rank-æ•°æ®ç»“æ„è®¾è®¡-å¤šç»´åº¦æ’åº" class="headerlink" title="1012 The Best Rank (æ•°æ®ç»“æ„è®¾è®¡/å¤šç»´åº¦æ’åº)"></a>1012 The Best Rank (æ•°æ®ç»“æ„è®¾è®¡/å¤šç»´åº¦æ’åº)<span id="1012"></span></h2><h3 id="1-é¢˜ç›®å¤§æ„-4"><a href="#1-é¢˜ç›®å¤§æ„-4" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>æ‰¾å‡ºæ¯ä¸ªäººè‡ªå·±æœ€ä¼˜åŠ¿çš„ç§‘ç›®ï¼Œä¹Ÿå°±æ˜¯å•ç‹¬æ’åæœ€å¥½çš„ç§‘ç›®ï¼Œä¼˜å…ˆçº§ A &gt; C &gt; M &gt; E</p><ul><li>Sample Input:<pre><code>5 6310101 98 85 88310102 70 95 88310103 82 87 94310104 91 91 91310105 85 90 90310101310102310103310104310105999999</code></pre></li><li>Sample Output:<pre><code>1 C1 M1 E1 A3 AN/A</code></pre></li></ul><h3 id="2-ä¸ªäººä»£ç "><a href="#2-ä¸ªäººä»£ç " class="headerlink" title="2. ä¸ªäººä»£ç "></a>2. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805502658068480" target="_blank" rel="noopener">PTA-1012</a></p><h3 id="3-å­¦ä¹ è¦ç‚¹"><a href="#3-å­¦ä¹ è¦ç‚¹" class="headerlink" title="3. å­¦ä¹ è¦ç‚¹"></a>3. å­¦ä¹ è¦ç‚¹</h3><p>æ•°æ®ç»“æ„è®¾è®¡</p><pre><code class="lang-cpp">struct node{    //ä¸€å®šè¦ç”¨æ•°ç»„å½¢å¼ï¼Œé¿å…è¿‡å¤šå˜é‡ int c, m, e, c_r, m_r, e_r, a_r;    int id, best;    int score[4], rank[4];}stu[2001];  //è¾“å…¥å­¦ç”Ÿåºåˆ—ï¼Œéå­¦å·æ’åºint exist[1000000], flag=-1; //exist è‡³å°‘ &gt;0, é¡ºä¾¿å»ºç«‹ id-è¾“å…¥åºå· æ˜ å°„//ä½¿ç”¨ flag é…ç½®ä½œç”¨ï¼Œé¿å…å†™è¿‡å¤šé‡å¤çš„ cmp å‡½æ•°bool cmp(node &amp;a, node &amp;b){ return a.score[flag] &gt; b.score[flag];}</code></pre><p>è¾“å…¥åï¼Œåˆ©ç”¨<code>exist[stu[k].id] = k + 1; k++</code> ä¾æ¬¡å»ºç«‹æ˜ å°„<br>è¾“å‡ºæ—¶ï¼Œåˆ©ç”¨<code>cin &gt;&gt; tmp; ex = exist[tmp]</code>å’Œ<code>stu[ex-1]</code>å®ç°æ˜ å°„ï¼Œæ— éœ€ find<br>å¤„ç†æ—¶ï¼Œä½¿ç”¨<code>sort(stu, stu+n, cmp)</code> å¾ªç¯ <code>flag++</code>ï¼Œå®ç°åˆ†å­¦ç§‘å¤šæ¬¡æ’åºï¼Œç¡®å®š <code>rank[]</code></p><hr><p><span id="1013"></span></p><h2 id="1013-Battle-Over-Citiesï¼ˆå›¾çš„éå†ï¼Œç»Ÿè®¡å¼ºè¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼Œdfsï¼‰"><a href="#1013-Battle-Over-Citiesï¼ˆå›¾çš„éå†ï¼Œç»Ÿè®¡å¼ºè¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼Œdfsï¼‰" class="headerlink" title="1013 Battle Over Citiesï¼ˆå›¾çš„éå†ï¼Œç»Ÿè®¡å¼ºè¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼Œdfsï¼‰"></a>1013 Battle Over Citiesï¼ˆå›¾çš„éå†ï¼Œç»Ÿè®¡å¼ºè¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼Œdfsï¼‰</h2><h3 id="1-é¢˜ç›®å¤§æ„-5"><a href="#1-é¢˜ç›®å¤§æ„-5" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å‡ºnä¸ªåŸå¸‚ä¹‹é—´æœ‰ç›¸äº’è¿æ¥çš„mæ¡é“è·¯ï¼Œå½“åˆ é™¤ä¸€ä¸ªåŸå¸‚å’Œå…¶è¿æ¥çš„é“è·¯çš„æ—¶å€™ï¼Œé—®å…¶ä»–å‡ ä¸ªå‰©ä½™çš„åŸå¸‚è‡³å°‘è¦æ·»åŠ å¤šå°‘ä¸ªè·¯çº¿ï¼Œæ‰èƒ½è®©å®ƒä»¬é‡æ–°å˜ä¸ºè¿é€šå›¾</p><h3 id="2-åˆ†æ-3"><a href="#2-åˆ†æ-3" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>n è¿é€šåˆ†é‡ï¼Œæœ€å°‘éœ€è¦ n-1 æ¡è¾¹ç›¸è¿ï¼Œæ‰€ä»¥æœ¬é¢˜å®è´¨å°±æ˜¯æ±‚ã€Œå»é™¤æŸç‚¹åŠå…¶ç›¸è¿çš„è¾¹ã€åï¼Œå‰©ä½™çš„ã€Œè¿é€šåˆ†é‡ä¸ªæ•°ã€æ˜¯ä¸€ä¸ªå›¾ç®—æ³•ï¼Œéœ€è¦ç”¨å›¾çš„éå†æ¥è§£å†³ (DFS)</p><blockquote><p>æ±‚è¿é€šåˆ†é‡ä¾æ®ï¼šä¸€æ¬¡ <code>dfs()</code>èµ°åˆ°åº•ï¼Œå¯ä»¥è®¿é—®å®Œä¸€ä¸ªè¿é€šåˆ†é‡</p></blockquote><p>æ•°æ®ç»“æ„ï¼š</p><blockquote><p>æ¶‰åŠå›¾çš„éå†ï¼Œè¦è€ƒè™‘ <code>visit[]</code>æ•°ç»„<br>å›¾çš„è·¯å¾„å­˜å‚¨ï¼Œä½¿ç”¨äºŒç»´çŸ©é˜µ</p></blockquote><h3 id="3-ä¸ªäººä»£ç -4"><a href="#3-ä¸ªäººä»£ç -4" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805500414115840" target="_blank" rel="noopener">PTA-1013</a></p><pre><code class="lang-cpp">for (int i = 0; i &lt; k; ++i) {        int cur, cnt=0;        cin &gt;&gt; cur;        fill(visited, visited+n, false);        visited[cur] = true;  //ç›¸å½“äºæŠŠæœ¬ç‚¹å»é™¤        for (int j = 1; j &lt;= n; ++j) {  //ä¾æ¬¡è®¡ç®—æ‰€æœ‰è¿é€šåˆ†é‡ï¼Œè€Œéä»æœ¬ç‚¹å‡ºå‘            if(!visited[j]){                dfs(j);                cnt++;            }        }        cout &lt;&lt; cnt-1 &lt;&lt; endl;    }</code></pre><pre><code class="lang-cpp">void dfs(int st){   //åªç”¨æ¥ visitï¼Œä¸è´Ÿè´£è®¡æ•°    visited[st] = true;    for (int i = 0; i &lt;= n; ++i)        if(!visited[i] &amp;&amp; e[st][i]){   //æœªè®¿é—®ä¸”æœ‰è·¯            dfs(i);        }}</code></pre><h3 id="4-å‘ç‚¹"><a href="#4-å‘ç‚¹" class="headerlink" title="4.å‘ç‚¹"></a>4.å‘ç‚¹</h3><p>æœ‰äº›é¢˜ç›®, æ²¡æœ‰ç»™å®š n çš„èŒƒå›´, å¼€äºŒç»´æ•°ç»„å¯èƒ½ä¼šå†…å­˜è¶…é™. æ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>é‚»æ¥è¡¨</code>, vector çš„æ•°ç»„.</p><pre><code class="lang-cpp">vector&lt;int&gt; Adj[maxn];//è¾“å…¥æ—¶if(m!=n){    Adj[n].push_back(m);    Adj[m].push_back(n);}else{    Adj[n].push_back(m);}//éå†æ—¶void DFS(int n){    flag[n]=true;    for(int i=0; i&lt;Adj[n].size(); ++i) //åªéå†è‡ªå·±çš„é‚»æ¥ç‚¹    {        int v=Adj[n][i];        if(flag[v]==false)        {            DFS(v);        }    }}</code></pre><hr><p><span id="1014"></span></p><h2 id="1014-Reversible-Primesï¼ˆé˜Ÿåˆ—åº”ç”¨-æ’é˜Ÿé—®é¢˜"><a href="#1014-Reversible-Primesï¼ˆé˜Ÿåˆ—åº”ç”¨-æ’é˜Ÿé—®é¢˜" class="headerlink" title="1014 Reversible Primesï¼ˆé˜Ÿåˆ—åº”ç”¨ æ’é˜Ÿé—®é¢˜"></a>1014 Reversible Primesï¼ˆé˜Ÿåˆ—åº”ç”¨ æ’é˜Ÿé—®é¢˜</h2><h3 id="1-é¢˜ç›®å¤§æ„-6"><a href="#1-é¢˜ç›®å¤§æ„-6" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>nä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£å¯ä»¥æ’é˜Ÿmäºº. æœ‰kä½ç”¨æˆ·éœ€è¦æœåŠ¡ï¼Œç»™å‡ºäº†æ¯ä½ç”¨æˆ·éœ€è¦çš„minuteæ•°ï¼Œæ‰€æœ‰å®¢æˆ·åœ¨8ç‚¹å¼€å§‹æœåŠ¡ï¼Œå¦‚æœæœ‰çª—å£è¿˜æ²¡æ’æ»¡å°±å…¥é˜Ÿï¼Œå¦åˆ™å°±åœ¨é»„çº¿å¤–ç­‰å€™. å¦‚æœæœ‰æŸä¸€åˆ—æœ‰ä¸€ä¸ªç”¨æˆ·èµ°äº†æœåŠ¡å®Œæ¯•äº†ï¼Œé»„çº¿å¤–çš„äººå°±è¿›æ¥ä¸€ä¸ª. å¦‚æœåŒæ—¶å°±é€‰çª—å£æ•°å°çš„. æ±‚qä¸ªäººçš„æœåŠ¡ç»“æŸæ—¶é—´.<br>å¦‚æœä¸€ä¸ªå®¢æˆ·åœ¨17:00ä»¥åŠä»¥åè¿˜æ²¡æœ‰å¼€å§‹æœåŠ¡ï¼ˆæ­¤å¤„ä¸æ˜¯ç»“æŸæœåŠ¡æ˜¯å¼€å§‹17:00ï¼‰å°±ä¸å†æœåŠ¡è¾“å‡ºsorryï¼›å¦‚æœè¿™ä¸ªæœåŠ¡å·²ç»å¼€å§‹äº†ï¼Œæ— è®ºæ—¶é—´å¤šé•¿éƒ½è¦ç­‰ä»–æœåŠ¡å®Œæ¯•. </p><h3 id="2-å­¦ä¹ è¦ç‚¹"><a href="#2-å­¦ä¹ è¦ç‚¹" class="headerlink" title="2. å­¦ä¹ è¦ç‚¹"></a>2. å­¦ä¹ è¦ç‚¹</h3><p>é¢å¯¹æ­¤ç±»é¢˜ç›®ï¼Œæ€»æƒ³æŒ‰ç…§ timeline æ¯åˆ†æ¯ç§’å»å†³ç­–ï¼Œå…¶å®é˜Ÿåˆ—çš„é—®é¢˜ç”¨é˜Ÿåˆ—è§£å†³. </p><p>ä»¥æ¯ä¸ªçª—å£ä¸ºå•ä½è®¾è®¡ç»“æ„ä½“ï¼Œ<code>poptime</code> ç”¨äºåˆšå…¥é»„çº¿çš„äººå†³ç­–ï¼Œ<code>endtime</code> ç”¨äºå·²ç»åœ¨é˜Ÿå†…çš„äººæ˜¯å¦ä¼š sorry å†³ç­–ï¼Œ<code>q</code> è¡¨ç¤ºæœ¬é˜Ÿåˆ—å†…æ’é˜Ÿæƒ…å†µ. </p><p>ç»™å®šå®¢æˆ·åºåˆ—ï¼Œåˆ™ä»¥æ¯ä¸€ä¸ªå®¢æˆ·ä¸ºå¾ªç¯å•ä½<code>(index++)</code>ï¼Œé˜Ÿåˆ—æœ‰ä¸€ä¸ªè¿›å°±ä¼šæœ‰ä¸€ä¸ªå‡ºï¼Œæ¯æ¬¡å˜åŠ¨ä¸€ä¸ªå•ä½ï¼Œæ›´æ–°å„ä¸ªé˜Ÿåˆ—çš„<code>poptime endtime q</code>ç­‰å˜é‡. </p><pre><code class="lang-cpp">struct node {    int poptime, endtime;  //é˜Ÿé¦–çš„äººå‡ºé˜Ÿï¼ˆç»“æŸï¼‰çš„æ—¶é—´, é˜Ÿå°¾çš„äººç»“æŸçš„æ—¶é—´    queue&lt;int&gt; q;};int index = 1;    //ç¬¬ 1 æ­¥ï¼šn*m ä¸ªå®¢æˆ·å…ˆæŠ¢å é»„çº¿å†…, ç›´æ¥ç¬é—´æ¶Œå…¥ï¼Œä¸å­˜åœ¨é€‰æ‹©    for (int i = 1; i &lt;= cap; ++i) {    //çœ‹åšè¡Œå’Œåˆ—ï¼Œå…ˆæŠ¢ç¬¬ä¸€è¡Œ        for (int j = 1; j &lt;= n; ++j) {            if(index &lt;= k){                win[j].q.push(time[index]);                if(win[j].endtime &gt;= 540)                    sorry[index] = true;                win[j].endtime += time[index];                if(i == 1)  //å¯¹äºç¬¬ä¸€è¡Œï¼Œå‡ºé˜Ÿæ—¶é—´å³æœ¬é˜Ÿç»“æŸæ—¶é—´ï¼Œåšä¸€ä¸ªåˆå§‹åŒ–                    win[j].poptime = win[j].endtime;                res[index] = win[j].endtime;  //åˆšè¿›æ¥çš„ï¼Œè‡ªå·±æ˜¯é˜Ÿå°¾ï¼Œé˜Ÿä¼ç»“æŸå°±æ˜¯è‡ªå·±ç»“æŸ                index++;            }        }    }    //ç¬¬ 2 æ­¥ï¼šåç»­çš„å®¢æˆ·    while (index &lt;= k){   //whileä¸€æ¬¡å¾ªç¯è¡¨ç¤ºä¸€ä¸ªå®¢æˆ·çš„é€‰æ‹©        int temp_min = win[1].poptime, temp_win = 1;  //åˆå§‹åŒ–        for (int i = 2; i &lt;= n; ++i) {   //æ‰¾æœ€æ—©å‡ºé˜Ÿçš„            if(win[i].poptime &lt; temp_min){                temp_win = i;                temp_min = win[i].poptime;            }        }        win[temp_win].q.pop();        win[temp_win].q.push(time[index]);        win[temp_win].poptime += win[temp_win].q.front(); //æ›´æ–°ï¼šæœ€å‰é¢é‚£ä¸ªäººå®Œæˆçš„æ—¶é—´å°±æ˜¯å‡ºé˜Ÿæ—¶é—´        if(win[temp_win].endtime &gt;= 540)  //endtime è¿˜æœªæ›´æ–°ï¼Œæ˜¯çœ‹çš„å‰ä¸€ä¸ªäººçš„å®Œæˆæ—¶é—´ï¼Œæ˜¯å¦è¶…æ—¶            sorry[index] = true;        win[temp_win].endtime += time[index];  //æ›´æ–°ï¼šåˆšè¿›æ¥çš„è¿™ä¸ªäººçš„å®Œæˆæ—¶é—´å°±æ˜¯æœ¬é˜Ÿçš„å®Œæˆæ—¶é—´        res[index] = win[temp_win].endtime;        index++;    }</code></pre><hr><p><span id="1015"></span></p><h2 id="1015-åˆ¤æ–­ç´ æ•°-è¿›åˆ¶è½¬æ¢"><a href="#1015-åˆ¤æ–­ç´ æ•°-è¿›åˆ¶è½¬æ¢" class="headerlink" title="1015 åˆ¤æ–­ç´ æ•° è¿›åˆ¶è½¬æ¢"></a>1015 åˆ¤æ–­ç´ æ•° è¿›åˆ¶è½¬æ¢</h2><h3 id="1-å¯ä»¥ç›´æ¥å–ç”¨çš„å‡½æ•°"><a href="#1-å¯ä»¥ç›´æ¥å–ç”¨çš„å‡½æ•°" class="headerlink" title="1. å¯ä»¥ç›´æ¥å–ç”¨çš„å‡½æ•°"></a>1. å¯ä»¥ç›´æ¥å–ç”¨çš„å‡½æ•°</h3><pre><code class="lang-cpp">//è®¡ç®—ä»»æ„è¿›åˆ¶çš„æ–¹æ³•, 10è¿›åˆ¶-&gt;ä»»æ„è¿›åˆ¶void cal(){    int a, b;    scanf(&quot;%d %d&quot;, &amp;a, &amp;b);    int arr[40], index = 0;    while(a != 0) {        arr[index++] = a % b;        a = a / b;    }}//åˆ¤æ–­ç´ æ•°bool isPrime(int x){    if(x == 2) return true;    if(x &lt;= 1 ) return false;    int loop = (int)sqrt(x * 1.0);    for (int i = 2; i &lt;= loop; ++i) {        if(x % i == 0) return false;    }    return true;}</code></pre><ol><li>ä»»æ„è¿›åˆ¶å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢<br><a href="#NK-jzzh">NK-è¿›åˆ¶è½¬æ¢</a></li></ol><hr><p><span id="1016"></span></p><h2 id="1016-Phone-Billsï¼ˆæ—¥æœŸç±»è®¡ç®—"><a href="#1016-Phone-Billsï¼ˆæ—¥æœŸç±»è®¡ç®—" class="headerlink" title="1016 Phone Billsï¼ˆæ—¥æœŸç±»è®¡ç®—)"></a>1016 Phone Billsï¼ˆæ—¥æœŸç±»è®¡ç®—)</h2><h3 id="1-é¢˜ç›®å¤§æ„-7"><a href="#1-é¢˜ç›®å¤§æ„-7" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šå›ºå®šæ ¼å¼çš„æ—¥æœŸ<code>mm:dd:hh:mm</code>è®¡ç®—å„ä¸ªæ—¶é—´çš„å·®å€¼ï¼Œä»¥åŠæ¯ä¸ªæ—¶é—´æ®µæœ‰ä¸åŒçš„è´¹ç‡ï¼Œè®¡ç®—æ€»çš„è´¦å•è´¹ç”¨. </p><h3 id="2-å­¦ä¹ è¦ç‚¹-1"><a href="#2-å­¦ä¹ è¦ç‚¹-1" class="headerlink" title="2. å­¦ä¹ è¦ç‚¹"></a>2. å­¦ä¹ è¦ç‚¹</h3><p>1.æ•°æ®ç»“æ„è®¾è®¡<br>å› ä¸ºè¾“å…¥æ˜¯ç»™å®šä¸€ä¸ªä¸ª call åºåˆ—ï¼Œæ‰€ä»¥ä¾¿äºå­˜å‚¨ï¼Œä¹Ÿä»¥æ¯ä¸ª call ä¸ºå•ä½ï¼Œç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œï¼ŒæŒ‰ç…§åå­—ã€æ—¶é—´æ’åºï¼Œè®¡ç®—çš„æ—¶å€™ï¼Œåªè¦è€ƒè™‘ i å’Œ i-1 å‰åä¸¤ä¸ªå…ƒç´ æ˜¯å¦æœ‰åŒä¸€ä¸ª name ä»¥åŠ status ä¸€ä¸ªä¸º 0 ä¸€ä¸ªä¸º 1 å³å¯. </p><pre><code class="lang-cpp">struct node {    string name;    int status, month, time, day, hour, minute;};bool cmp(node a, node b) {    return a.name != b.name ? a.name &lt; b.name : a.time &lt; b.time;}</code></pre><p>2.æ—¥æœŸå·®å€¼è®¡ç®—<br>ç›´æ¥â€01:05:02:24â€œ-â€01:04:23:59â€œ éš¾ä»¥è®¡ç®—ï¼Œæ¯ä¸ªå°æ—¶è¿˜æœ‰ä¸åŒçš„è´¹ç‡ï¼Œæ‰€ä»¥ <strong>ç»Ÿä¸€ä»æœ¬æœˆ 0 å¤© 0 ç‚¹å¼€å§‹è®¡ç®—</strong>ï¼Œä»¥<code>dd:hh:mm</code>æ ¼å¼å†ç›¸å‡å³å¯ï¼Œéš”å¤©çš„æƒ…å†µåˆ™åŠ ä¸Šè¿™ä¸€æ•´å¤©</p><pre><code class="lang-cpp">double billFromZero(node call, int *rate) {    double total;    total = rate[call.hour];  //æœ¬å°æ—¶çš„è´¹ç”¨    total += call.minute + rate[24] * 60 * call.day;  //ä»æœ¬æœˆç¬¬ 0 å¤©åˆ°ä»Šå¤©    for (int i = 0; i &lt; call.hour; i++)        total += rate[i] * 60;  //æœ¬å¤©å†… 0 ç‚¹åˆ°ç°åœ¨ç´¯åŠ     return total / 100.0;}</code></pre><hr><h2 id="1018-Public-Bike-Managementï¼ˆå›¾æœ€çŸ­è·¯å¾„-Dijkstra-DFSï¼‰"><a href="#1018-Public-Bike-Managementï¼ˆå›¾æœ€çŸ­è·¯å¾„-Dijkstra-DFSï¼‰" class="headerlink" title="1018 Public Bike Managementï¼ˆå›¾æœ€çŸ­è·¯å¾„ Dijkstra + DFSï¼‰"></a>1018 Public Bike Managementï¼ˆå›¾æœ€çŸ­è·¯å¾„ Dijkstra + DFSï¼‰<span id="1018"></span></h2><p>å›¾ä¾‹ç»è¿‡ Dijkstra ä¹‹åçš„ç»“æœ</p><pre><code class="lang-cpp">dis[1] = 1      pre[1] = {0}dis[2] = 1      pre[2] = {0}dis[3] = 2      pre[3] = {1, 2}</code></pre><hr><p><span id="1020"></span></p><h2 id="1020-Tree-Traversals-å·²çŸ¥ååºå’Œä¸­åºï¼Œè½¬å‰åº-å±‚åº"><a href="#1020-Tree-Traversals-å·²çŸ¥ååºå’Œä¸­åºï¼Œè½¬å‰åº-å±‚åº" class="headerlink" title="1020 Tree Traversals (å·²çŸ¥ååºå’Œä¸­åºï¼Œè½¬å‰åº/å±‚åº)"></a>1020 Tree Traversals (å·²çŸ¥ååºå’Œä¸­åºï¼Œè½¬å‰åº/å±‚åº)</h2><h3 id="1-è¾“å…¥æ ¼å¼"><a href="#1-è¾“å…¥æ ¼å¼" class="headerlink" title="1. è¾“å…¥æ ¼å¼"></a>1. è¾“å…¥æ ¼å¼</h3><pre><code>72 3 1 5 7 6 41 2 3 4 5 6 7</code></pre><h3 id="2-åˆ†æ-4"><a href="#2-åˆ†æ-4" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>å’Œæ‰‹åŠ¨æ¨¡æ‹Ÿå·®ä¸å¤šï¼Œæ‰¾åˆ°æ ¹èŠ‚ç‚¹ (pre çš„ç¬¬ä¸€ä¸ªï¼Œpost çš„æœ€åä¸€ä¸ª) -&gt; æ‰¾åˆ°å·¦å³ä¸¤æ®µçš„ç«¯ç‚¹ï¼Œåˆ†åˆ«ä½œä¸ºå·¦å³å­æ ‘ -&gt; é€’å½’é‡å¤. å…³é”®åœ¨äºé€’å½’çš„å†™æ³•ï¼Œç«¯ç‚¹çš„å¯»æ‰¾. </p><h3 id="3-ä¸ªäººä»£ç -5"><a href="#3-ä¸ªäººä»£ç -5" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><code>level</code> çš„ä½œç”¨å³æŒ‰ç…§ <code>index</code> å­˜å‚¨ï¼Œåˆ©ç”¨ 2n+1 2n+2 çš„å…¬å¼å¯ä»¥å®šä½å·¦å³å­©å­ï¼Œè€Œç´¢å¼•çš„é¡ºåºæ°å¥½æ˜¯å±‚åºéå†çš„é¡ºåºï¼ˆå…·ä½“ç¬¬å‡ å±‚ä¸çŸ¥é“ï¼‰<br>è½¬ä¸ºå‰åºéå†ï¼Œåªéœ€åœ¨ pre é€’å½’å‰æ‰“å° root å³å¯</p><pre><code class="lang-cpp">vector&lt;int&gt; in, post, level(100000, -1);void pre(int root, int start, int end, int index){      //start end éƒ½æ˜¯ç›¸å¯¹äºä¸­åºåºåˆ—, ä½†æ˜¯ root æ˜¯ç›¸å¯¹äº post åºåˆ—çš„ï¼    if(start &gt; end) return;    level[index] = post[root];    int i = start;    while (i &lt; end &amp;&amp; in[i] != post[root]) i++;  //æ‰¾åˆ°ä¸­åº in åºåˆ—ä¸­çš„æ ¹èŠ‚ç‚¹    int left_size = i-start, right_size = end-i;    pre(root-right_size-1, start, i-1, index*2+1);  //æ­¤ root å³ä¸ºå·¦å­©å­èŠ‚ç‚¹ï¼Œå¯ä»¥ç¡®å®šä¸º index*2+1    pre(root-1, i+1, end, index*2+2);    //æ‰¾åˆ°æ ¹èŠ‚ç‚¹ iï¼Œå·¦å­æ ‘ start ~ i-1, å³å­æ ‘ i+1 ~ end}pre(n-1, 0, n-1, 0);</code></pre><h3 id="4-ç±»é¢˜"><a href="#4-ç±»é¢˜" class="headerlink" title="4. ç±»é¢˜"></a>4. ç±»é¢˜</h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805380754817024" target="_blank" rel="noopener">PTA-1086</a>ï¼ˆå·²çŸ¥å‰åºå’Œä¸­åºéå†ï¼Œæ±‚ååºéå†ï¼‰<br>ç»™å‡ºç”¨æ ˆè¿›è¡Œä¸­åºéå†çš„è¿‡ç¨‹ï¼Œæ±‚ååºéå†. æœ‰ä¸€ä¸ªéšå«æ¡ä»¶ï¼Œpush çš„é¡ºåºå³ä¸ºå‰åºéå†ï¼Œç›¸å¯¹äºå·²çŸ¥ pre å’Œ inï¼Œæ±‚ postï¼ŒåŒæ ·æ‰¾ root, start, end å³å¯. </p><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805345078067200" target="_blank" rel="noopener">PTA-1138</a> (å·²çŸ¥ä¸­åºå’Œå‰åºéå†, æ±‚ååºéå†çš„ç¬¬ä¸€ä¸ªæ•°å­—)<br>æ€è·¯ä¸€æ ·, ååºéå†æ˜¯å·¦å³æ ¹, å› æ­¤æœ‰å·¦è¾¹å°±åª post é€’å½’å·¦è¾¹, æ²¡æœ‰å·¦è¾¹æ‰é€’å½’å³è¾¹.</p><pre><code class="lang-C++">int pre[50001], in[50001], n, fir;void post(int root, int start, int end){    if(start == end){        fir = start;        return;   //åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹    }    int i = start;    while(i &lt;= end &amp;&amp; pre[root] != in[i]) i++;  //æ‰¾åˆ° in åºåˆ—ä¸­å¯¹åº”çš„ i    if(i &gt; start)        post(root+1, start, i-1);   //å·¦è¾¹æœ‰å°±å¾€å·¦è¾¹éå†    else        post(root+1, i+1, end);}</code></pre><hr><p><span id="1021"></span></p><h2 id="1021-Deepest-Root-æ±‚æ ‘ä¸­æœ€é•¿çš„è·¯å¾„ï¼ŒDFSï¼Œè¿é€šåˆ†é‡"><a href="#1021-Deepest-Root-æ±‚æ ‘ä¸­æœ€é•¿çš„è·¯å¾„ï¼ŒDFSï¼Œè¿é€šåˆ†é‡" class="headerlink" title="1021 Deepest Root (æ±‚æ ‘ä¸­æœ€é•¿çš„è·¯å¾„ï¼ŒDFSï¼Œè¿é€šåˆ†é‡)"></a>1021 Deepest Root (æ±‚æ ‘ä¸­æœ€é•¿çš„è·¯å¾„ï¼ŒDFSï¼Œè¿é€šåˆ†é‡)</h2><h3 id="1-é¢˜ç›®å¤§æ„-8"><a href="#1-é¢˜ç›®å¤§æ„-8" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å‡ºnä¸ªç»“ç‚¹ï¼ˆ1~nï¼‰ä¹‹é—´çš„næ¡è¾¹ï¼Œé—®æ˜¯å¦èƒ½æ„æˆä¸€æ£µæ ‘ï¼Œå¦‚æœä¸èƒ½æ„æˆåˆ™è¾“å‡ºå®ƒæœ‰çš„è¿é€šåˆ†é‡ä¸ªæ•°ï¼›å¦‚æœèƒ½æ„æˆä¸€æ£µæ ‘ï¼Œè¾“å‡ºèƒ½æ„æˆæœ€æ·±çš„æ ‘çš„é«˜åº¦æ—¶ï¼Œæ ‘çš„æ ¹ç»“ç‚¹. å¦‚æœæœ‰å¤šä¸ªï¼ŒæŒ‰ç…§ä»å°åˆ°å¤§è¾“å‡º. </p><h3 id="2-åˆ†æ-5"><a href="#2-åˆ†æ-5" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>è¿é€šåˆ†é‡çš„ä¸ªæ•°ï¼šåŸºæœ¬å¥—è·¯ï¼Œä¸€æ¬¡ DFS èµ°å®Œä¸€ä¸ªè¿é€šåˆ†é‡ï¼Œç»Ÿè®¡å¾ªç¯ä¸­ DFS å¼€å¯çš„æ¬¡æ•°å³å¯<br>æœ¬é¢˜å…³é”®åœ¨äºï¼Œä¸¤æ¬¡ DFS å³å¯æ±‚å‡ºæ‰€æœ‰æœ€è¿œç«¯ç‚¹ï¼ˆå³æ‰€æœ‰æœ€é•¿è·¯å¾„ä¸­çš„æ‰€æœ‰ç«¯ç‚¹ï¼‰å¦‚æœæ˜¯ä¸€æ£µæ ‘çš„è¯ï¼Œçº¿æ®µæ— éæ˜¯ä¸¤ä¸ªç«¯ç‚¹ï¼Œç¬¬ä¸€æ¬¡ DFS èƒ½æ‰¾åˆ°ä¸€ç«¯ï¼Œåœ¨è¿™äº›æœ€è¿œç«¯ç‚¹ä¸­ï¼ˆå¯èƒ½æœ‰å¤šä¸ªåŒæ ·æœ€è¿œçš„ï¼Œå¯èƒ½åªæœ‰ä¸€ä¸ªæœ€è¿œçš„ï¼‰éšä¾¿é€‰ä¸€ä¸ªä½œä¸ºèµ·ç‚¹ï¼Œå†æ¥ä¸€æ¬¡ DFSï¼Œå³å¯æ‰¾åˆ°å¦ä¸€ç«¯çš„æœ€è¿œç«¯ç‚¹. </p><h3 id="3-ä¸ªäººä»£ç -6"><a href="#3-ä¸ªäººä»£ç -6" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805482919673856" target="_blank" rel="noopener">PTA-1003</a></p><pre><code class="lang-cpp">void dfs(int node, int height) {    if(height &gt; maxheight) {        temp.clear();        temp.push_back(node);        maxheight = height;    } else if(height == maxheight){        temp.push_back(node);    }    visit[node] = true;    for(int i = 0; i &lt; v[node].size(); i++) {        if(visit[v[node][i]] == false)            dfs(v[node][i], height + 1);    }</code></pre><h3 id="4-åšé¢˜-Tips"><a href="#4-åšé¢˜-Tips" class="headerlink" title="4. åšé¢˜ Tips"></a>4. åšé¢˜ Tips</h3><ol><li>æœ¬é¢˜ä¸ç”¨è€ƒè™‘æƒé‡ï¼Œæ‰€ä»¥æ— éœ€å¼€ä¸€ä¸ªäºŒç»´æ•°ç»„ç”¨é‚»æ¥çŸ©é˜µå­˜å‚¨<br><code>e[10010][10010]; e[a]=e[b]=weight;</code><br>åªéœ€ä½¿ç”¨é‚»æ¥è¡¨ï¼ŒæŠŠå’Œè‡ªå·±ç›´æ¥ç›¸è¿çš„ç‚¹å­˜èµ·æ¥å³å¯<br><code>v[node][i]; resize(n+1);</code><br><br></li><li>DFS åŸºæœ¬å¥—è·¯<pre><code class="lang-cpp"> dfs(int node, ...){   //éå†è¿‡ç¨‹ä¸­é¡ºå¸¦åšå…¶å®ƒæ“ä½œ     visit[node] = true;     for ä¸æœ¬ç‚¹ç›´æ¥ç›¸è¿çš„ i:         if(!visit[i])             dfs(i, ...) }</code></pre></li></ol><hr><p><span id="1102"></span></p><h2 id="1102-Invert-a-Binary-Tree-ç¿»è½¬äºŒå‰æ ‘"><a href="#1102-Invert-a-Binary-Tree-ç¿»è½¬äºŒå‰æ ‘" class="headerlink" title="1102 Invert a Binary Tree (ç¿»è½¬äºŒå‰æ ‘)"></a>1102 Invert a Binary Tree (ç¿»è½¬äºŒå‰æ ‘)</h2><h3 id="1-é¢˜ç›®å¤§æ„-9"><a href="#1-é¢˜ç›®å¤§æ„-9" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œå…ˆç¿»è½¬å¥½ï¼Œè¾“å‡ºå±‚åºéå†å’Œä¸­åºéå†</p><h3 id="2-åˆ†æ-6"><a href="#2-åˆ†æ-6" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>å¯ä»¥å†™ä¸€ä¸ª invert å‡½æ•°ï¼Œäº¤æ¢æœ¬èŠ‚ç‚¹å·¦å³å…ƒç´ ï¼Œç„¶åå¯¹å·¦å³å­©å­é€’å½’å³å¯. </p><pre><code class="lang-cpp">struct node{    int left=-1, right=-1;  //-1 è¡¨ç¤º NULL};void invert(int r){    int a = v[r].left, b = v[r].right;    if(a == -1 &amp;&amp; b == -1)        return;    v[r].left = b;    v[r].right = a;    if(v[r].left != -1) invert(v[r].left);    if(v[r].right != -1) invert(v[r].right);}</code></pre><p>ä¹Ÿå¯ä»¥ä¸ç”¨å†™ï¼Œæ­£å¸¸éå†å³å¯ï¼Œåªæ˜¯å…ˆéå†å³å­©å­ï¼Œå†éå†å·¦å­©å­å³å¯. </p><pre><code class="lang-cpp">//å±‚åºéå†æ ‡å‡†æ¨¡å¼ï¼švoid level(int r){    queue&lt;int&gt; q;    q.push(r);    while (!q.empty()){        r = q.front();        q.pop();        // if(q.empty()) break;        le_ans.push_back(r);        if(v[r].left != -1) q.push(v[r].left);        if(v[r].right != -1) q.push(v[r].right);    }}</code></pre><h3 id="3-å‘ç‚¹ï¼š"><a href="#3-å‘ç‚¹ï¼š" class="headerlink" title="3. å‘ç‚¹ï¼š"></a>3. å‘ç‚¹ï¼š</h3><ol><li>ä¸€èˆ¬çš„é¢˜ï¼Œéƒ½è¦è€ƒè™‘å…ƒç´ å¯èƒ½æœ‰é‡å¤ï¼Œå¯èƒ½ä¸æŒ‰é¡ºåº. æœ¬é¢˜ä½¿ç”¨    <code>mark</code>æ•°ç»„ç¡®å®š<code>root</code>æ˜¯æœ€å¥½çš„æ–¹å¼</li><li><code>queue</code>å’Œä¸€èˆ¬çš„<code>vector</code>æœ‰æœ¬è´¨çš„ä¸åŒï¼Œä¸èƒ½ç”¨è¿­ä»£å™¨éå†ï¼Œä¸èƒ½ç´¢å¼•ï¼Œåªèƒ½é€šè¿‡<code>front(), back()</code>è®¿é—®. <code>quque</code>è¿›è¡Œ<code>pop(),front()</code>ç­‰æ“ä½œæ—¶ï¼Œä¸€å®šè¦æ£€æŸ¥<code>q.empty()</code></li><li>å½“<code>queue</code>ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œ<code>pop()</code>åï¼Œåœ¨è®¿é—®<code>front()</code>å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸æ•°å­—</li></ol><hr><p><span id="1040"></span></p><h2 id="1040-Longest-Symmetric-String-æ±‚æœ€é•¿å¯¹ç§°å­ä¸²-DP"><a href="#1040-Longest-Symmetric-String-æ±‚æœ€é•¿å¯¹ç§°å­ä¸²-DP" class="headerlink" title="1040 Longest Symmetric String (æ±‚æœ€é•¿å¯¹ç§°å­ä¸² DP)"></a>1040 Longest Symmetric String (æ±‚æœ€é•¿å¯¹ç§°å­ä¸² DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-10"><a href="#1-é¢˜ç›®å¤§æ„-10" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°æœ€é•¿çš„ã€å¯¹ç§°çš„å­ä¸²ï¼Œè¾“å‡ºé•¿åº¦<br>æ¯”å¦‚<code>Is PAT&amp;TAP symmetric?</code> è¾“å‡º 11, å³<code>s PAT&amp;TAP s</code>çš„é•¿åº¦</p><h3 id="2-åˆ†æ-7"><a href="#2-åˆ†æ-7" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><ol><li><p>åŸºæœ¬é€’å½’çš„æ€è·¯ï¼Œå¤§é—®é¢˜æ‹†æˆå°é—®é¢˜ï¼Œæ‹†æˆä¸€ä¸ªå·²çŸ¥æ¡ä»¶ä¸‹çš„å…·ä½“é—®é¢˜. å¯¹äº å­ä¸²/å­åºåˆ— é—®é¢˜ï¼Œè¦ä¹ˆç”¨ <code>dp[i][j]</code>è¡¨ç¤º i å’Œ j çš„å­ä¸²ï¼Œè¦ä¹ˆç”¨ <code>dp[i]</code>è¡¨ç¤º 0 åˆ° i ä¹‹é—´çš„å­ä¸².</p></li><li><p>æœ¬é¢˜è¦æ±‚æ¯ä¸€å¯¹<code>dp[i][j]</code>å°±è¦å·²çŸ¥<code>dp[i+1][j-1]</code>, å†æ ¹æ®<code>str[i]</code>å’Œ<code>str[j]</code>æ¥åˆ¤æ–­æœ¬æ®µæ˜¯å¦å¯¹ç§°, å¤æ‚é—®é¢˜è¢«ç®€åŒ–, é€å±‚é€å±‚æŠ›å¼ƒ.</p></li><li><p>dp çš„å¦å¤–ä¸€ä¸ªå…³é”®å°±åœ¨äºåˆå§‹åŒ–, æœ¬é¢˜å°†æ‰€æœ‰<code>dp[i][i]</code>å’Œç›¸é‚»ç›¸ç­‰çš„æ‰€æœ‰<code>dp[i][i-1]</code>èµ‹å€¼ä¸º 1</p></li><li><p>æœ¬é¢˜ä¸€ä¸ªéš¾ç‚¹åœ¨äº, æ™®é€šçš„ dp éƒ½å¯ä»¥ä»åºåˆ—å¼€å¤´é€’å½’å³å¯, æœ¬é¢˜è¦æ ¹æ®å­ä¸²çš„é•¿åº¦, ä»çŸ­åˆ°é•¿è¿›è¡Œå¾ªç¯, ä»ä¸­æ²‰æ·€å‡ºæœ€é•¿çš„ length. å³åŒºé—´ DP çš„åŸºæœ¬æ€è·¯ï¼šåŒºé—´é•¿åº¦ä½œä¸ºæœ€å¤–å±‚å¾ªç¯ï¼Œç«¯ç‚¹ä½œä¸ºå†…å±‚å¾ªç¯.</p></li></ol><h3 id="3-ä¸ªäººä»£ç -7"><a href="#3-ä¸ªäººä»£ç -7" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p><a href="https://pintia.cn/problem-sets/994805342720868352/problems/994805446102073344" target="_blank" rel="noopener">PTA-1040</a></p><pre><code class="lang-c++">for (int L = 3; L &lt;= len; ++L) {   //çº¿æ®µé•¿åº¦ç”±å°åˆ°å¤§        for (int i = 0; i &lt; len - L + 1; ++i) {  //èƒ½å¤Ÿåˆ°è¾¾çš„æœ€å³ç«¯ç‚¹            int j = i + L - 1;  //æœ¬æ¬¡ i å¯¹åº”çš„å³ç«¯ç‚¹ j            if(str[i] == str[j] &amp;&amp; dp[i+1][j-1]){  //æ›´æ–°dp                dp[i][j] = 1;                ans = L;            }        }    }</code></pre><hr><p><span id="1045"></span></p><h2 id="1045-Favorite-Color-Stripe-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—-DP"><a href="#1045-Favorite-Color-Stripe-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—-DP" class="headerlink" title="1045 Favorite Color Stripe (æœ€é•¿ä¸ä¸‹é™å­åºåˆ— DP)"></a>1045 Favorite Color Stripe (æœ€é•¿ä¸ä¸‹é™å­åºåˆ— DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-11"><a href="#1-é¢˜ç›®å¤§æ„-11" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å‡ºmä¸­é¢œè‰²ä½œä¸ºå–œæ¬¢çš„é¢œè‰²ï¼ˆåŒæ—¶ä¹Ÿç»™å‡ºé¡ºåºï¼‰ï¼Œç„¶åç»™å‡ºä¸€ä¸²é•¿åº¦ä¸ºLçš„é¢œè‰²åºåˆ—ï¼Œç°åœ¨è¦å»æ‰è¿™ä¸ªåºåˆ—ä¸­çš„ä¸å–œæ¬¢çš„é¢œè‰²ï¼Œç„¶åæ±‚å‰©ä¸‹åºåˆ—çš„ä¸€ä¸ªå­åºåˆ—ï¼Œä½¿å¾—è¿™ä¸ªå­åºåˆ—è¡¨ç¤ºçš„é¢œè‰²é¡ºåºç¬¦åˆè‡ªå·±å–œæ¬¢çš„é¢œè‰²çš„é¡ºåºï¼Œä¸ä¸€å®šè¦æ‰€æœ‰å–œæ¬¢çš„é¢œè‰²éƒ½å‡ºç°.<br>1 - N è¡¨ç¤º N ç§é¢œè‰², æ¯”å¦‚ç»™å‡º 2 3 1 5 6 è¡¨ç¤ºè‡ªå·±å–œæ¬¢çš„é¢œè‰²åºåˆ—</p><h3 id="2-åˆ†æ-8"><a href="#2-åˆ†æ-8" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>åœ¨åŸä¸²ä¸­è¦æ‰¾å‡ºç¬¦åˆ 2 3 1 5 6 é¡ºåºçš„æ‰€æœ‰å­ä¸², å¯èƒ½éœ€è¦å¤šå±‚å¾ªç¯éå†, è¿˜è¦ç”¨é¢å¤–æ•°ç»„ tmp ä¸´æ—¶è®°å½•, æ•°æ®éš¾ä»¥æ¯”è¾ƒå’Œåˆ¤æ–­, å¾ˆéº»çƒ¦. æ‰€ä»¥è€ƒè™‘è½¬åŒ–æˆæœ‰åºæ•°ç»„, ä¸€ä¸€å¯¹åº”æˆ 1 2 3 4 5, é€šè¿‡æ¯”å¤§å°å³å¯åˆ¤æ–­, ç­‰ä»·äºè½¬åŒ–æˆä¸€ä¸ª<strong>æœ€é•¿ä¸ä¸‹é™å­åºåˆ—</strong>é—®é¢˜.</p><p>ç»´æŠ¤å•è°ƒæ•°ç»„ dp, <code>dp[i]</code>è¡¨ç¤ºä» 0 - i æœ€é•¿ä¸ä¸‹é™å­åºåˆ—çš„é•¿åº¦, å¯ä»¥ DP çš„ç²¾é«“å°±åœ¨äº, æœ¬ä½ç½® i å¯¹åº”çš„<code>dp[i]</code>å¯ä»¥ç”±å‰é¢çš„<code>dp[0]</code> â€” <code>dp[i-1]</code> ç›´æ¥æ¨å‡º.</p><p>ä¸¾ä¾‹:</p><pre><code>i  2 1 5 3 6 4 8 9 7dp 1 1 2 2 3 3 4 5 4j  2 1 5 3 6 4 8 9 7</code></pre><p>æ­¤è¿‡ç¨‹ä¸­æ²‰æ·€å‡ºçš„ maxn å°±æ˜¯ 5</p><h3 id="3-ä¸ªäººä»£ç -8"><a href="#3-ä¸ªäººä»£ç -8" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><pre><code class="lang-c++">int book[201], a[10001], dp[10001];//dp[i]å†…å­˜å‚¨çš„æ˜¯, ä» 0 åˆ° i ä¸ºæ­¢æœ€é•¿çš„é•¿åº¦, ä¸ book æ— å…³int main(){    int n, m, l, tmp, maxn = -1;    cin &gt;&gt; n &gt;&gt; m;    for (int i = 1; i &lt;= m; ++i) {  //é¢œè‰²ä¸º 1-n å°†é¢œè‰²åºåˆ—æ˜ å°„ä¸º idx é€’å¢åºåˆ—        cin &gt;&gt; tmp;        book[tmp] = i;    }    cin &gt;&gt; l;    int num = 0;    for (int i = 0; i &lt; l; ++i) {  //å…³é”®ä¸€æ­¥ï¼ŒæŠŠæ‰€æœ‰é¢œè‰²è½¬åŒ–ä¸ºåºå·ï¼Œä¾æ¬¡å­˜å…¥ a ä¸­        cin &gt;&gt; tmp;        if(book[tmp] &gt;= 1){            a[num++] = book[tmp];  //a å­˜å‚¨ idx        }    }    for (int i = 0; i &lt; num; ++i) {   //ä¸å–œæ¬¢çš„é¢œè‰²ç›´æ¥å¿½ç•¥äº†,ä¸è®¡å…¥è€ƒå¯ŸèŒƒå›´        dp[i] = 1;   //æ¯æ¬¡åˆå§‹èµ‹å€¼ä¸º 1, æ£€æŸ¥ 0-i        for (int j = 0; j &lt; i; ++j) {            if(a[i] &gt;= a[j]){   //ä»¥ a ä¸ºè¯„åˆ¤æ ‡å‡†, å¤§äºç­‰äºå°±èƒ½åšä¸‹ä¸€æ­¥                dp[i] = max(dp[i], dp[j]+1);                //æ ¸å¿ƒæ€æƒ³ï¼Œå·²çŸ¥0 ~ i-1 çš„æœ€å¤§å€¼ï¼Œæ–°æ¥çš„ i æœ€å¤šæ¯”0 ~ i-1 å¤š 1            }        }        maxn = max(maxn, dp[i]);    }    cout &lt;&lt; maxn;    return 0;}</code></pre><hr><p><span id="T4861"></span></p><h2 id="TK-4861-æœ€åŸå§‹çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—-DP"><a href="#TK-4861-æœ€åŸå§‹çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—-DP" class="headerlink" title="TK 4861 æœ€åŸå§‹çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ— DP"></a>TK 4861 æœ€åŸå§‹çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ— DP</h2><h3 id="1-é¢˜ç›®å¤§æ„-12"><a href="#1-é¢˜ç›®å¤§æ„-12" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>è¾“å…¥è¾“å‡ºæ ·ä¾‹</p><pre><code>73 7 2 5 6 3 8-----4</code></pre><h3 id="2-ä¸ªäººä»£ç -1"><a href="#2-ä¸ªäººä»£ç -1" class="headerlink" title="2.ä¸ªäººä»£ç "></a>2.ä¸ªäººä»£ç </h3><p>æ ¸å¿ƒåˆ¤æ–­ <code>if(v[j] &gt; v[i]) dp[j] = max(dp[j], dp[i]+1)</code> ä¸¤å±‚å¾ªç¯, å¯¹äºæ¯ä¸ª i, ä» i ä¹‹åå¼€å§‹éå†, æ¯”å®ƒå¤§åˆ™ä¸€å®šå¯ä»¥åœ¨å®ƒçš„ dp[i] åŸºç¡€ä¸Š +1.</p><pre><code class="lang-cpp">int main(){    int n, max_len=-1;    cin &gt;&gt; n;    vector&lt;int&gt; v(n), dp(n);  // dp[i]è¡¨ç¤º 0 ~ i ç›®å‰æœ€é•¿çš„ä¸ä¸‹é™åºåˆ—é•¿åº¦    for (int i = 0; i &lt; n; ++i) {        cin &gt;&gt; v[i];        dp[i] = 1;    }    for (int i = 0; i &lt; n; ++i) {        for (int j = i; j &lt; n; ++j) {   // ä» i ä¹‹åå¼€å§‹éå†            if(v[j] &gt; v[i])                dp[j] = max(dp[j], dp[i]+1);            max_len = max(max_len, dp[j]);  // æ²‰æ·€å‡ºæœ€å¤§çš„é•¿åº¦        }    }    cout &lt;&lt; max_len;    return  0;}</code></pre><hr><p><span id="1068"></span></p><h2 id="1068-Find-More-Coins-01-èƒŒåŒ…é—®é¢˜-DP"><a href="#1068-Find-More-Coins-01-èƒŒåŒ…é—®é¢˜-DP" class="headerlink" title="1068 Find More Coins (01 èƒŒåŒ…é—®é¢˜ DP)"></a>1068 Find More Coins (01 èƒŒåŒ…é—®é¢˜ DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-13"><a href="#1-é¢˜ç›®å¤§æ„-13" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç”¨nä¸ªç¡¬å¸ä¹°ä»·å€¼ä¸ºmçš„ä¸œè¥¿ï¼Œè¾“å‡ºä½¿ç”¨æ–¹æ¡ˆï¼Œä½¿å¾—æ­£å¥½å‡ ä¸ªç¡¬å¸åŠ èµ·æ¥ä»·å€¼ä¸ºm. ä»å°åˆ°å¤§æ’åˆ—ï¼Œè¾“å‡ºæœ€å°çš„é‚£ä¸ªæ’åˆ—æ–¹æ¡ˆ</p><h3 id="2-å°è¯•-DFS"><a href="#2-å°è¯•-DFS" class="headerlink" title="2. å°è¯•(DFS)"></a>2. å°è¯•(DFS)</h3><p>æœ¬é¢˜å¯ä»¥é‡‡ç”¨é€’å½’æ–¹æ¡ˆ, DFS é€’å½’åˆ°åº•, ç›´åˆ°åˆšå¥½<code>target==0</code>å³å¯, ç±»ä¼¼äºäºŒå‰æ ‘çš„å¯»æ‰¾è·¯å¾„å’Œ. ä½†æ˜¯æŸä¸ªæµ‹è¯•ç‚¹ä¼šè¶…æ—¶.</p><p>æ ¸å¿ƒä»£ç (DFS é€’å½’):</p><pre><code class="lang-c++">bool sear(int st, int target){   //æœç´¢ st ~ n, æ¯æ¬¡ä» st æœåˆ°æœ«ä½    if(0 == target)        return true;    for (int i = st; i &lt; n; ++i) {        if(target &lt; a[i])   //åé¢çš„é¢é¢åªä¼šè¶Šæ¥è¶Šå¤§,ä¸ç”¨æœäº†(å‰ªæ)            return false;        tmp.push_back(a[i]);        if (sear(i+1, target-a[i]))  //targetå‡å»å½“å‰,å¤§ç›®æ ‡æ‹†æˆå°ç›®æ ‡            return true;   //æ‰¾åˆ°ä¸€ä¸ªä¸º true å°±ä¸ç”¨å†æœäº†,è¿”å›        else tmp.pop_back();  //sear()==false è¡¨ç¤ºèµ°ä¸é€š, popå‡ºæ¥æ¢ä¸‹ä¸€ä¸ª    }    return false;}sort(a, a+n);  //ä»å°åˆ°å¤§æ’åº, ä¾¿äºè¾“å‡ºæœ€å°çš„æ–¹æ¡ˆif(a[0] &gt; m){ printf(&quot;No Solution\n&quot;); return 0; } //é¢é¢å¤ªå¤§,ä»˜ä¸äº†å°é’±for (int i = 0; i &lt; n; ++i) {  //é€ä¸ªä½œä¸ºèµ·ç‚¹è¿›è¡Œæœç´¢    tmp.clear();    if(sear(i, m))        break;}</code></pre><h3 id="3-0-1èƒŒåŒ…é—®é¢˜-DP"><a href="#3-0-1èƒŒåŒ…é—®é¢˜-DP" class="headerlink" title="3. 0-1èƒŒåŒ…é—®é¢˜(DP)"></a>3. 0-1èƒŒåŒ…é—®é¢˜(DP)</h3><p>ç»™å®š n ç§ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º C çš„èƒŒåŒ…ï¼Œç‰©å“ i çš„é‡é‡æ˜¯ wiï¼Œå…¶ä»·å€¼ä¸º vi . </p><p>é—®ï¼šåº”è¯¥å¦‚ä½•é€‰æ‹©è£…å…¥èƒŒåŒ…çš„ç‰©å“ï¼Œä½¿å¾—è£…å…¥èƒŒåŒ…ä¸­çš„ç‰©å“çš„æ€»ä»·å€¼æœ€å¤§ï¼Ÿ<br>DP çš„é¢˜è¿˜æ˜¯è¦ç”¨ DP æ¥åš, å…³é”®åœ¨äºææ¸…æ¥šæ¯ä¸€ä¸ªæ•°ç»„çš„ä½œç”¨</p><p>ğŸ’èƒŒåŒ…é—®é¢˜çš„ç»å…¸è½¬ç§»å…¬å¼</p><pre><code class="lang-c++">if(j &gt;= w[i])    dp[i][j] = max(dp[i-1][j], dp[i-1][j-w[i]]+v[i]);else    dp[i][j] = dp[i-1][j];  //é¢å¯¹è¿™ä¸ª i ç‰©å“, ä¸æ‹¿(æˆ–è£…ä¸ä¸‹), å°±ç­‰åŒäº i-1 çš„æƒ…å†µ</code></pre><p><code>dp[i][j]</code> è¡¨ç¤º åœ¨é¢å¯¹ç¬¬ i ä»¶ç‰©å“ï¼Œä¸”èƒŒåŒ…å®¹é‡ä¸º j æ—¶æ‰€èƒ½è·å¾—çš„æœ€å¤§ä»·å€¼<br><code>dp[i-1][j-w[i]]+v[i]</code>åˆ™æ˜¯å®¹é‡ç©ºå‡º<code>w[i]</code>çš„æƒ…å†µä¸‹( i-1è¡¨ç¤ºå›æº¯ä¸€ä¸ªåºå·), è£…å…¥<code>v[i]</code>æ‰€èƒ½å¾—åˆ°çš„ä»·å€¼.</p><p><a href="#T21802">ğŸ‘†æœ€åŸºæœ¬èƒŒåŒ…: é‡‡è¯ğŸŒ¿</a></p><h3 id="4-æ­£è§£-DP"><a href="#4-æ­£è§£-DP" class="headerlink" title="4. æ­£è§£(DP)"></a>4. æ­£è§£(DP)</h3><pre><code>8 95 9 8 7 2 3 4 1</code></pre><pre><code>1 3 5</code></pre><pre><code class="lang-c++">int dp[101], choice[10001][101], w[10001];//dp[j] è¡¨ç¤ºå®¹é‡ä¸º j çš„æ—¶å€™, æœ€å¤šèƒ½è£…å¤šå°‘é’±æ•°; wä¸ºæ¯ä¸ªç¡¬å¸çš„é¢é¢//choice[i][j]=true è¡¨ç¤ºæ€»ç›®æ ‡é’±æ•°ä¸º j æ—¶, i å¯ä»¥ä½œä¸ºä¸€ä¸ªé€‰æ‹©</code></pre><p>æœ¬é¢˜ä¸æ˜¯æ±‚æœ€å¤§ä»·å€¼, åªè¦æ±‚åˆšå¥½è£…æ»¡, åªéœ€è¦åŠ ä¸€ä¸ªåˆ¤æ–­<code>if(dp[m] != m)</code>, ç„¶åä»¥ m ä¸ºç›®æ ‡, æ·»åŠ æ‰€æœ‰ choice ç­›é€‰çš„ [<strong>æ€»ç›®æ ‡é’±æ•°ä¸º m æ—¶, å¯ä»¥ä½œä¸ºä¸€ä¸ªé€‰æ‹©</strong>] çš„åºåˆ—</p><p>æœ¬é¢˜çš„åˆ¤æ–­ç²¾é«“å°±åœ¨è¿™ä¸€å¥<code>if(dp[j] &lt;= dp[j-w[i]] + w[i])</code> å«ä¹‰å°±æ˜¯, é€‰æ‹© w[i] ä¹‹å, ä¹Ÿèƒ½å‡‘å¾—å’Œ<code>dp[j]</code>ä¹‹å‰ <strong>ä¸€æ ·çš„, ç”šè‡³æ›´å¤šçš„</strong> é’±æ•°.</p><p>æœ¬é¢˜å®é™…å‘æŒ¥ä½œç”¨çš„æ—¶å€™, å°äºå·<code>&lt;</code>å®é™…å‘æŒ¥çš„ä½œç”¨å°±æ˜¯åˆå§‹åŒ–, è®©<code>dp[j]</code>ä»0å˜æˆä¸€ä¸ªæ•°å€¼, æ¯”å¦‚<code>dp[9]=9</code>, 9 çš„é¢é¢ç›´æ¥æ»¡è¶³; ç­‰äºå·<code>=</code>å®é™…å‘æŒ¥çš„ä½œç”¨å°±æ˜¯å¯»æ‰¾æ–°çš„è·¯å¾„, æ›´æ–°<code>choice[i][j]</code> è®©<code>1 3 5</code>ä¹Ÿç»„æˆè¿›æ¥.</p><p>æ¯”å¦‚, i=5 çš„æ—¶å€™, w[i]=4 å·²ç»æ›´æ–°äº† dp[9]=9, dp[5]=5, æ­¤æ—¶ j ä» m éå†é€’å‡, åˆä» 9 å¼€å§‹, æœ‰<code>dp[9] = dp[5] + w[i]</code>, å°±æŠŠ i=5, å³ w[i]=4 æ·»åŠ è¿›<code>choice[9][5] = true</code>, ä½œä¸ºè·¯å¾„ä¹‹ä¸€</p><pre><code class="lang-c++">sort(w + 1, w + n + 1, cmp);  //ä»å¤§çš„é¢é¢æ‰¾èµ·for (int i = 1; i &lt;= n; ++i) {    for (int j = m; j &gt;= w[i]; --j) {    //å®¹é‡ä» m é€’å‡,ç›´åˆ°æ¯” w[j] å°åˆ™è£…ä¸ä¸‹,å¿½ç•¥        if(dp[j] &lt;= dp[j-w[i]] + w[i]){            choice[i][j] = true;            dp[j] = dp[j-w[i]] + w[i];        }    }}if(dp[m] != m) cout &lt;&lt; &quot;No Solution&quot;;else{    int v = m, index = n;  //v è¡¨ç¤ºç›®æ ‡å®¹é‡, n è¡¨ç¤ºåˆå§‹åºå·åœ¨æœ«å°¾(ä»æœ€å°çš„é€‰èµ·)    while (v &gt; 0){        if(choice[index][v]){  //ç›®æ ‡ä¸º v çš„æ—¶å€™, w[index] å¯ä»¥ä½œä¸ºé€‰é¡¹            arr.push_back(w[index]);            v -= w[index];        }        index--;    }    //è¾“å‡º arr}</code></pre><h3 id="5-åè®°"><a href="#5-åè®°" class="headerlink" title="5. åè®°"></a>5. åè®°</h3><p>ä¸€é“åŸºç¡€çš„èƒŒåŒ…é—®é¢˜, å±…ç„¶æ€è€ƒäº†æˆ‘ä¸€æ•´ä¸ªä¸‹åˆ, ç®—æ³•åŸºç¡€çœŸçš„è–„å¼±. é‰´äºç½‘ä¸Šçš„é¢˜è§£è¦ä¹ˆä¸å¤Ÿå¤§ä½¬, ä»£ç ä¸å¤Ÿæœ€ä¼˜; è¦ä¹ˆå¤ªè¿‡äºå¤§ä½¬, è§£é‡Šå¾—å¾ˆç®€ç•¥. äºæ˜¯æˆ‘å§æœ€å¤§ä½¬çš„ä»£ç , ç”¨æœ€æ¸…æ¥šçš„è¯­è¨€è§£é‡Š, æ˜¯å¯¹è‡ªå·±æ€è·¯çš„ä¸€ä¸ªé”»ç‚¼, ä¹Ÿå¸Œæœ›å¸®åŠ©åæ¥çš„èŒæ–°ä»¬.</p><hr><p><span id="NK-zxyps"></span></p><h2 id="NK-æœ€å°é‚®ç¥¨æ•°-åŠ¨æ€è§„åˆ’ï¼Œç‰¹å®šå€¼å­åºåˆ—å’Œ"><a href="#NK-æœ€å°é‚®ç¥¨æ•°-åŠ¨æ€è§„åˆ’ï¼Œç‰¹å®šå€¼å­åºåˆ—å’Œ" class="headerlink" title="NK æœ€å°é‚®ç¥¨æ•° (åŠ¨æ€è§„åˆ’ï¼Œç‰¹å®šå€¼å­åºåˆ—å’Œ)"></a>NK æœ€å°é‚®ç¥¨æ•° (åŠ¨æ€è§„åˆ’ï¼Œç‰¹å®šå€¼å­åºåˆ—å’Œ)</h2><h3 id="1-é¢˜ç›®å¤§æ„-14"><a href="#1-é¢˜ç›®å¤§æ„-14" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>é¢˜ç›®æè¿°<br>    æœ‰è‹¥å¹²å¼ é‚®ç¥¨ï¼Œè¦æ±‚ä»ä¸­é€‰å–æœ€å°‘çš„é‚®ç¥¨å¼ æ•°å‡‘æˆä¸€ä¸ªç»™å®šçš„æ€»å€¼ã€‚     å¦‚ï¼Œæœ‰1åˆ†ï¼Œ3åˆ†ï¼Œ3åˆ†ï¼Œ3åˆ†ï¼Œ4åˆ†äº”å¼ é‚®ç¥¨ï¼Œè¦æ±‚å‡‘æˆ10åˆ†ï¼Œåˆ™ä½¿ç”¨3å¼ é‚®ç¥¨ï¼š3åˆ†ã€3åˆ†ã€4åˆ†å³å¯ã€‚<br>è¾“å…¥æè¿°:<br>    æœ‰å¤šç»„æ•°æ®ï¼Œå¯¹äºæ¯ç»„æ•°æ®ï¼Œé¦–å…ˆæ˜¯è¦æ±‚å‡‘æˆçš„é‚®ç¥¨æ€»å€¼Mï¼ŒM&lt;100ã€‚ç„¶åæ˜¯ä¸€ä¸ªæ•°Nï¼ŒNã€ˆ20ï¼Œè¡¨ç¤ºæœ‰Nå¼ é‚®ç¥¨ã€‚æ¥ä¸‹æ¥æ˜¯Nä¸ªæ­£æ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿™Nå¼ é‚®ç¥¨çš„é¢å€¼ï¼Œä¸”ä»¥å‡åºæ’åˆ—ã€‚<br>è¾“å‡ºæè¿°:<br>      å¯¹äºæ¯ç»„æ•°æ®ï¼Œèƒ½å¤Ÿå‡‘æˆæ€»å€¼Mçš„æœ€å°‘é‚®ç¥¨å¼ æ•°ã€‚è‹¥æ— è§£ï¼Œè¾“å‡º0ã€‚<br>è¾“å…¥</p><pre><code>1051 3 3 3 4</code></pre><p>è¾“å‡º</p><pre><code>3</code></pre><h3 id="2-é¢˜è§£"><a href="#2-é¢˜è§£" class="headerlink" title="2.é¢˜è§£"></a>2.é¢˜è§£</h3><p><a href="https://github.com/cowarder/Algorithms/blob/master/%E7%89%9B%E5%AE%A2/%E6%9C%80%E5%B0%8F%E9%82%AE%E7%A5%A8%E6%95%B0.cpp" target="_blank" rel="noopener">ç‰›å®¢-æœ€å°é‚®ç¥¨æ•°</a></p><hr><p><span id="1044"></span></p><h2 id="1044-Shopping-in-Mars-ç‰¹å®šå€¼å­åºåˆ—å’Œ-äºŒåˆ†æŸ¥æ‰¾"><a href="#1044-Shopping-in-Mars-ç‰¹å®šå€¼å­åºåˆ—å’Œ-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="1044 Shopping in Mars (ç‰¹å®šå€¼å­åºåˆ—å’Œ, äºŒåˆ†æŸ¥æ‰¾)"></a>1044 Shopping in Mars (ç‰¹å®šå€¼å­åºåˆ—å’Œ, äºŒåˆ†æŸ¥æ‰¾)</h2><h3 id="1-é¢˜ç›®å¤§æ„-15"><a href="#1-é¢˜ç›®å¤§æ„-15" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>æ±‚ä¸€ä¸²çš„æ•°å­—ä¸­è¿ç»­çš„ä¸€æ®µï¼Œä½¿å¾—è¿™ä¸ªè¿ç»­çš„æ®µå†…æ•°å­—çš„å’Œæ°å¥½ç­‰äºæ‰€æœŸæœ›çš„å€¼m. å¦‚æœä¸èƒ½æ‰¾åˆ°æ°å¥½ç­‰äºï¼Œå°±æ‰¾è®©è‡ªå·±ä»˜å‡ºæœ€å°‘çš„ä»·æ ¼ï¼ˆæ€»å’Œå¿…é¡»å¤§äºç­‰äºæ‰€ç»™å€¼ï¼‰çš„é‚£æ®µåŒºé—´, æ±‚æ‰€æœ‰å¯èƒ½çš„ç»“æœ.<br>ç®€è€Œè¨€ä¹‹, å°±æ˜¯æ‰¾ä¸€ä¸ªè¿ç»­å­åºåˆ—, æ°å¥½ç­‰äº target</p><h3 id="2-ä¸ªäººä»£ç -2"><a href="#2-ä¸ªäººä»£ç -2" class="headerlink" title="2. ä¸ªäººä»£ç "></a>2. ä¸ªäººä»£ç </h3><p>å› ä¸ºç»™å®šçš„é‡‘å¸åºåˆ—æ˜¯ä¹±åºçš„, è¿™é¢˜ä¸€å¼€å§‹æ²¡æƒ³åˆ°å¯ä»¥äºŒåˆ†æ³•. å…¶å®é¢˜ç›®è¦æ±‚çš„æ˜¯è¿ç»­çš„å­æ®µ, é‚£ä¹ˆå°±å¯ä»¥é€çº§å åŠ æ±‚<code>sum</code>, <code>a[j] - a[i-1]</code>å³æ˜¯ i~j è¿™ä¸€æ®µçš„å­æ®µå’Œ. è€Œè¿™ä¸ªé€çº§å åŠ çš„<code>sum</code>æ•°ç»„, å°±æ˜¯ä¸€ä¸ªå®Œç¾çš„é€’å¢åºåˆ—.</p><p>æ³¨æ„è§£é¢˜æŠ€å·§, éœ€è¦å¤šä¸ªå‚æ•°æ—¶, å¯ä»¥é‡‡ç”¨<code>int &amp;j, int &amp;temp_sum</code>å¼•ç”¨ä¼ å‚.</p><pre><code class="lang-c++">#include &lt;iostream&gt;#include &lt;stdlib.h&gt;#include &lt;vector&gt;#include &lt;map&gt;#include &lt;algorithm&gt;using namespace std;vector&lt;int&gt; sum, ans;int n, m;// ä» i å¼€å§‹, ä»¥ n ç»“å°¾çš„åºåˆ—, äºŒåˆ†æŸ¥æ‰¾// ç›®æ ‡: æ‰¾åˆ°å³ç«¯ç‚¹, åˆšå¥½æ¯”å·¦ç«¯ç‚¹å¤§ mvoid search(int i, int &amp;j, int &amp;temp_sum){    int left = i, right = n;    int target = sum[left-1] + m;    while (left &lt; right){        // ä¿ç•™å³ä¾§çš„äºŒåˆ†æŸ¥æ‰¾, ä¸æ±‚æ‰¾åˆ°è€Œé€€å‡º        // æœ€åè®© left==right æ—¶é€€å‡º, æ­¤æ—¶æ˜¯æ¯” target å¤§çš„æœ€å°æ•°        // å› ä¸º mid å°äº†çš„æ—¶å€™, æ€»æ˜¯èˆå¼ƒå·¦ç«¯ç‚¹, mid å¤§äº†çš„æ—¶å€™, å³ç«¯ç‚¹è¢«ä¿ç•™        int mid = (left+right)/2;        if(sum[mid] &lt; target)            left = mid + 1;        else            right = mid;    }    j = right;    temp_sum = sum[right] - sum[i-1];}int main(){    cin &gt;&gt; n &gt;&gt; m;    sum.resize(n+1);    sum[0] = 0;    for (int i = 1; i &lt;= n; ++i) {  //è½¬åŒ–ä¸ºé€’å¢åºåˆ—, å¾—ä»¥åº”ç”¨äºŒåˆ†, æé«˜æ•ˆç‡        cin &gt;&gt; sum[i];        sum[i] += sum[i-1];    }    int min_ans = sum[n];  //æ±‚æ¯” m å¤§çš„æœ€å°å’Œ    for (int i = 1; i &lt;= n; ++i) {        int j=0, temp_sum=0;  //ä»…ä»…ä½œä¸ºå‚æ•°ä¼ å›æ¥è€Œå·²        search(i, j, temp_sum);        if(temp_sum &lt; m) continue;        else{            if(temp_sum &lt; min_ans){                min_ans = temp_sum;                ans.clear();                ans.push_back(i);                ans.push_back(j);            }            else if (temp_sum == min_ans){                ans.push_back(i);                ans.push_back(j);            }        }    }    for (int i = 0; i &lt; ans.size(); i += 2) {        cout &lt;&lt; ans[i] &lt;&lt; &quot;-&quot; &lt;&lt; ans[i+1] &lt;&lt; endl;    }    return 0;}</code></pre><hr><p><span id="1085"></span></p><h2 id="1085-Perfect-Sequence-äºŒåˆ†æŸ¥æ‰¾-upper-bound-åŒæŒ‡é’ˆ"><a href="#1085-Perfect-Sequence-äºŒåˆ†æŸ¥æ‰¾-upper-bound-åŒæŒ‡é’ˆ" class="headerlink" title="1085 Perfect Sequence (äºŒåˆ†æŸ¥æ‰¾, upper-bound, åŒæŒ‡é’ˆ)"></a>1085 Perfect Sequence (äºŒåˆ†æŸ¥æ‰¾, upper-bound, åŒæŒ‡é’ˆ)</h2><h3 id="1-é¢˜ç›®å¤§æ„-16"><a href="#1-é¢˜ç›®å¤§æ„-16" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>è®¾è¿™ä¸ªæ•°åˆ—ä¸­çš„æœ€å¤§å€¼æ˜¯Mï¼Œæœ€å°å€¼æ˜¯mï¼Œå¦‚æœM &lt;= m * pï¼Œåˆ™ç§°è¿™ä¸ªæ•°åˆ—æ˜¯å®Œç¾æ•°åˆ—. ç°åœ¨ç»™å®šä¸€ä¸ªåºåˆ—, æ±‚æ»¡è¶³å®Œç¾åºåˆ—çš„æœ€é•¿å­åºåˆ—é•¿åº¦</p><h3 id="2-äºŒåˆ†æ³•"><a href="#2-äºŒåˆ†æ³•" class="headerlink" title="2.äºŒåˆ†æ³•"></a>2.äºŒåˆ†æ³•</h3><p>æœ¬é¢˜å¯ä»¥åº”ç”¨ upper_bound æ¥æŸ¥æ‰¾, æ—¢ç„¶è¦æ±‚æ»¡è¶³æœ€å¤§çš„<code>max &lt;= p*min</code>, é‚£ä¹ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ª<code>max &gt; p*min</code>å³å¯, å³æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºtarget çš„å…ƒç´ .</p><p><strong>upper-bound ä»£ç </strong></p><pre><code class="lang-c++">int bin_sear_upper(int left, int right, int target){    int mid;    while (left &lt; right){        mid = (left+right)/2;        if(a[mid] &gt; target)            right = mid;        else            left = mid + 1;    }    return right;}</code></pre><p>å…³é”®ç‚¹ 1: <code>left &lt; right</code>åˆ°æœ€åå¿…ç„¶ä¼šå¤¹å‡º left==right è¿”å›å³å¯.</p><p>å…³é”®ç‚¹ 2: å…ˆåˆ¤æ–­<code>&gt;</code>, è®©<code>right = mid</code>ç›®çš„æ˜¯å°½å¯èƒ½ä¿ç•™å¤§æ•°,<code>left = mid + 1</code>å°æ•°ä¸ä¿ç•™æ— æ‰€è°“.</p><p><strong>lower-bound ä»£ç </strong></p><pre><code class="lang-c++">if(a[mid] &gt;= target)    right = mid;else    left = mid + 1;</code></pre><p>åªéœ€æ¢ä¸º<code>&gt;=</code>å³å¯, å…¶ä»–å®Œå…¨ä¸€æ ·, ä¹Ÿæ˜¯ä¿å¤§.</p><p>æ¯”å¦‚ 3 4 5 5 7 8 8 8 9, target ä¸º 8.<br>upper_bound æ‰¾åˆ°çš„ä¸º 3 4 5 5 7 [8] 8 8 9, lower_bound æ‰¾åˆ°çš„ä¸º 3 4 5 5 7 8 8 8 [9].</p><p><strong>æ™®é€šçš„æŸ¥æ‰¾å®šå€¼</strong><br><code>if(a[mid]==target)</code>, éœ€è¦<code>left &lt;= right</code>ä½œä¸ºæ¡ä»¶, æ‰¾ä¸åˆ°å°±è¿”å›-1</p><pre><code class="lang-cpp">while(low &lt;= high){    int mid = (low + high)/2;    if(array[mid] &lt; key)        low = mid + 1;    else if(array[mid] &gt; key)        high = mid - 1;    else        return mid;}return -1;</code></pre><p>è¿™ä¸‰ç§äºŒåˆ†æ³•åŸºæœ¬å¯ä»¥æ¶µç›–æ‰€æœ‰äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨.</p><h3 id="3-ä¸ªäººä»£ç -9"><a href="#3-ä¸ªäººä»£ç -9" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><pre><code class="lang-c++">int search(int left, long long target){  // å¯»æ‰¾æ¯” target å°çš„æœ€å¤§æ•° upper_bound    int right = n-1, mid;    if(a[right] &lt;= target){  //æœ€å¤§çš„æ¯” target å°        return right;    }    while (left &lt; right){        mid = (left + right)/2;        if(a[mid] &gt; target)            right = mid;        else            left = mid + 1;    }    return right-1;  // æœ€å left==right æ‰¾åˆ°çš„æ˜¯ç¬¬ä¸€ä¸ªæ¯” tar å¤§çš„æ•°, -1 å³å¯}</code></pre><p>åº”ç”¨çš„æ˜¯ upper_bound, <code>right-1</code>å³å¯å¾—åˆ°æ»¡è¶³<code>max &lt;= p*min</code>çš„æœ€å¤§æ•°å­—.</p><h3 id="4-å‘ç‚¹-1"><a href="#4-å‘ç‚¹-1" class="headerlink" title="4. å‘ç‚¹"></a>4. å‘ç‚¹</h3><ol><li><code>æ®µé”™è¯¯</code> æ•°ç»„å¼€çš„ä¸å¤Ÿå¤§, é€’å½’è°ƒç”¨è¿‡å¤š</li><li><code>ç­”æ¡ˆé”™è¯¯</code> å‘ç°å­˜åœ¨æº¢å‡º, int æœ€å¤§ç®¡åˆ° $10^9$, æ­¤é¢˜ä¹˜èµ·æ¥ä¹‹åä¼šè¶…è¿‡, è¦ç”¨ long long !</li></ol><h3 id="5-Two-points-åŒæŒ‡é’ˆæ³•"><a href="#5-Two-points-åŒæŒ‡é’ˆæ³•" class="headerlink" title="5. Two points åŒæŒ‡é’ˆæ³•"></a>5. Two points åŒæŒ‡é’ˆæ³•</h3><p>ç¬é—´éå¸¸ç®€å•</p><pre><code class="lang-c++">    sort(v.begin(), v.end());    int result = 0, temp = 0;    for (int i = 0; i &lt; n; i++) {        for (int j = i + result; j &lt; n; j++) {          //result å·²ç»æ˜¯æœ€é•¿äº†, ä¹‹åçš„ç›´æ¥ä» result ä»¥ä¸Šçš„æ‰¾èµ·            if (v[j] &lt;= v[i] * p) {                temp = j - i + 1;                if (temp &gt; result)                    result = temp;            } else {                break;            }        }    }    cout &lt;&lt; result;</code></pre><p><img src="https://i.loli.net/2020/02/09/2OERK3tFJve4YDH.gif" data-original="https://i.loli.net/2020/02/12/Buth7AGTcCpPonS.png" alt="æ•ˆç‡å¯¹æ¯”å·®è·æ˜æ˜¾" width="140" height="180"/></p><hr><p><span id="1029"></span></p><h2 id="1029-Median-æ‰¾ä¸­ä½æ•°-è®¡æ•°æ’åº"><a href="#1029-Median-æ‰¾ä¸­ä½æ•°-è®¡æ•°æ’åº" class="headerlink" title="1029 Median (æ‰¾ä¸­ä½æ•° è®¡æ•°æ’åº)"></a>1029 Median (æ‰¾ä¸­ä½æ•° è®¡æ•°æ’åº)</h2><h3 id="1-é¢˜ç›®å¤§æ„-17"><a href="#1-é¢˜ç›®å¤§æ„-17" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><hr><p><span id="1143"></span></p><h2 id="1143-Lowest-Common-Ancestor-æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ"><a href="#1143-Lowest-Common-Ancestor-æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ" class="headerlink" title="1143 Lowest Common Ancestor (æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ)"></a>1143 Lowest Common Ancestor (æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ)</h2><h3 id="1-é¢˜ç›®å¤§æ„-18"><a href="#1-é¢˜ç›®å¤§æ„-18" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šäºŒå‰æœç´¢æ ‘ BST çš„ pre å‰åºéå†, å†ç»™å®šä¸€å¯¹ U,V æ±‚ U,V çš„ LCA</p><h3 id="2-åˆ†æ-9"><a href="#2-åˆ†æ-9" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>æœ¬é¢˜æœ‰ä¸¤ä¸ªç‰¹æ®Šæ¡ä»¶, ä¸€ä¸ªæ˜¯<code>BST</code>, å½¢å¼æ˜¯<code>å·¦è¾¹å°å³è¾¹å¤§</code>, ä¸€ä¸ªæ˜¯<code>å‰åºéå†pre</code>, å¯¹äºæ•°ç»„å½¢å¼çš„ pre åºåˆ—, å½¢å¼æ˜¯<code>æ ¹å·¦å³</code>. æ‰€ä»¥åªéœ€è¦ u,v åˆ†åˆ«åœ¨ a çš„ä¸¤ç«¯, ä¸€ä¸ªæ¯” a å¤§, ä¸€ä¸ªæ¯” a å°, a å°±æ˜¯å…¬å…±ç¥–å…ˆ. å½“ <code>a==u || a==v æ—¶</code>, è°åœ¨å‰è°å°±æ˜¯ç¥–å…ˆ</p><h3 id="3-ä»£ç "><a href="#3-ä»£ç " class="headerlink" title="3. ä»£ç "></a>3. ä»£ç </h3><pre><code class="lang-cpp">map&lt;int, bool&gt; mp;int main() {    int m, n, u, v, a;    scanf(&quot;%d %d&quot;, &amp;m, &amp;n);    vector&lt;int&gt; pre(n);    for (int i = 0; i &lt; n; i++) {        scanf(&quot;%d&quot;, &amp;pre[i]);        mp[pre[i]] = true;    }    for (int i = 0; i &lt; m; i++) {        scanf(&quot;%d %d&quot;, &amp;u, &amp;v);        for(int j = 0; j &lt; n; j++) {            a = pre[j];            if ((a &gt;= u &amp;&amp; a &lt;= v) || (a &gt;= v &amp;&amp; a &lt;= u)) break;        }         if (mp[u] == false &amp;&amp; mp[v] == false)            printf(&quot;ERROR: %d and %d are not found.\n&quot;, u, v);        else if (mp[u] == false || mp[v] == false)            printf(&quot;ERROR: %d is not found.\n&quot;, mp[u] == false ? u : v);        else if (a == u || a == v)            printf(&quot;%d is an ancestor of %d.\n&quot;, a, a == u ? v : u);        else            printf(&quot;LCA of %d and %d is %d.\n&quot;, u, v, a);    }    return 0;}</code></pre><hr><p><span id="1071"></span></p><h2 id="1071-Speech-Patterns-è¯é¢‘ç»Ÿè®¡"><a href="#1071-Speech-Patterns-è¯é¢‘ç»Ÿè®¡" class="headerlink" title="1071 Speech Patterns (è¯é¢‘ç»Ÿè®¡)"></a>1071 Speech Patterns (è¯é¢‘ç»Ÿè®¡)</h2><h3 id="1-é¢˜ç›®å¤§æ„-19"><a href="#1-é¢˜ç›®å¤§æ„-19" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸€è¡Œå¥å­, ç»Ÿè®¡å‡ºç°é¢‘ç‡æœ€é«˜çš„ word. word å®šä¹‰ä¸ºä»…åŒ…å«<code>0-9 A-Z a-z</code>çš„è¿ç»­ä¸². å¦‚æœæœ‰ç›¸åŒè¯é¢‘, å°±è¾“å‡ºå­—å…¸åºæœ€å°çš„.</p><pre><code>Can1: &quot;Can a can can a can?  It can!&quot;</code></pre><pre><code>can 5</code></pre><h3 id="2-ä¸ªäººä»£ç -3"><a href="#2-ä¸ªäººä»£ç -3" class="headerlink" title="2. ä¸ªäººä»£ç "></a>2. ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">map&lt;string, int&gt; m;  //ä¼šæŒ‰ç…§é”®çš„å­—å…¸åºæ’åºint main(){    string str, t;    int maxn=-1, i=0;    getline(cin, str);    for (auto &amp;c : str) {        i++;        if(isalnum(c)){            t += tolower(c);        }        if(!isalnum(c) || i==str.length()){ //ç¢°åˆ°é—´éš™æˆ–è€…ç»“å°¾æ—¶, è¿›è¡Œè®¡æ•°            if(t.length()) m[t]++;            t = &quot;&quot;;        }    }    for(auto it=m.begin(); it!=m.end(); it++){        if(it-&gt;second &gt; maxn){            maxn = it-&gt;second;            t = it-&gt;first;        }    }    cout &lt;&lt; t &lt;&lt; &quot; &quot; &lt;&lt; maxn;    return 0;}</code></pre><hr><p><span id="T21802"></span></p><h2 id="TK-21802-é‡‡è¯-æœ€åŸºç¡€çš„å®¹é‡-ä»·å€¼æœ€å¤§åŒ–-èƒŒåŒ…é—®é¢˜-DP"><a href="#TK-21802-é‡‡è¯-æœ€åŸºç¡€çš„å®¹é‡-ä»·å€¼æœ€å¤§åŒ–-èƒŒåŒ…é—®é¢˜-DP" class="headerlink" title="TK 21802  é‡‡è¯ (æœ€åŸºç¡€çš„å®¹é‡-ä»·å€¼æœ€å¤§åŒ–, èƒŒåŒ…é—®é¢˜, DP)"></a>TK 21802  é‡‡è¯ (æœ€åŸºç¡€çš„å®¹é‡-ä»·å€¼æœ€å¤§åŒ–, èƒŒåŒ…é—®é¢˜, DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-20"><a href="#1-é¢˜ç›®å¤§æ„-20" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p><strong>è¾“å…¥</strong><br>è¾“å…¥çš„ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•°Tï¼ˆ1 &lt;= T &lt;= 1000ï¼‰å’ŒMï¼ˆ1 &lt;= M &lt;= 100ï¼‰ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼ŒTä»£è¡¨æ€»å…±èƒ½å¤Ÿç”¨æ¥é‡‡è¯çš„æ—¶é—´ï¼ŒMä»£è¡¨å±±æ´é‡Œçš„è‰è¯çš„æ•°ç›®. æ¥ä¸‹æ¥çš„Mè¡Œæ¯è¡ŒåŒ…æ‹¬ä¸¤ä¸ªåœ¨1åˆ°100ä¹‹é—´ï¼ˆåŒ…æ‹¬1å’Œ100ï¼‰çš„æ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºé‡‡æ‘˜æŸæ ªè‰è¯çš„æ—¶é—´å’Œè¿™æ ªè‰è¯çš„ä»·å€¼.<br><strong>è¾“å‡º</strong><br>è¾“å‡ºåŒ…æ‹¬ä¸€è¡Œï¼Œè¿™ä¸€è¡ŒåªåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œå¯ä»¥é‡‡åˆ°çš„è‰è¯çš„æœ€å¤§æ€»ä»·å€¼.</p><pre><code>70 371 10069 11 2------3</code></pre><h3 id="2-æ–¹æ³•ä¸€"><a href="#2-æ–¹æ³•ä¸€" class="headerlink" title="2.æ–¹æ³•ä¸€"></a>2.æ–¹æ³•ä¸€</h3><p>æœ¬é¢˜åªéœ€ä½¿ç”¨æœ€æœ€ç»å…¸åŸå§‹çš„èƒŒåŒ…é—®é¢˜è½¬ç§»å…¬å¼å³å¯</p><pre><code class="lang-cpp">int v[110], t[110], dp[110][1010];  // dp[i][j] è¡¨ç¤ºé¢å¯¹ç¬¬ i ä¸ª,å®¹é‡ä¸º j æ—¶ çš„æœ€å¤§ä»·å€¼int main(){    int T, m;   // T æ€»æ—¶é—´, m ä¸ªè¯è‰    cin &gt;&gt; T &gt;&gt; m;    for (int i = 1; i &lt;= m; ++i) {        cin &gt;&gt; t[i] &gt;&gt; v[i];    }    for (int i = 1; i &lt;= m; ++i) {        for (int j = 0; j &lt;= T; ++j) {            if(j &gt;= t[i])                dp[i][j] = max(dp[i-1][j-t[i]] + v[i], dp[i-1][j]);            else                dp[i][j] = dp[i-1][j];  // i-1 è¡¨ç¤ºä¸æ‹¿è¿™ä¸€ä¸ªè‰è¯, ç›¸å½“äºæ²¡ç¢°è§å‰        }    }    cout &lt;&lt; dp[m][T];    return  0;}</code></pre><p>å‘ç‚¹: ä¸€å®šè¦æ³¨æ„ dp æ•°ç»„çš„èŒƒå›´, 1010 ä¸èƒ½å¼€å°äº†</p><h3 id="3-æ–¹æ³•äºŒ"><a href="#3-æ–¹æ³•äºŒ" class="headerlink" title="3.æ–¹æ³•äºŒ"></a>3.æ–¹æ³•äºŒ</h3><p>ä¸€ç»´æ•°ç»„ dp, æ— éœ€æ¯ä¸€ä¸ªå®¹é‡é¢å¯¹æ¯ä¸€ä¸ªç‰©å“, åªéœ€è®¾å®š dp[x] è¡¨ç¤ºå®¹é‡ä¸º x æ—¶çš„æœ€å¤§ä»·å€¼. çŠ¶æ€è½¬ç§»æ–¹ç¨‹:<br><code>dp[v] = max (dp[v] , dp[v - t[i]] + v[i])</code><br>å…¶ä¸­ t[i] è¡¨ç¤ºè‰è¯çš„é‡‡é›†æ—¶é—´ ï¼Œ v[i] æŒ‡è‰è¯çš„ä»·å€¼.</p><pre><code class="lang-cpp">const int maxv=1010,maxn=110;int dp[maxv], t[maxn], v[maxn];...    for(int i=1;i&lt;=n;++i)        for(int x = T; x &gt;= t[i]; --x)  //ä» T å¼€å§‹éå†            dp[x] = max(dp[x], dp[x-t[i]] + v[i]);  //è£… or ä¸è£…    for(int x = 0; x &lt;= T; ++x)        if(dp[x] &gt; max)            max = dp[x];...}</code></pre><hr><p><span id="H1130"></span></p><h2 id="H1130-åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„-èƒŒåŒ…é—®é¢˜-DP"><a href="#H1130-åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„-èƒŒåŒ…é—®é¢˜-DP" class="headerlink" title="H1130 åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„ (èƒŒåŒ…é—®é¢˜ DP)"></a>H1130 åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„ (èƒŒåŒ…é—®é¢˜ DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-21"><a href="#1-é¢˜ç›®å¤§æ„-21" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>å°æ˜ç­é‡Œè¦ä¸¾è¡Œä¸€æ¬¡æ‹”æ²³æ¯”èµ›ï¼Œç­ä¸»ä»»å†³å®šå°†æ‰€æœ‰äººåˆ†ä¸ºä¸¤é˜Ÿï¼Œæ¯ä¸ªäººéƒ½å¿…é¡»å‚åŠ . ä¸¤ä¸ªé˜Ÿä¼çš„äººæ•°ä¹‹å·®ä¸èƒ½è¶…è¿‡1ï¼Œå¹¶ä¸”ä¸¤ä¸ªé˜Ÿä¼çš„ä½“é‡ä¹‹å’Œ<code>è¦å°½å¯èƒ½ç›¸è¿‘</code>ï¼Œå½“ç„¶ç›¸åŒæ˜¯æœ€å¥½çš„äº†. åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªé˜Ÿä¼çš„ä½“é‡ä¹‹å’Œï¼ŒæŒ‰å‡åºæ’åº.</p><p>ç®€è€Œè¨€ä¹‹, å°†ä¸€ä¸ªæ•°ç»„åˆ†æˆä¸¤ä¸ªå°½å¯èƒ½æ¥è¿‘çš„å­æ•°ç»„.</p><h3 id="2-åˆ†æ-10"><a href="#2-åˆ†æ-10" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>æœ‰ä¸€ç³»åˆ—å…ƒç´ , è®©è¿™äº›å…ƒç´ å°½å¯èƒ½åœ°æ¥è¿‘ä¸€ä¸ªç›®æ ‡å€¼, è¿™å°±æ˜¯å…¸å‹çš„èƒŒåŒ… DP é—®é¢˜. æœ¬é¢˜çš„å…³é”®åœ¨äº, åªç ”ç©¶ä¸€ä¸ªæ•°ç»„, è®©å®ƒå°½å¯èƒ½æ¥è¿‘ sum/2 å³å¯, å¦ä¸€ä¸ªå°±ä¸å®ƒæœ€æ¥è¿‘.</p><h3 id="3-æ ¸å¿ƒä»£ç "><a href="#3-æ ¸å¿ƒä»£ç " class="headerlink" title="3. æ ¸å¿ƒä»£ç "></a>3. æ ¸å¿ƒä»£ç </h3><pre><code class="lang-cpp">int sum = 0;int a[n+1];for (int i = 1; i &lt;= n; ++i) {    cin &gt;&gt; a[i];    sum += a[i];}vector&lt;int&gt; dp(sum);  //dp[i]è¡¨ç¤ºå®¹é‡ä¸º i æ—¶èƒ½è£…ä¸‹çš„æ€»é‡fill(dp.begin(), dp.end(), 0);for (int i = 1; i &lt;= n; i++){  //é¢å¯¹ç¬¬ i ä¸ªçš„æ—¶å€™    for (int j = sum/2; j &gt;= a[i]; j--){  //å®¹é‡ä»ç›®æ ‡å¼€å§‹å‡å°‘        dp[j] = max(dp[j], dp[j-a[i]] + a[i]); //æ ‡å‡†è½¬ç§»å…¬å¼    }}int tmp = max(dp[sum/2], sum-dp[sum/2]);printf(&quot;%d %d\n&quot;, sum-tmp, tmp);</code></pre><p>æ­¤ç¨‹åºçš„ç›®çš„, å°±æ˜¯ç»™å®šä¸€ä¸ª target=sum/2, è®©å…ƒç´ é€šè¿‡å„ç§ç»„åˆ, å»æ— é™é€¼è¿‘ target.</p><p>å¯¹äº<code>dp[j-a[i]] + a[i])</code>è¦ç†è§£æ¸…æ¥š, è¡¨ç¤º<code>å·²çŸ¥</code>ç©ºå‡º a[i] åçš„æœ€å¤§å®¹é‡, å†åŠ å…¥ a[i] çœ‹æ•ˆæœ. å› ä¸ºå¯¹äºæ¯ä¸€ç§å®¹é‡, ä¸å¯èƒ½éƒ½ä¼š<code>æ°å¥½è£…æ»¡</code>, æ‰€ä»¥ dp[5] å¯èƒ½ç­‰äº 3, é‚£ä¹ˆé¢å¯¹ä¸€ä¸ª 4, dp[9] å°±ç­‰äº 3+4=7.</p><h3 id="4-è®°å¿†ç‚¹"><a href="#4-è®°å¿†ç‚¹" class="headerlink" title="4. è®°å¿†ç‚¹"></a>4. è®°å¿†ç‚¹</h3><ul><li><p>ä¸¤å±‚å¾ªç¯, å¤–å±‚ä¸€ä»¶ä»¶ç‰©å“éå†, <code>for (int i = 1; i &lt;= n; i++)</code>, å†…å±‚ä»ç›®æ ‡å®¹é‡é€’å‡ (å®¹é‡æ˜¯è¿ç»­å€¼) <code>for (int j = sum/2; j &gt;= a[i]; j--)</code>, ç›´åˆ°è£…ä¸ä¸‹ä¸ºæ­¢.</p></li><li><p>è½¬ç§»å…¬å¼<code>dp[j] = max(dp[j], dp[j-a[i]] + a[i]);</code>, å¯¹åº”ä¸¤ç§æƒ…å†µ, <code>çœ‹è§äº† a[i] ä½†ä¸è£…</code>, å’Œ <code>è£…ä¸‹ a[i]</code></p></li><li><p>æ­¤å¤„ä½¿ç”¨ä¸€ä½æ•°ç»„ dp, å’ŒäºŒç»´ dp æ•°ç»„åŒºåˆ«å¼€</p></li></ul><hr><p><span id="1067"></span></p><h2 id="1067-Sort-with-Swap-0-i-è´ªå¿ƒ-å…ƒç´ å½’ä½"><a href="#1067-Sort-with-Swap-0-i-è´ªå¿ƒ-å…ƒç´ å½’ä½" class="headerlink" title="1067 Sort with Swap(0, i) (è´ªå¿ƒ, å…ƒç´ å½’ä½)"></a>1067 Sort with Swap(0, i) (è´ªå¿ƒ, å…ƒç´ å½’ä½)</h2><h3 id="1-é¢˜ç›®å¤§æ„-22"><a href="#1-é¢˜ç›®å¤§æ„-22" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸€ä¸ª 0~n-1 çš„ä¹±åºåºåˆ—, æ¯æ¬¡åªèƒ½ç”¨ 0 ä¸æŸä¸ªæ•°äº¤æ¢, æ±‚éœ€è¦äº¤æ¢å¤šå°‘æ¬¡æ‰èƒ½å½’ä½.</p><pre><code>103 5 7 2 6 4 9 0 8 1</code></pre><pre><code>9</code></pre><h3 id="2-åˆ†æ-11"><a href="#2-åˆ†æ-11" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h3><p>åŸºæœ¬æ€è·¯: æŠŠ 0 å½“åšå“¨å…µ, æ ¹æ® 0 å¤„åœ¨çš„ä½ç½® i , æ¯æ¬¡è®© 0 ä¸åŸæœ¬åº”å¤„äº i çš„é‚£ä¸ªæ•°å»äº¤æ¢. å¦‚æœ 0 å·²ç»å½’ä½, åˆ™é¡ºæ¬¡æŸ¥æ‰¾ä¸‹ä¸€ä¸ªä¸åœ¨æœ¬ä½çš„è¿›è¡Œäº¤æ¢.</p><p>ä¸€å¼€å§‹çš„åšæ³•æ˜¯, ç»´æŠ¤åŸæ¥çš„æ•°ç»„, æ¯æ¬¡ for å¾ªç¯éå†æŸ¥æ‰¾å¯¹åº”çš„é‚£ä¸ªæ•°, ç»“æœè¶…æ—¶/å‡ºé”™.</p><p>æœ¬é¢˜å·§å¦™ä¹‹å¤„åœ¨äº, ç”±äºæ•°ç»„æ˜¯ä¸€ä¸ª 0~n-1 çš„æ— é‡å¤æ•°ç»„, ä¸ä¸€å®šè¦ä¿å­˜å€¼çš„æ•°ç»„, è€Œæ˜¯ä¿å­˜ä¸€ä¸ªç´¢å¼•çš„æ•°ç»„, å› ä¸º swap ç›®çš„å°±æ˜¯è¦äº¤æ¢ä½ç½®, <code>äº¤æ¢ç´¢å¼•</code>è€Œå·². äº¤æ¢ç´¢å¼•å, ä¸éœ€è¦éå†æŸ¥æ‰¾å¯¹åº”æ•°, å› ä¸º a[0] å°±æ˜¯ 0 æ‰€å¤„åœ¨çš„ä½ç½®index, äº¤æ¢ a[0] å’Œ a[a[0]] å³å¯.</p><h3 id="3-ä¸ªäººä»£ç -10"><a href="#3-ä¸ªäººä»£ç -10" class="headerlink" title="3. ä¸ªäººä»£ç "></a>3. ä¸ªäººä»£ç </h3><p>ä¸€ä¸ª n çš„ for å¾ªç¯, å½“ n ä¸ªéƒ½æ»¡è¶³<code>a[i] != i</code>å°±ç»“æŸ</p><pre><code class="lang-cpp">vector&lt;int&gt; a(n);for (int i = 0; i &lt; n; ++i) {    cin &gt;&gt; t;    a[t] = i;   // t å¯¹åº”çš„ç´¢å¼•}for (int i = 1; i &lt; n; ++i) {  //a[0] å³ 0 å¯¹åº”çš„ç´¢å¼•, æ¯æ¬¡æ‹¿ 0 äº¤æ¢    while (a[0] != 0){        swap(a[0], a[a[0]]);   //å¯ä»¥ä¸€ç›´æ¢ 0 çš„ç´¢å¼•        cnt++;    }    if (a[i] != i){   //0 æš‚æ—¶å½’ä½,åˆ™åˆ¤æ–­å½“å‰ i æ˜¯å¦å½’ä½        swap(a[0], a[i]);        cnt++;    }}</code></pre><hr><p><span id="1100"></span></p><h2 id="1100-Complete-Binary-Tree-åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘-å±‚åºéå†"><a href="#1100-Complete-Binary-Tree-åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘-å±‚åºéå†" class="headerlink" title="1100 Complete Binary Tree (åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘, å±‚åºéå†)"></a>1100 Complete Binary Tree (åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘, å±‚åºéå†)</h2><h3 id="1-é¢˜ç›®å¤§æ„-23"><a href="#1-é¢˜ç›®å¤§æ„-23" class="headerlink" title="1. é¢˜ç›®å¤§æ„"></a>1. é¢˜ç›®å¤§æ„</h3><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘, åˆ¤æ–­æ˜¯ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘</p><pre><code>97 8- -- -- -0 12 34 5- -- -</code></pre><h3 id="2-å°è¯•å±‚åºéå†"><a href="#2-å°è¯•å±‚åºéå†" class="headerlink" title="2.å°è¯•å±‚åºéå†"></a>2.å°è¯•å±‚åºéå†</h3><p>å±‚åºéå†åˆ†å±‚è¾“å‡º: æ·»åŠ ä¸€ä¸ª<code>cur_len</code>è¡¨ç¤ºæœ¬å±‚ç›®å‰çš„é•¿åº¦, <code>cur_len</code>é€šè¿‡<code>next_level</code>æ¥ç»´æŠ¤, æ¯æ·»åŠ ä¸€ä¸ªå­èŠ‚ç‚¹è¿›å…¥é˜Ÿåˆ—, å°±<code>next_level++</code>, æ¯ pop ä¸€ä¸ªèŠ‚ç‚¹, å°±<code>cur_len--</code>. ç›´åˆ°<code>cur_len==0</code> è¡¨ç¤ºä¸€å±‚çš„ç»“æŸ, å¯ä»¥åšä¸€ä¸ªå°ç»“äº†.</p><pre><code class="lang-cpp">q.push(root);    int next_level = 0, cur_len = 1, no=-1;    vector&lt;int&gt; lev;    lev.push_back(1);    while (!q.empty()){        no = q.front();        cur_len--;  //æœ¬å±‚å‡ 1        if(v[no].left != -1){            next_level++;            q.push(v[no].left);        }        if(v[no].right != -1){            next_level++;            q.push(v[no].right);        }        if(cur_len == 0){   //æœ¬å±‚ç»“æŸ            if(next_level) lev.push_back(next_level);            else break;            cur_len = next_level; //æ›´æ–°ä¸ºä¸‹ä¸€å±‚çš„é•¿åº¦            next_level = 0;        }        q.pop();    }</code></pre><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªèƒ½åˆ¤æ–­å‰å‡ å±‚æ˜¯å¦æ»¡è¶³ 1, 2, 4, 8 çš„è§„å¾‹, æ— æ³•åˆ¤æ–­æœ€åä¸€å±‚.</p><h3 id="3-æ­£ç¡®è§£æ³•"><a href="#3-æ­£ç¡®è§£æ³•" class="headerlink" title="3.æ­£ç¡®è§£æ³•"></a>3.æ­£ç¡®è§£æ³•</h3><p>é€’å½’å‡ºæœ€å¤§çš„ä¸‹æ ‡å€¼ï¼Œå®Œå…¨äºŒå‰æ ‘ä¸€å®šæŠŠå‰é¢çš„ä¸‹æ ‡å……æ»¡ï¼š æœ€å¤§çš„ä¸‹æ ‡å€¼ == æœ€å¤§çš„èŠ‚ç‚¹æ•°ï¼›ä¸å®Œå…¨äºŒå‰æ ‘å‰æ»¡ä¸€å®šæœ‰ä½ç½®æ˜¯ç©ºï¼Œä¼šå¾€åæŒ¤ï¼š æœ€å¤§çš„ä¸‹æ ‡å€¼ &gt; æœ€å¤§çš„èŠ‚ç‚¹æ•°.</p><pre><code class="lang-cpp">struct node{    int left=-1, right=-1;};int maxn = -1, last;  //è®°å½•æœ€å¤§ä¸‹æ ‡, æœ€åä¸€ä¸ªå…ƒç´ ä¸‹æ ‡void dfs(int nod, int index){    if(index &gt; maxn){        maxn = index;        last = nod;    }    if(v[nod].left != -1)        dfs(v[nod].left, index*2+1);    if(v[nod].right != -1)        dfs(v[nod].right, index*2+2);}dfs(root, 0);if(maxn == n-1)    cout &lt;&lt; &quot;YES &quot; &lt;&lt; last;else    cout &lt;&lt; &quot;NO &quot; &lt;&lt; root;</code></pre><h3 id="4-å‘ç‚¹-2"><a href="#4-å‘ç‚¹-2" class="headerlink" title="4.å‘ç‚¹"></a>4.å‘ç‚¹</h3><p>æ³¨æ„ä¼šå‡ºç°<code>æ®µé”™è¯¯</code>, ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æ•°ç»„å¼€çš„ä¸å¤Ÿå¤§, ç»“æœå‘ç°è¿™ä¸ªé¢˜çœŸæ˜¯çŠ¯äº†ä¸€ä¸ªä½çº§çš„é”™è¯¯ï¼Œæˆ‘å¼€å§‹ç”¨å­—ç¬¦å˜é‡æ¥è¾“å…¥ï¼Œç„¶è€Œä¸€ä¸ªå­—ç¬¦å˜é‡åªèƒ½èµ‹ä¸€ä¸ªæ•°å­—ï¼Œæ‰€ä»¥å¦‚æœæ•°çš„æ•°æ®æœ‰äºŒä½æ•°ï¼Œé‚£ä¹ˆå­—ç¬¦å˜é‡åªèƒ½å½•å…¥åä½æ•°å­—ï¼Œæˆ–è€…å°±å‡ºé”™ï¼Œå‡ºç°æ®µé”™è¯¯. ä¸€å®šè¦ç”¨ string ç„¶å <code>stoi</code>, ä¸èƒ½ç”¨ char.</p><p>ç„¶åè¿˜æœ‰ä¸€ç§<code>è¿è¡Œæ—¶é”™è¯¯</code>, æƒ³è¦é€šè¿‡ set æ‰¾åˆ°æ ¹èŠ‚ç‚¹, ä¸çŸ¥é“ä¸ºä»€ä¹ˆé”™è¯¯.</p><pre><code class="lang-cpp">    {  ...       s.insert(stoi(a));       s.insert(stoi(b));    }   for (int i = 0; i &lt; n; ++i) {  //æ‰¾åˆ°æ ¹èŠ‚ç‚¹       if(s.find(i) == s.end()){           root = i;           break;       }   }</code></pre><p>æ­£ç¡®çš„æ–¹æ³•åº”è¯¥æ˜¯ç”¨æ•°ç»„è¿›è¡Œæ ‡è®°, æ‰¾åˆ° root.</p><pre><code class="lang-cpp">while (have[root] != 0) root++;</code></pre><hr><p><span id="T1131"></span></p><h2 id="TK-1131-åˆ†æ¢¨"><a href="#TK-1131-åˆ†æ¢¨" class="headerlink" title="TK 1131 åˆ†æ¢¨"></a>TK 1131 åˆ†æ¢¨</h2><h3 id="1-é¢˜ç›®å¤§æ„-24"><a href="#1-é¢˜ç›®å¤§æ„-24" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>ç°åœ¨è¦æŠŠMä¸ªæ¢¨å­æ”¾åˆ°Nä¸ªç›˜å­é‡Œé¢ï¼ˆæˆ‘ä»¬å…è®¸ç›˜å­ä¸ºç©ºï¼‰ï¼Œæœ‰å¤šå°‘ç§åˆ†æ³•ï¼Ÿè¯·æ³¨æ„ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªç›˜å­ï¼Œæˆ‘ä»¬å°† 5,1,1 å’Œ 1,1,5ï¼Œè§†ä¸ºåŒä¸€ç§åˆ†æ³•</p><h3 id="2-åˆ†æ-12"><a href="#2-åˆ†æ-12" class="headerlink" title="2.åˆ†æ"></a>2.åˆ†æ</h3><p>å±äºå…¥é—¨ DP, æŒæ¡æ€æƒ³. è®¾ pï¼ˆm,nï¼‰ä¸ºæœ‰mä¸ªæ¢¨å’Œnä¸ªç›˜å­æ—¶çš„æ–¹æ¡ˆæ•°ï¼Œåˆ™å¯åˆ†æƒ…å†µè®¨è®ºè®¾è®¡çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><p>1ï¼šå½“ m &lt; n æ—¶ï¼Œåˆ™å¿…æœ‰ n-m ä¸ªç©ºç›˜å­ï¼Œå› ä¸ºç›˜å­æ— é¡ºåºå¯è¨€ï¼Œå¯ä»¥å¿½ç•¥æ‰é‚£ n-m ä¸ªç©ºç›˜å­, åˆ™å¯æ¨å¾— <code>p(m,n) = p(m,m)</code></p><p>2ï¼šå½“ m&gt;=n æ—¶ï¼Œåˆ™ <code>p(m,n) = p(m-n,n) + p(m,n-1)</code>, <code>p(m-n,n)</code> è¡¨ç¤º <strong>æ²¡æœ‰ä»»ä½•ç©ºç›˜å­</strong>, å°†æ‰€æœ‰ç›˜å­è‡³å°‘æ”¾ä¸€ä¸ªæ¢¨å­, <code>p(m,n-1)</code> è¡¨ç¤º <strong>è‡³å°‘æœ‰ä¸€ä¸ªç›˜å­ä¸ºç©º</strong>, å¤šä¸ªç›˜å­ä¸ºç©ºä¹ŸåŒ…å«åœ¨å†….</p><p>3ï¼šæœ€ç»ˆé€’å½’çš„ç»ˆææ¡ä»¶ä¸ºï¼Œåªæœ‰ä¸€ä¸ªç›˜å­æˆ–è€…æ²¡æœ‰æ¢¨</p><h3 id="ä¸ªäººä»£ç "><a href="#ä¸ªäººä»£ç " class="headerlink" title="ä¸ªäººä»£ç "></a>ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">int Pear(int m, int n){//    if(m == 1 || n == 1 || m == 0 || n == 0) // æ³¨æ„ 1 ä¸ªæ¢¨å­æˆ–è€… 0 ä¸ªç›˜å­, ä¸è¡Œ, å› ä¸ºå¯ä»¥ä¸æ”¾    if(n == 1 || m == 0)   //1 ä¸ªç›˜å­, æˆ–è€… 0 ä¸ªæ¢¨å­, ä¸€å®šä¸º 1        return 1;    if(m &lt; n)        return Pear(m , m);    return Pear(m-n, n) + Pear(m, n-1);}int main(){    int t, m, n;    while (scanf(&quot;%d&quot;, &amp;t) != EOF){        while (t--){            cin &gt;&gt; m &gt;&gt; n;            cout &lt;&lt; Pear(m, n) &lt;&lt; endl;        }    }    return  0;}</code></pre><hr><p><span id="T1132"></span></p><h2 id="TK-1132-æœ€é•¿å…¬å…±å­åºåˆ—-LCS-å…¥é—¨ç»å…¸-DP"><a href="#TK-1132-æœ€é•¿å…¬å…±å­åºåˆ—-LCS-å…¥é—¨ç»å…¸-DP" class="headerlink" title="TK 1132 æœ€é•¿å…¬å…±å­åºåˆ— LCS (å…¥é—¨ç»å…¸ DP)"></a>TK 1132 æœ€é•¿å…¬å…±å­åºåˆ— LCS (å…¥é—¨ç»å…¸ DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-25"><a href="#1-é¢˜ç›®å¤§æ„-25" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>æ ·ä¾‹è¾“å…¥</p><pre><code>abcfbc abfcabprogramming contest abcd mnp</code></pre><p>æ ·ä¾‹è¾“å‡º</p><pre><code>420</code></pre><h3 id="2-åˆ†æ-amp-ä»£ç "><a href="#2-åˆ†æ-amp-ä»£ç " class="headerlink" title="2.åˆ†æ &amp; ä»£ç "></a>2.åˆ†æ &amp; ä»£ç </h3><p>æ³¨æ„ä¸€ä¸ªå‘ç‚¹, ä¸‹æ ‡ä¸€å®šè¦ä» 1 å¼€å§‹. ä»¥åŠæ³¨æ„ä¸€ä¸‹ scanf è¯»å…¥å­—ç¬¦ä¸², æ­¤é¢˜æœ€å¥½ä½¿ç”¨ char[] æ•°ç»„.</p><pre><code class="lang-cpp">char a[110], b[110];  //string æ— æ³•è¯»å…¥int dp[110][110];  //dp[i][j] è¡¨ç¤º A_i å’Œ B_j ä¹‹é—´çš„æœ€é•¿å…¬å…±é•¿åº¦// æ³¨æ„å‘ç‚¹, ä¸‹æ ‡å¿…é¡»ä» 1 å¼€å§‹, å› ä¸ºæ¶‰åŠ dp[i-1] è¿™ç§int main(){    while (scanf(&quot;%s %s&quot;, a+1, b+1) != EOF){  // ä» 1 å¼€å§‹å­˜å‚¨        int lenA=1, lenB=1;        while (a[lenA++] != &#39;\0&#39;);        while (b[lenB++] != &#39;\0&#39;);        lenA -= 2; lenB -= 2;        for (int i = 1; i &lt;= lenA; ++i)            for (int j = 1; j &lt;= lenB; ++j)                if(a[i] == b[j])    // é‡åˆ°å…±åŒå­—ç¬¦ç›´æ¥ +1                    dp[i][j] = dp[i-1][j-1] + 1;                else     //æ²¡æœ‰é‡åˆ°å–æœ€å¤§                    dp[i][j] = max(dp[i-1][j], dp[i][j-1]);        cout &lt;&lt; dp[lenA][lenB] &lt;&lt; endl;    }    return  0;}</code></pre><p>é™„: å¦‚æœæ²¡æœ‰ç»™å®šæ•°æ®èŒƒå›´, å¯ä»¥ä½¿ç”¨äºŒç»´ vector åš dp æ•°ç»„</p><pre><code class="lang-cpp">int len1 = s1.length();int len2 = s2.length();vector&lt;vector&lt;int&gt;&gt;dp;dp.resize(len1);for (int i = 0; i &lt; len1; i++)    dp[i].resize(len2);</code></pre><hr><p><span id="T5578"></span></p><h2 id="TK-5578-æœ€å¤§çº¦æ•°å’Œ-DP"><a href="#TK-5578-æœ€å¤§çº¦æ•°å’Œ-DP" class="headerlink" title="TK 5578 æœ€å¤§çº¦æ•°å’Œ (DP)"></a>TK 5578 æœ€å¤§çº¦æ•°å’Œ (DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-26"><a href="#1-é¢˜ç›®å¤§æ„-26" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>[é—®é¢˜æè¿°] é€‰å–<code>å’Œ</code>ä¸è¶…è¿‡Sçš„è‹¥å¹²ä¸ªä¸åŒçš„æ­£æ•´æ•°ï¼Œä½¿å¾—æ‰€æœ‰æ•°çš„çº¦æ•°ï¼ˆä¸å«å®ƒæœ¬èº«ï¼‰ä¹‹å’Œæœ€å¤§. è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°Sè¾“å‡ºæœ€å¤§çš„çº¦æ•°ä¹‹å’Œ<br>[æ ·ä¾‹è¾“å…¥]<br>11<br>[æ ·ä¾‹è¾“å‡º]<br>9<br>[æ ·ä¾‹è¯´æ˜]<br>å–æ•°å­—4å’Œ6ï¼Œå¯ä»¥å¾—åˆ°æœ€å¤§å€¼(1+2)+(1+2+3) = 9</p><h3 id="2-ä¸ªäººä»£ç -4"><a href="#2-ä¸ªäººä»£ç -4" class="headerlink" title="2.ä¸ªäººä»£ç "></a>2.ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">int a[1005], dp[1005];   // dp[i] è¡¨ç¤º &lt;= i çš„æœ€å¤§çº¦æ•°å’Œint main(){    int s;    cin &gt;&gt; s;    for (int i = 1; i &lt;= s; ++i)        for (int j = 1; j &lt;= i/2; ++j)            if(i % j == 0) dp[i] += j; // å¦‚æœ j æ˜¯ i çš„çº¦æ•°ä¹‹ä¸€    for (int i = 1; i &lt;= s; ++i) {        for (int j = 1; j &lt;= i/2; ++j) {            dp[i] = max(dp[i], dp[j] + dp[i-j]);  // æ¯ä¸€å¯¹ä¸è¶…è¿‡ s çš„å’Œéƒ½è®¡ç®—è¿‡        }    }    cout &lt;&lt; dp[s];    return  0;}</code></pre><hr><p><span id="T5579"></span></p><h2 id="TK-5579-ç¯å½¢çŸ³å­åˆå¹¶-åŒºé—´-DP"><a href="#TK-5579-ç¯å½¢çŸ³å­åˆå¹¶-åŒºé—´-DP" class="headerlink" title="TK 5579 ç¯å½¢çŸ³å­åˆå¹¶ (åŒºé—´ DP)"></a>TK 5579 ç¯å½¢çŸ³å­åˆå¹¶ (åŒºé—´ DP)</h2><h3 id="1-é¢˜ç›®å¤§æ„-27"><a href="#1-é¢˜ç›®å¤§æ„-27" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>çŸ³å­åˆå¹¶é—®é¢˜çš„ä¸‰ç§ç±»å‹: ä»»æ„åˆå¹¶/ç›¸é‚»åˆå¹¶/ç¯å½¢åˆå¹¶. <a href="#https://blog.csdn.net/qq_40507857/article/details/81266843">è¯¦æƒ…é“¾æ¥ğŸ‘†</a><br><strong>ç¯å½¢åˆå¹¶</strong>: åœ¨ä¸€ä¸ª<code>åœ†å½¢</code>æ“åœºçš„å››å‘¨æ‘†æ”¾ç€ n å †çŸ³å­. ç°è¦å°†çŸ³å­æœ‰æ¬¡åºåœ°åˆå¹¶æˆä¸€å †. è§„å®šæ¯æ¬¡åªèƒ½æŠŠ<code>ç›¸é‚»</code>çš„ 2 å †çŸ³å­åˆå¹¶æˆæ–°çš„ä¸€å †ï¼Œå¹¶å°†æ–°çš„ä¸€å †çŸ³å­æ•°è®°ä¸ºè¯¥æ¬¡åˆå¹¶çš„å¾—åˆ†.<br>è¯•è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œè®¡ç®—å‡ºå°†nå †çŸ³å­åˆå¹¶æˆä¸€å †çš„æœ€å°å¾—åˆ†å’Œæœ€å¤§å¾—åˆ†.</p><h3 id="2-å…³é”®æ€è·¯"><a href="#2-å…³é”®æ€è·¯" class="headerlink" title="2.å…³é”®æ€è·¯"></a>2.å…³é”®æ€è·¯</h3><pre><code class="lang-cpp">const int maxn = 210;  // a1...an a1...an å¤åˆ¶ä¸ºä¸¤ä¸ªint sum[maxn][maxn], min_dp[maxn][maxn], max_dp[maxn][maxn];//sum[i][j] è¡¨ç¤º i åˆ° j çš„çŸ³å­æ€»å’Œ,  dp[i][j] è¡¨ç¤º i åˆ° j çš„æ€»ä»£ä»·</code></pre><p>ä» i åˆ° j åˆå¹¶çš„ä»£ä»·/å¾—åˆ†ä¸º: i åˆ° j çš„æ€»çŸ³å­æ•° + i~k çš„å¾—åˆ† + k+1~j çš„å¾—åˆ†<br>å¯¹äºåŒºé—´DPï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ä¸€ä¸ªå¾ªç¯æšä¸¾åŒºé—´çš„é•¿åº¦ï¼Œä¸€ä¸ªå¾ªç¯æšä¸¾åŒºé—´çš„å·¦ç«¯ç‚¹.<br>éå†æ–¹å¼: ä¸‰å±‚éå†, åŒºé—´é•¿åº¦ -&gt; åŒºé—´èµ·ç‚¹ -&gt; åŒºé—´åˆ†å‰²ç‚¹</p><h3 id="3-ä¸ªäººä»£ç -11"><a href="#3-ä¸ªäººä»£ç -11" class="headerlink" title="3.ä¸ªäººä»£ç "></a>3.ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">int main(){    int n, x, min_sc=inf, max_sc=0;    cin &gt;&gt; n;    fill(min_dp[0], min_dp[0] + maxn*maxn, inf);  // é»˜è®¤è·ç¦»ä¸ºæœ€å¤§, æ–¹ä¾¿å– min    for (int i = 1; i &lt;= n; ++i) {        cin &gt;&gt; x;        sum[i][i] = sum[i+n][i+n] = x;        min_dp[i][i] = min_dp[i+n][i+n] = 0;    }    for (int len = 1; len &lt; n; ++len) {  //åŒºé—´é•¿åº¦        for (int i = 1; i &lt;= 2*n &amp;&amp; i+len &lt;= 2*n; ++i) {    //åŒºé—´èµ·ç‚¹            int j = i+len;                  //åŒºé—´ç»ˆç‚¹            for (int k = i; k &lt; j; ++k) {  //åŒºé—´åˆ†å‰²ç‚¹                sum[i][j] = sum[i][k] + sum[k+1][j];                min_dp[i][j] = min(min_dp[i][j], min_dp[i][k]+min_dp[k+1][j] + sum[i][j]);   //æ›´æ–°æœ€å°å¾—åˆ†                max_dp[i][j] = max(max_dp[i][j], max_dp[i][k]+max_dp[k+1][j] + sum[i][j]);   //æ›´æ–°æœ€å¤§å¾—åˆ†            }            if(len == n-1){                min_sc = min(min_sc, min_dp[i][j]);   //æ²‰æ·€å‡º i~j çš„æœ€å°å€¼                max_sc = max(max_sc, max_dp[i][j]);   //æ²‰æ·€å‡º i~j çš„æœ€å¤§å€¼            }        }    }    cout &lt;&lt; min_sc &lt;&lt; endl;    cout &lt;&lt; max_sc &lt;&lt; endl;    return  0;}</code></pre><h3 id="3-ç±»ä¼¼é—®é¢˜"><a href="#3-ç±»ä¼¼é—®é¢˜" class="headerlink" title="3.ç±»ä¼¼é—®é¢˜"></a>3.ç±»ä¼¼é—®é¢˜</h3><p>åŒºé—´åŠ¨å½’: <a href="https://blog.csdn.net/A_Comme_Amour/article/details/78477488" target="_blank" rel="noopener">é‚®å±€é—®é¢˜</a><br>æ ‘å½¢åŒºé—´åŠ¨å½’: <a href="https://blog.csdn.net/qq_41205417/article/details/95939090" target="_blank" rel="noopener">åŠ åˆ†äºŒå‰æ ‘</a></p><h4 id="ä¹˜ç§¯æœ€å¤§"><a href="#ä¹˜ç§¯æœ€å¤§" class="headerlink" title="ä¹˜ç§¯æœ€å¤§"></a>ä¹˜ç§¯æœ€å¤§</h4><p>è®¾æœ‰ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°å­—ä¸²ï¼Œè¦æ±‚é€‰æ‰‹ä½¿ç”¨Kä¸ªä¹˜å·å°†å®ƒåˆ†æˆK+1ä¸ªéƒ¨åˆ†ï¼Œæ‰¾å‡ºä¸€ç§åˆ†æ³•ï¼Œä½¿å¾—è¿™K+1ä¸ªéƒ¨åˆ†çš„ä¹˜ç§¯æœ€å¤§.<br>åŒæ—¶ï¼Œä¸ºäº†å¸®åŠ©é€‰æ‰‹èƒ½å¤Ÿæ­£ç¡®ç†è§£é¢˜æ„ï¼Œä¸»æŒäººè¿˜ä¸¾äº†å¦‚ä¸‹çš„ä¸€ä¸ªä¾‹å­ï¼š<br>æœ‰ä¸€ä¸ªæ•°å­—ä¸²ï¼š312ï¼Œ å½“N=3ï¼ŒK=1æ—¶ä¼šæœ‰ä»¥ä¸‹ä¸¤ç§åˆ†æ³•ï¼š<br>1ï¼‰3<em>12=36<br>2ï¼‰31</em>2=62<br>è¿™æ—¶ï¼Œç¬¦åˆé¢˜ç›®è¦æ±‚çš„ç»“æœæ˜¯ï¼š31*2=62</p><ul><li><p>åŒºé—´ DP</p><pre><code class="lang-cpp">int dp[50][50], num[50][50], a[50];//num[i][j]è¡¨ç¤º i~j å¯¹åº”çš„æ•°å€¼, dp[i][k]è¡¨ç¤º k ä¸ªä¹˜å·, åˆ° i ä¸ºæ­¢çš„æœ€å¤§ä¹˜ç§¯</code></pre><p>å…³é”®: åˆå§‹åŒ–, <code>num[i][i]</code> å°±æ˜¯åŸæ¥çš„æ•°å­—, <code>dp[i][0] = num[1][i]</code> ä¹˜å·ä¸ªæ•°ä¸º 0 æ—¶, åˆ° i ä½ç½®çš„æœ€å¤§ä¹˜ç§¯å°±æ˜¯ 1~i è¡¨ç¤ºçš„æ•°å­—æœ¬èº«. <code>dp[i][k] = max(dp[i][k], dp[j][k-1]*num[j+1][i])</code>  ä¹˜å·ä¹‹å‰ $\times$ ä¹˜å·ä¹‹å</p><pre><code class="lang-cpp">int main(){  int n, m, k, maxn=-1; cin &gt;&gt; n &gt;&gt; m;  string str; cin &gt;&gt; str;  for (int i = 1; i &lt;= n; i++){      a[i] = str[i-1]-&#39;0&#39;;      num[i][i] = a[i];  }  for (int i = 1; i &lt; n; ++i)      for (int j = i+1; j &lt;= n; ++j)          num[i][j] = num[i][j-1]*10 + a[j];  fill(dp[0], dp[0]+50*50, 0);  for (int i = 1; i &lt;= n; ++i)      dp[i][0] = num[1][i];   //æ²¡æœ‰ä¹˜å·çš„æ—¶å€™, ç”¨äºä¸‹é¢ dp[i][k-1] åˆå§‹åŒ–  for (int k = 1; k &lt;= m; ++k) {            //ä¹˜å·ä¸ªæ•°k      for (int i = 1; i &lt;= n; ++i) {        //ç»ˆç‚¹ä½ç½®, åˆ° i ä¸ºæ­¢çš„æœ€å¤§ä¹˜ç§¯          for (int j = 1; j &lt; i; ++j) {     //ä¹˜å·ä½ç½®j, j ä¹‹å‰çš„æœ€å¤§ä¹˜ç§¯dp[j][k-1], j ä»¥åçš„æ•°å­— num[j+1][i]              dp[i][k] = max(dp[i][k], dp[j][k-1]*num[j+1][i]);  //ä¹˜å·ä¹‹å‰ x ä¹˜å·ä¹‹å          }      }  }  cout &lt;&lt; dp[n][m];  return  0;}</code></pre></li></ul><hr><p><span id="NK-ctgc"></span></p><h2 id="NK-ç•…é€šå·¥ç¨‹-å¹¶æŸ¥é›†-æœ€å°ç”Ÿæˆæ ‘-Kruscal-ç®—æ³•"><a href="#NK-ç•…é€šå·¥ç¨‹-å¹¶æŸ¥é›†-æœ€å°ç”Ÿæˆæ ‘-Kruscal-ç®—æ³•" class="headerlink" title="NK-ç•…é€šå·¥ç¨‹ (å¹¶æŸ¥é›†, æœ€å°ç”Ÿæˆæ ‘ Kruscal ç®—æ³•)"></a>NK-ç•…é€šå·¥ç¨‹ (å¹¶æŸ¥é›†, æœ€å°ç”Ÿæˆæ ‘ Kruscal ç®—æ³•)</h2><h3 id="1-é¢˜ç›®å¤§æ„-28"><a href="#1-é¢˜ç›®å¤§æ„-28" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>ç»™å®šæ‘åº„ä¸¤ä¸¤ä¹‹é—´çš„è·ç¦», è¾“å‡ºæ‰€æœ‰æ‘åº„è¿é€šçš„æœ€å°é•¿åº¦.</p><p>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„ç¬¬1è¡Œç»™å‡ºè¯„ä¼°çš„é“è·¯æ¡æ•° Nã€æ‘åº„æ•°ç›®M (N, M &lt; =100 )ï¼›éšåçš„ N è¡Œå¯¹åº”æ‘åº„é—´é“è·¯çš„æˆæœ¬ï¼Œæ¯è¡Œç»™å‡ºä¸€å¯¹æ­£æ•´æ•°ï¼Œåˆ†åˆ«æ˜¯ä¸¤ä¸ªæ‘åº„çš„ç¼–å·ï¼Œä»¥åŠæ­¤ä¸¤æ‘åº„é—´é“è·¯çš„æˆæœ¬ï¼ˆä¹Ÿæ˜¯æ­£æ•´æ•°ï¼‰. ä¸ºç®€å•èµ·è§ï¼Œæ‘åº„ä»1åˆ°Mç¼–å·. å½“Nä¸º0æ—¶ï¼Œå…¨éƒ¨è¾“å…¥ç»“æŸ.</p><p>æ ·ä¾‹:</p><pre><code>3 31 2 11 3 22 3 41 32 3 20 100------3?</code></pre><h3 id="2-åˆ†æ-13"><a href="#2-åˆ†æ-13" class="headerlink" title="2.åˆ†æ"></a>2.åˆ†æ</h3><p>æ­¤é¢˜ä¸å»ºè®®ç”¨ç®€å•çš„ dfs æ¥åš, ä¼šå¾ˆéº»çƒ¦. å› ä¸ºæ¯æ¬¡ dfs éƒ½è¦é‡æ–°è®¾ç½® visit æ•°ç»„, è¦æŠŠæ¯ä¸€ä¸ªæ‘åº„ä¾æ¬¡ä½œä¸º dfs çš„èµ·ç‚¹, æ¯”è¾ƒæœ€å°çš„é•¿åº¦, æ•ˆç‡å¾ˆä½. ä½¿ç”¨ g[a][b]+é‚»æ¥è¡¨+visit æ•°ç»„çš„è€ä¸‰æ ·æ­é…, ä¸çµäº†, è€Œä¸”æ•°ç»„è¶Šç•Œ.</p><p>æ­¤é¢˜æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»å…¸ç®€å•çš„ç®—æ³•â€”<code>å¹¶æŸ¥é›†</code>, æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä½¿ç”¨ä¸€ä¸ª Father æ•°ç»„, <code>Father[i] = x</code> è¡¨ç¤º i çš„çˆ¶äº²æ˜¯ x, <code>Father[i] = x</code> è¡¨ç¤º i æ˜¯æ ¹èŠ‚ç‚¹. </p><p>å¹¶æŸ¥é›†å’Œæœ€å°è·¯å¾„é—®é¢˜æ˜¯å¤©ç„¶æ­é…, åªéœ€æ¯æ¬¡ Union æ“ä½œ, å°±èƒ½è¡¨ç¤ºåŠ å…¥äº†ä¸€æ¡æ–°çš„è¾¹. å¿…é¡»è¦ä¿è¯æ²¡æœ‰åœ¨åŒä¸€é¢—æ ‘ç§, ä¸æ˜¯åŒä¸€ä¸ª root, æ‰èƒ½è¿›è¡Œ Union, å¯ä»¥ä¿è¯è®¿é—®è¿‡çš„ä¸ä¼šå†è®¿é—®.</p><p>ä¸€æ¬¡å¾ªç¯éå†æ‰€æœ‰è¾¹, å¦‚æœåˆšå¥½æ‰€æœ‰ç‚¹éƒ½ Union åˆ°äº†åŒä¸€æ£µæ ‘ä¸­, è¡¨ç¤ºå›¾æ˜¯è¿é€šçš„. å¦‚æœè¿˜æœ‰åˆ«çš„æ ‘å•ç‹¬åœ¨å¤–, è¡¨ç¤ºéè¿é€š.</p><p>å› ä¸ºç»™å®šæ‰€æœ‰è¾¹çš„ä¿¡æ¯, æ­¤é¢˜çš„æœ€å°ç”Ÿæˆæ ‘é—®é¢˜é‡‡ç”¨ Kruscal ç®—æ³•, ç›´æ¥æŒ‰è¾¹æ’åº, æ¯æ¬¡ç›´æ¥æ‰¾æœ€çŸ­çš„è¾¹.</p><h3 id="3-ä¸ªäººä»£ç -12"><a href="#3-ä¸ªäººä»£ç -12" class="headerlink" title="3.ä¸ªäººä»£ç "></a>3.ä¸ªäººä»£ç </h3><pre><code class="lang-cpp">#include &lt;iostream&gt;#include &lt;algorithm&gt;#define N 101using namespace std;int Father[N];struct Path{    int city1;    int city2;    int cost;}buf[N];bool cmp(Path p1,Path p2) { return p1.cost&lt;p2.cost;int findRoot(int x){    if(Father[x]==-1)return x;    else {        int tmp;        tmp = findRoot(Father[x]);        Father[x] = tmp;        return tmp;    }}int main(){    int n,m;    int a,b;    while(scanf(&quot;%d&quot;,&amp;n)!=EOF){        if(n==0)break;        for(int i=0;i&lt;N;i++){            Father[i]=-1;   //å…¨éƒ¨åˆå§‹åŒ–ä¸º -1. çœ‹åšéƒ½æ˜¯å­¤ç«‹çš„é›†åˆ        }        scanf(&quot;%d&quot;,&amp;m);        for(int i=0;i&lt;n;i++){            scanf(&quot;%d%d%d&quot;,&amp;buf[i].city1,&amp;buf[i].city2,&amp;buf[i].cost);        }        sort(buf,buf+n,cmp);  //ä»æœ€çŸ­çš„è·¯å¼€å§‹æ‰¾        int TotalCost = 0;        for(int i=0;i&lt;n;i++){            int rootA = findRoot(buf[i].city1);            int rootB = findRoot(buf[i].city2);            if(rootA!=rootB){//è‹¥ç›®å‰ä¸åœ¨ä¸€ä¸ªé›†åˆå†…(ä¸æ˜¯åŒä¸€ä¸ªçˆ¶äº²) å¯ä»¥ä¿è¯è®¿é—®è¿‡çš„ä¸ä¼šå†è®¿é—®)                Father[rootA] = rootB;//æŠŠé›†åˆAæ”¾å…¥Bä¸­ Union æ“ä½œ                TotalCost+=buf[i].cost;            }        }        int cnt=0;        for(int i=1;i&lt;=m;i++){            if(Father[i]==-1){   //ç»Ÿè®¡æ ¹èŠ‚ç‚¹çš„æ•°é‡                cnt++;            }        }        if(cnt&lt;=1)            printf(&quot;%d\n&quot;,TotalCost);        else//æ— æ³•æ„æˆæœ€å°ç”Ÿæˆæ ‘            printf(&quot;?\n&quot;);    }    return 0;}</code></pre><h3 id="4-è¡¥å……"><a href="#4-è¡¥å……" class="headerlink" title="4.è¡¥å……"></a>4.è¡¥å……</h3><p>æœ¬é¢˜çš„å¹¶æŸ¥é›†æ–¹æ³•, ä¹Ÿå¯ä»¥ç”¨æ¥ç»Ÿè®¡è¿é€šåˆ†é‡çš„ä¸ªæ•°, åªéœ€æœ€å <code>if(tree[i]==-1) ans++;</code> è®¡ç®—æ ‘çš„ä¸ªæ•°å³å¯.</p><hr><p><span id="NK-jzzh"></span></p><h2 id="NK-è¿›åˆ¶è½¬æ¢-10è¿›åˆ¶-VS-2è¿›åˆ¶"><a href="#NK-è¿›åˆ¶è½¬æ¢-10è¿›åˆ¶-VS-2è¿›åˆ¶" class="headerlink" title="NK-è¿›åˆ¶è½¬æ¢ 10è¿›åˆ¶ VS 2è¿›åˆ¶"></a>NK-è¿›åˆ¶è½¬æ¢ 10è¿›åˆ¶ VS 2è¿›åˆ¶</h2><p>(ä»»æ„é•¿åº¦å­—ç¬¦ä¸²è¿›åˆ¶è½¬æ¢: å¯å–ç”¨å‡½æ•°)</p><h3 id="1-é¢˜ç›®å¤§æ„-29"><a href="#1-é¢˜ç›®å¤§æ„-29" class="headerlink" title="1.é¢˜ç›®å¤§æ„"></a>1.é¢˜ç›®å¤§æ„</h3><p>å¯¹äºä¸€ä¸ªåè¿›åˆ¶æ•°Aï¼Œå°†Aè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œç„¶åæŒ‰ä½é€†åºæ’åˆ—ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶æ•°Bï¼Œæˆ‘ä»¬ç§°Bä¸ºAçš„äºŒè¿›åˆ¶é€†åºæ•°.<br>ä¾‹å¦‚å¯¹äºåè¿›åˆ¶æ•°173ï¼Œå®ƒçš„äºŒè¿›åˆ¶å½¢å¼ä¸º10101101ï¼Œé€†åºæ’åˆ—å¾—åˆ°10110101ï¼Œå…¶åè¿›åˆ¶æ•°ä¸º181ï¼Œ181å³ä¸º173çš„äºŒè¿›åˆ¶é€†åºæ•°.</p><h3 id="2-ä¸ªäººä»£ç -5"><a href="#2-ä¸ªäººä»£ç -5" class="headerlink" title="2.ä¸ªäººä»£ç "></a>2.ä¸ªäººä»£ç </h3><p>çœŸæ­£æ— æƒ§æº¢å‡ºçš„è¿›åˆ¶è½¬æ¢. åœ¨å­—ç¬¦ä¸²ä¸Šç›´æ¥è¿›è¡Œé™¤æ³•, æ— éœ€ int å­˜å‚¨.<br>æ— æƒ§æ•°ç»„è¶Šç•Œ, ä¸éœ€è¦è®¾å®šå­—ç¬¦æ•°ç»„é•¿åº¦.</p><pre><code class="lang-cpp">string conversion(int m, string a, int n){  //æ•°å­—å­—ç¬¦ä¸² a ä» m è¿›åˆ¶è½¬æ¢ä¸º n è¿›åˆ¶    int len = a.length(), last_rem = 0;    string res;    for (int i = 0; i &lt; len;) {           //æœ¬å¾ªç¯åŠŸèƒ½: åšå­—ç¬¦ä¸²é™¤æ³•, æ¯æ¬¡é™¤ä»¥ n        last_rem = 0;   //å¼€å§‹äº†æ–°ä¸€è½®è®¡ç®—, ä½™æ•°åªæ˜¯ä¸ºäº†æ·»åŠ åˆ°ç»“æœä¸­, æ¯æ¬¡ä¸€å®šè¦é‡æ–°ç½® 0        for (int j = i; j &lt; len; ++j) {   //æ¯æ¬¡ä» ä¸ä¸º 0 çš„æœ€é«˜ä½å¼€å§‹å¾€å            int cur_rem = (a[j] - &#39;0&#39; + last_rem * m) % n; //æ±‚ä½™æ•°, ä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨            a[j] = (a[j] - &#39;0&#39; + last_rem * m) / n + &#39;0&#39;;  //æ›¿æ¢æ‰ a[j]            last_rem = cur_rem;        }        res = char(last_rem + &#39;0&#39;) + res;        while (a[i] == &#39;0&#39;) i++;   //è·³è¿‡é«˜ä½çš„ 0, å³ 086 -&gt; 86 ç›´æ¥è®¡ç®—    }    return res;}</code></pre><hr><p><span id="dp-set"></span></p><h2 id="åŠ¨æ€è§„åˆ’å¸¸è§é—®é¢˜åˆé›†"><a href="#åŠ¨æ€è§„åˆ’å¸¸è§é—®é¢˜åˆé›†" class="headerlink" title="åŠ¨æ€è§„åˆ’å¸¸è§é—®é¢˜åˆé›†"></a>åŠ¨æ€è§„åˆ’å¸¸è§é—®é¢˜åˆé›†</h2><pre><code class="lang-c++">(1)æœ€é•¿é€’å¢å­åºåˆ—åŸç†ï¼šf[1]=1f[i]=max(1,f[j]+1)(j&lt;i,v[j]&lt;v[i])f[i]è¡¨ç¤ºé€’å¢å­åºåˆ—ä»¥v[i]ç»“æŸæ—¶å®ƒçš„æœ€é•¿é•¿åº¦#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;int main() {    vector&lt;int&gt;v{ 0,2,3,4,4,3,2,5,34,4,6,123 };    vector&lt;int&gt;num;    num.resize(v.size());    num[0] = 1;    for (int i = 2; i &lt; v.size(); i++) {        vector&lt;int&gt;n;        n.push_back(1);        for (int j = 0; j &lt; i; j++)            if (v[j] &lt;= v[i])                n.push_back(num[j] + 1);        num[i] = *max_element(n.begin(), n.end());    }    cout &lt;&lt; *max_element(num.begin(), num.end())&lt;&lt;endl;    return 0;}(2)æœ€é•¿å…¬å…±å­åºåˆ—åŸç†ï¼šdp[i][j]è¡¨ç¤ºs1å‰iä¸ªå­—ç¬¦å’Œs2å‰jä¸ªå­—ç¬¦ç»„æˆçš„ä¸¤ä¸ªå‰ç¼€å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²é•¿åº¦dp[0][i]=0(0=&lt;i&lt;=m)dp[j][0]=0(0=&lt;j&lt;=n)dp[i][j]=dp[i-1][j-1]+1 (s[i]==s[j])dp[i][j]=max{dp[i-1][j],dp[i][j-1]} (s[i]!=s[j])    #include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;string&gt;#include&lt;algorithm&gt;using namespace std;int main() {    string s1 = &quot;asdfuuu&quot;;    string s2 = &quot;dfummm&quot;;    vector&lt;vector&lt;int&gt;&gt;dp;    int m = s1.length();    int n = s2.length();    dp.resize(m + 1);    for (int i = 0; i &lt;= m; i++)        dp[i].resize(n + 1);    for (int i = 0; i &lt;= m; i++)        dp[i][0] = 0;    for (int j = 0; j &lt;= n; j++)        dp[0][j] = 0;    for (int i = 1; i &lt;= m; i++)        for (int j = 1; j &lt;= n; j++)            if (s1[i] == s2[j])                dp[i][j] = dp[i - 1][j - 1] + 1;            else                dp[i][j] = max(dp[i - 1][j], dp[i][j - 1]);    cout &lt;&lt; dp[m][n] &lt;&lt; endl;    return 0;}(3)æœ€é•¿è¿ç»­å…¬å…±å­åºåˆ—åŸç†ï¼šdp[i][j]è¡¨ç¤ºä»¥s1[i]ï¼Œs2[j]ä¸ºç»“å°¾çš„å­—ç¬¦ä¸²çš„å…¬å…±é•¿åº¦#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;string&gt;#include&lt;algorithm&gt;using namespace std;int main() {    string s1 = &quot;asdfuuuu&quot;;    string s2 = &quot;dfuummm&quot;;    vector&lt;vector&lt;int&gt;&gt;dp;    int m = s1.length();    int n = s2.length();    dp.resize(m + 1);    for (int i = 0; i &lt;= m; i++)        dp[i].resize(n + 1);    for (int i = 0; i &lt;= m; i++)        dp[i][0] = 0;    for (int j = 0; j &lt;= n; j++)        dp[0][j] = 0;    for (int i = 1; i &lt;= m; i++)        for (int j = 1; j &lt;= n; j++)            if (s1[i-1] == s2[j-1])                dp[i][j] = dp[i - 1][j - 1] + 1;    int max = -1;    for (int i = 1; i &lt;= m; i++)        for (int j = 1; j &lt;= n; j++)            if (dp[i][j] &gt; max)                max = dp[i][j];    cout &lt;&lt; max &lt;&lt; endl;    return 0;}(4)æœ€å¤§è¿ç»­å­åºåˆ—çš„å’ŒåŸç†ï¼šdp[i]è¡¨ç¤ºä»¥ç¬¬iä¸ªæ•°å­—ä¸ºç»“å°¾çš„è¿ç»­å­åºåˆ—çš„å’Œdp[i]=max{dp[i-1]+a[i],a[i]}ç¤ºä¾‹ç¨‹åº:#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;int main() {    vector&lt;int&gt;v{ 1,2,3,-5,3,5,2,-7 };    vector&lt;int&gt;sum;    sum.resize(8);    sum[0] = v[0];    for (int i = 1; i &lt; v.size(); i++)        sum[i] = max(sum[i - 1] + v[i], v[i]);    cout &lt;&lt; *max_element(sum.begin(), sum.end());    return 0;}(5)æœ€å¤§å­åºåˆ—å’Œint findMaxSum(vector&lt;int&gt;v){    int sum=0;    int maxSum=0;    for(int i=0;i&lt;v.size();i++){        sum+=v[i];        if(sum&gt;maxSum)            maxSum=sum;        else if(sum&lt;0)            sum=0;    }    cout&lt;&lt;maxSum&lt;&lt;endl;}(7)æœ€å¤§å­åºåˆ—å’Œï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé™å®šæœ€å¤§å€¼ï¼Œå°±è½¬æ¢ä¸ºåŠ¨æ€è§„åˆ’é—®é¢˜ä¸­çš„èƒŒåŒ…é—®é¢˜å¯¹äºæ¯ä¸ªå˜é‡æ¥è¯´ï¼Œå®ƒçš„valueåŒæ—¶ä¹Ÿæ˜¯å®ƒçš„costdp[i][j] = max(dp[i - 1][j], dp[i - 1][j - intValue[i]] + intValue[i]);å½“é‡åˆ°èƒŒåŒ…ä¸­çš„å€¼ä¸ºdoubleç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥å°†å…¶ä¹˜ä»¥10çš„æ¬¡æ–¹ï¼Œè½¬æ¢ä¸ºæ•´æ•°(6)0-1èƒŒåŒ…é—®é¢˜è¦æ³¨æ„vector&lt;vector&lt;int&gt;&gt;dpçš„æ—¶å€™ä¸ä¸€å®šæ˜¯0ï¼ï¼ï¼ï¼Œå¿…é¡»è¦åˆå§‹åŒ–åŸç†ï¼šdp[i][j]è¡¨ç¤ºæ€»ä½“ç§¯ä¸è¶…è¿‡jçš„æ¡ä»¶ä¸‹ï¼Œå‰iä»¶ç‰©å“å¯ä»¥è¾¾åˆ°çš„æœ€å¤§ä»·å€¼ç‚¹èœé—®é¢˜ï¼š#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;class Node {public:    int value;    int cost;};int main() {    vector&lt;Node&gt;v;    vector&lt;vector&lt;int&gt;&gt;dp;    int n;    int cost;    while (cin &gt;&gt;cost&gt;&gt; n) {        v.clear();        dp.clear();        v.resize(0);        dp.resize(0);        v.resize(n + 1);        for (int i = 1; i &lt;= n; i++)            cin &gt;&gt; v[i].cost &gt;&gt; v[i].value;        dp.resize(n + 1);        for (int i = 0; i &lt;= n; i++)            dp[i].resize(cost+1);        //è¿™é‡Œå½“æ—¶è°ƒè¯•äº†å‡ æ¬¡ï¼Œç”±äºå°†costå†™ä¸ºnçš„åŸå› ï¼Œåˆå§‹åŒ–è¿‡ç¨‹å¿…ä¸å¯å°‘        for (int i = 0; i &lt;= cost; i++)dp[0][i] = 0;        for (int i = 1; i &lt;= n; i++) {            for (int j = cost; j &gt;= v[i].cost; j--)                //dp[i][j]è¡¨ç¤ºåœ¨æ€»ä½“ç§¯ä¸è¶…è¿‡jçš„æƒ…å†µä¸‹ï¼Œå‰iä¸ªç‰©ä½“å¯ä»¥è¾¾åˆ°çš„æœ€å¤§ä»·å€¼                dp[i][j] = max(dp[i - 1][j - v[i].cost] + v[i].value, dp[i - 1][j]);            for (int j = v[i].cost - 1; j &gt;= 0; j--)                dp[i][j] = dp[i - 1][j];        }        cout &lt;&lt; dp[n][cost] &lt;&lt; endl;    }    return 0;}</code></pre><hr><p><span id="NK-dcth"></span></p><h2 id="NK-å•è¯æ›¿æ¢"><a href="#NK-å•è¯æ›¿æ¢" class="headerlink" title="NK-å•è¯æ›¿æ¢"></a>NK-å•è¯æ›¿æ¢</h2><ol><li><p>é¢˜ç›®å¤§æ„</p><pre><code>You want someone to help youYouI</code></pre><pre><code>I want someone to help you</code></pre></li><li><p>æ ¸å¿ƒä»£ç <br>æ‰‹å†™ split å‡½æ•°, çœå»å­—ç¬¦ä¸²åŒ¹é…çš„éº»çƒ¦</p><pre><code class="lang-C++">void split(string s) { v.clear(); v.resize(0); int index = s.find(&#39; &#39;); while(index!=-1){     v.push_back(s.substr(0, index));     s = s.substr(index+1, s.length() - index - 1);     index = s.find(&#39; &#39;); } v.push_back(s);}</code></pre></li></ol><hr><p><span id="NK-graph"></span></p><h2 id="å›¾ç›¸å…³ç®—æ³•"><a href="#å›¾ç›¸å…³ç®—æ³•" class="headerlink" title="å›¾ç›¸å…³ç®—æ³•"></a>å›¾ç›¸å…³ç®—æ³•</h2><pre><code class="lang-c++">ï¼ˆ1ï¼‰è®¡ç®—è”é€šå­å›¾çš„æ•°ç›®#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;/*    ç»™å‡ºåŸé•‡æ ‡å·ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªåŸé•‡æ˜¯è”é€šçš„    æ±‚å‡ºéœ€è¦å†å»ºå¤šå°‘æ¡è·¯æ‰èƒ½ä½¿å¾—æ‰€æœ‰åŸé•‡è”é€š*/vector&lt;int&gt;tree;    //ç”¨æ¥åŒ…å«æ¯ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹int findRoot(int x) {   //å¯»æ‰¾æ ¹èŠ‚ç‚¹    if (tree[x] == -1)        return x;    else {        int tmp = findRoot(tree[x]);        tree[x] = tmp;        return tmp;    }}int main() {    int n, e;    while (cin &gt;&gt; n &gt;&gt; e) {        tree.clear();        tree.resize(n + 1);        for (int i = 1; i &lt;= n; i++)            tree[i] = -1;        int a, b;        for (int i = 1; i &lt;= e; i++) {            cin &gt;&gt; a &gt;&gt; b;            a = findRoot(a);            b = findRoot(b);            if (a != b)                tree[a] = b;        }        int ans = 0;        for (int i = 1; i &lt;= n; i++)            if (tree[i] == -1)                ans++;        cout &lt;&lt; ans - 1 &lt;&lt; endl;    }    return 0;}ï¼ˆ2ï¼‰æ±‚å‡ºå…·æœ‰æœ€å¤šå…ƒç´ çš„è”é€šå­å›¾çš„ç»“ç‚¹æ•°é‡//æ€è·¯ï¼šæ·»åŠ ä¸€ä¸ªsumæ•°ç»„ï¼Œsum[i]è¡¨ç¤ºä»¥ç¬¬iä¸ªç»“ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„ç»“ç‚¹æ•°ç›®#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;vector&lt;int&gt;tree;    //ç”¨æ¥åŒ…å«æ¯ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹vector&lt;int&gt;sum;     //ç”¨æ¥è¡¨ç¤ºä»¥sum[i]ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘ä¸­ç»“ç‚¹æ•°ç›®int findRoot(int x) {   //å¯»æ‰¾æ ¹èŠ‚ç‚¹    if (tree[x] == -1)        return x;    else {        int tmp = findRoot(tree[x]);        tree[x] = tmp;        return tmp;    }}int main() {    int n;    while (cin &gt;&gt; n ) {        tree.clear();        tree.resize(101);        sum.clear();        sum.resize(101);        for (int i = 1; i &lt;= 100; i++) {            tree[i] = -1;            sum[i] = 1;        }        int a, b;        for (int i = 1; i &lt;= n; i++) {            cin &gt;&gt; a &gt;&gt; b;            a = findRoot(a);            b = findRoot(b);            if (a != b) {                tree[a] = b;                sum[b] += sum[a];            }        }        int max = 0;        for (int i = 1; i &lt;= 100; i++)            if (sum[i] &gt; max)                max = sum[i];        cout &lt;&lt; max &lt;&lt; endl;    }    return 0;}ï¼ˆ3ï¼‰Kruskalç®—æ³•ï¼Œæœ€å°ç”Ÿæˆæ ‘#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;algorithm&gt;using namespace std;/*    é¢˜ç›®ï¼šè¾“å…¥ç»“ç‚¹å’Œè¾¹çš„é•¿åº¦ï¼Œè¾“å‡ºæœ€å°ç”Ÿæˆæ ‘çš„é•¿åº¦    æ³¨æ„ï¼šè¦åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿæ„æˆä¸€ä¸ªè”é€šå›¾*/vector&lt;int&gt;tree;    //ç”¨æ¥åŒ…å«æ¯ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹int findRoot(int x) {   //å¯»æ‰¾æ ¹èŠ‚ç‚¹    if (tree[x] == -1)        return x;    else {        int tmp = findRoot(tree[x]);        tree[x] = tmp;        return tmp;    }}class Edge {public:    int a, b;    int length;    bool operator&lt;(Edge&amp; e) {        return length &lt; e.length;    }};int main() {    int n;    while (cin &gt;&gt; n) {        if (n == 0)            break;        tree.resize(n + 1);        vector&lt;Edge&gt;e;        e.resize(n*(n - 1) / 2);        for (int i = 1; i &lt;= n; i++)            tree[i] = -1;        for (int i = 0; i &lt; e.size(); i++)            cin &gt;&gt; e[i].a &gt;&gt; e[i].b &gt;&gt; e[i].length;        sort(e.begin(), e.end());        int ans = 0;        for (int i = 0; i &lt; e.size(); i++) {            int a = findRoot(e[i].a);            int b = findRoot(e[i].b);            if (a != b) {                tree[a] = b;                ans += e[i].length;            }        }        int num = 0;    //åˆ¤æ–­æ ¹èŠ‚ç‚¹çš„æ•°ç›®ï¼Œå¦‚æœä¸ä¸º1è¯´æ˜è¿™ä¸ªå›¾æ˜¯ä¸è¿é€šçš„        for (int i = 1; i &lt; tree.size(); i++)            if (tree[i] == -1)                num++;        if (num != 1)            cout &lt;&lt; &quot;å›¾æ˜¯ä¸è¿é€šçš„&quot; &lt;&lt; endl;        else            cout &lt;&lt; ans &lt;&lt; endl;    }    return 0;}ï¼ˆ4ï¼‰åˆ¤æ–­ä¸€ä¸ªå›¾æ˜¯å¦å­˜åœ¨ç¯/*    åŸç†ï¼šä¸€ä¸ªæ‹“æ‰‘æ’åºï¼Œç»Ÿè®¡æ¯ä¸ªç»“ç‚¹çš„å…¥åº¦ï¼Œæ¯æ¬¡æ‰¾å‡ºæ¥ä¸€ä¸ªå…¥åº¦ä¸º0çš„ç»“ç‚¹ï¼Œç„¶åå®ƒçš„æ‰€æœ‰å­ç»“ç‚¹        çš„å…¥åº¦å‡1ï¼Œç„¶ååŠ ä¸€ä¸ªæ ‡å¿—ä½ï¼Œé˜²æ­¢è¢«è®¿é—®è¿‡çš„ç»“ç‚¹é‡å¤è¢«æå–å‡ºæ¥*/#include&lt;iostream&gt;#include&lt;vector&gt;#include&lt;queue&gt;using namespace std;class Node {public:    int degree;    bool taken;    vector&lt;int&gt;next;    Node() {        taken = false;        degree = 0;    }};int main() {    int n, m;    while (cin &gt;&gt; n &gt;&gt; m) {        vector&lt;Node&gt;v;        v.resize(n);        int s, e;        for (int i = 1; i &lt;= m; i++) {            cin &gt;&gt; s &gt;&gt; e;            v[s].next.push_back(e);            v[e].degree++;        }        queue&lt;int&gt;q;        int ans = 0;        for (int i = 0; i &lt; n; i++)            if (v[i].degree == 0)                q.push(i);        while (!q.empty()) {            int index = q.front();            v[index].taken = true;            q.pop();            ans++;            for (int i : v[index].next)                v[i].degree--;            for (int i = 0; i &lt; n; i++)                if (v[i].degree == 0 &amp;&amp; v[i].taken == false)                    q.push(i);        }        if (ans != n)            cout &lt;&lt; &quot;å›¾å­˜åœ¨ç¯&quot; &lt;&lt; endl;        else            cout &lt;&lt; &quot;å›¾ä¸å­˜åœ¨ç¯&quot; &lt;&lt; endl;    }    return 0;}</code></pre><hr><p><span id="NK-dzs"></span></p><h2 id="C-å¤§æ•´æ•°-ä¹˜æ³•"><a href="#C-å¤§æ•´æ•°-ä¹˜æ³•" class="headerlink" title="C++å¤§æ•´æ•° - ä¹˜æ³•"></a>C++å¤§æ•´æ•° - ä¹˜æ³•</h2><h3 id="1-é¢˜ç›®æè¿°"><a href="#1-é¢˜ç›®æè¿°" class="headerlink" title="1.é¢˜ç›®æè¿°"></a>1.é¢˜ç›®æè¿°</h3><p>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°Nï¼Œè¾“å‡ºNçš„é˜¶ä¹˜ã€‚<br>è¾“å…¥æè¿°:<br>æ­£æ•´æ•°N(0&lt;=N&lt;=1000)<br>è¾“å‡ºæè¿°:<br>è¾“å…¥å¯èƒ½åŒ…æ‹¬å¤šç»„æ•°æ®ï¼Œå¯¹äºæ¯ä¸€ç»„è¾“å…¥æ•°æ®ï¼Œè¾“å‡ºNçš„é˜¶ä¹˜</p><h3 id="2-é¢˜è§£ä»£ç "><a href="#2-é¢˜è§£ä»£ç " class="headerlink" title="2.é¢˜è§£ä»£ç "></a>2.é¢˜è§£ä»£ç </h3><pre><code class="lang-c++">using namespace std;class BigInteger {public:    vector&lt;int&gt;v;    void set(int x) {        v.clear();        v.resize(0);        do {            v.push_back(x%10000);            x /= 10000;        } while (x != 0);    }    void output() {        for (int i = v.size() - 1; i &gt;= 0; i--) {            if (i != v.size() - 1)                cout &lt;&lt; setw(4) &lt;&lt; setfill(&#39;0&#39;) &lt;&lt; v[i];            else                cout &lt;&lt; v[i];        }        cout &lt;&lt; endl;    }    BigInteger operator*(int x) const{        int jin = 0;        BigInteger res;        for (int i = 0; i &lt; v.size(); i++) {            res.v.push_back((x*v[i] + jin) % 10000);            jin = (x*v[i] + jin) / 10000;        }        if (jin &gt; 0)            res.v.push_back(jin);        return res;    }};int main() {    int N;    while (cin &gt;&gt; N) {        BigInteger a;        a.set(1);        for (int i = 1; i &lt;= N; i++)            a =a* i;        a.output();    }    return 0;}</code></pre><h2 id="C-å¤§æ•´æ•°-å¤§æ•´æ•°çš„å› å­"><a href="#C-å¤§æ•´æ•°-å¤§æ•´æ•°çš„å› å­" class="headerlink" title="C++å¤§æ•´æ•° - å¤§æ•´æ•°çš„å› å­"></a>C++å¤§æ•´æ•° - å¤§æ•´æ•°çš„å› å­</h2><h3 id="1-é¢˜ç›®æè¿°-1"><a href="#1-é¢˜ç›®æè¿°-1" class="headerlink" title="1.é¢˜ç›®æè¿°"></a>1.é¢˜ç›®æè¿°</h3><p>å·²çŸ¥æ­£æ•´æ•°kæ»¡è¶³2&lt;=k&lt;=9ï¼Œç°ç»™å‡ºé•¿åº¦æœ€å¤§ä¸º30ä½çš„åè¿›åˆ¶éè´Ÿæ•´æ•°cï¼Œæ±‚æ‰€æœ‰èƒ½æ•´é™¤cçš„k.</p><h3 id="2-é¢˜è§£ä»£ç -1"><a href="#2-é¢˜è§£ä»£ç -1" class="headerlink" title="2.é¢˜è§£ä»£ç "></a>2.é¢˜è§£ä»£ç </h3><pre><code class="lang-c++">while (cin &gt;&gt; s) {    if (s == &quot;-1&quot;)continue;    vector&lt;int&gt;v;    int flag;    for (int k = 2; k &lt;= 9; k++) {   //å¯¹æ¯ä¸ªå› å­æ•´é™¤        flag = 0;        for (int i = 0; i &lt; s.length(); i++) {   //æ¨¡æ‹Ÿå¤§æ•´æ•°çš„é™¤æ³•, ä»é«˜ä½å¼€å§‹            flag *= 10;            if (flag + (s[i] - &#39;0&#39;) &lt; k)                flag += (s[i] - &#39;0&#39;);            else                flag = (flag + (s[i] - &#39;0&#39;)) % k;        }        if (flag == 0)v.push_back(k);   //flag ä¸º 0 æ‰è¡¨ç¤ºé™¤å°½    }}</code></pre><hr><p><span id="NK-sxzs"></span></p><h2 id="æ‰‡å½¢ç€è‰²é—®é¢˜"><a href="#æ‰‡å½¢ç€è‰²é—®é¢˜" class="headerlink" title="æ‰‡å½¢ç€è‰²é—®é¢˜"></a>æ‰‡å½¢ç€è‰²é—®é¢˜</h2><p>å°†ä¸€ä¸ªåœ†å½¢åˆ†æˆnä¸ªæ‰‡å½¢ï¼Œç°æœ‰mç§æ¶‚æ–™ï¼Œç°åœ¨ç”¨è¿™mç§æ¶‚æ–™å¯¹æ‰‡å½¢è¿›è¡Œç€è‰²ï¼Œè¦æ±‚ç›¸é‚»ä¸¤ä¸ªæ‰‡å½¢çš„é¢œè‰²ä¸èƒ½ç›¸åŒ</p><p>æ€è·¯ï¼š<br>    ç¬¬ä¸€ä¸ªmç§å¯èƒ½ï¼Œç¬¬äºŒä¸ªm-1ç§å¯èƒ½ï¼Œç¬¬nä¸ªm-1ç§å¯èƒ½ï¼Œæ‰€ä»¥ä¸€å…±å°±æ˜¯ <code>m(m-1)^(n-1)</code>ï¼Œä½†æ˜¯ç”±äºç¬¬nä¸ªå¯èƒ½è·Ÿç¬¬ä¸€ä¸ªè¿›è¡Œé‡åˆï¼Œæ‰€ä»¥å°±éœ€è¦å‡å»è¿™ç§æƒ…å†µï¼Œå¯ä»¥è§†ä½œæ˜¯ç¬¬nä¸ªä¸ç¬¬ä¸€ä¸ªæ„æˆä¸€ä¸ªæ‰‡åŒºè¿›è¡Œç€è‰²ï¼Œæ‰€ä»¥å°±æ˜¯ <code>A(n-1,m)</code><br>    æ‰€ä»¥ <code>A(n,m)=m*(m-1)^(n-1)+A(n-1,m)</code></p><p>ç¼–ç¨‹ï¼š</p><pre><code class="lang-cpp">    int count(n,m){        if(n==0||m==0)            return 0;        if(n==1)            return m;        vector&lt;int&gt;v;        v.resize(n+1);        v[1]=m;        v[2]=m*(m-1);        for(int i=3;i&lt;=n;i++)            v[i]=int(m*pow(m-1,i-1)-v[i-1]);        cout&lt;&lt;v[n]&lt;&lt;endl;    }</code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PAT </tag>
            
            <tag> OJ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¬¢è¿æ¥åˆ° Hexo</title>
      <link href="/2020/02/02/hello-world/"/>
      <url>/2020/02/02/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><p>æœ¬åšå®¢é‡‡ç”¨ Hexo å¿«é€Ÿæ­å»ºï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸Šæ‰‹ä½¿ç”¨ Hexoï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼Œçœæ—¶çœåŠ›ï¼Œå·¥å…·é½å…¨ï¼Œç”Ÿæ€ä¼˜è¶Šï¼Œå¯æ‰©å±•æ€§å¥½</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="lang-bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="lang-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="lang-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="lang-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
